import{Q as h,a2 as C,a3 as b,a4 as f,j as e,E as p,a1 as D,Y as V,H as S,a as N,r as m,a0 as j,_ as B,c as r,V as u,d as P}from"./App-gA5x4fi9-_X5yoohI.js";import{G as x}from"./_extensionId._-lbVwWplo.js";import{L as q,S as w,R as E,d as v,i as d}from"./IssueCountsPerSeverityLevel-CXLJVRPn-CgcZ-9iW.js";const _=({children:s})=>e.jsx(B,{className:"my-6",children:s}),z=({imageVersionsPromise:s})=>{const{data:n}=x.use(s),{totalImageVersions:i}=j(n);return i},L=({version:s,selected:n=!1,displayDetailsButton:i=!0,onItemClick:a,onDetailClick:t})=>e.jsxs(N,{onClick:a,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(r,{className:"service-image-versions-cell",children:e.jsxs(u,{gap:"1",direction:"vertical",children:[e.jsxs(u,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(u,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:o=>o.stopPropagation(),children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(P,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(r,{className:"service-image-versions-cell",children:s.tag}),e.jsx(r,{className:"items-center",children:e.jsx("span",{children:s.componentInstancesCount||0})}),e.jsx(r,{className:"items-center !px-2",children:e.jsx(d,{severity:"critical",count:s.issueCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(r,{className:"items-center !px-2",children:e.jsx(d,{severity:"high",count:s.issueCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(r,{className:"items-center !px-2",children:e.jsx(d,{severity:"medium",count:s.issueCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(r,{className:"items-center !px-2",children:e.jsx(d,{severity:"low",count:s.issueCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(r,{className:"items-center !px-2",children:e.jsx(d,{severity:"unknown",count:s.issueCounts.none,tooltipContent:"None Vulnerabilities"})}),i&&e.jsx(r,{children:e.jsx(V,{size:"small",label:"Show Details",onClick:t})})]}),Q=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:i,imageVersionsPromise:a,onDetailsButtonClick:t,onImageVersionItemClick:o})=>{const{error:l,data:I}=x.use(a),{imageVersions:g}=j(I);return l?e.jsx(v,{colSpan:s,children:"Error loading image versions."}):g.length===0?e.jsx(v,{colSpan:s,children:"No image version found"}):g.map(c=>e.jsx(L,{version:c,selected:c.version===n,displayDetailsButton:i,onItemClick:()=>{o?.(c)},onDetailClick:k=>{k.stopPropagation(),t?.(c)}},c.version))},y=9,F=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:i=!1,onImageVersionItemClick:a,onDetailsButtonClick:t,goToPage:o})=>{const l=i?y:y-1;return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:["Image Versions",e.jsx(p,{children:e.jsxs(x.Suspense,{children:["(",e.jsx(z,{imageVersionsPromise:s}),")"]})})]}),i&&e.jsx(D,{children:e.jsx(V,{size:"small",onClick:()=>t?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(S,{columns:l,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(N,{children:[e.jsx(m,{children:"Image Repository"}),e.jsx(m,{children:"Tag"}),e.jsx(m,{children:"Occurrences"}),e.jsx(m,{colSpan:5,children:"Vulnerability Counts"}),i&&e.jsx(m,{})]}),e.jsx(p,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:q({colspan:l}),children:e.jsx(x.Suspense,{fallback:e.jsx(w,{colSpan:l}),children:e.jsx(Q,{columnSpan:l,displayDetailsButton:i,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:t,onImageVersionItemClick:a})})})]})}),e.jsx(p,{children:e.jsx(x.Suspense,{children:e.jsx(E,{dataNormalizationMethod:j,dataPromise:s,goToPage:o})})})]})},H=({queryClient:s,apiClient:n,service:i,after:a})=>s.ensureQueryData({queryKey:["imageVersions",i,a],queryFn:()=>n.query({query:f,variables:{filter:{serviceCcrn:[i]},filterCi:{serviceCcrn:[i]},filterIc:{serviceCcrn:[i]},orderBy:[{by:b.Severity,direction:h.Desc}],orderByCi:[{by:C.Cluster,direction:h.Asc},{by:C.Namespace,direction:h.Asc}],after:a}})});export{_ as O,H as U,F as _};
