import{R as b,e as v,j as e,u as T,a as Z,b as A,d as V,f as _,N as D,r as d,s as i,V as m,m as N,Y as F,W as f,c as x,G as O,H as B,o as j,g as G,X as J,w as K}from"./App-D4Hginvv-SlDKBwsE.js";import{j as h}from"./_extensionId._-NRn9YDPA.js";import{o as P,Z as $,c as k,l as z,r as H,a as M}from"./FirefoxCorsWarning-Zp0qhSyi-nhgFjwJm.js";import"./index-CnJxcwyK.js";import"./Shell-DtpXpov5.js";import"./index-CjWeDpzK.js";const S=({timestamp:s})=>{const n=r=>new Date(r).toLocaleString("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Europe/Berlin",timeZoneName:"short"});return e.jsx("div",{children:n(s)})},U=s=>s.length>40?s.substring(0,40)+"...":s,W=({silence:s},n)=>e.jsxs(d,{children:[e.jsxs(i,{className:"whitespace-nowrap",children:[e.jsx(S,{timestamp:s?.startsAt}),e.jsx(S,{timestamp:s?.endsAt})]}),e.jsxs(i,{className:"overflow-hidden",children:[e.jsx("div",{ref:n,children:s?.comment}),e.jsxs("div",{className:"text-theme-light",children:["Silence ",s.id," created by ",s?.createdBy]}),e.jsx(J,{className:"py-2 px-0",children:e.jsx(m,{gap:"2",alignment:"start",wrap:!0,children:s?.matchers?.map((r,l)=>e.jsx(K,{pillKey:r.name,pillValue:U(r.value)},l))})})]}),e.jsx(i,{className:"overflow-hidden",children:e.jsx("p",{children:s?.status?.state})}),e.jsx(i,{className:"overflow-hidden",children:s?.status?.state===x.SILENCE_ACTIVE||s?.status?.state===x.SILENCE_PENDING?e.jsx(H,{silence:s}):e.jsx(M,{silence:s})})]}),X=h.forwardRef(W),Q=`
bg-theme-background-lvl-1
py-2
px-4
my-px
`,Y=()=>{const s=T(),n=Z(),[r,l]=h.useState(n),u=A(),c=V(),{setSilences:C}=v(),{addMessage:E,resetMessages:w}=_(),{data:g,isLoading:y,error:p}=P("silences");p&&(w(),p instanceof $&&E({variant:"warning",text:e.jsx(k,{})}),E({variant:"error",text:z(p)})),h.useEffect(()=>{g&&C({items:g.silences})},[g]),h.useEffect(()=>{let t=n.filter(a=>a?.status?.state===u);try{c&&(t=t.filter(a=>JSON.stringify(a).match(new RegExp(c,"i"))))}catch(a){console.warn("search term is not a valid regex. "+a),t=t.filter(o=>JSON.stringify(o).toLowerCase().includes(c.toLowerCase))}l(t)},[u,c,n]);const L=t=>{const a=setTimeout(()=>{s({to:"/silences",search:o=>({...o,silencesRegEx:t.target.value})})},500);return()=>clearTimeout(a)},{scrollListItems:I,iterator:R}=D(r,{loadingObject:e.jsx(d,{children:e.jsx(i,{colSpan:3,children:e.jsxs(m,{gap:"3",alignment:"center",direction:"horizontal",children:["Loading...",e.jsx(N,{})]})})}),refFunction:t=>e.jsx(d,{children:e.jsx(i,{colSpan:3,className:"border-b-0 py-0",children:e.jsx("span",{ref:t})})})});return e.jsx(e.Fragment,{children:y?e.jsxs(m,{gap:"2",children:[e.jsx("span",{children:"Loading"}),e.jsx(N,{variant:"primary"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{direction:"horizontal",className:`${Q}`,children:[e.jsxs(F,{className:"w-3/12",label:"Status",value:u,onChange:t=>{s({to:"/silences",search:a=>({...a,silencesStatus:t})})},children:[e.jsx(f,{value:x.SILENCE_ACTIVE}),e.jsx(f,{value:x.SILENCE_PENDING}),e.jsx(f,{value:x.SILENCE_EXPIRED})]}),e.jsx(O,{placeholder:"search term or regular expression",className:"ml-auto w-7/12",value:c||"",onChange:t=>{L(t)},onSearch:t=>{s({to:"/silences",search:a=>({...a,silencesRegEx:t})})},onClear:()=>{s({to:"/silences",search:t=>{const{silencesRegEx:a,...o}=t;return{...o}}})}})]}),e.jsx(B,{columns:4,minContentColumns:[0,2,3],cellVerticalAlignment:"top",className:"silences ",children:e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx(j,{children:"Time intervall"}),e.jsx(j,{children:"Details"}),e.jsx(j,{children:"State"}),e.jsx(j,{children:"Action"})]}),I?.length?R.map(t=>e.jsx(X,{silence:t},t.id)):e.jsx(d,{children:e.jsx(i,{colSpan:4,children:e.jsxs(m,{gap:"3",children:[e.jsx(G,{icon:"info",color:"text-theme-info"}),e.jsx("div",{children:"We couldn't find any matching silences."})]})})})]})})]})})};function re(){const{appStateFromUrl:{silencesRegEx:s,silencesStatus:n}}=b.useRouteContext(),{setSilencesRegEx:r,setSilencesStatus:l}=v();return h.useLayoutEffect(()=>{r(s),l(n)},[s,n]),e.jsx(Y,{})}export{re as component};
