import{j as e,h as f,u as C,d as j,r as z,s as $,S as v,X as Z,b as D,l as x,n as F,k as b,q as A,g as N,a as I,e as L,f as q,T,p as G,c as O,m as Y,i as k,G as K,L as M,o as E,Z as J,w as P,y as d,z as h,t as w,v as W}from"./App-CnuHLQ5c-0Vrfb6w6.js";import{w as n}from"./index-Bjlhngo5.js";import{f as V,X,Y as _,_ as B,r as p}from"./IssueCountsPerSeverityLevel-CCPZ__-4-CciJBcb-.js";import"./index-C9pFgUF3.js";const H=()=>{const s=C(),{queryClient:r,apiClient:a}=_({from:"/services/"}),{service:l}=I({from:"/services/"}),t=l?q({queryClient:r,apiClient:a,service:l}):void 0,c=n.useCallback(()=>{s({to:"/services",search:u=>{const{service:m,...i}=u;return{...i}}})},[s]),o=n.useCallback(u=>{l&&s({to:"/services/$service",params:{service:l},search:{imageVersion:u==null?void 0:u.version}})},[s,l]);return e.jsx(T,{children:e.jsx(G,{heading:l?`${O(l)} Overview`:void 0,opened:!!l,onClose:c,size:"large",children:e.jsx(Y,{children:l&&t&&e.jsx(B,{displayActions:!0,imageVersionsPromise:t,onDetailsButtonClick:o})})})})},y={supportGroups:"support_group",region:"region",integrity:"integrity"},Q=({serviceDetails:s})=>{const r=(a,l)=>e.jsx(P,{pillKey:a,pillKeyLabel:a,pillValue:l,pillValueLabel:l},l);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,l])=>Array.isArray(l)?l.map(t=>r(y[a],t)):r(y[a],l))})},R=({item:s,selected:r,onItemClick:a,onServiceDetailClick:l})=>e.jsxs(D,{className:`cursor-pointer ${r?"active":""}`,onClick:a,children:[e.jsx(d,{children:s.name}),e.jsx(d,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(d,{children:e.jsx(Q,{serviceDetails:s.serviceDetails})}),e.jsx(d,{className:"cursor-default interactive",onClick:t=>t.stopPropagation(),children:e.jsx(b,{label:"Show Details",onClick:l,size:"small",className:"whitespace-nowrap"})})]}),U=8,ee=()=>{const s=C(),{servicesPromise:r}=j({from:"/services/"}),{service:a}=I({from:"/services/"}),{error:l,data:t}=n.use(r),{services:c}=N(t),o=n.useCallback(m=>{s({to:"/services",search:i=>({...i,service:m.name})})},[]),u=n.useCallback(m=>{s({to:"/services/$service",params:{service:m.name}})},[]);return e.jsxs(e.Fragment,{children:[!l&&c.length>0&&c.map(m=>e.jsx(R,{item:m,selected:m.name===a,onItemClick:()=>o(m),onServiceDetailClick:()=>u(m)},m.id)),!l&&c.length===0&&e.jsx(V,{colSpan:U,children:"No services found"})]})},se=()=>{const{servicesPromise:s}=j({from:"/services/"}),{data:r}=n.use(s),{pages:a,pageNumber:l}=N(r);return e.jsx(v,{distribution:"end",className:"mt-4",children:e.jsx(L,{variant:"number",currentPage:l,onPressNext:()=>{},onPressPrevious:()=>{},pages:a.length})})},S=8,re=()=>e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(Z,{minContentColumns:[1,2,3,4,5,7],columns:S,children:[e.jsxs(D,{children:[e.jsx(x,{children:"Service"}),e.jsx(x,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(x,{children:"Details"}),e.jsx(x,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(V,{colSpan:S,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(f,{variant:"primary"})]})}),children:e.jsx(ee,{})})]}),e.jsx(n.Suspense,{children:e.jsx(se,{})}),e.jsx(H,{})]}),ae=({servicesPromise:s})=>{const{error:r,data:a}=n.use(s),{servicesIssuesCount:l}=N(a);return e.jsx(v,{gap:"1",children:r?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(X,{counts:l})})},le=()=>{const{servicesPromise:s}=j({from:"/services/"});return e.jsx(v,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(f,{size:"small"}),children:e.jsx(ae,{servicesPromise:s})})})},ie=({filters:s,onChange:r})=>{var a,l;const[t,c]=n.useState(""),[o]=n.useState(""),u=(l=(a=s.find(i=>i.filterName===t))==null?void 0:a.values)==null?void 0:l.filter(i=>i),m=n.useCallback(i=>{!k.isEmpty(t)&&!k.isEmpty(i)&&r({name:t,value:i})},[t,r]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(F,{children:[e.jsx(K,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:t,onChange:i=>{c(String(i))},children:s==null?void 0:s.map(({displayName:i,filterName:g})=>e.jsx(M,{value:g,label:i,"data-testid":g},g))}),e.jsx(E,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:o,onChange:m,children:u==null?void 0:u.map(i=>e.jsx(J,{value:i,label:i,"data-testid":i},i))}),e.jsx(b,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},te=({selectedFilters:s,onDelete:r})=>e.jsx(v,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(P,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>r(a)},`${name}:${a.value}`))}),ne=({filters:s,filterSettings:r,onFilterChange:a,searchInputPlaceholder:l})=>{const t=n.useCallback(c=>{var o;a({...r,selectedFilters:(o=r.selectedFilters)==null?void 0:o.filter(u=>!(u.name===c.name&&u.value===c.value))})},[r,a]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(F,{children:[e.jsx(ie,{filters:s,onChange:c=>{var o;a({...r,selectedFilters:(o=r==null?void 0:r.selectedFilters)==null?void 0:o.concat(c)})}}),e.jsx(b,{label:"Clear all",className:"ml-4",onClick:()=>a({...r,selectedFilters:[]}),variant:"subdued"}),e.jsx(A,{placeholder:l||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",onSearch:c=>{a({...r,searchTerm:c})},onClear:()=>a({...r,searchTerm:""})})]}),r.selectedFilters&&r.selectedFilters.length>0&&e.jsx(te,{selectedFilters:r.selectedFilters,onDelete:t})]})},ce=()=>{const s=C(),{filtersPromise:r,filterSettings:a}=j({from:"/services/"}),{data:l}=n.use(r),t=z(l),c=n.useCallback(o=>{s({to:"/services",search:{service:o.searchTerm,...$(o)}})},[a,s]);return e.jsx(ne,{filters:t,filterSettings:a,onFilterChange:c,searchInputPlaceholder:"search term for services name"})},oe=()=>e.jsxs(e.Fragment,{children:[e.jsx(n.Suspense,{children:e.jsx(ce,{})}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(f,{size:"small"})}),children:[e.jsx(le,{}),e.jsx(re,{})]})]});h.object({service:h.string().transform(s=>w(s)).optional(),searchTerm:h.string().transform(s=>w(s)).optional()}).catchall(h.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(W)))return s},h.union([h.string(),h.array(h.string())])));const ve=oe;export{ve as component};
