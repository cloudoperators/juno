import{N as w,j as e,b as p,y as l,H as S,K as f,Y as b,v as D,Q as R,x as F,S as x,t as L,k as N,R as O,U as z,X as E,l as m,e as M,A as g,V as v,W as P,_ as q}from"./App-B4nUHjW2.js";import{a as d}from"./index-XHe11NJb.js";function Y(s){return w({...s,select:n=>s.select?s.select(n.context):n.context})}const y=({colSpan:s,children:n})=>e.jsx(p,{children:e.jsx(l,{colSpan:s,children:n})}),H=({children:s})=>e.jsx(S,{className:"my-6",children:s}),Z=({imageVersionsPromise:s})=>{const{data:n}=d.use(s),{totalImageVersions:r}=f(n);return r},i=({icon:s,count:n,variant:r,tooltipContent:a,showDashIfZero:t=!1})=>t&&n===0?e.jsx("span",{children:"â€”"}):e.jsxs(b,{triggerEvent:"hover",children:[e.jsx(D,{children:e.jsx(R,{icon:s,text:n>0?n.toString():"0",variant:n>0?r:"default"})}),e.jsx(F,{children:a})]}),U=({version:s,selected:n=!1,displayDetailsButton:r=!0,onItemClick:a,onDetailClick:t})=>e.jsxs(p,{onClick:a,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(l,{className:"service-image-versions-cell",children:e.jsxs(x,{gap:"1",direction:"vertical",children:[e.jsxs(x,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(x,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:o=>o.stopPropagation(),children:e.jsxs(x,{gap:"1.5",alignment:"center",children:[e.jsx(L,{icon:"openInNew",size:"16",color:"jn-global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(l,{className:"service-image-versions-cell",children:s.tag}),e.jsx(l,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(l,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(l,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(l,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(l,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),r&&e.jsx(l,{children:e.jsx(N,{size:"small",label:"Show Details",onClick:t})})]}),_=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:r,imageVersionsPromise:a,onDetailsButtonClick:t,onImageVersionItemClick:o})=>{const{error:c,data:h}=d.use(a),{imageVersions:u}=f(h);return e.jsxs(e.Fragment,{children:[!c&&u.length>0&&u.map(j=>e.jsx(U,{version:j,selected:j.version===n,displayDetailsButton:r,onItemClick:()=>{o==null||o(j)},onDetailClick:I=>{I.stopPropagation(),t==null||t(j)}},j.version)),!c&&u.length===0&&e.jsx(y,{colSpan:s,children:"No services found"})]})},A=({dataPromise:s,goToPage:n,dataNormalizationMethod:r})=>{const{data:a}=d.use(s),{pages:t,pageNumber:o}=r(a),c=d.useCallback(h=>{if(h){const u=t[h-2];n(h===1||u==null?void 0:u.after)}},[t,n]);return e.jsx(x,{distribution:"end",className:"mt-4",children:e.jsx(O,{variant:"number",currentPage:o,onPressNext:c,onPressPrevious:c,pages:t.length})})},C=8,G=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:r=!1,onImageVersionItemClick:a,onDetailsButtonClick:t,goToPage:o})=>{const c=r?C:C-1;return e.jsxs(d.Suspense,{children:[e.jsxs(H,{children:["Image Versions",e.jsxs(d.Suspense,{children:["(",e.jsx(Z,{imageVersionsPromise:s}),")"]})]}),r&&e.jsx(z,{children:e.jsx(N,{size:"small",onClick:()=>t==null?void 0:t(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(E,{columns:c,minContentColumns:[2,3,4,5,6],children:[e.jsxs(p,{children:[e.jsx(m,{children:"Image Repository"}),e.jsx(m,{children:"Tag"}),e.jsx(m,{colSpan:5,children:"Issue Counts"}),r&&e.jsx(m,{})]}),e.jsx(d.Suspense,{fallback:e.jsx(y,{colSpan:c,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(M,{variant:"primary"})]})}),children:e.jsx(_,{columnSpan:c,displayDetailsButton:r,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:t,onImageVersionItemClick:a})})]})}),e.jsx(d.Suspense,{children:e.jsx(A,{dataNormalizationMethod:f,dataPromise:s,goToPage:o})})]})},K=({queryClient:s,apiClient:n,service:r,after:a})=>s.ensureQueryData({queryKey:["imageVersions",r,a],queryFn:()=>n.query({query:q,variables:{filter:{serviceCcrn:[r]},filterCi:{serviceCcrn:[r]},filterIc:{serviceCcrn:[r]},orderBy:[{by:P.Severity,direction:g.Desc}],orderByCi:[{by:v.Cluster,direction:g.Asc},{by:v.Namespace,direction:g.Asc}],after:a}})}),Q=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(x,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(i,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(i,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(i,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(i,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(i,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{A as C,y as E,Q as I,G as S,i as a,H as b,K as f,Y as u};
