import{u as g,a as D,j as e,T as z,p as A,c as R,m as O,b as k,y as h,k as C,S as v,w as I,g as S,d as b,f as V,X as Z,l as j,e as f,h as N,i as F,G as $,L as _,n as q,Z as G,q as M,o as K,z as m,s as w,r as U}from"./App-B4nUHjW2.js";import{R as X,a as l}from"./index-XHe11NJb.js";import{u as L,f as B,S as H,a as p,E,C as W,I as J}from"./IssueCountsPerSeverityLevel-BQOhn4Sr.js";const Q=()=>{const s=g(),{queryClient:a,apiClient:r}=L({from:"/services/"}),{service:t}=D({from:"/services/"}),[o,n]=X.useState(void 0),d=t?B({queryClient:a,apiClient:r,service:t,after:o}):void 0,u=l.useCallback(()=>{s({to:"/services",search:c=>{const{service:x,...T}=c;return{...T}}})},[s]),i=l.useCallback(c=>{t&&s({to:"/services/$service",params:{service:t},search:{imageVersion:c==null?void 0:c.version}})},[s,t]);return e.jsx(z,{children:e.jsx(A,{heading:t?`${R(t)} Overview`:void 0,opened:!!t,onClose:u,size:"large",children:e.jsx(O,{children:t&&d&&e.jsx(H,{displayActions:!0,imageVersionsPromise:d,onDetailsButtonClick:i,goToPage:n})})})})},y={supportGroups:"support_group",region:"region",integrity:"integrity"},Y=({serviceDetails:s})=>{const a=(r,t)=>e.jsx(I,{pillKey:r,pillKeyLabel:r,pillValue:t,pillValueLabel:t},t);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([r,t])=>Array.isArray(t)?t.map(o=>a(y[r],o)):a(y[r],t))})},ee=({item:s,selected:a,onItemClick:r,onServiceDetailClick:t})=>e.jsxs(k,{className:`cursor-pointer ${a?"active":""}`,onClick:r,children:[e.jsx(h,{children:s.name}),e.jsx(h,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(h,{children:e.jsx(Y,{serviceDetails:s.serviceDetails})}),e.jsx(h,{className:"cursor-default interactive",onClick:o=>o.stopPropagation(),children:e.jsx(C,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),se=8,ae=({servicesPromise:s})=>{const a=g(),{service:r}=D({from:"/services/"}),{error:t,data:o}=l.use(s),{services:n}=S(o),d=l.useCallback(i=>{a({to:"/services",search:c=>({...c,service:i.name})})},[]),u=l.useCallback(i=>{a({to:"/services/$service",params:{service:i.name}})},[]);return e.jsxs(e.Fragment,{children:[!t&&n.length>0&&n.map(i=>e.jsx(ee,{item:i,selected:i.name===r,onItemClick:()=>d(i),onServiceDetailClick:()=>u(i)},i.id)),!t&&n.length===0&&e.jsx(E,{colSpan:se,children:"No services found"})]})},P=8,re=()=>{const{queryClient:s,apiClient:a}=L({from:"/services/"}),{servicesPromise:r,filterSettings:t}=b({from:"/services/"}),[o,n]=l.useState(r),d=l.useCallback(u=>{const i=V({queryClient:s,apiClient:a,filterSettings:t,after:u});n(i)},[n,s,a,t]);return l.useEffect(()=>{n(r)},[n,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(Z,{minContentColumns:[1,2,3,4,5,7],columns:P,children:[e.jsxs(k,{children:[e.jsx(j,{children:"Service"}),e.jsx(j,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(j,{children:"Details"}),e.jsx(j,{})]}),e.jsx(l.Suspense,{fallback:e.jsx(E,{colSpan:P,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(f,{variant:"primary"})]})}),children:e.jsx(ae,{servicesPromise:o})})]}),e.jsx(l.Suspense,{children:e.jsx(W,{dataPromise:o,goToPage:d,dataNormalizationMethod:S})}),e.jsx(Q,{})]})},te=({servicesPromise:s})=>{const{error:a,data:r}=l.use(s),{servicesIssuesCount:t}=S(r);return e.jsx(v,{gap:"1",children:a?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(J,{counts:t})})},ne=()=>{const{servicesPromise:s}=b({from:"/services/"});return e.jsx(v,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(l.Suspense,{fallback:e.jsx(f,{size:"small"}),children:e.jsx(te,{servicesPromise:s})})})},ce=({filters:s,onChange:a})=>{var u,i;const[r,t]=l.useState(""),[o]=l.useState(""),n=(i=(u=s.find(c=>c.filterName===r))==null?void 0:u.values)==null?void 0:i.filter(c=>c),d=l.useCallback(c=>{!N.isEmpty(r)&&!N.isEmpty(c)&&a({name:r,value:c})},[r,a]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(F,{children:[e.jsx($,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:r,onChange:c=>{t(String(c))},children:s==null?void 0:s.map(({displayName:c,filterName:x})=>e.jsx(_,{value:x,label:c,"data-testid":x},x))}),e.jsx(q,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:o,onChange:d,children:n==null?void 0:n.map(c=>e.jsx(G,{value:c,label:c,"data-testid":c},c))}),e.jsx(C,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ie=({selectedFilters:s,onDelete:a})=>e.jsx(v,{gap:"2",wrap:!0,children:s==null?void 0:s.map(r=>e.jsx(I,{closeable:!0,pillKey:r.name,pillValue:r.value,onClose:()=>a(r)},`${name}:${r.value}`))}),le=({filters:s,filterSettings:a,onFilterChange:r,searchInputPlaceholder:t})=>{const o=l.useCallback(n=>{var d;r({...a,selectedFilters:(d=a.selectedFilters)==null?void 0:d.filter(u=>!(u.name===n.name&&u.value===n.value))})},[a,r]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(F,{children:[e.jsx(ce,{filters:s,onChange:n=>{var u;((u=a.selectedFilters)==null?void 0:u.some(i=>i.name===n.name&&i.value===n.value))||r({...a,selectedFilters:[...a.selectedFilters||[],n]})}}),e.jsx(C,{label:"Clear all",className:"ml-4",onClick:()=>r({...a,selectedFilters:[]}),variant:"subdued"}),e.jsx(M,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:a.searchTerm,onSearch:n=>{r({...a,searchTerm:n})},onClear:()=>r({...a,searchTerm:""})})]}),a.selectedFilters&&a.selectedFilters.length>0&&e.jsx(ie,{selectedFilters:a.selectedFilters,onDelete:o})]})},oe=()=>{const s=g(),{filters:a,filterSettings:r}=b({from:"/services/"}),t=l.useCallback(o=>{s({to:"/services",search:{...K(o)}})},[r,s]);return e.jsx(le,{filters:a,filterSettings:r,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},ue=()=>e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsxs(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(f,{size:"small"})}),children:[e.jsx(ne,{}),e.jsx(re,{})]})]});m.object({service:m.string().transform(s=>w(s)).optional(),searchTerm:m.string().transform(s=>w(s)).optional()}).catchall(m.preprocess((s,a)=>{if(!(a.path.length>0&&typeof a.path[0]=="string"&&!a.path[0].startsWith(U)))return s},m.union([m.string(),m.array(m.string()),m.undefined()])));const ve=ue;export{ve as component};
