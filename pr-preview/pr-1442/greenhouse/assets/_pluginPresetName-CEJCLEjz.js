import{j as e,V as d,P as b,o,r as c,l as i,s as w,L as f,m as C,M as P,z as j,Q as S,Z as R,T as E,i as v,U as D,W as $,_ as m,$ as g}from"./Shell-DO_mhGpw.js";import{r as y}from"./index-DFfJWXmv.js";import{S as I,b as F,g as L,L as T,u as N,a as _,R as A,c as O}from"./Stats-DK7auaPg.js";import{E as H}from"./ErrorMessage-cOSivLQe.js";import"./index-BAvoaAcW.js";const K="pluginPreset",M=async({apiClient:s,namespace:n,pluginPresetName:a})=>s.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${n}/pluginpresets/${a}`),V=s=>{const n=s.status?.totalPlugins||0,a=s.status?.readyPlugins||0,t=s.status?.failedPlugins||0,l=n-a-t,r=s.status?.pluginStatuses?.length||0;return[{label:"Total Plugins",value:n,subtext:r>0?`across ${r} cluster${r!==1?"s":""}`:void 0,variant:"default"},{label:"Ready Plugins",value:a,variant:"success"},{label:"Failed Plugins",value:t,variant:"danger"},{label:"Pending Plugins",value:l,variant:"warning"}]},k=({pluginPreset:s})=>{const n=y.useMemo(()=>V(s),[s]);return e.jsx(I,{title:"Plugin Instance Health Distribution",data:n})},q=({pluginPreset:s})=>e.jsxs(d,{gap:"4",direction:"vertical",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs(b,{columns:2,minContentColumns:[0],children:[e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Name"}),e.jsx(i,{children:s.metadata?.name||"N/A"})]}),e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Plugin Definition"}),e.jsx(i,{children:s.spec?.plugin?.pluginDefinitionRef?.name||"N/A"})]}),e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Owning Team"}),e.jsx(i,{children:s.metadata?.labels?.["greenhouse.sap/owned-by"]||"N/A"})]}),s.metadata?.labels&&Object.keys(s.metadata.labels).length>0&&e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Labels"}),e.jsx(i,{children:e.jsx(d,{gap:"2",wrap:!0,children:Object.entries(s.metadata.labels).map(([n,a])=>e.jsx(w,{pillKey:n,pillValue:a},n))})})]})]})]}),z=({pluginPreset:s})=>{const n=s.spec?.clusterSelector;return e.jsxs(d,{gap:"4",direction:"vertical",children:[e.jsx("h3",{children:"Cluster Selector"}),n?e.jsx(f,{expanded:!0,data:n}):e.jsx("p",{children:"No cluster selector configured"})]})},Q="plugins",U=async({apiClient:s,namespace:n,pluginPresetName:a})=>{const t=await s.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${n}/plugins`,{params:{labelSelector:`greenhouse.sap/pluginpreset=${a}`}});return Array.isArray(t?.items)?t.items:[]},h=4,B=({colSpan:s})=>{const{pluginPresetName:n}=P({from:"/admin/plugin-presets/$pluginPresetName"}),{apiClient:a,organization:t}=N({from:"/admin/plugin-presets/$pluginPresetName"}),{data:l}=_({queryKey:[Q,t,n],queryFn:()=>U({apiClient:a,namespace:t,pluginPresetName:n})});if(l.length===0)return e.jsx(o,{children:e.jsx(i,{colSpan:s,children:"No plugin instances found for this plugin preset."})});const r=u=>u.status?.statusConditions?.conditions?.some(x=>x.type==="Ready"&&x.status==="True");return e.jsx(e.Fragment,{children:l.map(u=>{const x=r(u);return e.jsxs(o,{onClick:()=>{},children:[e.jsx(i,{children:e.jsx(C,{icon:x?"checkCircle":"error",color:x?"text-theme-success":"text-theme-danger"})}),e.jsx(i,{children:u.metadata?.name}),e.jsx(i,{children:u.spec?.clusterName||"greenhouse"}),e.jsx(i,{children:x?"Ready":"Not Ready"})]},u.metadata?.name)})})},G=()=>e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"Plugin Instances"}),e.jsxs(b,{columns:h,children:[e.jsxs(o,{children:[e.jsx(c,{children:e.jsx(C,{icon:"monitorHeart"})}),e.jsx(c,{children:"Plugin Name"}),e.jsx(c,{children:"Cluster"}),e.jsx(c,{children:"Status"})]}),e.jsx(F,{displayErrorMessage:!0,fallbackRender:L({colspan:h}),children:e.jsx(y.Suspense,{fallback:e.jsx(T,{colSpan:h}),children:e.jsx(B,{colSpan:h})})})]})]}),Y=({pluginPreset:s})=>e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"Conditions"}),e.jsx(A,{conditions:s.status?.statusConditions?.conditions||[],enableDetailsView:!0})]}),p=({children:s})=>e.jsx(j,{px:!1,py:!0,children:s}),Z=({pluginPreset:s})=>e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsx(k,{pluginPreset:s})}),e.jsx(p,{children:e.jsx(q,{pluginPreset:s})}),e.jsx(p,{children:e.jsx(z,{pluginPreset:s})}),e.jsx(p,{children:e.jsx(Y,{pluginPreset:s})}),e.jsx(p,{children:e.jsx(G,{})})]}),W=({pluginPreset:s})=>e.jsx(j,{px:!1,py:!0,children:e.jsx(S,{children:e.jsx(f,{data:s.spec?.plugin?.optionValues||{},toolbar:!0,expanded:2})})}),J=({pluginPreset:s})=>e.jsx(j,{px:!1,py:!0,children:e.jsx(S,{children:e.jsx(f,{data:s,toolbar:!0,expanded:2})})}),X=({pluginPreset:s})=>{const[n,a]=y.useState(0);return e.jsx(e.Fragment,{children:e.jsxs(D,{selectedIndex:n,onSelect:a,children:[e.jsxs($,{children:[e.jsx(m,{label:"Overview"}),e.jsx(m,{label:"Configuration Overrides"}),e.jsx(m,{label:"Raw Data"})]}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:s&&e.jsx(Z,{pluginPreset:s})})}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:s&&e.jsx(W,{pluginPreset:s})})}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:s&&e.jsx(J,{pluginPreset:s})})})]})})},ee=()=>{const{pluginPresetName:s}=P({from:"/admin/plugin-presets/$pluginPresetName"}),{apiClient:n,organization:a}=N({from:"/admin/plugin-presets/$pluginPresetName"}),{data:t,isLoading:l,error:r}=O({queryKey:[K,a,s],queryFn:()=>M({apiClient:n,namespace:a,pluginPresetName:s})});return e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx(R,{className:"pb-0",children:s}),t&&e.jsx(E,{icon:!0,text:v(t)?"Ready":"Failing",variant:v(t)?"success":"error"})]}),e.jsx("p",{children:"Plugin preset configuration and instance status"}),l&&e.jsx("p",{children:"Loading..."}),!l&&r&&e.jsx(H,{error:r}),!l&&!r&&t&&e.jsx(X,{pluginPreset:t})]})},ie=ee;export{ie as component};
