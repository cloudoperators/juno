import{j as e,V as d,P,o,r as c,l as i,s as w,L as f,m as b,M as C,z as j,Q as S,Z as R,T as E,i as v,U as D,W as $,_ as m,$ as g}from"./Shell-CNjexP_0.js";import{r as y}from"./index-DeoR2ieF.js";import{S as I,b as L,g as T,L as _,u as N,a as F,R as O,c as H}from"./Stats-msFcsjVs.js";import{E as A}from"./ErrorMessage-o7yaZ_Ts.js";import"./index-DSs6ZM1b.js";const K="pluginPreset",M=async({apiClient:s,namespace:n,pluginPresetName:a})=>s.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${n}/pluginpresets/${a}`),V=s=>{const n=s.status?.totalPlugins||0,a=s.status?.readyPlugins||0,t=s.status?.failedPlugins||0,l=n-a-t,r=s.status?.pluginStatuses?.length||0;return[{label:"Total Plugins",value:n,subtext:r>0?`across ${r} cluster${r!==1?"s":""}`:void 0,variant:"default"},{label:"Ready Plugins",value:a,variant:"success"},{label:"Failed Plugins",value:t,variant:"danger"},{label:"Pending Plugins",value:l,variant:"warning"}]},k=({pluginPreset:s})=>{const n=y.useMemo(()=>V(s),[s]);return e.jsx(I,{title:"Plugin Instance Health Distribution",data:n})},q=({pluginPreset:s})=>e.jsxs(d,{gap:"4",direction:"vertical",className:"flex-1",children:[e.jsx("h3",{children:"Basic Information"}),e.jsxs(P,{columns:2,minContentColumns:[0],children:[e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Name"}),e.jsx(i,{children:s.metadata?.name})]}),e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Plugin Definition"}),e.jsx(i,{children:s.spec?.plugin?.pluginDefinitionRef?.name})]}),e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Owning Team"}),e.jsx(i,{children:s.metadata?.labels?.["greenhouse.sap/owned-by"]})]}),s.metadata?.labels&&Object.keys(s.metadata.labels).length>0&&e.jsxs(o,{children:[e.jsx(c,{nowrap:!0,children:"Labels"}),e.jsx(i,{children:e.jsx(d,{gap:"2",wrap:!0,children:Object.entries(s.metadata.labels).map(([n,a])=>e.jsx(w,{pillKey:n,pillValue:a},n))})})]})]})]}),z=({pluginPreset:s})=>{const n=s.spec?.clusterSelector;return e.jsxs(d,{gap:"4",direction:"vertical",className:"flex-1",children:[e.jsx("h3",{children:"Cluster Selector"}),n?e.jsx(f,{expanded:!0,data:n}):e.jsx("p",{children:"No cluster selector configured"})]})},Q="plugins",U=async({apiClient:s,namespace:n,pluginPresetName:a})=>{const t=await s.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${n}/plugins`,{params:{labelSelector:`greenhouse.sap/pluginpreset=${a}`}});return Array.isArray(t?.items)?t.items:[]},p=4,B=({colSpan:s})=>{const{pluginPresetName:n}=C({from:"/admin/plugin-presets/$pluginPresetName"}),{apiClient:a,organization:t}=N({from:"/admin/plugin-presets/$pluginPresetName"}),{data:l}=F({queryKey:[Q,t,n],queryFn:()=>U({apiClient:a,namespace:t,pluginPresetName:n})});if(l.length===0)return e.jsx(o,{children:e.jsx(i,{colSpan:s,children:"No plugin instances found for this plugin preset."})});const r=u=>u.status?.statusConditions?.conditions?.some(x=>x.type==="Ready"&&x.status==="True")??!1;return e.jsx(e.Fragment,{children:l.map(u=>{const x=r(u);return e.jsxs(o,{onClick:()=>{},children:[e.jsx(i,{children:e.jsx(b,{icon:x?"checkCircle":"error",color:x?"text-theme-success":"text-theme-danger"})}),e.jsx(i,{children:u.metadata?.name}),e.jsx(i,{children:u.spec?.clusterName}),e.jsx(i,{children:x?"Ready":"Not Ready"})]},u.metadata?.name)})})},G=()=>e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"Plugin Instances"}),e.jsxs(P,{columns:p,children:[e.jsxs(o,{children:[e.jsx(c,{children:e.jsx(b,{icon:"monitorHeart"})}),e.jsx(c,{children:"Plugin Name"}),e.jsx(c,{children:"Cluster"}),e.jsx(c,{children:"Status"})]}),e.jsx(L,{displayErrorMessage:!0,fallbackRender:T({colspan:p}),children:e.jsx(y.Suspense,{fallback:e.jsx(_,{colSpan:p}),children:e.jsx(B,{colSpan:p})})})]})]}),Y=({pluginPreset:s})=>e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"Conditions"}),e.jsx(O,{conditions:s.status?.statusConditions?.conditions||[],enableDetailsView:!0})]}),h=({children:s,...n})=>e.jsx(j,{px:!1,py:!0,...n,children:s}),Z=({pluginPreset:s})=>e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsx(k,{pluginPreset:s})}),e.jsxs(h,{className:"flex",children:[e.jsx(q,{pluginPreset:s}),e.jsx(z,{pluginPreset:s})]}),e.jsx(h,{children:e.jsx(Y,{pluginPreset:s})}),e.jsx(h,{children:e.jsx(G,{})})]}),W=({pluginPreset:s})=>e.jsx(j,{px:!1,py:!0,children:e.jsx(S,{children:e.jsx(f,{data:s.spec?.plugin?.optionValues||{},toolbar:!0,expanded:2})})}),J=({pluginPreset:s})=>e.jsx(j,{px:!1,py:!0,children:e.jsx(S,{children:e.jsx(f,{data:s,toolbar:!0,expanded:2})})}),X=({pluginPreset:s})=>{const[n,a]=y.useState(0);return e.jsxs(D,{selectedIndex:n,onSelect:a,children:[e.jsxs($,{children:[e.jsx(m,{label:"Overview"}),e.jsx(m,{label:"Configuration Overrides"}),e.jsx(m,{label:"Raw Data"})]}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:e.jsx(Z,{pluginPreset:s})})}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:e.jsx(W,{pluginPreset:s})})}),e.jsx(g,{children:e.jsx(j,{px:!1,py:!0,children:e.jsx(J,{pluginPreset:s})})})]})},ee=()=>{const{pluginPresetName:s}=C({from:"/admin/plugin-presets/$pluginPresetName"}),{apiClient:n,organization:a}=N({from:"/admin/plugin-presets/$pluginPresetName"}),{data:t,isLoading:l,error:r}=H({queryKey:[K,a,s],queryFn:()=>M({apiClient:n,namespace:a,pluginPresetName:s})});return e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx(R,{className:"pb-0",children:s}),t&&e.jsx(E,{icon:!0,text:v(t)?"Ready":"Failing",variant:v(t)?"success":"error"})]}),e.jsx("p",{children:"Plugin preset configuration and instance status"}),l&&e.jsx("p",{children:"Loading..."}),!l&&r&&e.jsx(A,{error:r}),!l&&!r&&t&&e.jsx(X,{pluginPreset:t})]})},ie=ee;export{ie as component};
