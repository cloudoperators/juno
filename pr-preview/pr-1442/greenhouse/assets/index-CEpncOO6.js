import{g as b,n as _,i as f,h as V,u as E,k,j as e,o as w,l as m,m as D,p as q,Y as F,q as R,P as K,r as h,V as x,s as I,t as S,v as T,w as $,x as H,N as z,y as U,A as M,S as N,B as Q,z as y,Z as G,X as O,C as Y,E as P,F as X,H as B,I as W,J as Z}from"./Shell-DO_mhGpw.js";import{r as p}from"./index-DFfJWXmv.js";import{u as v,a as J,E as ee,R as se,b as te,g as ne,L as ae,c as ie,S as re}from"./Stats-DK7auaPg.js";import{E as le}from"./ErrorMessage-cOSivLQe.js";import"./index-BAvoaAcW.js";function oe(n,t){const a=b(),s=a.getQueryCache();return p.useSyncExternalStore(p.useCallback(i=>s.subscribe(_.batchCalls(i)),[s]),()=>a.isFetching(n),()=>a.isFetching(n))}const ce=(n,t)=>{if(t?.selectedFilters){const a=t.selectedFilters.filter(s=>s.id==="pluginPresetDefinition").map(s=>s.value);a.length>0&&(n=n.filter(s=>{const i=s.spec?.plugin?.pluginDefinitionRef?.name||s.spec?.plugin?.pluginDefinition;return i&&a.includes(i)}))}if(t?.searchTerm){const a=t.searchTerm.toLowerCase();return n.filter(s=>(s.metadata?.name?.toLowerCase()||"").includes(a))}return n},ue=n=>n.sort((t,a)=>{const s=f(t),i=f(a);if(s!==i)return s?1:-1;const d=t.metadata?.name?.toLowerCase()||"",c=a.metadata?.name?.toLowerCase()||"";return d<c?-1:d>c?1:0}),C="pluginPresets",de=async({apiClient:n,namespace:t,filterSettings:a})=>{const s=await n.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${t}/pluginpresets`);return Array.isArray(s?.items)?ue(ce(s.items,a)):[]},pe=n=>Array.from(new Set(n.map(t=>t.spec?.plugin?.pluginDefinitionRef.name||t.spec?.plugin?.pluginDefinition))).filter(t=>!!t),L="pluginPresetsStats",ge=async({apiClient:n,namespace:t})=>{const a=await n.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${t}/pluginpresets`),s=Array.isArray(a?.items)?a.items:[],i=s.length,d=pe(s).length,c=s.filter(l=>f(l)).length,o=s.filter(l=>!f(l)).length;return[{label:"Total Presets",value:i,variant:"default"},{label:"Plugin Definitions",value:d,variant:"default"},{label:"Ready Presets",value:c,subtext:`of ${i}`,variant:"success"},{label:"Failing Presets",value:o,subtext:`of ${i}`,variant:"danger"}]},me=({colSpan:n})=>{const{apiClient:t,organization:a}=v({from:"/admin/plugin-presets/"}),s=V({from:"/admin/plugin-presets/"}),i=E(),d=k(s),{data:c}=J({queryKey:[C,a,d],queryFn:()=>de({apiClient:t,namespace:a,filterSettings:d})});if(!c||c.length===0)return e.jsx(ee,{colSpan:n,children:"No plugin presets found."});const o=l=>{i({to:"/admin/plugin-presets/$pluginPresetName",params:{pluginPresetName:l}})};return e.jsx(e.Fragment,{children:c.map(l=>e.jsxs(w,{onClick:()=>o(l.metadata?.name||""),children:[e.jsx(m,{children:e.jsx(D,{icon:f(l)?"checkCircle":"error",color:f(l)?"text-theme-success":"text-theme-danger"})}),e.jsxs(m,{children:[l.status?.readyPlugins||0,"/",l.status?.totalPlugins||0]}),e.jsx(m,{children:l.metadata?.name}),e.jsx(m,{children:l.spec?.plugin?.pluginDefinitionRef.name||l.spec?.plugin?.pluginDefinition}),e.jsx(m,{children:f(l)?"":q(l)?.message}),e.jsx(m,{children:e.jsx(se,{conditions:l.status?.statusConditions?.conditions||[]})}),e.jsx(m,{nowrap:!0,children:e.jsx(F,{size:"small",variant:"primary",className:"w-fit",children:"View details"})})]},l.metadata?.name))})},j=7,he=()=>{const{filterSettings:n}=R({from:"/admin/plugin-presets/"});return e.jsxs(K,{minContentColumns:[0,1,6],columns:j,children:[e.jsxs(w,{children:[e.jsx(h,{children:e.jsx(D,{icon:"monitorHeart"})}),e.jsx(h,{children:"Instances"}),e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Plugin Definition"}),e.jsx(h,{children:"Message"}),e.jsx(h,{children:"Readiness Conditions"}),e.jsx(h,{children:"Actions"})]}),e.jsx(te,{displayErrorMessage:!0,fallbackRender:ne({colspan:j}),resetKeys:[n],children:e.jsx(p.Suspense,{fallback:e.jsx(ae,{colSpan:j}),children:e.jsx(me,{colSpan:j})})})]})},fe=({selectedFilters:n,onDelete:t})=>e.jsx(x,{gap:"2",wrap:!0,children:n?.map(a=>e.jsx(I,{closeable:!0,pillKey:a.id,pillValue:a.value,onClose:()=>t(a)},`${a.id}:${a.value}`))}),xe=n=>Array.from(new Set(n.map(t=>t.spec?.plugin?.pluginDefinitionRef.name||t.spec?.plugin?.pluginDefinition))).filter(t=>!!t),je=n=>[{id:"pluginPresetDefinition",label:"Plugin Preset Definition",values:xe(n)}],ye="pluginPresetsFilters",Pe=async({apiClient:n,namespace:t})=>{const a=await n.get(`/apis/greenhouse.sap/v1alpha1/namespaces/${t}/pluginpresets`);return Array.isArray(a?.items)?je(a.items):[]},Ce=({filters:n,isLoading:t,error:a,onChange:s})=>{const[i,d]=p.useState(""),[c,o]=p.useState(""),l=n?.find(r=>r.id===i)?.values?.filter(r=>r),u=p.useCallback(r=>{o(r),!S(i)&&!S(r)&&s({id:i,value:r}),setTimeout(()=>{o("")},0)},[i,o,s]);return e.jsx(x,{alignment:"center",gap:"8",children:e.jsxs(T,{children:[e.jsx($,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:i,loading:t,errortext:a?e.jsx(le,{error:a}):void 0,onChange:r=>{d(String(r))},children:n?.map(({label:r,id:g})=>e.jsx(H,{value:g,label:r,"data-testid":g},g))}),e.jsx(z,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,disabled:!i,onChange:r=>{u(String(r))},children:l?.map(r=>e.jsx(U,{value:r,label:r,"data-testid":r},r))})]})})},Fe=()=>{const n=E(),{apiClient:t,organization:a}=v({from:"/admin/plugin-presets"}),{filterSettings:s}=R({from:"/admin/plugin-presets/"}),{data:i,isLoading:d,error:c}=ie({queryKey:[ye,a],queryFn:()=>Pe({apiClient:t,namespace:a})}),o=p.useCallback(u=>{n({to:"/admin/plugin-presets",search:r=>{const g=M(u);return{...Object.fromEntries(Object.entries(r).filter(([A])=>!A.startsWith(N))),...g}}})},[n]),l=p.useCallback(u=>{o({...s,selectedFilters:s.selectedFilters?.filter(r=>!(r.id===u.id&&r.value===u.value))})},[s,o]);return e.jsxs(x,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(x,{alignment:"start",gap:"4",children:[e.jsx(T,{children:e.jsx(Ce,{filters:i,isLoading:d,error:c,onChange:u=>{s.selectedFilters?.some(g=>g.id===u.id&&g.value===u.value)||o({...s,selectedFilters:[...s.selectedFilters||[],u]})}})}),e.jsx(F,{label:"Clear all",className:"ml-4",onClick:()=>o({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(Q,{placeholder:"search term for plugin presets name",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:u=>{o({...s,searchTerm:u})},onClear:()=>o({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(fe,{selectedFilters:s.selectedFilters,onDelete:l})]})},ve=()=>{const{apiClient:n,organization:t}=v({from:"/admin/plugin-presets"});return e.jsx(re,{title:"PluginPreset Health Distribution",queryKey:[L,t],queryFn:()=>ge({apiClient:n,namespace:t})})},Se=()=>{const[n,t]=p.useState(Date.now()),a=oe({queryKey:[C]}),s=b(),i=()=>{s.invalidateQueries({queryKey:[C]}),s.invalidateQueries({queryKey:[L]}),t(Date.now())};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{px:!1,py:!0,children:[e.jsx(G,{children:"Plugin Presets Overview"}),e.jsx("p",{children:"Manage and monitor plugin preset configurations across all clusters"})]}),e.jsx(y,{px:!1,py:!0,children:e.jsx(ve,{})}),e.jsxs(y,{px:!1,py:!0,children:[e.jsx(Fe,{}),e.jsx(O,{children:e.jsx(x,{children:e.jsxs(x,{alignment:"center",children:[n&&`Last update: ${new Date(n).toLocaleString()}`,e.jsx(F,{size:"small",label:a>0?"Loading...":"Refresh",className:"ml-4 min-w-[90px]",onClick:i,variant:"subdued",disabled:a>0})]})})}),e.jsx(he,{})]})]})};Y({searchTerm:P().optional()}).catchall(X((n,t)=>{if(!(t.path.length>0&&typeof t.path[0]=="string"&&!t.path[0].startsWith(N)))return n},B([P(),W(P()),Z()])));const Ne=Se;export{Ne as component};
