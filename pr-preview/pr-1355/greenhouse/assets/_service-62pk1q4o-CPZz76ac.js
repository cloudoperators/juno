import{a as b,k as K,N as V,b as S,j as e,E as h,m as q,y as T,X as y,r as u,o as d,c as p,V as m,C as j,P as D,p as E,h as I,M as z,K as F,d as v,L,u as M,g as w,i as $}from"./App-DLw6we_i-c3c01nlR.js";import{G as o}from"./_extensionId._-r5-Cuqeg.js";import{P as N,D as P,L as G,S as R,R as _,d as C}from"./IssueCountsPerSeverityLevel-D0kU7-J6-tUcUizic.js";import{O as k,F as O,U as Q}from"./fetchImages-Br_z86ax-B8vRqw-9.js";import{s as U}from"./IssueTimestamp-MmliCKwk-B55b0-Li.js";import"./index-B-wigHBl.js";import"./Shell-BT13cjLS.js";import"./index-DLIwQoiy.js";const W=s=>{const l=s.toLowerCase(),i=w(l);return e.jsx(v,{icon:$[l]||"help",color:i})},A=({severity:s})=>W(s),B=s=>`
    border-l-2
    ${w(s.toLowerCase())}
    h-full
    pl-5
  `,H=({issue:s})=>{const[l,i]=o.useState(!1),{needsExpansion:a,textRef:n}=M(s.description),t=r=>{r.preventDefault(),i(!l)};return e.jsxs(u,{children:[e.jsx(p,{className:"pl-0",children:e.jsx("div",{className:B(s.severity),children:e.jsx(A,{severity:s.severity})})}),e.jsx(p,{className:"whitespace-nowrap",children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceLink&&s.sourceLink!=="-"&&e.jsx("a",{href:s.sourceLink,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(m,{gap:"1.5",alignment:"center",children:[e.jsx(v,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(p,{className:"whitespace-nowrap",children:e.jsx(U,{targetDate:s.earliestTargetRemediation})}),e.jsx(p,{children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:n,className:l?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&a&&e.jsx("a",{href:"#",onClick:t,className:"link-hover",children:e.jsxs(m,{alignment:"center",children:[l?"Show less":"Show more",e.jsx(v,{color:"global-text",icon:l?"expandLess":"expandMore"})]})})]})})]})},J=({issuesPromise:s,searchTerm:l})=>{const{error:i,data:a}=o.use(s),{issues:n}=L(a);if(i)return e.jsxs(C,{colSpan:4,children:["Error loading vulnerabilities: ",i.message]});const t=l?n.filter(r=>r.name.toLowerCase().includes(l.toLowerCase())):n;return t.length===0?e.jsx(C,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):t.map(r=>e.jsx(H,{issue:r},r.name))},X=({service:s,image:l})=>{const{apiClient:i,queryClient:a}=N({from:"/services/$service"}),[n,t]=o.useState(void 0),[r,x]=o.useState(void 0),c=k({apiClient:i,queryClient:a,filter:{service:[s],repository:[l.repository]},firstVulnerabilities:20,afterVulnerabilities:r});return e.jsxs(e.Fragment,{children:[e.jsxs(m,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(z,{children:"Vulnerabilities"}),e.jsx(F,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:g=>t(g||""),onClear:()=>{t("")}})]}),e.jsxs(y,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(u,{children:[e.jsx(d,{children:e.jsx(v,{icon:"monitorHeart"})}),e.jsx(d,{children:"Vulnerability"}),e.jsx(d,{children:"Target Date"}),e.jsx(d,{children:"Description"})]}),c&&e.jsx(h,{displayErrorMessage:!0,fallbackRender:G({colspan:4}),resetKeys:[c,n],children:e.jsx(o.Suspense,{fallback:e.jsx(R,{colSpan:4}),children:e.jsx(J,{issuesPromise:c,searchTerm:n})})})]}),c&&e.jsx(h,{resetKeys:[c],children:e.jsx(o.Suspense,{children:e.jsx(_,{dataPromise:c,dataNormalizationMethod:L,goToPage:x})})})]})},Y=({imagesPromise:s})=>{const l=b(),{service:i}=V({from:"/services/$service"}),{image:a}=S({from:"/services/$service"}),{data:n}=o.use(s),{images:t}=D(n),r=t.find(x=>x.repository===a);return r?e.jsx(E,{heading:`Image ${r.repository} Information`,opened:!!i,onClose:()=>l({to:"/services/$service",params:{service:i}}),size:"large",children:e.jsxs(I,{children:[e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",children:[e.jsxs(u,{children:[e.jsx(d,{children:"Details"}),e.jsx(p,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(j,{pillKey:"repository",pillKeyLabel:"repository",pillValue:r.repository,pillValueLabel:r.repository}),r.versionsCount!==void 0&&r.versionsCount>0&&e.jsx(j,{pillKey:"versions",pillKeyLabel:"versions",pillValue:r.versionsCount.toString(),pillValueLabel:r.versionsCount.toString()})]})})]}),e.jsxs(u,{children:[e.jsx(d,{children:"Vulnerabilities Counts"}),e.jsx(p,{children:e.jsx(P,{counts:r.issueCounts})})]})]}),i&&a&&r&&e.jsx(X,{service:i,image:r})]})}):null},Z=({servicePromise:s})=>{const{data:l}=o.use(s),i=T(l).services[0];return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:["Service ",i.name]}),e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(u,{children:[e.jsx(d,{children:"Details"}),e.jsx(p,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(j,{pillKey:"service",pillKeyLabel:"service",pillValue:i.name,pillValueLabel:i.name}),i.serviceDetails?.supportGroups?.map(a=>e.jsx(j,{pillKey:"support_group",pillKeyLabel:"support_group",pillValue:a,pillValueLabel:a},a))]})})]}),e.jsxs(u,{children:[e.jsx(d,{children:"Vulnerabilities Counts"}),e.jsx(p,{children:e.jsx(P,{counts:i.issuesCount})})]})]})]})},ee=()=>{const s=b(),{queryClient:l,apiClient:i}=N({from:"/services/$service"}),{servicePromise:a}=K({from:"/services/$service"}),{service:n}=V({from:"/services/$service"}),{image:t}=S({from:"/services/$service"}),[r,x]=o.useState(void 0),[c,g]=o.useState(void 0);return o.useEffect(()=>{const f=k({queryClient:l,apiClient:i,filter:{service:[n]},after:r});g(f)},[r,n,l,i]),e.jsxs(e.Fragment,{children:[e.jsx(h,{displayErrorMessage:!0,children:e.jsx(o.Suspense,{fallback:e.jsx(q,{className:"mt-4"}),children:e.jsx(Z,{servicePromise:a})})}),c&&e.jsxs(e.Fragment,{children:[e.jsx(O,{selectedImage:t,imagesPromise:c,onImageItemClick:f=>{s({to:"/services/$service",params:{service:n},search:{image:f.repository}})},goToPage:x}),e.jsx(h,{children:e.jsx(o.Suspense,{children:e.jsx(Y,{imagesPromise:c})})})]})]})},ce=ee;export{ce as component};
