import{j as e,x as b,u as C,d as N,e as V,K as d,b as y,p as k,M as f,c as p,f as g,g as v,a as P,R as q,D as I,v as x,q as M,z as m,S as E}from"./App-BYwhfNfa-qp1fVpTd.js";import{w as n}from"./_extensionId._-DkqKZl-L.js";import{E as z,N as S,y as T,M as $,V as B,S as D}from"./IssueCountsPerSeverityLevel-BbCwb6FP-D1aK17Lc.js";import{B as F}from"./IssueTimestamp-BeMVioFh-BA4xabwY.js";import{C as O}from"./index-D8HzmCBi-Bh2Fk8OJ.js";import"./index-CPHQn3n1.js";import"./Shell-Wyu9iwfd.js";import"./index-BM8E2uxH.js";const U=i=>`
    border-l-2
    ${D(i||"none")}
    h-full
    pl-5
  `,A=i=>{const r=(i||"none").toLowerCase(),l=D(i||"none"),s={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(g,{icon:s[r]||"help",color:l})},H=({vulnerability:i,selected:r,onItemClick:l})=>{const[s,t]=n.useState(!1),{needsExpansion:a,textRef:o}=B(i.description),c=u=>{u.preventDefault(),u.stopPropagation(),t(!s)};return e.jsxs(f,{className:`cursor-pointer ${r?"active":""}`,onClick:l,children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:U(i.severity),children:A(i.severity)})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx("span",{children:i.servicesCount})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(F,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&a&&e.jsx("a",{href:"#",onClick:c,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},R=({vulnerabilitiesPromise:i})=>{const r=C(),{vulnerability:l}=P({from:"/vulnerabilities/"}),{error:s,data:t}=n.use(i),{vulnerabilities:a}=v(t),o=n.useCallback(c=>{r({to:"/vulnerabilities",search:u=>({...u,vulnerability:c.name})})},[r]);return s?e.jsxs(S,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):a.length===0?e.jsx(S,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):a.map(c=>e.jsx(H,{vulnerability:c,selected:c.name===l,onItemClick:()=>o(c)},c.name))},G=({vulnerabilityName:i,vulnerabilitiesPromise:r,onServiceClick:l})=>{const s=C(),t=h=>{l?l(h):s({to:"/services/$service",params:{service:h}})},{data:a}=n.use(r),{vulnerabilities:o}=v(a),c=o.find(h=>h.name===i);if(!c)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",i]});const u=c.services||[];return u.length===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx("div",{className:"mb-4",children:e.jsx(n.Suspense,{fallback:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]}),children:e.jsx(d,{gap:"4",direction:"horizontal",wrap:!0,children:u.map((h,j)=>e.jsx("a",{href:"#",onClick:w=>{w.preventDefault(),t(h.ccrn)},className:"link-hover",children:h.ccrn},j))})})})},K=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:l}=n.use(i),{vulnerabilities:s}=v(l),t=s.find(a=>a.name===r);return t?e.jsx(d,{gap:"1",direction:"horizontal",wrap:!0,children:e.jsx(n.Suspense,{fallback:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]}),children:t.supportGroups?.map(a=>e.jsx(M,{pillValue:a,pillValueLabel:a},a))})}):null},W=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:l}=n.use(i),{vulnerabilities:s}=v(l),t=s.find(o=>o.name===r),{servicesCount:a}=t||{servicesCount:0};return a},_=()=>{const i=C(),{queryClient:r,apiClient:l}=z({from:"/vulnerabilities/"}),{vulnerability:s}=P({from:"/vulnerabilities/"}),[t,a]=n.useState(void 0),o=n.useMemo(()=>{if(s)return y({queryClient:r,apiClient:l,filterSettings:{selectedFilters:[{name:"name",value:s}]}})},[s,r,l]),c=n.useMemo(()=>{if(s)return y({queryClient:r,apiClient:l,filterSettings:{selectedFilters:[{name:"name",value:s}]},afterServices:t})},[s,t,r,l]),u=n.useCallback(()=>{i({to:"/vulnerabilities",search:j=>{const{vulnerability:w,...L}=j;return{...L}}})},[i]),h=n.useCallback(j=>{i({to:"/services/$service",params:{service:j}})},[i]);return e.jsx(q,{heading:s?`${s} Overview`:void 0,opened:!!s,onClose:u,size:"large",children:e.jsx(I,{children:s&&o&&c&&e.jsx(n.Suspense,{children:e.jsxs(k,{columns:2,gridColumnTemplate:"15% auto",minContentColumns:[1],className:"mb-6",children:[e.jsxs(f,{children:[e.jsx(p,{className:"whitespace-nowrap",children:"Support Groups"}),e.jsx(x,{children:e.jsx(K,{vulnerabilitiesPromise:o,vulnerabilityName:s})})]}),e.jsxs(f,{children:[e.jsxs(p,{className:"whitespace-nowrap",children:["Services (",e.jsx(n.Suspense,{children:e.jsx(W,{vulnerabilitiesPromise:o,vulnerabilityName:s})}),")"]}),e.jsx(x,{children:e.jsx(G,{vulnerabilityName:s,vulnerabilitiesPromise:c,onServiceClick:h})})]})]})})})})},J=()=>{const{queryClient:i,apiClient:r}=z({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:l,filterSettings:s}=N({from:"/vulnerabilities/"}),[t,a]=n.useState(l),o=n.useCallback(c=>{const u=y({queryClient:i,apiClient:r,filterSettings:s,after:c});a(u)},[a,i,r,s]);return n.useEffect(()=>{a(l)},[a,l]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(k,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(f,{children:[e.jsx(p,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Services"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),e.jsx(n.Suspense,{fallback:e.jsx(S,{colSpan:5,children:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(b,{variant:"primary"})]})}),children:e.jsx(R,{vulnerabilitiesPromise:t})})]}),e.jsx(n.Suspense,{children:e.jsx(T,{dataPromise:t,goToPage:o,dataNormalizationMethod:v})}),e.jsx(_,{})]})},Q=()=>{const i=C(),{filters:r,filterSettings:l}=N({from:"/vulnerabilities/"}),s=n.useCallback(t=>{i({to:"/vulnerabilities",search:{...V(t)}})},[l,i]);return e.jsx(O,{filters:r,filterSettings:l,onFilterChange:s,searchInputPlaceholder:"search term for vulnerabilities name"})},X=({vulnerabilitiesPromise:i})=>{const{error:r,data:l}=n.use(i),{vulnerabilitiesCounts:s}=v(l);return e.jsx(d,{gap:"1",children:r?e.jsx("div",{className:"font-bold",children:"All vulnerabilities: --"}):e.jsx($,{counts:s})})},Y=()=>{const{vulnerabilitiesPromise:i}=N({from:"/vulnerabilities/"});return e.jsx(d,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(b,{size:"small"}),children:e.jsx(X,{vulnerabilitiesPromise:i})})})},Z=()=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(b,{size:"small"})}),children:[e.jsx(Y,{}),e.jsx(J,{})]})]});m.object({vulnerability:m.string().optional(),searchTerm:m.preprocess(i=>typeof i=="number"?i.toString():i,m.string().optional())}).catchall(m.preprocess((i,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(E)))return i},m.union([m.string(),m.array(m.string()),m.undefined()])));const ce=Z;export{ce as component};
