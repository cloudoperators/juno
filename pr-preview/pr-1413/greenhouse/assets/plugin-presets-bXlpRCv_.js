import{j as e,o as C,d as h,V as d,e as A,T as I,f as L,Q as O,q as z,g as y,i as g,h as K,Y as E,P as M,n as x,k as N,l as w,m as D,p as U,N as k,r as H,s as X,t as Y,u as q,v as V,w as G,S,x as Q,y as W,z as f,Z,X as J,A as $,B as v,C as _,E as ee,F as se,H as te}from"./Shell-CcQDY_mB.js";import{r as o,R as ae}from"./index-BIxrmEyE.js";import{E as T}from"./ErrorMessage-DBm3kogt.js";import"./index-D0RYjcDb.js";const F=({colSpan:a,children:s})=>e.jsx(C,{children:e.jsx(h,{colSpan:a,children:s})}),P={True:"success",False:"error",Unknown:"warning"},re=({condition:a})=>{const s=P[a.status]??P.Unknown,t=A(a.type);return e.jsxs(I,{triggerEvent:"hover",children:[e.jsx(L,{asChild:!0,children:e.jsx(O,{icon:!0,text:t,variant:s})}),e.jsx(z,{children:a.type})]})},ne=({conditions:a})=>e.jsx(d,{gap:"2",children:a.map(s=>e.jsx(re,{condition:s},s.type))}),le=({pluginPresetsPromise:a,colSpan:s})=>{const t=o.use(a);return!t||t.length===0?e.jsx(F,{colSpan:s,children:"No plugin presets found."}):e.jsx(e.Fragment,{children:t.map(r=>e.jsxs(C,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(y,{icon:g(r)?"checkCircle":"error",color:g(r)?"text-theme-success":"text-theme-danger"})}),e.jsxs(h,{children:[r.status?.readyPlugins||0,"/",r.status?.totalPlugins||0]}),e.jsx(h,{children:r.metadata?.name}),e.jsx(h,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[r.spec?.plugin?.pluginDefinitionRef.name||r.spec?.plugin?.pluginDefinition,!!r.spec?.plugin?.pluginDefinition&&e.jsx("a",{target:"_blank",href:r.spec?.plugin?.pluginDefinition,children:e.jsx(y,{size:"18",icon:"openInNew"})})]})}),e.jsx(h,{children:g(r)?"":K(r)?.message}),e.jsx(h,{children:e.jsx(ne,{conditions:r.status?.statusConditions?.conditions||[]})}),e.jsx(h,{nowrap:!0,children:e.jsx(E,{size:"small",variant:"primary",className:"w-fit",children:"View details"})})]},r.metadata?.name))})},ie=({colSpan:a})=>e.jsx(F,{colSpan:a,children:e.jsx(d,{gap:"2",alignment:"center",children:e.jsx("div",{children:"Loading..."})})}),ce=o.createContext(null),b={didCatch:!1,error:null};let oe=class extends o.Component{constructor(s){super(s),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=b}static getDerivedStateFromError(s){return{didCatch:!0,error:s}}resetErrorBoundary(){const{error:s}=this.state;if(s!==null){for(var t,r,l=arguments.length,n=new Array(l),i=0;i<l;i++)n[i]=arguments[i];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:n,reason:"imperative-api"}),this.setState(b)}}componentDidCatch(s,t){var r,l;(r=(l=this.props).onError)===null||r===void 0||r.call(l,s,t)}componentDidUpdate(s,t){const{didCatch:r}=this.state,{resetKeys:l}=this.props;if(r&&t.error!==null&&de(s.resetKeys,l)){var n,i;(n=(i=this.props).onReset)===null||n===void 0||n.call(i,{next:l,prev:s.resetKeys,reason:"keys"}),this.setState(b)}}render(){const{children:s,fallbackRender:t,FallbackComponent:r,fallback:l}=this.props,{didCatch:n,error:i}=this.state;let u=s;if(n){const m={error:i,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")u=t(m);else if(r)u=o.createElement(r,m);else if(l!==void 0)u=l;else throw i}return o.createElement(ce.Provider,{value:{didCatch:n,error:i,resetErrorBoundary:this.resetErrorBoundary}},u)}};function de(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a.length!==s.length||a.some((t,r)=>!Object.is(t,s[r]))}const B=({children:a,displayErrorMessage:s,fallbackRender:t,resetKeys:r})=>e.jsx(oe,{resetKeys:r,fallbackRender:s?t||T:()=>null,children:a}),ue=({colspan:a})=>{const s=({error:t})=>e.jsx(F,{colSpan:a,children:e.jsx(d,{gap:"2",alignment:"center",children:e.jsx(T,{error:t})})});return s.displayName="ErrorDataRow",s},p=7,he=({pluginPresetsPromise:a})=>e.jsxs(M,{minContentColumns:[0,1,6],columns:p,children:[e.jsxs(C,{children:[e.jsx(x,{children:e.jsx(y,{icon:"monitorHeart"})}),e.jsx(x,{children:"Instances"}),e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Plugin Definition"}),e.jsx(x,{children:"Message"}),e.jsx(x,{children:"Readiness Conditions"}),e.jsx(x,{children:"Actions"})]}),e.jsx(B,{displayErrorMessage:!0,fallbackRender:ue({colspan:p}),resetKeys:[a],children:e.jsx(o.Suspense,{fallback:e.jsx(ie,{colSpan:p}),children:e.jsx(le,{pluginPresetsPromise:a,colSpan:p})})})]}),xe=({filtersPromise:a,onChange:s})=>{const[t,r]=o.useState(""),[l,n]=o.useState(""),i=o.use(a),u=i.find(c=>c.id===t)?.values?.filter(c=>c),m=o.useCallback(c=>{n(c),!N(t)&&!N(c)&&s({id:t,value:c}),setTimeout(()=>{n("")},0)},[t,n,s]);return e.jsx(d,{alignment:"center",gap:"8",children:e.jsxs(w,{children:[e.jsx(D,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:t,onChange:c=>{r(String(c))},children:i?.map(({label:c,id:j})=>e.jsx(U,{value:j,label:c,"data-testid":j},j))}),e.jsx(k,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:l,disabled:!t,onChange:m,children:u?.map(c=>e.jsx(H,{value:c,label:c,"data-testid":c},c))})]})})},me=({selectedFilters:a,onDelete:s})=>e.jsx(d,{gap:"2",wrap:!0,children:a?.map(t=>e.jsx(X,{closeable:!0,pillKey:t.id,pillValue:t.value,onClose:()=>s(t)},`${t.id}:${t.value}`))}),R=({loading:a,error:s})=>e.jsx(d,{alignment:"center",gap:"8",children:e.jsxs(w,{children:[e.jsx(D,{loading:a,className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",errortext:s?s.message||"Error loading filters":void 0}),e.jsx(k,{disabled:!0,className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue"})]})}),pe=({filtersPromise:a,filterSettings:s,onFilterChange:t,searchInputPlaceholder:r})=>{const l=o.useCallback(n=>{t({...s,selectedFilters:s.selectedFilters?.filter(i=>!(i.id===n.id&&i.value===n.value))})},[s,t]);return e.jsxs(d,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(d,{alignment:"start",gap:"4",children:[e.jsx(w,{children:e.jsx(B,{displayErrorMessage:!0,fallbackRender:n=>e.jsx(R,{...n}),children:e.jsx(o.Suspense,{fallback:e.jsx(R,{loading:!0}),children:e.jsx(xe,{filtersPromise:a,onChange:n=>{s.selectedFilters?.some(u=>u.id===n.id&&u.value===n.value)||t({...s,selectedFilters:[...s.selectedFilters||[],n]})}})})})}),e.jsx(E,{label:"Clear all",className:"ml-4",onClick:()=>t({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(Y,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:n=>{t({...s,searchTerm:n})},onClear:()=>t({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(me,{selectedFilters:s.selectedFilters,onDelete:l})]})},je=()=>{const a=q(),{filtersPromise:s,filterSettings:t}=V({from:"/admin/plugin-presets"}),r=o.useCallback(l=>{a({to:"/admin/plugin-presets",search:n=>{const i=G(l);return{...Object.fromEntries(Object.entries(n).filter(([m])=>!m.startsWith(S))),...i}}})},[a]);return e.jsx(pe,{filtersPromise:s,filterSettings:t,onFilterChange:r,searchInputPlaceholder:"search term for plugin presets name"})},ge=({label:a,value:s,subtext:t,variant:r="default"})=>{const l=()=>{switch(r){case"success":return"text-theme-success";case"warning":return"text-theme-warning";case"danger":return"text-theme-danger";default:return"text-theme-default"}};return e.jsx(Q,{padding:!0,className:"flex-1",children:e.jsxs(d,{direction:"vertical",gap:"1",className:"flex-1",children:[e.jsx("span",{className:"text-theme-light text-sm",children:a}),e.jsxs(d,{direction:"horizontal",gap:"1",alignment:"baseline",children:[e.jsx("span",{className:`text-2xl font-bold ${l()}`,children:s}),t&&e.jsx("span",{className:"text-xs text-theme-light",children:t})]})]})})},fe=({statsPromise:a})=>ae.use(a).map((t,r)=>e.jsx(ge,{label:t.label,value:t.value,subtext:t.subtext,variant:t.variant},r)),ve=({statsPromise:a})=>e.jsxs(d,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"PluginPreset Health Distribution"}),e.jsx(d,{direction:"horizontal",gap:"4",className:"w-full",children:e.jsx(o.Suspense,{fallback:"Loading...",children:e.jsx(fe,{statsPromise:a})})})]}),be=()=>{const a=W(),{pluginPresetsPromise:s,statsPromise:t,lastUpdatedAt:r}=V({from:"/admin/plugin-presets"}),l=()=>{a.invalidate()};return e.jsxs(e.Fragment,{children:[e.jsxs(f,{px:!1,py:!0,children:[e.jsx(Z,{children:"Plugin Presets Overview"}),e.jsx("p",{children:"Manage and monitor plugin preset configurations across all clusters"})]}),e.jsx(f,{px:!1,py:!0,children:e.jsx(ve,{statsPromise:t})}),e.jsxs(f,{px:!1,py:!0,children:[e.jsx(je,{}),e.jsx(J,{children:e.jsx(d,{children:e.jsxs(d,{alignment:"center",children:[r&&`Last update: ${new Date(r).toLocaleString()}`,e.jsx(E,{size:"small",label:"Refresh",className:"ml-4",onClick:l,variant:"subdued"})]})})}),e.jsx(he,{pluginPresetsPromise:s})]})]})};$({searchTerm:v().optional()}).catchall(_((a,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(S)))return a},ee([v(),se(v()),te()])));const Ne=be;export{Ne as component};
