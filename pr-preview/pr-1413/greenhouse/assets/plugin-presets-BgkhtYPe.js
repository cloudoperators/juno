import{j as e,o as C,d as h,V as o,e as I,T as A,f as L,Q as O,q as M,g as y,i as g,h as z,Y as E,P as K,n as x,k as F,l as w,m as D,p as U,N as V,r as H,s as Y,t as q,u as G,v as N,w as Q,S,x as W,y as Z,A as X,z as f,Z as J,B as _,C as v,E as $,F as ee,H as se,I as te}from"./Shell-C-XK4HgO.js";import{r as d,R as ae}from"./index-CvbMxmaL.js";import{E as T}from"./ErrorMessage-CajTnLXT.js";import"./index-C4eKzRfm.js";const P=({colSpan:a,children:s})=>e.jsx(C,{children:e.jsx(h,{colSpan:a,children:s})}),R={True:"success",False:"error",Unknown:"warning"},re=({condition:a})=>{const s=R[a.status]??R.Unknown,t=I(a.type);return e.jsxs(A,{triggerEvent:"hover",children:[e.jsx(L,{asChild:!0,children:e.jsx(O,{text:t,icon:s!=="success",variant:s,"data-variant":s})}),e.jsx(M,{children:a.type})]})},ne=({conditions:a})=>e.jsx("div",{children:e.jsx(o,{gap:"2",children:e.jsx(o,{gap:"1",children:a.map(s=>e.jsx(re,{condition:s},s.type))})})}),le=({pluginPresetsPromise:a,colSpan:s})=>{const t=d.use(a);return!t||t.length===0?e.jsx(P,{colSpan:s,children:"No plugin presets found."}):e.jsx(e.Fragment,{children:t.map(r=>e.jsxs(C,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(y,{icon:g(r)?"checkCircle":"error",color:g(r)?"text-theme-success":"text-theme-danger"})}),e.jsxs(h,{children:[r.status?.readyPlugins||0,"/",r.status?.totalPlugins||0]}),e.jsx(h,{children:r.metadata?.name}),e.jsx(h,{children:e.jsxs("span",{className:"flex items-center gap-1",children:[r.spec?.plugin?.pluginDefinitionRef.name||r.spec?.plugin?.pluginDefinition,!!r.spec?.plugin?.pluginDefinition&&e.jsx("a",{target:"__blank",href:r.spec?.plugin?.pluginDefinition,children:e.jsx(y,{size:"18",icon:"openInNew"})})]})}),e.jsx(h,{children:g(r)?"":z(r)?.message}),e.jsx(h,{children:e.jsx(ne,{conditions:r.status?.statusConditions?.conditions||[]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx(E,{size:"small",variant:"primary",children:"View details"})})]},r.metadata?.name))})},ie=({colSpan:a})=>e.jsx(P,{colSpan:a,children:e.jsx(o,{gap:"2",alignment:"center",children:e.jsx("div",{children:"Loading..."})})}),ce=d.createContext(null),b={didCatch:!1,error:null};let oe=class extends d.Component{constructor(s){super(s),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=b}static getDerivedStateFromError(s){return{didCatch:!0,error:s}}resetErrorBoundary(){const{error:s}=this.state;if(s!==null){for(var t,r,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:n,reason:"imperative-api"}),this.setState(b)}}componentDidCatch(s,t){var r,i;(r=(i=this.props).onError)===null||r===void 0||r.call(i,s,t)}componentDidUpdate(s,t){const{didCatch:r}=this.state,{resetKeys:i}=this.props;if(r&&t.error!==null&&de(s.resetKeys,i)){var n,l;(n=(l=this.props).onReset)===null||n===void 0||n.call(l,{next:i,prev:s.resetKeys,reason:"keys"}),this.setState(b)}}render(){const{children:s,fallbackRender:t,FallbackComponent:r,fallback:i}=this.props,{didCatch:n,error:l}=this.state;let u=s;if(n){const m={error:l,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")u=t(m);else if(r)u=d.createElement(r,m);else if(i!==void 0)u=i;else throw l}return d.createElement(ce.Provider,{value:{didCatch:n,error:l,resetErrorBoundary:this.resetErrorBoundary}},u)}};function de(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a.length!==s.length||a.some((t,r)=>!Object.is(t,s[r]))}const B=({children:a,displayErrorMessage:s,fallbackRender:t,resetKeys:r})=>e.jsx(oe,{resetKeys:r,fallbackRender:s?t||T:()=>null,children:a}),ue=({colspan:a})=>{const s=({error:t})=>e.jsx(P,{colSpan:a,children:e.jsx(o,{gap:"2",alignment:"center",children:e.jsx(T,{error:t})})});return s.displayName="ErrorDataRow",s},p=7,he=({pluginPresetsPromise:a})=>e.jsxs(K,{minContentColumns:[0,1,5],columns:p,children:[e.jsxs(C,{children:[e.jsx(x,{children:e.jsx(y,{icon:"monitorHeart"})}),e.jsx(x,{children:"Instances"}),e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Plugin Definition"}),e.jsx(x,{children:"Message"}),e.jsx(x,{children:"Readiness Conditions"}),e.jsx(x,{children:"Actions"})]}),e.jsx(B,{displayErrorMessage:!0,fallbackRender:ue({colspan:p}),resetKeys:[a],children:e.jsx(d.Suspense,{fallback:e.jsx(ie,{colSpan:p}),children:e.jsx(le,{pluginPresetsPromise:a,colSpan:p})})})]}),xe=({filtersPromise:a,onChange:s})=>{const[t,r]=d.useState(""),[i,n]=d.useState(""),l=d.use(a),u=l.find(c=>c.id===t)?.values?.filter(c=>c),m=d.useCallback(c=>{n(c),!F(t)&&!F(c)&&s({id:t,value:c}),setTimeout(()=>{n("")},0)},[t,n,s]);return e.jsx(o,{alignment:"center",gap:"8",children:e.jsxs(w,{children:[e.jsx(D,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:t,onChange:c=>{r(String(c))},children:l?.map(({label:c,id:j})=>e.jsx(U,{value:j,label:c,"data-testid":j},j))}),e.jsx(V,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:i,disabled:!t,onChange:m,children:u?.map(c=>e.jsx(H,{value:c,label:c,"data-testid":c},c))})]})})},me=({selectedFilters:a,onDelete:s})=>e.jsx(o,{gap:"2",wrap:!0,children:a?.map(t=>e.jsx(Y,{closeable:!0,pillKey:t.id,pillValue:t.value,onClose:()=>s(t)},`${t.id}:${t.value}`))}),k=({loading:a,error:s})=>e.jsx(o,{alignment:"center",gap:"8",children:e.jsxs(w,{children:[e.jsx(D,{loading:a,className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",errortext:s?s.message||"Error loading filters":void 0}),e.jsx(V,{disabled:!0,className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue"})]})}),pe=({filtersPromise:a,filterSettings:s,onFilterChange:t,searchInputPlaceholder:r})=>{const i=d.useCallback(n=>{t({...s,selectedFilters:s.selectedFilters?.filter(l=>!(l.id===n.id&&l.value===n.value))})},[s,t]);return e.jsxs(o,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(o,{alignment:"start",gap:"4",children:[e.jsx(w,{children:e.jsx(B,{displayErrorMessage:!0,fallbackRender:n=>e.jsx(k,{...n}),children:e.jsx(d.Suspense,{fallback:e.jsx(k,{loading:!0}),children:e.jsx(xe,{filtersPromise:a,onChange:n=>{s.selectedFilters?.some(u=>u.id===n.id&&u.value===n.value)||t({...s,selectedFilters:[...s.selectedFilters||[],n]})}})})})}),e.jsx(E,{label:"Clear all",className:"ml-4",onClick:()=>t({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(q,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:n=>{t({...s,searchTerm:n})},onClear:()=>t({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(me,{selectedFilters:s.selectedFilters,onDelete:i})]})},je=()=>{const a=G(),{filtersPromise:s,filterSettings:t}=N({from:"/admin/plugin-presets"}),r=d.useCallback(i=>{a({to:"/admin/plugin-presets",search:n=>{const l=Q(i);return{...Object.fromEntries(Object.entries(n).filter(([m])=>!m.startsWith(S))),...l}}})},[a]);return e.jsx(pe,{filtersPromise:s,filterSettings:t,onFilterChange:r,searchInputPlaceholder:"search term for plugin presets name"})},ge=()=>{const a=W(),{lastUpdatedAt:s}=N({from:"/admin/plugin-presets"}),t=()=>{a.invalidate()};return e.jsx(o,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsxs(o,{alignment:"center",className:"ml-auto",children:[s&&`Last update: ${new Date(s).toLocaleString()}`,e.jsx(E,{label:"Refresh",className:"ml-4",onClick:t,variant:"subdued"})]})})},fe=({label:a,value:s,subtext:t,variant:r="default"})=>{const i=()=>{switch(r){case"success":return"text-theme-success";case"warning":return"text-theme-warning";case"danger":return"text-theme-danger";default:return"text-theme-default"}};return e.jsx(X,{padding:!0,className:"flex-1",children:e.jsxs(o,{direction:"vertical",gap:"1",className:"flex-1",children:[e.jsx("span",{className:"text-theme-light text-sm",children:a}),e.jsxs(o,{direction:"horizontal",gap:"1",alignment:"baseline",children:[e.jsx("span",{className:`text-2xl font-bold ${i()}`,children:s}),t&&e.jsx("span",{className:"text-xs text-theme-light",children:t})]})]})})},ve=({statsPromise:a})=>ae.use(a).map((t,r)=>e.jsx(fe,{label:t.label,value:t.value,subtext:t.subtext,variant:t.variant},r)),be=({statsPromise:a})=>e.jsxs(o,{direction:"vertical",gap:"4",children:[e.jsx("h3",{children:"PluginPreset Health Distribution"}),e.jsx(o,{direction:"horizontal",gap:"4",className:"w-full",children:e.jsx(d.Suspense,{fallback:e.jsx(Z,{}),children:e.jsx(ve,{statsPromise:a})})})]}),ye=()=>{const{pluginPresetsPromise:a,statsPromise:s}=N({from:"/admin/plugin-presets"});return e.jsxs(e.Fragment,{children:[e.jsxs(f,{px:!1,py:!0,children:[e.jsx(J,{children:"Plugin Presets Overview"}),e.jsx("p",{children:"Manage and monitor plugin preset configurations across all clusters"})]}),e.jsx(f,{px:!1,py:!0,children:e.jsx(be,{statsPromise:s})}),e.jsxs(f,{px:!1,py:!0,children:[e.jsx(je,{}),e.jsx(ge,{}),e.jsx(he,{pluginPresetsPromise:a})]})]})};_({searchTerm:v().optional()}).catchall($((a,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(S)))return a},ee([v(),se(v()),te()])));const Fe=ye;export{Fe as component};
