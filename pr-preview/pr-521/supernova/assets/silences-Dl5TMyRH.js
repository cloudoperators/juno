(function(){"use strict";function h(e){let t={serviceName:null,initialFetch:!0,fetchFn:null,watch:!0,watchInterval:3e5,onFetchStart:null,onFetchEnd:null,onFetchError:null,debug:!1},n=!1;const c=Object.keys(t);let s;const a=()=>{if(t.fetchFn)return t.onFetchStart&&t.onFetchStart(),t!=null&&t.debug&&console.info(`ApiService::${t.serviceName||""}: start fetch`),n=!0,t.fetchFn().then(()=>{t.onFetchEnd&&t.onFetchEnd()}).catch(r=>{console.warn("ApiService::%s:%s",t.serviceName,r),t.onFetchError&&t.onFetchError(r)});t!=null&&t.debug&&console.warn(`ApiService::${t.serviceName||""}: missing fetch function`)},T=r=>{n&&r.watch===t.watch&&r.watchInterval===t.watchInterval||(clearInterval(s),t.watch&&(s=setInterval(a,t.watchInterval||3e5)))};this.configure=r=>{const p={...t};t={...t,...r},Object.keys(t).forEach(i=>c.indexOf(i)<0&&delete t[i]),t!=null&&t.debug&&console.debug("ApiService::%s: new config: %s",t.serviceName,t),T(p),t.initialFetch&&!n&&a()},this.fetch=a,this.configure(e)}class u extends Error{constructor(t,n){super(n||t),this.name="HTTPError",this.statusCode=t}}const l=e=>e.status<400?e:e.text().then(t=>{var n=new u(e.status,t||e.statusText);return n.statusCode=e.status,n.httperror=!0,Promise.reject(n)}),E={"Content-Type":"application/json",Accept:"application/json"},f=(e,t={})=>{const n={headers:E,...t};return fetch(e,n).then(l).then(c=>{const s=c.headers.get("Content-Type");return s&&s.includes("application/json")?c.json():c.text()})},d=(e,t={})=>f(e,{method:"GET",...t}),S=e=>{const t={};return!e||e.length===0?{}:(e.forEach(n=>{var s;const c=(s=n.status)==null?void 0:s.state;t[c]||(t[c]=[]),t[c].push(n)}),t)},F=e=>d(`${e}/silences`,{}).then(t=>{const n=t.reduce((s,a)=>(s[a.id]=a,s),{}),c=S(t);self.postMessage({action:"SILENCES_UPDATE",silences:t,silencesHash:n,silencesBySate:c})}),o=new h({serviceName:"silences",debug:!0,onFetchStart:()=>self.postMessage({action:"SILENCES_FETCH_START"}),onFetchEnd:()=>self.postMessage({action:"SILENCES_FETCH_END"}),onFetchError:e=>{self.postMessage({action:"SILENCES_FETCH_ERROR",error:e.message})}});self.onmessage=e=>{var n;switch(e.data.action){case"SILENCES_CONFIGURE":(n=e.data)!=null&&n.apiEndpoint&&(e.data.fetchFn=()=>{var c;return F((c=e.data)==null?void 0:c.apiEndpoint)}),o.configure(e.data);break;case"SILENCES_FETCH":o.fetch();break}}})();
