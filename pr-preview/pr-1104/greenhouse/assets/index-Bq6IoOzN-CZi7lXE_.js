import{j as e,x as j,b as C,u as f,c as y,a as N,l as k,C as g,h as o,f as p,K as h,g as v,v as c,o as B,p as u,s as d,S as P,d as z,e as D,i as R}from"./App-DBksnQHs-fhT6VRVe.js";import{w as l}from"./index-DIzOKZWP.js";import{v as E,C as m,P as I,j as M,E as b}from"./CursorPagination-By4r6Isk-Jgr73zEF.js";import{B as T}from"./IssueTimestamp-DUQoMKrr-Dkwnggz5.js";import{C as U}from"./index-DvRotK2W-D4-UcenU.js";import"./index-BUHtvWOh.js";const q=i=>`
    border-l-2
    ${b(i)}
    h-full
    pl-5
  `,F=i=>{const s=i.toLowerCase(),r=b(i),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(p,{icon:n[s]||"help",color:r})},L=({vulnerability:i})=>{const[s,r]=l.useState(!1),{needsExpansion:n,textRef:a}=M(i.description),t=x=>{x.preventDefault(),r(!s)};return e.jsxs(g,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:q(i.severity),children:F(i.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(p,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:i.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(T,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:a,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&n&&e.jsx("a",{href:"#",onClick:t,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(p,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},O=({vulnerabilitiesPromise:i})=>{const{error:s,data:r}=l.use(i),{vulnerabilities:n}=v(r);return s?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(L,{vulnerability:a},a.name))},A=()=>{const{queryClient:i,apiClient:s}=E({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:r,filterSettings:n}=f({from:"/vulnerabilities/"}),[a,t]=l.useState(r),x=l.useCallback(S=>{const w=N({queryClient:i,apiClient:s,filterSettings:n,after:S});t(w)},[t,i,s,n]);return l.useEffect(()=>{t(r)},[t,r]),e.jsxs(e.Fragment,{children:[e.jsxs(k,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(g,{children:[e.jsx(o,{children:e.jsx(p,{icon:"monitorHeart"})}),e.jsx(o,{children:"Vulnerability"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(l.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(j,{variant:"primary"})]})}),children:e.jsx(O,{vulnerabilitiesPromise:a})})]}),e.jsx(l.Suspense,{children:e.jsx(I,{dataPromise:a,goToPage:x,dataNormalizationMethod:v})})]})},K=()=>{const i=C(),{filters:s,filterSettings:r}=f({from:"/vulnerabilities/"}),n=l.useCallback(a=>{i({to:"/vulnerabilities",search:{...y(a)}})},[r,i]);return e.jsx(U,{filters:s,filterSettings:r,onFilterChange:n,searchInputPlaceholder:"search term for vulnerabilities name"})},V=()=>e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(j,{size:"small"})}),children:e.jsx(A,{})})]});B({vulnerability:d().optional(),searchTerm:u(i=>typeof i=="number"?i.toString():i,d().optional())}).catchall(u((i,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(P)))return i},z([d(),D(d()),R()])));const G=V;export{G as component};
