import{j as e,C as j,v as l,K as p,f as h,g,u as f,a as S,l as E,h as c,x as b,b as N,c as T,o as y,p as m,s as d,S as F,d as D,e as V,i as R}from"./App-B2jdUlmg.js";import{a}from"./index-BDZeUQLf.js";import{u as I,g as v,E as u,a as L,C as P}from"./CursorPagination-D89Qn-iL.js";import{I as k}from"./IssueTimestamp-CMCvTHBs.js";import{F as z}from"./index-DJ_02qFo.js";const U=s=>`
    border-l-2
    ${v(s||"none")}
    h-full
    pl-5
  `,M=s=>{const r=(s||"none").toLowerCase(),n=v(s||"none"),i={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(h,{icon:i[r]||"help",color:n})},_=({vulnerability:s})=>{const[r,n]=a.useState(!1),{needsExpansion:i,textRef:t}=I(s.description),o=x=>{x.preventDefault(),n(!r)};return e.jsxs(j,{children:[e.jsx(l,{className:"pl-0",children:e.jsx("div",{className:U(s.severity),children:M(s.severity)})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(h,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsx(k,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(l,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:t,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&i&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(h,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},K=({vulnerabilitiesPromise:s})=>{const{error:r,data:n}=a.use(s),{vulnerabilities:i}=g(n);return r?e.jsxs(u,{colSpan:5,children:["Error loading vulnerabilities: ",r.message]}):i.length===0?e.jsx(u,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):i.map(t=>e.jsx(_,{vulnerability:t},t.name))},O=()=>{const{queryClient:s,apiClient:r}=L({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:i}=f({from:"/vulnerabilities/"}),[t,o]=a.useState(n),x=a.useCallback(C=>{const w=S({queryClient:s,apiClient:r,filterSettings:i,after:C});o(w)},[o,s,r,i]);return a.useEffect(()=>{o(n)},[o,n]),e.jsxs(e.Fragment,{children:[e.jsxs(E,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(j,{children:[e.jsx(c,{children:e.jsx(h,{icon:"monitorHeart"})}),e.jsx(c,{children:"Vulnerability"}),e.jsx(c,{children:"Services"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),e.jsx(a.Suspense,{fallback:e.jsx(u,{colSpan:5,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(b,{variant:"primary"})]})}),children:e.jsx(K,{vulnerabilitiesPromise:t})})]}),e.jsx(a.Suspense,{children:e.jsx(P,{dataPromise:t,goToPage:x,dataNormalizationMethod:g})})]})},q=()=>{const s=N(),{filters:r,filterSettings:n}=f({from:"/vulnerabilities/"}),i=a.useCallback(t=>{s({to:"/vulnerabilities",search:{...T(t)}})},[n,s]);return e.jsx(z,{filters:r,filterSettings:n,onFilterChange:i,searchInputPlaceholder:"search term for vulnerabilities name"})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(b,{size:"small"})}),children:e.jsx(O,{})})]});y({vulnerability:d().optional(),searchTerm:m(s=>typeof s=="number"?s.toString():s,d().optional())}).catchall(m((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(F)))return s},D([d(),V(d()),R()])));const B=A;export{B as component};
