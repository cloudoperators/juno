import{j as e,k as x,A as P,N as O,H as z,P as G,X as V,U as S,y as E,G as $,d as k,a as h,u as A,C as R,c as Z,E as _,e as M,b,r as L,x as B,F as H,s as K,g as T}from"./App-BhRtRAQ8.js";import{a as d}from"./index-ASvsQ40N.js";import{l as v,S as N,a as U,E as w,u as Q,I as X,b as q,O as J,c as W,g as Y,d as D,e as ee}from"./IssueCountsPerSeverityLevel-G84jRkMU.js";const se=({filters:s,onChange:t})=>{var u,o;const[a,r]=d.useState(""),[m]=d.useState(""),c=(o=(u=s.find(n=>n.filterName===a))==null?void 0:u.values)==null?void 0:o.filter(n=>n),i=d.useCallback(n=>{!v.isEmpty(a)&&!v.isEmpty(n)&&t({name:a,value:n})},[a,t]);return e.jsx(x,{alignment:"center",gap:"8",children:e.jsxs(P,{children:[e.jsx(O,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:n=>{r(String(n))},children:s==null?void 0:s.map(({displayName:n,filterName:p})=>e.jsx(z,{value:p,label:n,"data-testid":p},p))}),e.jsx(G,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:m,onChange:i,children:c==null?void 0:c.map(n=>e.jsx(V,{value:n,label:n,"data-testid":n},n))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ae=({selectedFilters:s,onDelete:t})=>e.jsx(x,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(E,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>t(a)},`${name}:${a.value}`))}),te=({filters:s,filterSettings:t,onFilterChange:a,searchInputPlaceholder:r})=>{const m=d.useCallback(c=>{var i;a({...t,selectedFilters:(i=t.selectedFilters)==null?void 0:i.filter(u=>!(u.name===c.name&&u.value===c.value))})},[t,a]);return e.jsxs(x,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(P,{children:[e.jsx(se,{filters:s,onChange:c=>{var i;a({...t,selectedFilters:(i=t==null?void 0:t.selectedFilters)==null?void 0:i.concat(c)})}}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>a({...t,selectedFilters:[]}),variant:"subdued"}),e.jsx($,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",onSearch:c=>{a({...t,searchTerm:c})},onClear:()=>a({...t,searchTerm:""})})]}),t.selectedFilters&&t.selectedFilters.length>0&&e.jsx(ae,{selectedFilters:t.selectedFilters,onDelete:m})]})},I={supportGroups:"support_group",region:"region",integrity:"integrity"},re=({serviceDetails:s})=>{const t=(a,r)=>e.jsx(E,{pillKey:a,pillKeyLabel:a,pillValue:r,pillValueLabel:r},r);return e.jsx(x,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,r])=>Array.isArray(r)?r.map(m=>t(I[a],m)):t(I[a],r))})},ne=({item:s,selected:t,onItemClick:a,onServiceDetailClick:r})=>e.jsxs(k,{className:`cursor-pointer ${t?"active":""}`,onClick:a,children:[e.jsx(h,{children:s.name}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(h,{children:e.jsx(re,{serviceDetails:s.serviceDetails})}),e.jsx(h,{className:"cursor-default interactive",onClick:m=>m.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),ce=({service:s,onClose:t})=>{const a=A();return e.jsx(R,{heading:`${Z(s.name)} Overview`,opened:!0,onClose:t,size:"large",children:e.jsx(_,{children:e.jsx(U,{service:s,onDetailsButtonClick:r=>a({to:"/services/$service",params:{service:s.name},search:{imageVersion:r==null?void 0:r.version}}),displayActions:!0})})})},F=8,le=({defaultSelectService:s,services:t,loading:a,error:r,currentPage:m,totalNumberOfPages:c,goToPage:i})=>{const u=A(),[o,n]=d.useState(null),p=d.useCallback(l=>{n(g=>(g==null?void 0:g.id)===l.id?null:l),u({to:"/services",search:{service:l.name}})},[]),C=d.useCallback(()=>{n(null),u({to:"/services"})},[]),j=d.useCallback(l=>{u({to:"/services/$service",params:{service:l.name}})},[]);return d.useEffect(()=>{n(t.find(l=>l.name===s)||null)},[s,t]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(M,{minContentColumns:[1,2,3,4,5,7],columns:F,children:[e.jsxs(k,{children:[e.jsx(b,{children:"Service"}),e.jsx(b,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(b,{children:"Details"}),e.jsx(b,{})]}),a&&e.jsx(w,{colSpan:F,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),!a&&!r&&t.length>0&&t.map(l=>e.jsx(ne,{item:l,selected:(o==null?void 0:o.id)===l.id,onItemClick:()=>p(l),onServiceDetailClick:()=>j(l)},l.id)),!a&&!r&&t.length===0&&e.jsx(w,{colSpan:F,children:"No services found"})]}),!!c&&e.jsx(x,{distribution:"end",className:"mt-4",children:e.jsx(B,{variant:"number",currentPage:m,onPressNext:i,onPressPrevious:i,pages:c})}),o&&e.jsx(H,{children:e.jsx(ce,{service:o,onClose:C})})]})},oe=s=>{var t;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((t=s==null?void 0:s.values)==null?void 0:t.filter(a=>a!==null))||[]}},ie=s=>v.isEmpty(s)||v.isEmpty(s.ServiceFilterValues)?[]:v.map(v.omit(s.ServiceFilterValues,["__typename"]),oe),ue=()=>{const{data:s,previousData:t,loading:a,error:r}=Q();return{serviceFilters:ie(v.isEmpty(s)?t:s),loading:a,error:r}},de=({loading:s,error:t,counts:a})=>e.jsxs(x,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(x,{gap:"1",children:!t&&!s?e.jsx(X,{counts:a}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(x,{alignment:"center",className:"ml-auto",children:s&&e.jsx(L,{size:"small",className:"mr-2"})})]}),me=({filterSettings:s,pageSize:t=20})=>{const a=d.useRef(null),[r,{data:m,loading:c,error:i}]=q({variables:{first:t,orderBy:[{by:W.Severity,direction:J.Desc}]},fetchPolicy:"network-only"}),{services:u,servicesIssuesCount:o,pages:n,pageNumber:p}=Y(m);a.current=n;const C=d.useCallback(j=>{var l,g;if(!v.isNil(j)){const f=(g=(l=a.current)==null?void 0:l.find(y=>(y==null?void 0:y.pageNumber)===j-1))==null?void 0:g.after;r({variables:{filter:D(s),after:f}})}},[s]);return d.useEffect(()=>{r({variables:{filter:D(s)}})},[s]),{loading:c,error:ee(i),services:u||[],servicesIssuesCount:o,currentPage:p,totalNumberOfPages:n.length||0,goToPage:C}},pe=s=>{var a;return{selectedFilters:((a=s==null?void 0:s.support_group)==null?void 0:a.map(r=>({name:"supportGroupCcrn",value:r})))??[],searchTerm:""}},xe=({defaultSelectService:s,initialFilters:t})=>{const{serviceFilters:a}=ue(),{addMessage:r,resetMessages:m}=K(),[c,i]=d.useState(pe(t)),{loading:u,error:o,services:n,servicesIssuesCount:p,currentPage:C,totalNumberOfPages:j,goToPage:l}=me({filterSettings:c});return d.useEffect(()=>{o?r({variant:"error",text:o}):m()},[o]),e.jsxs(e.Fragment,{children:[e.jsx(te,{filters:a,filterSettings:c,onFilterChange:i,searchInputPlaceholder:"search term for services name"}),e.jsx(de,{counts:p,loading:u,error:o}),e.jsx(le,{defaultSelectService:s,services:n,loading:u,error:o,currentPage:C,totalNumberOfPages:j,goToPage:l})]})},ge=function(){const t=T("/services/"),{appProps:a}=t.useRouteContext(),{service:r}=t.useSearch();return e.jsx(xe,{defaultSelectService:r,initialFilters:a.initialFilters})};export{ge as component};
