import{g as V,j as e,s as T,k as g,A as k,U as S,G as O,r as I,u as D,e as $,d as W,b,x as A,F as Z,N as z,H as B,P as L,X as R,y as _,a as p,C as G,c as K,E as M}from"./App-CBrE6jxj-ZDgq8nfL.js";import{w as m}from"./index-CSTZsjTl.js";import{l as q,j as h,d as H,q as J,J as Q,g as U,v as w,i as X,y as Y,x as F,f as C,a as ee}from"./IssueCountsPerSeverityLevel-DgTR-YO8-BWLW8PAC.js";import"./index-CFvdG9RL.js";const se=({filters:s,onChange:a})=>{var l,r;const[n,o]=m.useState(""),[c]=m.useState(""),u=(r=(l=s.find(i=>i.filterName===n))==null?void 0:l.values)==null?void 0:r.filter(i=>i),d=m.useCallback(i=>{!h.isEmpty(n)&&!h.isEmpty(i)&&a({name:n,value:i})},[n,a]);return e.jsx(g,{alignment:"center",gap:"8",children:e.jsxs(k,{children:[e.jsx(z,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:n,onChange:i=>{o(String(i))},children:s==null?void 0:s.map(({displayName:i,filterName:v})=>e.jsx(B,{value:v,label:i,"data-testid":v},v))}),e.jsx(L,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,onChange:d,children:u==null?void 0:u.map(i=>e.jsx(R,{value:i,label:i,"data-testid":i},i))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ae=({selectedFilters:s,onDelete:a})=>e.jsx(g,{gap:"2",wrap:!0,children:s==null?void 0:s.map(l=>e.jsx(_,{closeable:!0,pillKey:l.name,pillValue:l.value,onClose:()=>a(l)},`${name}:${l.value}`))}),le=({filters:s,filterSettings:a,onFilterChange:l,searchInputPlaceholder:r})=>{const n=m.useCallback(o=>{var c;l({...a,selectedFilters:(c=a.selectedFilters)==null?void 0:c.filter(u=>!(u.name===o.name&&u.value===o.value))})},[a,l]);return e.jsxs(g,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(k,{children:[e.jsx(se,{filters:s,onChange:o=>{var c;l({...a,selectedFilters:(c=a==null?void 0:a.selectedFilters)==null?void 0:c.concat(o)})}}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>l({...a,selectedFilters:[]}),variant:"subdued"}),e.jsx(O,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",onSearch:o=>{l({...a,searchTerm:o})},onClear:()=>l({...a,searchTerm:""})})]}),a.selectedFilters&&a.selectedFilters.length>0&&e.jsx(ae,{selectedFilters:a.selectedFilters,onDelete:n})]})},P={supportGroups:"support_group",region:"region",integrity:"integrity"},re=({serviceDetails:s})=>{const a=(l,r)=>e.jsx(_,{pillKey:l,pillKeyLabel:l,pillValue:r,pillValueLabel:r},r);return e.jsx(g,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([l,r])=>Array.isArray(r)?r.map(n=>a(P[l],n)):a(P[l],r))})},ie=({item:s,selected:a,onItemClick:l,onServiceDetailClick:r})=>e.jsxs(W,{className:`cursor-pointer ${a?"active":""}`,onClick:l,children:[e.jsx(p,{children:s.name}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(p,{children:e.jsx(re,{serviceDetails:s.serviceDetails})}),e.jsx(p,{className:"cursor-default interactive",onClick:n=>n.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),te=({service:s,onClose:a})=>{const l=D();return e.jsx(G,{heading:`${K(s.name)} Overview`,opened:!0,onClose:a,size:"large",children:e.jsx(M,{children:e.jsx(ee,{service:s,onDetailsButtonClick:r=>l({to:"/services/$service",params:{service:s.name},search:{imageVersion:r==null?void 0:r.version}}),displayActions:!0})})})},N=8,ne=({defaultSelectService:s,services:a,loading:l,error:r,currentPage:n,totalNumberOfPages:o,goToPage:c})=>{const u=D(),[d,i]=m.useState(null),v=m.useCallback(t=>{i(j=>(j==null?void 0:j.id)===t.id?null:t),u({to:"/services",search:{service:t.name}})},[]),f=m.useCallback(()=>{i(null),u({to:"/services"})},[]),x=m.useCallback(t=>{u({to:"/services/$service",params:{service:t.name}})},[]);return m.useEffect(()=>{i(a.find(t=>t.name===s)||null)},[s,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:N,children:[e.jsxs(W,{children:[e.jsx(b,{children:"Service"}),e.jsx(b,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(b,{children:"Details"}),e.jsx(b,{})]}),l&&e.jsx(F,{colSpan:N,children:e.jsxs(g,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(I,{variant:"primary"})]})}),!l&&!r&&a.length>0&&a.map(t=>e.jsx(ie,{item:t,selected:(d==null?void 0:d.id)===t.id,onItemClick:()=>v(t),onServiceDetailClick:()=>x(t)},t.id)),!l&&!r&&a.length===0&&e.jsx(F,{colSpan:N,children:"No services found"})]}),!!o&&e.jsx(g,{distribution:"end",className:"mt-4",children:e.jsx(A,{variant:"number",currentPage:n,onPressNext:c,onPressPrevious:c,pages:o})}),d&&e.jsx(Z,{children:e.jsx(te,{service:d,onClose:f})})]})},oe=s=>{var a;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((a=s==null?void 0:s.values)==null?void 0:a.filter(l=>l!==null))||[]}},ce=s=>h.isEmpty(s)||h.isEmpty(s.ServiceFilterValues)?[]:h.map(h.omit(s.ServiceFilterValues,["__typename"]),oe),ue=()=>{const{data:s,previousData:a,loading:l,error:r}=q();return{serviceFilters:ce(h.isEmpty(s)?a:s),loading:l,error:r}},de=({loading:s,error:a,counts:l})=>e.jsxs(g,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(g,{gap:"1",children:!a&&!s?e.jsx(Y,{counts:l}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(g,{alignment:"center",className:"ml-auto",children:s&&e.jsx(I,{size:"small",className:"mr-2"})})]}),me=({filterSettings:s,pageSize:a=20})=>{const l=m.useRef(null),[r,{data:n,loading:o,error:c}]=H({variables:{first:a,orderBy:[{by:Q.Severity,direction:J.Desc}]},fetchPolicy:"network-only"}),{services:u,servicesIssuesCount:d,pages:i,pageNumber:v}=U(n);l.current=i;const f=m.useCallback(x=>{var t,j;if(!h.isNil(x)){const E=(j=(t=l.current)==null?void 0:t.find(y=>(y==null?void 0:y.pageNumber)===x-1))==null?void 0:j.after;r({variables:{filter:w(s),after:E}})}},[s]);return m.useEffect(()=>{r({variables:{filter:w(s)}})},[s]),{loading:o,error:X(c),services:u||[],servicesIssuesCount:d,currentPage:v,totalNumberOfPages:i.length||0,goToPage:f}},ve=s=>{var a;return{selectedFilters:((a=s==null?void 0:s.support_group)==null?void 0:a.map(l=>({name:"supportGroupCcrn",value:l})))??[],searchTerm:""}},ge=({defaultSelectService:s,initialFilters:a})=>{const{serviceFilters:l}=ue(),{addMessage:r,resetMessages:n}=T(),[o,c]=m.useState(ve(a)),{loading:u,error:d,services:i,servicesIssuesCount:v,currentPage:f,totalNumberOfPages:x,goToPage:t}=me({filterSettings:o});return m.useEffect(()=>{d?r({variant:"error",text:d}):n()},[d]),e.jsxs(e.Fragment,{children:[e.jsx(le,{filters:l,filterSettings:o,onFilterChange:c,searchInputPlaceholder:"search term for services name"}),e.jsx(de,{counts:v,loading:u,error:d}),e.jsx(ne,{defaultSelectService:s,services:i,loading:u,error:d,currentPage:f,totalNumberOfPages:x,goToPage:t})]})},je=function(){const s=V("/services/"),{appProps:a}=s.useRouteContext(),{service:l}=s.useSearch();return e.jsx(ge,{defaultSelectService:l,initialFilters:a.initialFilters})};export{je as component};
