import{aw as Z,ax as K,ay as v,az as P,aA as j,aB as D,aC as A,aD as $,aE as ue,aF as F,aG as de,aH as fe,aI as V,aJ as U,aK as H,aL as pe,aM as L,y as _,aN as ee,w as te,d as se,g as re,j as a,Y as ne,E as ie,a as ae,D as me,F as ye,V as be,b as ge,$ as ve,H as k,I as Se,S as we,R as xe,K as Ee,aO as Re,aP as Ce}from"./App-Bw3NadcU.js";import{r as f}from"./index-l957sLqz.js";var Oe=class extends Z{constructor(e,t){super(),this.options=t,this.#s=e,this.#o=null,this.#a=K(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#r=void 0;#t=void 0;#n;#i;#a;#o;#m;#d;#f;#l;#h;#c;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),q(this.#e,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Q(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Q(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#S(),this.#w(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof v(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#x(),this.#e.setOptions(this.options),t._defaulted&&!P(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const s=this.hasListeners();s&&z(this.#e,r,this.options,t)&&this.#u(),this.updateResult(),s&&(this.#e!==r||v(this.options.enabled,this.#e)!==v(t.enabled,this.#e)||j(this.options.staleTime,this.#e)!==j(t.staleTime,this.#e))&&this.#y();const n=this.#b();s&&(this.#e!==r||v(this.options.enabled,this.#e)!==v(t.enabled,this.#e)||n!==this.#c)&&this.#g(n)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),r=this.createResult(t,e);return Ie(this,r)&&(this.#t=r,this.#i=this.options,this.#n=this.#e.state),r}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(r,s)=>(this.trackProp(s),t?.(s),s==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,s))})}trackProp(e){this.#p.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),r=this.#s.getQueryCache().build(this.#s,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#u(e){this.#x();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(D)),t}#y(){this.#S();const e=j(this.options.staleTime,this.#e);if(A||this.#t.isStale||!$(e))return;const r=ue(this.#t.dataUpdatedAt,e)+1;this.#l=F.setTimeout(()=>{this.#t.isStale||this.updateResult()},r)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#w(),this.#c=e,!(A||v(this.options.enabled,this.#e)===!1||!$(this.#c)||this.#c===0)&&(this.#h=F.setInterval(()=>{(this.options.refetchIntervalInBackground||de.isFocused())&&this.#u()},this.#c))}#v(){this.#y(),this.#g(this.#b())}#S(){this.#l&&(F.clearTimeout(this.#l),this.#l=void 0)}#w(){this.#h&&(F.clearInterval(this.#h),this.#h=void 0)}createResult(e,t){const r=this.#e,s=this.options,n=this.#t,l=this.#n,i=this.#i,g=e!==r?e.state:this.#r,{state:h}=e;let c={...h},p=!1,d;if(t._optimisticResults){const b=this.hasListeners(),M=!b&&q(e,t),C=b&&z(e,r,t,s);(M||C)&&(c={...c,...fe(h.data,e.options)}),t._optimisticResults==="isRestoring"&&(c.fetchStatus="idle")}let{error:S,errorUpdatedAt:w,status:x}=c;d=c.data;let I=!1;if(t.placeholderData!==void 0&&d===void 0&&x==="pending"){let b;n?.isPlaceholderData&&t.placeholderData===i?.placeholderData?(b=n.data,I=!0):b=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,b!==void 0&&(x="success",d=V(n?.data,b,t),p=!0)}if(t.select&&d!==void 0&&!I)if(n&&d===l?.data&&t.select===this.#m)d=this.#d;else try{this.#m=t.select,d=t.select(d),d=V(n?.data,d,t),this.#d=d,this.#o=null}catch(b){this.#o=b}this.#o&&(S=this.#o,d=this.#d,w=Date.now(),x="error");const O=c.fetchStatus==="fetching",E=x==="pending",o=x==="error",m=E&&O,R=d!==void 0,y={status:x,fetchStatus:c.fetchStatus,isPending:E,isSuccess:x==="success",isError:o,isInitialLoading:m,isLoading:m,data:d,dataUpdatedAt:c.dataUpdatedAt,error:S,errorUpdatedAt:w,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>g.dataUpdateCount||c.errorUpdateCount>g.errorUpdateCount,isFetching:O,isRefetching:O&&!E,isLoadingError:o&&!R,isPaused:c.fetchStatus==="paused",isPlaceholderData:p,isRefetchError:o&&R,isStale:B(e,t),refetch:this.refetch,promise:this.#a,isEnabled:v(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const b=N=>{y.status==="error"?N.reject(y.error):y.data!==void 0&&N.resolve(y.data)},M=()=>{const N=this.#a=y.promise=K();b(N)},C=this.#a;switch(C.status){case"pending":e.queryHash===r.queryHash&&b(C);break;case"fulfilled":(y.status==="error"||y.data!==C.value)&&M();break;case"rejected":(y.status!=="error"||y.error!==C.reason)&&M();break}}return y}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#n=this.#e.state,this.#i=this.options,this.#n.data!==void 0&&(this.#f=this.#e),P(t,e))return;this.#t=t;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,n=typeof s=="function"?s():s;if(n==="all"||!n&&!this.#p.size)return!0;const l=new Set(n??this.#p);return this.options.throwOnError&&l.add("error"),Object.keys(this.#t).some(i=>{const u=i;return this.#t[u]!==e[u]&&l.has(u)})};this.#E({listeners:r()})}#x(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#E(e){U.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function je(e,t){return v(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function q(e,t){return je(e,t)||e.state.data!==void 0&&Q(e,t,t.refetchOnMount)}function Q(e,t,r){if(v(t.enabled,e)!==!1&&j(t.staleTime,e)!=="static"){const s=typeof r=="function"?r(e):r;return s==="always"||s!==!1&&B(e,t)}return!1}function z(e,t,r,s){return(e!==t||v(s.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&B(e,r)}function B(e,t){return v(t.enabled,e)!==!1&&e.isStaleByTime(j(t.staleTime,e))}function Ie(e,t){return!P(e.getCurrentResult(),t)}var Te=class extends Z{#s;#e=void 0;#r;#t;constructor(e,t){super(),this.#s=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#s.defaultMutationOptions(e),P(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&H(t.mutationKey)!==H(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#i(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#i()}mutate(e,t){return this.#t=t,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(e)}#n(){const e=this.#r?.state??pe();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#i(e){U.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#e.variables,r=this.#e.context,s={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#t.onSuccess?.(e.data,t,r,s)}catch(n){Promise.reject(n)}try{this.#t.onSettled?.(e.data,null,t,r,s)}catch(n){Promise.reject(n)}}else if(e?.type==="error"){try{this.#t.onError?.(e.error,t,r,s)}catch(n){Promise.reject(n)}try{this.#t.onSettled?.(void 0,e.error,t,r,s)}catch(n){Promise.reject(n)}}}this.listeners.forEach(t=>{t(this.#e)})})}},oe=f.createContext(!1),Me=()=>f.useContext(oe);oe.Provider;function Ne(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Fe=f.createContext(Ne()),Pe=()=>f.useContext(Fe),De=(e,t,r)=>{const s=r?.state.error&&typeof e.throwOnError=="function"?L(e.throwOnError,[r.state.error,r]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||s)&&(t.isReset()||(e.retryOnMount=!1))},Ue=e=>{f.useEffect(()=>{e.clearReset()},[e])},_e=({result:e,errorResetBoundary:t,throwOnError:r,query:s,suspense:n})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(n&&e.data===void 0||L(r,[e.error,s])),ke=e=>{if(e.suspense){const r=n=>n==="static"?n:Math.max(n??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...n)=>r(s(...n)):r(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ae=(e,t)=>e.isLoading&&e.isFetching&&!t,Qe=(e,t)=>e?.suspense&&t.isPending,G=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function Le(e,t,r){const s=Me(),n=Pe(),l=_(),i=l.defaultQueryOptions(e);l.getDefaultOptions().queries?._experimental_beforeQuery?.(i);const u=l.getQueryCache().get(i.queryHash);i._optimisticResults=s?"isRestoring":"optimistic",ke(i),De(i,n,u),Ue(n);const g=!l.getQueryCache().get(i.queryHash),[h]=f.useState(()=>new t(l,i)),c=h.getOptimisticResult(i),p=!s&&e.subscribed!==!1;if(f.useSyncExternalStore(f.useCallback(d=>{const S=p?h.subscribe(U.batchCalls(d)):D;return h.updateResult(),S},[h,p]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),f.useEffect(()=>{h.setOptions(i)},[i,h]),Qe(i,c))throw G(i,h,n);if(_e({result:c,errorResetBoundary:n,throwOnError:i.throwOnError,query:u,suspense:i.suspense}))throw c.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(i,c),i.experimental_prefetchInRender&&!A&&Ae(c,s)&&(g?G(i,h,n):u?.promise)?.catch(D).finally(()=>{h.updateResult()}),i.notifyOnChangeProps?c:h.trackResult(c)}function Be(e,t){return Le(e,Oe)}function Ke(e,t){const r=_(),[s]=f.useState(()=>new Te(r,e));f.useEffect(()=>{s.setOptions(e)},[s,e]);const n=f.useSyncExternalStore(f.useCallback(i=>s.subscribe(U.batchCalls(i)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),l=f.useCallback((i,u)=>{s.mutate(i,u).catch(D)},[s]);if(n.error&&L(s.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:l,mutateAsync:n.mutate}}const ce=e=>typeof e=="string"?e.includes("Failed to fetch")?"Could not reach endpoint. Possible causes could include network issues, incorrect URL, or server outages.":$e(e):typeof e=="object"&&e?.message?(e?.code?`API: ${e.code}, `:"")+e?.message:"An error occurred",$e=e=>{let t=e;try{t=JSON.parse(e),t?.message&&(t=(t?.code?`API: ${t.code}, `:"")+t?.message)}catch(r){return console.warn(r),e}return t},le=(e,t)=>{let r;return function(...s){const n=this;clearTimeout(r),r=setTimeout(()=>e.apply(n,s),t)}},Ve=async e=>{try{const t=await fetch(`${e}/silences`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});return{silences:await t.json()}}catch(t){throw console.error(t),t}},He=async e=>{try{const t=await fetch(`${e.endpoint}/silence/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok){const r=await t.json().catch(()=>null),s=r?.message||r||`Error ${t.status}: ${t.statusText}`;throw new Error(s)}return await t}catch(t){throw console.error(t),t}},qe=async e=>{try{const t=await fetch(`${e.endpoint}/silences`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e.silence)});if(!t.ok){const r=await t.json().catch(()=>null),s=r?.message||r||`Error ${t.status}: ${t.statusText}`;throw new Error(s)}return await t.json()}catch(t){throw console.error(t),t}},ze={deleteSilences:He,createSilences:qe},he=(e,t={})=>{const r=ee(),s=ze[e];if(!s)throw new Error(`No mutation function mapped for key: ${e}`);return Ke({mutationFn:n=>s({...n,endpoint:r}),onError:t?.onError,...t})},st=e=>{const{addMessage:t}=te(),r=e.silence,[s,n]=f.useState(!1),l=_(),i=se(),{setSilences:u}=re(),{mutate:g}=he("deleteSilences",{onSuccess:c=>{l.cancelQueries({queryKey:["silences"]});const p=i.filter(w=>w.id===c.id);let d=p.length>0?p[0]:null;d={...d,status:{state:ae.SILENCE_EXPIRED}};const S=[...i.filter(w=>w?.id!==c?.id),d];u({items:S}),t({variant:"success",text:"Silence expired successfully. Please note that it may take up to 5 minutes for the silence to show up as expired."})},onError:c=>{t({variant:"error",text:ce(c)})},onSettled:()=>{l.invalidateQueries({queryKey:["silences"]})}}),h=le(()=>{g({id:r.id}),n(!1)},200);return a.jsxs(a.Fragment,{children:[a.jsx(ne,{onClick:()=>n(!0),children:"Expire"}),s&&a.jsxs(ie,{cancelButtonLabel:"Cancel",confirmButtonLabel:"Expire Silence",onCancel:()=>n(!1),onConfirm:h,open:!0,title:"Confirmation needed",children:[a.jsxs("p",{children:["Do you really want to expire the silence ",a.jsx("b",{children:r.id}),"?"]}),a.jsxs("p",{children:["Comment for the silence: ",a.jsx("b",{children:r?.comment})]})]})]})},J=[{label:"2 hours",value:2},{label:"12 hours",value:12},{label:"1 day",value:24},{label:"3 days",value:72},{label:"7 days",value:168}],rt=e=>{if(e?.length>0)return e.sort((r,s)=>new Date(s.endsAt).getTime()-new Date(r.endsAt).getTime())[0].endsAt},Ge=e=>{if(!e)return{items:J};const t=new Date,n=(new Date(e).getTime()-t.getTime())/(1e3*60*60),l=J.map(u=>u.value<=n?{...u,label:u.label+" (covered with the existing silence)",covered:!0}:u),i=l.find(u=>!u?.covered);return{items:l,firstNotCovered:i}},nt=(e,t=[],r=[])=>{if(!e||!t)return;const s=[];return Object.keys(e).forEach(n=>{const l=e?.[n];if(l){const i={name:n,value:l,isRegex:!1,excluded:!1,configurable:!1};r.includes(n)||(t.includes(n)?s.push({...i,excluded:!0,configurable:!0}):s.push(i))}}),s},Je=e=>{const s={};return e?.comment?.length<3&&(s.comment||(s.comment=[]),s.comment.push("Please enter at least 3 characters")),e?.createdBy?.length<1&&(s.createdBy||(s.createdBy=[]),s.createdBy.push("Please enter a name")),s},W=e=>e.map((t,r)=>a.jsx("span",{className:"block text-theme-danger ",children:t},r)),Y={duration:2,comment:""},it=e=>{const t=e.silence,{addMessage:r}=te(),s=me(),n=se(),{setSilences:l}=re(),i=_(),[u,g]=f.useState(!1),[h,c]=f.useState(Y),[p,d]=f.useState({}),[S,w]=f.useState(null);f.useLayoutEffect(()=>{u&&(c({...h,...Y,createdBy:s||"",matchers:t.matchers,comment:t.comment}),w(null),d({}))},[u]);const x=f.useMemo(()=>{const o=Ge(0);return o.firstNotCovered&&c({...h,duration:o.firstNotCovered.value}),o.items},[]),{mutate:I}=he("createSilences",{onMutate:o=>{i.cancelQueries({queryKey:["silences"]});const m={...o.silence,status:{state:ae.SILENCE_ACTIVE}},R=[...n,m];l({items:R}),g(!1)},onSuccess:o=>{r({variant:"success",text:`A silence object with id ${o?.silenceID} was created successfully. Please note that it may
            take up to 5 minutes for the alert to show up as silenced.`})},onError:o=>{r({variant:"error",text:ce(o)})},onSettled:()=>{i.invalidateQueries({queryKey:["silences"]})}}),O=le(()=>{w(null);const o=Je(h);if(d(o),Object.keys(o).length>0)return;const m={...h},R=new Date,T=new Date;T.setHours(T.getHours()+Number.parseInt(m.duration||4));const y={...m,startsAt:R.toISOString(),endsAt:T.toISOString()};I({silence:y})},200),E=({key:o,value:m})=>{m&&c({...h,[o]:m})};return a.jsxs(a.Fragment,{children:[a.jsx(ne,{onClick:o=>{o.stopPropagation(),g(!u)},children:"Recreate"}),u&&a.jsxs(ie,{title:"New Silence for",size:"large",open:!0,confirmButtonLabel:"Save",onCancel:()=>g(!1),onConfirm:O,children:[S&&a.jsx(ye,{text:S,variant:"danger"}),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"advanced-area overflow-hidden",children:[a.jsx("p",{className:"mt-2",children:"Matchers attached to this silence"}),a.jsx(be,{gap:"2",alignment:"start",wrap:!0,className:"mt-2",children:h?.matchers&&Object.keys(h?.matchers).map((o,m)=>a.jsx(ge,{pillKey:t?.matchers[o]?.name,pillKeyLabel:t?.matchers[o]?.name,pillValue:t?.matchers[o]?.value,pillValueLabel:t?.matchers[o]?.value},m))})]}),a.jsxs(ve,{className:"mt-6",children:[a.jsx(k,{children:a.jsx(Se,{required:!0,label:"Silenced by",value:h.createdBy,disabled:!!s,onChange:o=>E({key:"createdBy",value:o.target.value}),errortext:p.createdBy&&W(p.createdBy)})}),a.jsx(k,{children:a.jsx(we,{className:"h-20",label:"Description",value:h.comment,onChange:o=>E({key:"comment",value:o.target.value}),errortext:p.comment&&W(p.comment),required:!0})}),a.jsx(k,{children:a.jsx(xe,{required:!0,label:"Duration",value:h.duration,onChange:o=>E({key:"duration",value:o}),children:x?.map(o=>a.jsx(Ee,{label:o.label,value:String(o.value)},o.value))})})]})]})]})]})};let X;const We=async e=>{try{const t=await fetch(`${e}/alerts`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});const r=await t.json(),s=Re(r);s.forEach(l=>{l.labels&&(l.labels.status=l.status?.state)});const n=JSON.stringify(s);return X!==n?(X=n,{alerts:s,counts:Ce(s)}):null}catch(t){throw console.error(t),t}},Ye={alerts:We,silences:Ve};class Xe extends Error{constructor(t){super(t.message),this.name="CorsNetworkError",t.stack&&(this.stack=t.stack)}}function Ze(e){if(!(e instanceof TypeError))return!1;const t=e.message||"";return!!(navigator.userAgent.includes("Firefox")&&t.includes("NetworkError"))}const at=(e,{options:t}={})=>{const r=ee(),s=Ye[e];if(!s)throw new Error(`No fetch function mapped for key: ${e}`);return Be({queryKey:[e],queryFn:()=>s(r).catch(n=>{throw Ze(n)?new Xe(n):n}),...t})},ot=()=>a.jsxs("p",{children:["Firefox detected. Please ensure that you have activated ",a.jsx("b",{children:"allow_client_cert"})," to enable the retrieval of alerts and silences from the API.",a.jsxs("ul",{children:[a.jsx("li",{children:"1. Go to about:config (via address bar)"}),a.jsxs("li",{children:["2. Change ",a.jsx("b",{children:"network.cors_preflight.allow_client_cert"})," to ",a.jsx("b",{children:"true"})]}),a.jsx("li",{children:"3. Reload Greenhouse"})]})]});export{Xe as C,J as D,st as E,ot as F,it as R,he as a,le as d,Ge as g,rt as l,ce as p,nt as s,at as u};
