import{g as f,j as e,d as u,i as I,u as N,o as x,c,V as d,Q as y,y as V,Z as D,I as E,P as C,n as p,E as h,M as L,f as j,T as g,m as R}from"./App-C-QOLR2f.js";import{r as i}from"./index-jdayQlxK.js";import{E as v,u as P,g as T,L as k,C as K,I as M}from"./IssueCountsPerSeverityLevel-PTs2iHBr.js";import{S as z}from"./SectionContentHeading-BJ0XFE1R.js";import{I as F}from"./IssueTimestamp-CloF_eUN.js";const U=s=>{const r=s.toLowerCase(),o=f(r);return e.jsx(u,{icon:I[r]||"help",color:o})},H=({severity:s})=>U(s),Z=s=>`
    border-l-2
    ${f(s.toLowerCase())}
    h-full
    pl-5
  `,$=({issue:s})=>{const[r,o]=i.useState(!1),{needsExpansion:t,textRef:a}=N(s.description),n=m=>{m.preventDefault(),o(!r)};return e.jsxs(x,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:Z(s.severity),children:e.jsx(H,{severity:s.severity})})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(u,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(F,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:a,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&t&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(u,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},q=({issuesPromise:s})=>{const{error:r,data:o}=i.use(s),{vulnerabilities:t}=y(o);return r?e.jsxs(v,{colSpan:4,children:["Error loading vulnerabilities: ",r.message]}):t.length===0?e.jsx(v,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):t.map(a=>e.jsx($,{issue:a},a.id||a.name))},A=({service:s,image:r})=>{const{apiClient:o,queryClient:t}=P({from:"/services/$service"}),[a,n]=i.useState(void 0),[m,b]=i.useState(void 0),w=a?{search:[a]}:void 0,l=V({apiClient:o,queryClient:t,filter:{service:[s],repository:[r.repository]},firstVulnerabilities:20,afterVulnerabilities:m,vulFilter:w});return e.jsxs(e.Fragment,{children:[e.jsxs(d,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(D,{children:"Vulnerabilities"}),e.jsx(E,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:S=>n(S||""),onClear:()=>{n("")}})]}),e.jsxs(C,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(u,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),l&&e.jsx(h,{displayErrorMessage:!0,fallbackRender:T({colspan:4}),resetKeys:[l],children:e.jsx(i.Suspense,{fallback:e.jsx(k,{colSpan:4}),children:e.jsx(q,{issuesPromise:l})})})]}),l&&e.jsx(h,{resetKeys:[l],children:e.jsx(i.Suspense,{children:e.jsx(K,{dataPromise:l,dataNormalizationMethod:y,goToPage:b})})})]})},B=({imagesPromise:s,imageRepository:r,service:o})=>{const{data:t}=i.use(s),{images:a}=L(t),n=a.find(m=>m.repository===r);return n?e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:["Image ",n.repository]}),e.jsxs(C,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(x,{children:[e.jsx(p,{children:"Details"}),e.jsx(c,{children:e.jsxs(d,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(j,{pillKey:"repository",pillKeyLabel:"repository",pillValue:n.repository,pillValueLabel:n.repository}),n.versionsCount!==void 0&&n.versionsCount>0&&e.jsx(j,{pillKey:"versions",pillKeyLabel:"versions",pillValue:n.versionsCount.toString(),pillValueLabel:n.versionsCount.toString()})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(c,{children:e.jsx(M,{counts:n.vulnerabilityCounts})})]})]}),o&&r&&n&&e.jsx(A,{service:o,image:n})]}):null};function W(){const{imagesPromise:s}=g.useLoaderData(),{service:r,image:o}=g.useParams();return e.jsx(h,{displayErrorMessage:!0,children:e.jsx(i.Suspense,{fallback:e.jsx(R,{className:"mt-4"}),children:e.jsx(B,{imagesPromise:s,imageRepository:o,service:r})})})}export{W as component};
