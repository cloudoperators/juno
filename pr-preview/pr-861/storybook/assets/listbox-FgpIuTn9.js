import{r as c,e as B}from"./index-DysCNOs_.js";import{i as Z,T as pe,e as fe,u as be,s as ve}from"./form-CGPENT-o.js";import{U as C,I as V,s as xe,y as D,l as z,a as W,b as p,u as ge,C as E,p as N,c as Oe,d as H,o as me,T as Re,e as g,f as y,r as Se,O as Y,g as w,h as he,i as Le,j as ye,k as Ie,x as Te,m as Pe,n as ke}from"./keyboard-RYHMaleb.js";import{s as we}from"./use-text-value-BSk7WQuc.js";var Ce=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ce||{}),De=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(De||{}),Ee=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(Ee||{}),Me=(e=>(e[e.OpenListbox=0]="OpenListbox",e[e.CloseListbox=1]="CloseListbox",e[e.GoToOption=2]="GoToOption",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterOption=5]="RegisterOption",e[e.UnregisterOption=6]="UnregisterOption",e[e.RegisterLabel=7]="RegisterLabel",e))(Me||{});function K(e,a=i=>i){let i=e.activeOptionIndex!==null?e.options[e.activeOptionIndex]:null,o=ke(a(e.options.slice()),u=>u.dataRef.current.domRef.current),l=i?o.indexOf(i):null;return l===-1&&(l=null),{options:o,activeOptionIndex:l}}let $e={1(e){return e.dataRef.current.disabled||e.listboxState===1?e:{...e,activeOptionIndex:null,listboxState:1}},0(e){if(e.dataRef.current.disabled||e.listboxState===0)return e;let a=e.activeOptionIndex,{isSelected:i}=e.dataRef.current,o=e.options.findIndex(l=>i(l.dataRef.current.value));return o!==-1&&(a=o),{...e,listboxState:0,activeOptionIndex:a}},2(e,a){var i;if(e.dataRef.current.disabled||e.listboxState===1)return e;let o=K(e),l=Pe(a,{resolveItems:()=>o.options,resolveActiveIndex:()=>o.activeOptionIndex,resolveId:u=>u.id,resolveDisabled:u=>u.dataRef.current.disabled});return{...e,...o,searchQuery:"",activeOptionIndex:l,activationTrigger:(i=a.trigger)!=null?i:1}},3:(e,a)=>{if(e.dataRef.current.disabled||e.listboxState===1)return e;let i=e.searchQuery!==""?0:1,o=e.searchQuery+a.value.toLowerCase(),l=(e.activeOptionIndex!==null?e.options.slice(e.activeOptionIndex+i).concat(e.options.slice(0,e.activeOptionIndex+i)):e.options).find(t=>{var n;return!t.dataRef.current.disabled&&((n=t.dataRef.current.textValue)==null?void 0:n.startsWith(o))}),u=l?e.options.indexOf(l):-1;return u===-1||u===e.activeOptionIndex?{...e,searchQuery:o}:{...e,searchQuery:o,activeOptionIndex:u,activationTrigger:1}},4(e){return e.dataRef.current.disabled||e.listboxState===1||e.searchQuery===""?e:{...e,searchQuery:""}},5:(e,a)=>{let i={id:a.id,dataRef:a.dataRef},o=K(e,l=>[...l,i]);return e.activeOptionIndex===null&&e.dataRef.current.isSelected(a.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(i)),{...e,...o}},6:(e,a)=>{let i=K(e,o=>{let l=o.findIndex(u=>u.id===a.id);return l!==-1&&o.splice(l,1),o});return{...e,...i,activationTrigger:1}},7:(e,a)=>({...e,labelId:a.id})},q=c.createContext(null);q.displayName="ListboxActionsContext";function M(e){let a=c.useContext(q);if(a===null){let i=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,M),i}return a}let J=c.createContext(null);J.displayName="ListboxDataContext";function $(e){let a=c.useContext(J);if(a===null){let i=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,$),i}return a}function Ae(e,a){return w(a.type,$e,e,a)}let Fe=c.Fragment;function Qe(e,a){let{value:i,defaultValue:o,form:l,name:u,onChange:t,by:n=(s,d)=>s===d,disabled:b=!1,horizontal:O=!1,multiple:m=!1,...I}=e;const k=O?"horizontal":"vertical";let T=D(a),[R=m?[]:void 0,L]=pe(i,t,o),[v,r]=c.useReducer(Ae,{dataRef:c.createRef(),listboxState:1,options:[],searchQuery:"",labelId:null,activeOptionIndex:null,activationTrigger:1}),x=c.useRef({static:!1,hold:!1}),A=c.useRef(null),F=c.useRef(null),j=c.useRef(null),S=p(typeof n=="string"?(s,d)=>{let h=n;return(s==null?void 0:s[h])===(d==null?void 0:d[h])}:n),P=c.useCallback(s=>w(f.mode,{1:()=>R.some(d=>S(d,s)),0:()=>S(R,s)}),[R]),f=c.useMemo(()=>({...v,value:R,disabled:b,mode:m?1:0,orientation:k,compare:S,isSelected:P,optionsPropsRef:x,labelRef:A,buttonRef:F,optionsRef:j}),[R,b,m,v]);z(()=>{v.dataRef.current=f},[f]),he([f.buttonRef,f.optionsRef],(s,d)=>{var h;r({type:1}),Le(d,ye.Loose)||(s.preventDefault(),(h=f.buttonRef.current)==null||h.focus())},f.listboxState===0);let _=c.useMemo(()=>({open:f.listboxState===0,disabled:b,value:R}),[f,b,R]),ee=p(s=>{let d=f.options.find(h=>h.id===s);d&&G(d.dataRef.current.value)}),te=p(()=>{if(f.activeOptionIndex!==null){let{dataRef:s,id:d}=f.options[f.activeOptionIndex];G(s.current.value),r({type:2,focus:y.Specific,id:d})}}),re=p(()=>r({type:0})),oe=p(()=>r({type:1})),ne=p((s,d,h)=>s===y.Specific?r({type:2,focus:y.Specific,id:d,trigger:h}):r({type:2,focus:s,trigger:h})),ae=p((s,d)=>(r({type:5,id:s,dataRef:d}),()=>r({type:6,id:s}))),ie=p(s=>(r({type:7,id:s}),()=>r({type:7,id:null}))),G=p(s=>w(f.mode,{0(){return L==null?void 0:L(s)},1(){let d=f.value.slice(),h=d.findIndex(U=>S(U,s));return h===-1?d.push(s):d.splice(h,1),L==null?void 0:L(d)}})),le=p(s=>r({type:3,value:s})),se=p(()=>r({type:4})),ue=c.useMemo(()=>({onChange:G,registerOption:ae,registerLabel:ie,goToOption:ne,closeListbox:oe,openListbox:re,selectActiveOption:te,selectOption:ee,search:le,clearSearch:se}),[]),de={ref:T},Q=c.useRef(null),ce=N();return c.useEffect(()=>{Q.current&&o!==void 0&&ce.addEventListener(Q.current,"reset",()=>{L==null||L(o)})},[Q,L]),B.createElement(q.Provider,{value:ue},B.createElement(J.Provider,{value:f},B.createElement(Ie,{value:w(f.listboxState,{0:H.Open,1:H.Closed})},u!=null&&R!=null&&fe({[u]:R}).map(([s,d],h)=>B.createElement(be,{features:ve.Hidden,ref:h===0?U=>{var X;Q.current=(X=U==null?void 0:U.closest("form"))!=null?X:null}:void 0,...Te({key:s,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:l,disabled:b,name:s,value:d})})),E({ourProps:de,theirProps:I,slot:_,defaultTag:Fe,name:"Listbox"}))))}let Ue="button";function Be(e,a){var i;let o=V(),{id:l=`headlessui-listbox-button-${o}`,...u}=e,t=$("Listbox.Button"),n=M("Listbox.Button"),b=D(t.buttonRef,a),O=N(),m=p(v=>{switch(v.key){case g.Space:case g.Enter:case g.ArrowDown:v.preventDefault(),n.openListbox(),O.nextFrame(()=>{t.value||n.goToOption(y.First)});break;case g.ArrowUp:v.preventDefault(),n.openListbox(),O.nextFrame(()=>{t.value||n.goToOption(y.Last)});break}}),I=p(v=>{switch(v.key){case g.Space:v.preventDefault();break}}),k=p(v=>{if(Se(v.currentTarget))return v.preventDefault();t.listboxState===0?(n.closeListbox(),O.nextFrame(()=>{var r;return(r=t.buttonRef.current)==null?void 0:r.focus({preventScroll:!0})})):(v.preventDefault(),n.openListbox())}),T=Z(()=>{if(t.labelId)return[t.labelId,l].join(" ")},[t.labelId,l]),R=c.useMemo(()=>({open:t.listboxState===0,disabled:t.disabled,value:t.value}),[t]),L={ref:b,id:l,type:Re(e,t.buttonRef),"aria-haspopup":"listbox","aria-controls":(i=t.optionsRef.current)==null?void 0:i.id,"aria-expanded":t.listboxState===0,"aria-labelledby":T,disabled:t.disabled,onKeyDown:m,onKeyUp:I,onClick:k};return E({ourProps:L,theirProps:u,slot:R,defaultTag:Ue,name:"Listbox.Button"})}let ze="label";function Ne(e,a){let i=V(),{id:o=`headlessui-listbox-label-${i}`,...l}=e,u=$("Listbox.Label"),t=M("Listbox.Label"),n=D(u.labelRef,a);z(()=>t.registerLabel(o),[o]);let b=p(()=>{var m;return(m=u.buttonRef.current)==null?void 0:m.focus({preventScroll:!0})}),O=c.useMemo(()=>({open:u.listboxState===0,disabled:u.disabled}),[u]);return E({ourProps:{ref:n,id:o,onClick:b},theirProps:l,slot:O,defaultTag:ze,name:"Listbox.Label"})}let He="ul",Ve=Y.RenderStrategy|Y.Static;function je(e,a){var i;let o=V(),{id:l=`headlessui-listbox-options-${o}`,...u}=e,t=$("Listbox.Options"),n=M("Listbox.Options"),b=D(t.optionsRef,a),O=N(),m=N(),I=Oe(),k=I!==null?(I&H.Open)===H.Open:t.listboxState===0;c.useEffect(()=>{var r;let x=t.optionsRef.current;x&&t.listboxState===0&&x!==((r=me(x))==null?void 0:r.activeElement)&&x.focus({preventScroll:!0})},[t.listboxState,t.optionsRef]);let T=p(r=>{switch(m.dispose(),r.key){case g.Space:if(t.searchQuery!=="")return r.preventDefault(),r.stopPropagation(),n.search(r.key);case g.Enter:if(r.preventDefault(),r.stopPropagation(),t.activeOptionIndex!==null){let{dataRef:x}=t.options[t.activeOptionIndex];n.onChange(x.current.value)}t.mode===0&&(n.closeListbox(),W().nextFrame(()=>{var x;return(x=t.buttonRef.current)==null?void 0:x.focus({preventScroll:!0})}));break;case w(t.orientation,{vertical:g.ArrowDown,horizontal:g.ArrowRight}):return r.preventDefault(),r.stopPropagation(),n.goToOption(y.Next);case w(t.orientation,{vertical:g.ArrowUp,horizontal:g.ArrowLeft}):return r.preventDefault(),r.stopPropagation(),n.goToOption(y.Previous);case g.Home:case g.PageUp:return r.preventDefault(),r.stopPropagation(),n.goToOption(y.First);case g.End:case g.PageDown:return r.preventDefault(),r.stopPropagation(),n.goToOption(y.Last);case g.Escape:return r.preventDefault(),r.stopPropagation(),n.closeListbox(),O.nextFrame(()=>{var x;return(x=t.buttonRef.current)==null?void 0:x.focus({preventScroll:!0})});case g.Tab:r.preventDefault(),r.stopPropagation();break;default:r.key.length===1&&(n.search(r.key),m.setTimeout(()=>n.clearSearch(),350));break}}),R=Z(()=>{var r;return(r=t.buttonRef.current)==null?void 0:r.id},[t.buttonRef.current]),L=c.useMemo(()=>({open:t.listboxState===0}),[t]),v={"aria-activedescendant":t.activeOptionIndex===null||(i=t.options[t.activeOptionIndex])==null?void 0:i.id,"aria-multiselectable":t.mode===1?!0:void 0,"aria-labelledby":R,"aria-orientation":t.orientation,id:l,onKeyDown:T,role:"listbox",tabIndex:0,ref:b};return E({ourProps:v,theirProps:u,slot:L,defaultTag:He,features:Ve,visible:k,name:"Listbox.Options"})}let Ge="li";function Ke(e,a){let i=V(),{id:o=`headlessui-listbox-option-${i}`,disabled:l=!1,value:u,...t}=e,n=$("Listbox.Option"),b=M("Listbox.Option"),O=n.activeOptionIndex!==null?n.options[n.activeOptionIndex].id===o:!1,m=n.isSelected(u),I=c.useRef(null),k=we(I),T=xe({disabled:l,value:u,domRef:I,get textValue(){return k()}}),R=D(a,I);z(()=>{if(n.listboxState!==0||!O||n.activationTrigger===0)return;let S=W();return S.requestAnimationFrame(()=>{var P,f;(f=(P=I.current)==null?void 0:P.scrollIntoView)==null||f.call(P,{block:"nearest"})}),S.dispose},[I,O,n.listboxState,n.activationTrigger,n.activeOptionIndex]),z(()=>b.registerOption(o,T),[T,o]);let L=p(S=>{if(l)return S.preventDefault();b.onChange(u),n.mode===0&&(b.closeListbox(),W().nextFrame(()=>{var P;return(P=n.buttonRef.current)==null?void 0:P.focus({preventScroll:!0})}))}),v=p(()=>{if(l)return b.goToOption(y.Nothing);b.goToOption(y.Specific,o)}),r=ge(),x=p(S=>r.update(S)),A=p(S=>{r.wasMoved(S)&&(l||O||b.goToOption(y.Specific,o,0))}),F=p(S=>{r.wasMoved(S)&&(l||O&&b.goToOption(y.Nothing))}),j=c.useMemo(()=>({active:O,selected:m,disabled:l}),[O,m,l]);return E({ourProps:{id:o,ref:R,role:"option",tabIndex:l===!0?void 0:-1,"aria-disabled":l===!0?!0:void 0,"aria-selected":m,disabled:void 0,onClick:L,onFocus:v,onPointerEnter:x,onMouseEnter:x,onPointerMove:A,onMouseMove:A,onPointerLeave:F,onMouseLeave:F},theirProps:t,slot:j,defaultTag:Ge,name:"Listbox.Option"})}let We=C(Qe),qe=C(Be),Je=C(Ne),Xe=C(je),Ye=C(Ke),rt=Object.assign(We,{Button:qe,Label:Je,Options:Xe,Option:Ye});export{rt as I};
