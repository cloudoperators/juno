import{u as f,a as C,j as e,Y as E,d as V,J as O,F as L,B as p,U as R,K as j,c as A,q as S,h as y,r as U,e as z,S as m,y as P,t as B,k as g,v as _,w as N,o as K,s as d,p as M,l as Z,m as $,n as q}from"./App-CczAVbP_.js";import{R as W,a as n}from"./index-CWe1YSlZ.js";import{a as b,c as G,S as h,E as x,C as H,I as J}from"./IssueCountsPerSeverityLevel-C5UEylo2.js";import{f as Y,S as X}from"./fetchImageVersions-CVIB6Shz.js";import{F as Q}from"./index-YplvQqLE.js";const ee=()=>{const s=f(),{queryClient:t,apiClient:i}=b({from:"/services/"}),{service:r}=C({from:"/services/"}),[o,c]=W.useState(void 0),u=r?Y({queryClient:t,apiClient:i,service:r,after:o}):void 0,v=n.useCallback(()=>{s({to:"/services",search:l=>{const{service:w,...F}=l;return{...F}}})},[s]),a=n.useCallback(l=>{r&&s({to:"/services/$service",params:{service:r},search:{imageVersion:l?.version}})},[s,r]);return e.jsx(E,{children:e.jsx(V,{heading:r?`${G(r)} Overview`:void 0,opened:!!r,onClose:v,size:"large",children:e.jsx(O,{children:r&&u&&e.jsx(X,{displayActions:!0,imageVersionsPromise:u,onDetailsButtonClick:a,goToPage:c})})})})},D={supportGroups:"support_group",region:"region",integrity:"integrity"},se=({serviceDetails:s})=>{const t=(i,r)=>e.jsx(A,{pillKey:i,pillKeyLabel:i,pillValue:r,pillValueLabel:r},r);return e.jsx(j,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([i,r])=>Array.isArray(r)?r.map(o=>t(D[i],o)):t(D[i],r))})},re=({item:s,selected:t,onItemClick:i,onServiceDetailClick:r})=>e.jsxs(L,{className:`cursor-pointer ${t?"active":""}`,onClick:i,children:[e.jsx(p,{children:s.name}),e.jsx(p,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"severityCritical",variant:"danger",tooltipContent:"Critical Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issuesCount.high,icon:"severityHigh",variant:"warning",tooltipContent:"High Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"severityMedium",variant:"warning",tooltipContent:"Medium Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issuesCount.low,icon:"severityLow",variant:"info",tooltipContent:"Low Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issuesCount.none,icon:"severityUnknown",variant:"default",tooltipContent:"None Vulnerabilities"})}),e.jsx(p,{children:e.jsx(se,{serviceDetails:s.serviceDetails})}),e.jsx(p,{className:"cursor-default interactive",onClick:o=>o.stopPropagation(),children:e.jsx(R,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),I=8,te=({servicesPromise:s})=>{const t=f(),{service:i}=C({from:"/services/"}),{error:r,data:o}=n.use(s),{services:c}=S(o),u=n.useCallback(a=>{t({to:"/services",search:l=>({...l,service:a.name})})},[]),v=n.useCallback(a=>{t({to:"/services/$service",params:{service:a.name}})},[]);return r?e.jsx(x,{colSpan:I,children:"Error loading services"}):c.length===0?e.jsx(x,{colSpan:I,children:"No service found"}):c.map(a=>e.jsx(re,{item:a,selected:a.name===i,onItemClick:()=>u(a),onServiceDetailClick:()=>v(a)},a.id))},k=8,ie=()=>{const{queryClient:s,apiClient:t}=b({from:"/services/"}),{servicesPromise:i,filterSettings:r}=y({from:"/services/"}),[o,c]=n.useState(i),u=n.useCallback(v=>{const a=U({queryClient:s,apiClient:t,filterSettings:r,after:v});c(a)},[c,s,t,r]);return n.useEffect(()=>{c(i)},[c,i]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(z,{minContentColumns:[1,2,3,4,5,7],columns:k,children:[e.jsxs(L,{children:[e.jsx(m,{children:"Service"}),e.jsx(m,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(m,{children:"Details"}),e.jsx(m,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(x,{colSpan:k,children:e.jsxs(j,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(P,{variant:"primary"})]})}),children:e.jsx(te,{servicesPromise:o})})]}),e.jsx(n.Suspense,{children:e.jsx(H,{dataPromise:o,goToPage:u,dataNormalizationMethod:S})}),e.jsx(ee,{})]})},ae=({servicesPromise:s})=>{const{error:t,data:i}=n.use(s),{servicesIssuesCount:r}=S(i);return e.jsx(j,{gap:"1",children:t?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(J,{counts:r})})},ne=()=>{const{servicesPromise:s}=y({from:"/services/"});return e.jsx(j,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(P,{size:"small"}),children:e.jsx(ae,{servicesPromise:s})})})},oe=()=>{const s=f(),{filters:t,filterSettings:i}=y({from:"/services/"}),{appProps:r}=b({from:"/services/"}),o=C({from:"/services/"}),{hasAppliedInitialFilters:c,markInitialFiltersApplied:u}=B();n.useLayoutEffect(()=>{if(c)return;if(!Object.keys(o).some(l=>l.startsWith(g))&&r?.initialFilters?.support_group?.length){const l=_(r.initialFilters);l.length>0&&(s({to:"/services",search:N({searchTerm:"",selectedFilters:l}),replace:!0}),u())}},[s,r,c,u,o]);const v=n.useCallback(a=>{s({to:"/services",search:l=>{const w=N(a);return{...Object.fromEntries(Object.entries(l).filter(([T])=>!T.startsWith(g))),...w}}})},[s]);return e.jsx(Q,{filters:t,filterSettings:i,onFilterChange:v,searchInputPlaceholder:"search term for services name"})},ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(P,{size:"small"})}),children:[e.jsx(ne,{}),e.jsx(ie,{})]})]});K({service:d().optional(),searchTerm:d().optional()}).catchall(M((s,t)=>{if(!(t.path.length>0&&typeof t.path[0]=="string"&&!t.path[0].startsWith(g)))return s},Z([d(),$(d()),q()])));const me=ce;export{me as component};
