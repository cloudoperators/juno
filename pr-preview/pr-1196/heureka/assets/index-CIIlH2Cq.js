import{u as S,a as k,j as e,Y as T,d as E,J as V,F as L,B as p,U as A,K as j,c as R,q as y,h as P,r as O,e as U,S as d,y as w,t as z,k as f,v as B,w as F,o as _,s as g,p as K,l as M,m as Z,n as $}from"./App-CwZIKfGC.js";import{R as q,a as n}from"./index-BaXtdPQy.js";import{a as b,c as W,S as m,E as C,C as G,I as H}from"./IssueCountsPerSeverityLevel-COEYPDkD.js";import{f as J,S as Y}from"./fetchImageVersions-DGYJ6E-J.js";import{F as X}from"./index-BhVjyPNI.js";const Q=()=>{const s=S(),{queryClient:t,apiClient:i}=b({from:"/services/"}),{service:r}=k({from:"/services/"}),[o,c]=q.useState(void 0),h=r?J({queryClient:t,apiClient:i,service:r,after:o}):void 0,l=n.useCallback(()=>{s({to:"/services",search:u=>{const{service:v,...x}=u;return{...x}}})},[s]),a=n.useCallback(u=>{r&&s({to:"/services/$service",params:{service:r},search:{imageVersion:u?.version}})},[s,r]);return e.jsx(T,{children:e.jsx(E,{heading:r?`${W(r)} Overview`:void 0,opened:!!r,onClose:l,size:"large",children:e.jsx(V,{children:r&&h&&e.jsx(Y,{displayActions:!0,imageVersionsPromise:h,onDetailsButtonClick:a,goToPage:c})})})})},N={supportGroups:"support_group",region:"region",integrity:"integrity"},ee=({serviceDetails:s})=>{const t=(i,r)=>e.jsx(R,{pillKey:i,pillKeyLabel:i,pillValue:r,pillValueLabel:r},r);return e.jsx(j,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([i,r])=>Array.isArray(r)?r.map(o=>t(N[i],o)):t(N[i],r))})},se=({item:s,selected:t,onItemClick:i,onServiceDetailClick:r})=>e.jsxs(L,{className:`cursor-pointer ${t?"active":""}`,onClick:i,children:[e.jsx(p,{children:s.name}),e.jsx(p,{className:"items-center",children:e.jsx(m,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"severityCritical",variant:"danger",tooltipContent:"Critical Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(m,{showDashIfZero:!0,count:s.issuesCount.high,icon:"severityHigh",variant:"warning",tooltipContent:"High Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(m,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"severityMedium",variant:"warning",tooltipContent:"Medium Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(m,{showDashIfZero:!0,count:s.issuesCount.low,icon:"severityLow",variant:"info",tooltipContent:"Low Vulnerabilities"})}),e.jsx(p,{className:"items-center",children:e.jsx(m,{showDashIfZero:!0,count:s.issuesCount.none,icon:"severityUnknown",variant:"default",tooltipContent:"None Vulnerabilities"})}),e.jsx(p,{children:e.jsx(ee,{serviceDetails:s.serviceDetails})}),e.jsx(p,{className:"cursor-default interactive",onClick:o=>o.stopPropagation(),children:e.jsx(A,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),D=8,re=({servicesPromise:s})=>{const t=S(),{service:i}=k({from:"/services/"}),{error:r,data:o}=n.use(s),{services:c}=y(o),h=n.useCallback(a=>{t({to:"/services",search:u=>({...u,service:a.name})})},[]),l=n.useCallback(a=>{t({to:"/services/$service",params:{service:a.name}})},[]);return r?e.jsx(C,{colSpan:D,children:"Error loading services"}):c.length===0?e.jsx(C,{colSpan:D,children:"No service found"}):c.map(a=>e.jsx(se,{item:a,selected:a.name===i,onItemClick:()=>h(a),onServiceDetailClick:()=>l(a)},a.id))},I=8,te=()=>{const{queryClient:s,apiClient:t}=b({from:"/services/"}),{servicesPromise:i,filterSettings:r}=P({from:"/services/"}),[o,c]=n.useState(i),h=n.useCallback(l=>{const a=O({queryClient:s,apiClient:t,filterSettings:r,after:l});c(a)},[c,s,t,r]);return n.useEffect(()=>{c(i)},[c,i]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(U,{minContentColumns:[1,2,3,4,5,7],columns:I,children:[e.jsxs(L,{children:[e.jsx(d,{children:"Service"}),e.jsx(d,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(d,{children:"Details"}),e.jsx(d,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(C,{colSpan:I,children:e.jsxs(j,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(w,{variant:"primary"})]})}),children:e.jsx(re,{servicesPromise:o})})]}),e.jsx(n.Suspense,{children:e.jsx(G,{dataPromise:o,goToPage:h,dataNormalizationMethod:y})}),e.jsx(Q,{})]})},ie=({servicesPromise:s})=>{const{error:t,data:i}=n.use(s),{servicesIssuesCount:r}=y(i);return e.jsx(j,{gap:"1",children:t?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(H,{counts:r})})},ae=()=>{const{servicesPromise:s}=P({from:"/services/"});return e.jsx(j,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(w,{size:"small"}),children:e.jsx(ie,{servicesPromise:s})})})},ne=()=>{const s=S(),{filters:t,filterSettings:i}=P({from:"/services/"}),{appProps:r}=b({from:"/services/"}),{hasAppliedInitialFilters:o,markInitialFiltersApplied:c}=z();n.useEffect(()=>{if(o)return;const l=new URLSearchParams(window.location.search),a=Array.from(l.keys()).some(v=>v.startsWith(f)),u=l.toString().length>0;if(!a&&!u&&r?.initialFilters?.support_group?.length){const v=B(r.initialFilters);v.length>0&&(s({to:"/services",search:F({searchTerm:"",selectedFilters:v}),replace:!0}),c())}},[s,r,o,c]);const h=n.useCallback(l=>{s({to:"/services",search:a=>{const u=F(l);return{...Object.fromEntries(Object.entries(a).filter(([x])=>!x.startsWith(f))),...u}}})},[s]);return e.jsx(X,{filters:t,filterSettings:i,onFilterChange:h,searchInputPlaceholder:"search term for services name"})},oe=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(w,{size:"small"})}),children:[e.jsx(ae,{}),e.jsx(te,{})]})]});_({service:g().optional(),searchTerm:g().optional()}).catchall(K((s,t)=>{if(!(t.path.length>0&&typeof t.path[0]=="string"&&!t.path[0].startsWith(f)))return s},M([g(),Z(g()),$()])));const ve=oe;export{ve as component};
