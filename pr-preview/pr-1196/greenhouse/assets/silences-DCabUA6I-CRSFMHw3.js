import{R,e as y,j as e,u as T,a as A,b as D,d as F,s as O,f as V,Q as x,B as i,K as d,g as E,h as _,i as f,c as m,o as k,x as G,S as j,k as W,y as q,Z as J}from"./App-DrIK8FKQ-CC6k2TM_.js";import{j as h}from"./_extensionId._-5s9LH3A1.js";import{b as K,p as P,x as X,a as z,k as B,E as H,g as N}from"./FirefoxCorsWarning-DlsIXO9W-EbVODzTN.js";import"./index-D95t8QeR.js";import"./Shell-DxzXjpok.js";import"./index-D4mfCBcV.js";const v=({timestamp:s})=>{let t;s.includes("T")?t=N.fromISO(s):t=N.fromSQL(s);const r=t.toFormat("yyyy-LL-dd HH:mm Z");return e.jsx("div",{children:r})},M=s=>s.length>40?s.substring(0,40)+"...":s,Q=({silence:s},t)=>e.jsxs(x,{children:[e.jsxs(i,{className:"whitespace-nowrap",children:[e.jsx(v,{timestamp:s?.startsAt}),e.jsx(v,{timestamp:s?.endsAt})]}),e.jsxs(i,{className:"overflow-hidden",children:[e.jsx("div",{ref:t,children:s?.comment}),e.jsxs("div",{className:"text-theme-light",children:["Silence ",s.id," created by ",s?.createdBy]}),e.jsx(q,{className:"py-2 px-0",children:e.jsx(d,{gap:"2",alignment:"start",wrap:!0,children:s?.matchers?.map((r,l)=>e.jsx(J,{pillKey:r.name,pillValue:M(r.value)},l))})})]}),e.jsx(i,{className:"overflow-hidden",children:e.jsx("p",{children:s?.status?.state})}),e.jsx(i,{className:"overflow-hidden",children:s?.status?.state===m.SILENCE_ACTIVE||s?.status?.state===m.SILENCE_PENDING?e.jsx(B,{silence:s}):e.jsx(H,{silence:s})})]}),U=h.forwardRef(Q),$=`
bg-theme-background-lvl-1
py-2
px-4
my-px
`,Y=()=>{const s=T(),t=A(),[r,l]=h.useState(t),p=D(),c=F(),{setSilences:C}=y(),{addMessage:S,resetMessages:L}=O(),{data:u,isLoading:w,error:g}=K("silences");g&&(L(),g instanceof P&&S({variant:"warning",text:e.jsx(X,{})}),S({variant:"error",text:z(g)})),h.useEffect(()=>{u&&C({items:u.silences})},[u]),h.useEffect(()=>{let a=t.filter(n=>n?.status?.state===p);try{c&&(a=a.filter(n=>JSON.stringify(n).match(new RegExp(c,"i"))))}catch(n){console.warn("search term is not a valid regex. "+n),a=a.filter(o=>JSON.stringify(o).toLowerCase().includes(c.toLowerCase))}l(a)},[p,c,t]);const I=a=>{const n=setTimeout(()=>{s({to:"/silences",search:o=>({...o,silencesRegEx:a.target.value})})},500);return()=>clearTimeout(n)},{scrollListItems:b,iterator:Z}=V(r,{loadingObject:e.jsx(x,{children:e.jsx(i,{colSpan:3,children:e.jsxs(d,{gap:"3",alignment:"center",direction:"horizontal",children:["Loading...",e.jsx(E,{})]})})}),refFunction:a=>e.jsx(x,{children:e.jsx(i,{colSpan:3,className:"border-b-0 py-0",children:e.jsx("span",{ref:a})})})});return e.jsx(e.Fragment,{children:w?e.jsxs(d,{gap:"2",children:[e.jsx("span",{children:"Loading"}),e.jsx(E,{variant:"primary"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{direction:"horizontal",className:`${$}`,children:[e.jsxs(_,{className:"w-3/12",label:"Status",value:p,onChange:a=>{s({to:"/silences",search:n=>({...n,silencesStatus:a})})},children:[e.jsx(f,{value:m.SILENCE_ACTIVE}),e.jsx(f,{value:m.SILENCE_PENDING}),e.jsx(f,{value:m.SILENCE_EXPIRED})]}),e.jsx(k,{placeholder:"search term or regular expression",className:"ml-auto w-7/12",value:c||"",onChange:a=>{I(a)},onSearch:a=>{s({to:"/silences",search:n=>({...n,silencesRegEx:a})})},onClear:()=>{s({to:"/silences",search:a=>{const{silencesRegEx:n,...o}=a;return{...o}}})}})]}),e.jsx(G,{columns:4,minContentColumns:[0,2,3],cellVerticalAlignment:"top",className:"silences ",children:e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsx(j,{children:"Time intervall"}),e.jsx(j,{children:"Details"}),e.jsx(j,{children:"State"}),e.jsx(j,{children:"Action"})]}),b?.length?Z.map(a=>e.jsx(U,{silence:a},a.id)):e.jsx(x,{children:e.jsx(i,{colSpan:4,children:e.jsxs(d,{gap:"3",children:[e.jsx(W,{icon:"info",color:"text-theme-info"}),e.jsx("div",{children:"We couldn't find any matching silences."})]})})})]})})]})})};function ie(){const{appStateFromUrl:{silencesRegEx:s,silencesStatus:t}}=R.useRouteContext(),{setSilencesRegEx:r,setSilencesStatus:l}=y();return h.useLayoutEffect(()=>{r(s),l(t)},[s,t]),e.jsx(Y,{})}export{ie as component};
