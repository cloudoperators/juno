import{j as e,y as C,u as b,h as y,a as S,t as L,k as f,v as q,w as D,K as j,r as A,e as E,F,S as v,q as k,Y as G,d as M,J as z,B as u,U as O,c as Z,o as B,s as d,p as K,l as R,m as T,n as $}from"./App-C3bzSnXB-CT9af5ZM.js";import{w as n,g as H}from"./_extensionId._-CYXRL4g0.js";import{b as w,N as g,S as U,H as W,E as Y,a as p}from"./IssueCountsPerSeverityLevel-DY3Wv6WN-QPVJMtiD.js";import{M as _,q as J}from"./fetchImageVersions-Dp_2p15z-k-QXSbv_.js";import{y as X}from"./index-BAJWN8wT-DZ-L45Nc.js";import"./index-DpYhpCi6.js";import"./Shell-DGGsNoUp.js";import"./index-QuBfLjki.js";const Q=()=>{const s=b(),{queryClient:r,apiClient:a}=w({from:"/services/"}),{service:i}=S({from:"/services/"}),[l,c]=H.useState(void 0),o=i?_({queryClient:r,apiClient:a,service:i,after:l}):void 0,m=n.useCallback(()=>{s({to:"/services",search:h=>{const{service:N,...x}=h;return{...x}}})},[s]),t=n.useCallback(h=>{i&&s({to:"/services/$service",params:{service:i},search:{imageVersion:h?.version}})},[s,i]);return e.jsx(G,{children:e.jsx(M,{heading:i?`${Y(i)} Overview`:void 0,opened:!!i,onClose:m,size:"large",children:e.jsx(z,{children:i&&o&&e.jsx(J,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:t,goToPage:c})})})})},I={supportGroups:"support_group",region:"region",integrity:"integrity"},ee=({serviceDetails:s})=>{const r=(a,i)=>e.jsx(Z,{pillKey:a,pillKeyLabel:a,pillValue:i,pillValueLabel:i},i);return e.jsx(j,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,i])=>Array.isArray(i)?i.map(l=>r(I[a],l)):r(I[a],i))})},se=({item:s,selected:r,onItemClick:a,onServiceDetailClick:i})=>e.jsxs(F,{className:`cursor-pointer ${r?"active":""}`,onClick:a,children:[e.jsx(u,{children:s.name}),e.jsx(u,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"severityCritical",variant:"danger",tooltipContent:"Critical Vulnerabilities"})}),e.jsx(u,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.high,icon:"severityHigh",variant:"warning",tooltipContent:"High Vulnerabilities"})}),e.jsx(u,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"severityMedium",variant:"warning",tooltipContent:"Medium Vulnerabilities"})}),e.jsx(u,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.low,icon:"severityLow",variant:"info",tooltipContent:"Low Vulnerabilities"})}),e.jsx(u,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:s.issuesCount.none,icon:"severityUnknown",variant:"default",tooltipContent:"None Vulnerabilities"})}),e.jsx(u,{children:e.jsx(ee,{serviceDetails:s.serviceDetails})}),e.jsx(u,{className:"cursor-default interactive",onClick:l=>l.stopPropagation(),children:e.jsx(O,{label:"Show Details",onClick:i,size:"small",className:"whitespace-nowrap"})})]}),P=8,ie=({servicesPromise:s})=>{const r=b(),{service:a}=S({from:"/services/"}),{error:i,data:l}=n.use(s),{services:c}=k(l),o=n.useCallback(t=>{r({to:"/services",search:h=>({...h,service:t.name})})},[]),m=n.useCallback(t=>{r({to:"/services/$service",params:{service:t.name}})},[]);return i?e.jsx(g,{colSpan:P,children:"Error loading services"}):c.length===0?e.jsx(g,{colSpan:P,children:"No service found"}):c.map(t=>e.jsx(se,{item:t,selected:t.name===a,onItemClick:()=>o(t),onServiceDetailClick:()=>m(t)},t.id))},V=8,re=()=>{const{queryClient:s,apiClient:r}=w({from:"/services/"}),{servicesPromise:a,filterSettings:i}=y({from:"/services/"}),[l,c]=n.useState(a),o=n.useCallback(m=>{const t=A({queryClient:s,apiClient:r,filterSettings:i,after:m});c(t)},[c,s,r,i]);return n.useEffect(()=>{c(a)},[c,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(E,{minContentColumns:[1,2,3,4,5,7],columns:V,children:[e.jsxs(F,{children:[e.jsx(v,{children:"Service"}),e.jsx(v,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(v,{children:"Details"}),e.jsx(v,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(g,{colSpan:V,children:e.jsxs(j,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(C,{variant:"primary"})]})}),children:e.jsx(ie,{servicesPromise:l})})]}),e.jsx(n.Suspense,{children:e.jsx(U,{dataPromise:l,goToPage:o,dataNormalizationMethod:k})}),e.jsx(Q,{})]})},te=({servicesPromise:s})=>{const{error:r,data:a}=n.use(s),{servicesIssuesCount:i}=k(a);return e.jsx(j,{gap:"1",children:r?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(W,{counts:i})})},ae=()=>{const{servicesPromise:s}=y({from:"/services/"});return e.jsx(j,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(C,{size:"small"}),children:e.jsx(te,{servicesPromise:s})})})},ne=()=>{const s=b(),{filters:r,filterSettings:a}=y({from:"/services/"}),{appProps:i}=w({from:"/services/"}),l=S({from:"/services/"}),{hasAppliedInitialFilters:c,markInitialFiltersApplied:o}=L();n.useLayoutEffect(()=>{if(!c&&!Object.keys(l).some(t=>t.startsWith(f))&&i?.initialFilters?.support_group?.length){const t=q(i.initialFilters);t.length>0&&(s({to:"/services",search:D({searchTerm:"",selectedFilters:t}),replace:!0}),o())}},[s,i,c,o,l]);const m=n.useCallback(t=>{s({to:"/services",search:h=>{const N=D(t);return{...Object.fromEntries(Object.entries(h).filter(([x])=>!x.startsWith(f))),...N}}})},[s]);return e.jsx(X,{filters:r,filterSettings:a,onFilterChange:m,searchInputPlaceholder:"search term for services name"})},le=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(C,{size:"small"})}),children:[e.jsx(ae,{}),e.jsx(re,{})]})]});B({service:d().optional(),searchTerm:d().optional()}).catchall(K((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(f)))return s},R([d(),T(d()),$()])));const je=le;export{je as component};
