import{j as e,r as m,b as w,u,c as C,f as y,e as N,d as j,A as o,g as d,M as h,a as f,x as c,z as l,S as k}from"./App-CJKAoyef-DY56_ZMu.js";import{w as t}from"./index-C-fiG1g8.js";import{C as P,j as x,v as I,P as g}from"./CursorPagination-g5cBkYVL-E7uWBKMt.js";import{B as T}from"./IssueTimestamp-BZ1e9kvZ-aUebRq30.js";import{C as z}from"./index-CbVuJRfO-CZSE79m3.js";import"./index-DR2whRmf.js";const D=r=>`
    border-l-2
    ${g(r)}
    h-full
    pl-5
  `,M=r=>{const s=r.toLowerCase(),i=g(r),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[s]||"help",color:i})},L=({vulnerability:r})=>{const[s,i]=t.useState(!1),n=a=>{a.preventDefault(),i(!s)};return e.jsxs(j,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:D(r.severity),children:M(r.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:r.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(T,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},$=({vulnerabilitiesPromise:r})=>{const{error:s,data:i}=t.use(r),{vulnerabilities:n}=f(i);return s?e.jsxs(x,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(x,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(L,{vulnerability:a},a.name))},q=()=>{const{queryClient:r,apiClient:s}=P({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=u({from:"/vulnerabilities/"}),[a,p]=t.useState(i),v=t.useCallback(b=>{const S=y({queryClient:r,apiClient:s,filterSettings:n,after:b});p(S)},[p,r,s,n]);return t.useEffect(()=>{p(i)},[p,i]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(j,{children:[e.jsx(o,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(o,{children:"Issue"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(x,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(m,{variant:"primary"})]})}),children:e.jsx($,{vulnerabilitiesPromise:a})})]}),e.jsx(t.Suspense,{children:e.jsx(I,{dataPromise:a,goToPage:v,dataNormalizationMethod:f})})]})},B=()=>{const r=w(),{filters:s,filterSettings:i}=u({from:"/vulnerabilities/"}),n=t.useCallback(a=>{r({to:"/vulnerabilities",search:{...C(a)}})},[i,r]);return e.jsx(z,{filters:s,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},F=()=>e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(m,{size:"small"})}),children:e.jsx(q,{})})]});l.object({vulnerability:l.string().optional(),searchTerm:l.preprocess(r=>typeof r=="number"?r.toString():r,l.string().optional())}).catchall(l.preprocess((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(k)))return r},l.union([l.string(),l.array(l.string()),l.undefined()])));const O=F;export{O as component};
