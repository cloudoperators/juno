import{j as e,x as u,b as w,u as j,c as C,a as y,l as N,C as f,h as c,f as d,K as p,g,v as h,z as a,S as P}from"./App-BDAmC-66-rtmYeLTr.js";import{w as t}from"./index-Cm26t1d6.js";import{v as k,C as m,P as z,j as L,E as v}from"./CursorPagination-COwS1BBF-Y9fm8LzE.js";import{B as D}from"./IssueTimestamp-Crqz15C4-BaFUj0-C.js";import{C as I}from"./index-DdRj-miy-K9M0CMtl.js";import"./index-Bvcb2eNF.js";const T=r=>`
    border-l-2
    ${v(r)}
    h-full
    pl-5
  `,U=r=>{const s=r.toLowerCase(),i=v(r),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[s]||"help",color:i})},B=({vulnerability:r})=>{const[s,i]=t.useState(!1),{needsExpansion:n,textRef:l}=L(r.description),o=x=>{x.preventDefault(),i(!s)};return e.jsxs(f,{children:[e.jsx(h,{className:"pl-0",children:e.jsx("div",{className:T(r.severity),children:U(r.severity)})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx("span",{children:r.servicesCount})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx(D,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(h,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:l,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&n&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},E=({vulnerabilitiesPromise:r})=>{const{error:s,data:i}=t.use(r),{vulnerabilities:n}=g(i);return s?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(l=>e.jsx(B,{vulnerability:l},l.name))},F=()=>{const{queryClient:r,apiClient:s}=k({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=j({from:"/vulnerabilities/"}),[l,o]=t.useState(i),x=t.useCallback(b=>{const S=y({queryClient:r,apiClient:s,filterSettings:n,after:b});o(S)},[o,r,s,n]);return t.useEffect(()=>{o(i)},[o,i]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(f,{children:[e.jsx(c,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(c,{children:"Issue"}),e.jsx(c,{children:"Services"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(u,{variant:"primary"})]})}),children:e.jsx(E,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(z,{dataPromise:l,goToPage:x,dataNormalizationMethod:g})})]})},M=()=>{const r=w(),{filters:s,filterSettings:i}=j({from:"/vulnerabilities/"}),n=t.useCallback(l=>{r({to:"/vulnerabilities",search:{...C(l)}})},[i,r]);return e.jsx(I,{filters:s,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},$=()=>e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(u,{size:"small"})}),children:e.jsx(F,{})})]});a.object({vulnerability:a.string().optional(),searchTerm:a.preprocess(r=>typeof r=="number"?r.toString():r,a.string().optional())}).catchall(a.preprocess((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(P)))return r},a.union([a.string(),a.array(a.string()),a.undefined()])));const G=$;export{G as component};
