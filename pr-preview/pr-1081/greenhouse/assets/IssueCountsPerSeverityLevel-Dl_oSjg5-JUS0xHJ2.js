import{A as x,U as v,V as N,X as D,j as e,T as V,R as f,l as k,C as I,h,K as l,x as S,M as j,F as P,Z as B,w as b,Q as Z,y as z,v as r,f as q}from"./App-DZnUGQn1-CTcRRSPy.js";import{w as c}from"./index-ZLNqnsJ7.js";import{v as g,P as A}from"./CursorPagination-Dskx7YaD-DlxYZbU6.js";const F=({children:s})=>e.jsx(P,{className:"my-6",children:s}),M=({imageVersionsPromise:s})=>{const{data:n}=c.use(s),{totalImageVersions:i}=j(n);return i},t=({icon:s,count:n,variant:i,tooltipContent:a,showDashIfZero:o=!1})=>o&&n===0?e.jsx("span",{children:"â€”"}):e.jsxs(B,{triggerEvent:"hover",children:[e.jsx(b,{children:e.jsx(Z,{icon:s,text:n>0?n.toString():"0",variant:n>0?i:"default"})}),e.jsx(z,{children:a})]}),T=({version:s,selected:n=!1,displayDetailsButton:i=!0,onItemClick:a,onDetailClick:o})=>e.jsxs(I,{onClick:a,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(r,{className:"service-image-versions-cell",children:e.jsxs(l,{gap:"1",direction:"vertical",children:[e.jsxs(l,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(l,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:d=>d.stopPropagation(),children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(q,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(r,{className:"service-image-versions-cell",children:s.tag}),e.jsx(r,{className:"items-center",children:e.jsx(t,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(t,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(t,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(t,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(t,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),i&&e.jsx(r,{children:e.jsx(f,{size:"small",label:"Show Details",onClick:o})})]}),K=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:i,imageVersionsPromise:a,onDetailsButtonClick:o,onImageVersionItemClick:d})=>{const{error:u,data:w}=c.use(a),{imageVersions:p}=j(w);return u?e.jsx(g,{colSpan:s,children:"Error loading image versions."}):p.length===0?e.jsx(g,{colSpan:s,children:"No image version found"}):p.map(m=>e.jsx(T,{version:m,selected:m.version===n,displayDetailsButton:i,onItemClick:()=>{d?.(m)},onDetailClick:y=>{y.stopPropagation(),o?.(m)}},m.version))},C=8,U=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:i=!1,onImageVersionItemClick:a,onDetailsButtonClick:o,goToPage:d})=>{const u=i?C:C-1;return e.jsxs(c.Suspense,{children:[e.jsxs(F,{children:["Image Versions",e.jsxs(c.Suspense,{children:["(",e.jsx(M,{imageVersionsPromise:s}),")"]})]}),i&&e.jsx(V,{children:e.jsx(f,{size:"small",onClick:()=>o?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(k,{columns:u,minContentColumns:[2,3,4,5,6],children:[e.jsxs(I,{children:[e.jsx(h,{children:"Image Repository"}),e.jsx(h,{children:"Tag"}),e.jsx(h,{colSpan:5,children:"Issue Counts"}),i&&e.jsx(h,{})]}),e.jsx(c.Suspense,{fallback:e.jsx(g,{colSpan:u,children:e.jsxs(l,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]})}),children:e.jsx(K,{columnSpan:u,displayDetailsButton:i,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:o,onImageVersionItemClick:a})})]})}),e.jsx(c.Suspense,{children:e.jsx(A,{dataNormalizationMethod:j,dataPromise:s,goToPage:d})})]})},_=({queryClient:s,apiClient:n,service:i,after:a})=>s.ensureQueryData({queryKey:["imageVersions",i,a],queryFn:()=>n.query({query:D,variables:{filter:{serviceCcrn:[i]},filterCi:{serviceCcrn:[i]},filterIc:{serviceCcrn:[i]},orderBy:[{by:N.Severity,direction:x.Desc}],orderByCi:[{by:v.Cluster,direction:x.Asc},{by:v.Namespace,direction:x.Asc}],after:a}})}),E=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(l,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(t,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(t,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(t,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(t,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(t,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{U as K,_ as P,E as _,t as i,F as z};
