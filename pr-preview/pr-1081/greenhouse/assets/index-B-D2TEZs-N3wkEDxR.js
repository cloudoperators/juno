import{j as e,x as u,b as w,u as j,c as C,a as y,l as N,C as f,h as c,f as d,K as p,g,v as h,z as a,S as P}from"./App-kVxSbkw1-J07vTBVy.js";import{w as t}from"./index-BYfXiTBZ.js";import{v as k,C as m,P as z,j as L,E as v}from"./CursorPagination-Don10naU-DEqxcx3T.js";import{B as D}from"./IssueTimestamp-BI3AImgq-CZpjRgSk.js";import{C as T}from"./index-YbtZ4mII-D2FYUQkX.js";import"./index-GT02rB8n.js";const U=r=>`
    border-l-2
    ${v(r)}
    h-full
    pl-5
  `,B=r=>{const i=r.toLowerCase(),s=v(r),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[i]||"help",color:s})},E=({vulnerability:r})=>{const[i,s]=t.useState(!1),{needsExpansion:n,textRef:l}=L(r.description),o=x=>{x.preventDefault(),s(!i)};return e.jsxs(f,{children:[e.jsx(h,{className:"pl-0",children:e.jsx("div",{className:U(r.severity),children:B(r.severity)})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx("span",{children:r.servicesCount})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx(D,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(h,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:l,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&n&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},I=({vulnerabilitiesPromise:r})=>{const{error:i,data:s}=t.use(r),{vulnerabilities:n}=g(s);return i?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(l=>e.jsx(E,{vulnerability:l},l.name))},F=()=>{const{queryClient:r,apiClient:i}=k({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:s,filterSettings:n}=j({from:"/vulnerabilities/"}),[l,o]=t.useState(s),x=t.useCallback(b=>{const S=y({queryClient:r,apiClient:i,filterSettings:n,after:b});o(S)},[o,r,i,n]);return t.useEffect(()=>{o(s)},[o,s]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(f,{children:[e.jsx(c,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(c,{children:"Vulnerability"}),e.jsx(c,{children:"Services"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(u,{variant:"primary"})]})}),children:e.jsx(I,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(z,{dataPromise:l,goToPage:x,dataNormalizationMethod:g})})]})},M=()=>{const r=w(),{filters:i,filterSettings:s}=j({from:"/vulnerabilities/"}),n=t.useCallback(l=>{r({to:"/vulnerabilities",search:{...C(l)}})},[s,r]);return e.jsx(T,{filters:i,filterSettings:s,onFilterChange:n,searchInputPlaceholder:"search term for vulnerabilities name"})},V=()=>e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(u,{size:"small"})}),children:e.jsx(F,{})})]});a.object({vulnerability:a.string().optional(),searchTerm:a.preprocess(r=>typeof r=="number"?r.toString():r,a.string().optional())}).catchall(a.preprocess((r,i)=>{if(!(i.path.length>0&&typeof i.path[0]=="string"&&!i.path[0].startsWith(P)))return r},a.union([a.string(),a.array(a.string()),a.undefined()])));const G=V;export{G as component};
