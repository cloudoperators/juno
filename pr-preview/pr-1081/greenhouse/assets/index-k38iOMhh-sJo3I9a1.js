import{j as e,r as x,b as S,u as j,c as y,a as C,e as N,d as u,A as o,f as d,k as h,g as f,y as c,z as l,S as k}from"./App-Da1Yg2v0-7yBA7Vmt.js";import{w as t}from"./index-Be8xNjzN.js";import{p as P,j as m,b as D,y as g}from"./CursorPagination-ACu98_oB-D-m6jIzj.js";import{B as T}from"./IssueTimestamp-bFBImrYl-Dq4k8n0B.js";import{G as z}from"./index-DecOkGNK-BdKTksP2.js";import"./index-CAOJSEDT.js";const I=r=>`
    border-l-2
    ${g(r)}
    h-full
    pl-5
  `,L=r=>{const s=r.toLowerCase(),i=g(r),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[s]||"help",color:i})},A=({vulnerability:r})=>{const[s,i]=t.useState(!1),n=a=>{a.preventDefault(),i(!s)};return e.jsxs(u,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:I(r.severity),children:L(r.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:r.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(T,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},B=({vulnerabilitiesPromise:r})=>{const{error:s,data:i}=t.use(r),{vulnerabilities:n}=f(i);return s?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(A,{vulnerability:a},a.name))},F=()=>{const{queryClient:r,apiClient:s}=P({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=j({from:"/vulnerabilities/"}),[a,p]=t.useState(i),v=t.useCallback(b=>{const w=C({queryClient:r,apiClient:s,filterSettings:n,after:b});p(w)},[p,r,s,n]);return t.useEffect(()=>{p(i)},[p,i]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(u,{children:[e.jsx(o,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(o,{children:"Issue"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(x,{variant:"primary"})]})}),children:e.jsx(B,{vulnerabilitiesPromise:a})})]}),e.jsx(t.Suspense,{children:e.jsx(D,{dataPromise:a,goToPage:v,dataNormalizationMethod:f})})]})},M=()=>{const r=S(),{filters:s,filterSettings:i}=j({from:"/vulnerabilities/"}),n=t.useCallback(a=>{r({to:"/vulnerabilities",search:{...y(a)}})},[i,r]);return e.jsx(z,{filters:s,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},U=()=>e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(x,{size:"small"})}),children:e.jsx(F,{})})]});l.object({vulnerability:l.string().optional(),searchTerm:l.preprocess(r=>typeof r=="number"?r.toString():r,l.string().optional())}).catchall(l.preprocess((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(k)))return r},l.union([l.string(),l.array(l.string()),l.undefined()])));const W=U;export{W as component};
