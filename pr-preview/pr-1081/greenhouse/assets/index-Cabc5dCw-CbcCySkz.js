import{j as e,x,b as S,u,c as C,a as y,l as N,C as j,h as o,f as d,K as h,g,v as c,z as a,S as P}from"./App-DZnUGQn1-CTcRRSPy.js";import{w as t}from"./index-ZLNqnsJ7.js";import{p as k,v as m,P as z,w as f}from"./CursorPagination-Dskx7YaD-DlxYZbU6.js";import{B as L}from"./IssueTimestamp-CBnF0lgw-B8P07hCJ.js";import{C as D}from"./index-CDnYPKY5-Cg_veRiq.js";import"./index-BFr4-AgD.js";const I=r=>`
    border-l-2
    ${f(r)}
    h-full
    pl-5
  `,T=r=>{const s=r.toLowerCase(),i=f(r),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[s]||"help",color:i})},U=({vulnerability:r})=>{const[s,i]=t.useState(!1),n=l=>{l.preventDefault(),i(!s)};return e.jsxs(j,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:I(r.severity),children:T(r.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:r.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(L,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},B=({vulnerabilitiesPromise:r})=>{const{error:s,data:i}=t.use(r),{vulnerabilities:n}=g(i);return s?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(l=>e.jsx(U,{vulnerability:l},l.name))},F=()=>{const{queryClient:r,apiClient:s}=k({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=u({from:"/vulnerabilities/"}),[l,p]=t.useState(i),v=t.useCallback(b=>{const w=y({queryClient:r,apiClient:s,filterSettings:n,after:b});p(w)},[p,r,s,n]);return t.useEffect(()=>{p(i)},[p,i]),e.jsxs(e.Fragment,{children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(j,{children:[e.jsx(o,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(o,{children:"Issue"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(x,{variant:"primary"})]})}),children:e.jsx(B,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(z,{dataPromise:l,goToPage:v,dataNormalizationMethod:g})})]})},q=()=>{const r=S(),{filters:s,filterSettings:i}=u({from:"/vulnerabilities/"}),n=t.useCallback(l=>{r({to:"/vulnerabilities",search:{...C(l)}})},[i,r]);return e.jsx(D,{filters:s,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},E=()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(x,{size:"small"})}),children:e.jsx(F,{})})]});a.object({vulnerability:a.string().optional(),searchTerm:a.preprocess(r=>typeof r=="number"?r.toString():r,a.string().optional())}).catchall(a.preprocess((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(P)))return r},a.union([a.string(),a.array(a.string()),a.undefined()])));const A=E;export{A as component};
