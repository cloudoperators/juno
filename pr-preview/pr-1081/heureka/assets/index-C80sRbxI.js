import{j as e,C as m,v as o,K as p,f as h,g as x,u as j,a as S,l as w,h as c,x as g,b as E,c as N,z as t,S as F}from"./App-DRu_KzCf.js";import{a as l}from"./index-CmTL6-9U.js";import{g as f,E as u,u as D,C as I}from"./CursorPagination-CdApIftj.js";import{I as V}from"./IssueTimestamp-CoLKDUFG.js";import{F as L}from"./index-q-jLUAjU.js";const P=s=>`
    border-l-2
    ${f(s)}
    h-full
    pl-5
  `,R=s=>{const r=s.toLowerCase(),i=f(s),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(h,{icon:n[r]||"help",color:i})},k=({vulnerability:s})=>{const[r,i]=l.useState(!1),n=a=>{a.preventDefault(),i(!r)};return e.jsxs(m,{children:[e.jsx(o,{className:"pl-0",children:e.jsx("div",{className:P(s.severity),children:R(s.severity)})}),e.jsx(o,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(h,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(o,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(o,{className:"whitespace-nowrap",children:e.jsx(V,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(o,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(h,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},y=({vulnerabilitiesPromise:s})=>{const{error:r,data:i}=l.use(s),{vulnerabilities:n}=x(i);return r?e.jsxs(u,{colSpan:5,children:["Error loading vulnerabilities: ",r.message]}):n.length===0?e.jsx(u,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(k,{vulnerability:a},a.name))},T=()=>{const{queryClient:s,apiClient:r}=D({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=j({from:"/vulnerabilities/"}),[a,d]=l.useState(i),b=l.useCallback(v=>{const C=S({queryClient:s,apiClient:r,filterSettings:n,after:v});d(C)},[d,s,r,n]);return l.useEffect(()=>{d(i)},[d,i]),e.jsxs(e.Fragment,{children:[e.jsxs(w,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(m,{children:[e.jsx(c,{children:e.jsx(h,{icon:"monitorHeart"})}),e.jsx(c,{children:"Issue"}),e.jsx(c,{children:"Services"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),e.jsx(l.Suspense,{fallback:e.jsx(u,{colSpan:5,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(y,{vulnerabilitiesPromise:a})})]}),e.jsx(l.Suspense,{children:e.jsx(I,{dataPromise:a,goToPage:b,dataNormalizationMethod:x})})]})},z=()=>{const s=E(),{filters:r,filterSettings:i}=j({from:"/vulnerabilities/"}),n=l.useCallback(a=>{s({to:"/vulnerabilities",search:{...N(a)}})},[i,s]);return e.jsx(L,{filters:r,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},U=()=>e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:e.jsx(T,{})})]});t.object({vulnerability:t.string().optional(),searchTerm:t.preprocess(s=>typeof s=="number"?s.toString():s,t.string().optional())}).catchall(t.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(F)))return s},t.union([t.string(),t.array(t.string()),t.undefined()])));const G=U;export{G as component};
