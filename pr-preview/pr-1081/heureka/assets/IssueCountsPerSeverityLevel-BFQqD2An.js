import{j as e,B as w,J as p,V as S,K as b,M as D,s as E,d as C,y as o,k as c,f as O,U as y,Q as R,e as F,A as u,r as L,t as j,R as f,T as z,W as M}from"./App-DporlnqB.js";import{a as d}from"./index-DxFmpwI_.js";import{E as m,C as T}from"./CursorPagination-BSal-MuK.js";const U=({children:s})=>e.jsx(w,{className:"my-6",children:s}),V=({imageVersionsPromise:s})=>{const{data:n}=d.use(s),{totalImageVersions:r}=p(n);return r},i=({icon:s,count:n,variant:r,tooltipContent:t,showDashIfZero:a=!1})=>a&&n===0?e.jsx("span",{children:"â€”"}):e.jsxs(S,{triggerEvent:"hover",children:[e.jsx(b,{children:e.jsx(D,{icon:s,text:n>0?n.toString():"0",variant:n>0?r:"default"})}),e.jsx(E,{children:t})]}),Z=({version:s,selected:n=!1,displayDetailsButton:r=!0,onItemClick:t,onDetailClick:a})=>e.jsxs(C,{onClick:t,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(o,{className:"service-image-versions-cell",children:e.jsxs(c,{gap:"1",direction:"vertical",children:[e.jsxs(c,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(c,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:l=>l.stopPropagation(),children:e.jsxs(c,{gap:"1.5",alignment:"center",children:[e.jsx(O,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(o,{className:"service-image-versions-cell",children:s.tag}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),r&&e.jsx(o,{children:e.jsx(y,{size:"small",label:"Show Details",onClick:a})})]}),q=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:r,imageVersionsPromise:t,onDetailsButtonClick:a,onImageVersionItemClick:l})=>{const{error:h,data:I}=d.use(t),{imageVersions:g}=p(I);return h?e.jsx(m,{colSpan:s,children:"Error loading image versions."}):g.length===0?e.jsx(m,{colSpan:s,children:"No image version found"}):g.map(x=>e.jsx(Z,{version:x,selected:x.version===n,displayDetailsButton:r,onItemClick:()=>{l==null||l(x)},onDetailClick:N=>{N.stopPropagation(),a==null||a(x)}},x.version))},v=8,K=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:r=!1,onImageVersionItemClick:t,onDetailsButtonClick:a,goToPage:l})=>{const h=r?v:v-1;return e.jsxs(d.Suspense,{children:[e.jsxs(U,{children:["Image Versions",e.jsxs(d.Suspense,{children:["(",e.jsx(V,{imageVersionsPromise:s}),")"]})]}),r&&e.jsx(R,{children:e.jsx(y,{size:"small",onClick:()=>a==null?void 0:a(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(F,{columns:h,minContentColumns:[2,3,4,5,6],children:[e.jsxs(C,{children:[e.jsx(u,{children:"Image Repository"}),e.jsx(u,{children:"Tag"}),e.jsx(u,{colSpan:5,children:"Issue Counts"}),r&&e.jsx(u,{})]}),e.jsx(d.Suspense,{fallback:e.jsx(m,{colSpan:h,children:e.jsxs(c,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),children:e.jsx(q,{columnSpan:h,displayDetailsButton:r,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:a,onImageVersionItemClick:t})})]})}),e.jsx(d.Suspense,{children:e.jsx(T,{dataNormalizationMethod:p,dataPromise:s,goToPage:l})})]})},P=({queryClient:s,apiClient:n,service:r,after:t})=>s.ensureQueryData({queryKey:["imageVersions",r,t],queryFn:()=>n.query({query:M,variables:{filter:{serviceCcrn:[r]},filterCi:{serviceCcrn:[r]},filterIc:{serviceCcrn:[r]},orderBy:[{by:z.Severity,direction:j.Desc}],orderByCi:[{by:f.Cluster,direction:j.Asc},{by:f.Namespace,direction:j.Asc}],after:t}})}),_=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(c,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(i,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(i,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(i,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(i,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(i,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{_ as I,K as S,i as a,U as b,P as f};
