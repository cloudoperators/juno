import{j as e,d as u,y as l,k as d,f as h,g as x,u as j,a as S,e as w,A as c,r as g,b as N,c as E,z as t,S as F}from"./App-DporlnqB.js";import{a as o}from"./index-DxFmpwI_.js";import{g as f,E as m,u as D,C as k}from"./CursorPagination-BSal-MuK.js";import{I as y}from"./IssueTimestamp-Ces4fvri.js";import{F as I}from"./index-DDMJmYoc.js";const V=s=>`
    border-l-2
    ${f(s)}
    h-full
    pl-5
  `,L=s=>{const r=s.toLowerCase(),i=f(s),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(h,{icon:n[r]||"help",color:i})},P=({vulnerability:s})=>{const[r,i]=o.useState(!1),n=a=>{a.preventDefault(),i(!r)};return e.jsxs(u,{children:[e.jsx(l,{className:"pl-0",children:e.jsx("div",{className:V(s.severity),children:L(s.severity)})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(h,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(l,{className:"whitespace-nowrap",children:e.jsx(y,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(l,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&e.jsx("a",{href:"#",onClick:n,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(h,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},R=({vulnerabilitiesPromise:s})=>{const{error:r,data:i}=o.use(s),{vulnerabilities:n}=x(i);return r?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",r.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(P,{vulnerability:a},a.name))},T=()=>{const{queryClient:s,apiClient:r}=D({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:i,filterSettings:n}=j({from:"/vulnerabilities/"}),[a,p]=o.useState(i),b=o.useCallback(v=>{const C=S({queryClient:s,apiClient:r,filterSettings:n,after:v});p(C)},[p,s,r,n]);return o.useEffect(()=>{p(i)},[p,i]),e.jsxs(e.Fragment,{children:[e.jsxs(w,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(u,{children:[e.jsx(c,{children:e.jsx(h,{icon:"monitorHeart"})}),e.jsx(c,{children:"Issue"}),e.jsx(c,{children:"Services"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),e.jsx(o.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(R,{vulnerabilitiesPromise:a})})]}),e.jsx(o.Suspense,{children:e.jsx(k,{dataPromise:a,goToPage:b,dataNormalizationMethod:x})})]})},z=()=>{const s=N(),{filters:r,filterSettings:i}=j({from:"/vulnerabilities/"}),n=o.useCallback(a=>{s({to:"/vulnerabilities",search:{...E(a)}})},[i,s]);return e.jsx(I,{filters:r,filterSettings:i,onFilterChange:n,searchInputPlaceholder:"search term for vulnerability name"})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:e.jsx(T,{})})]});t.object({vulnerability:t.string().optional(),searchTerm:t.preprocess(s=>typeof s=="number"?s.toString():s,t.string().optional())}).catchall(t.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(F)))return s},t.union([t.string(),t.array(t.string()),t.undefined()])));const H=A;export{H as component};
