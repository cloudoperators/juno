import{g as S,j as e,d as g,i as E,u as R,r as u,c as d,V as m,L as b,M as P,K,X as C,o as p,E as v,a as I,N as w,b as V,P as $,p as T,h as k,C as f,y as z,k as F,m as M}from"./App-DK5Bgayc.js";import{r as t}from"./index-TqrtMguD.js";import{E as y,u as L,g as G,L as U,C as _,I as N}from"./IssueCountsPerSeverityLevel-rApSS2Ii.js";import{f as D,a as q,S as H}from"./fetchImages-B1BR3zDX.js";import{I as X}from"./IssueTimestamp-BZ9bZbUL.js";const A=s=>{const i=s.toLowerCase(),r=S(i);return e.jsx(g,{icon:E[i]||"help",color:r})},B=({severity:s})=>A(s),O=s=>`
    border-l-2
    ${S(s.toLowerCase())}
    h-full
    pl-5
  `,J=({issue:s})=>{const[i,r]=t.useState(!1),{needsExpansion:o,textRef:n}=R(s.description),l=a=>{a.preventDefault(),r(!i)};return e.jsxs(u,{children:[e.jsx(d,{className:"pl-0",children:e.jsx("div",{className:O(s.severity),children:e.jsx(B,{severity:s.severity})})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(m,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsx(X,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(d,{children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:n,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&o&&e.jsx("a",{href:"#",onClick:l,className:"link-hover",children:e.jsxs(m,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},Q=({issuesPromise:s})=>{const{error:i,data:r}=t.use(s),{vulnerabilities:o}=b(r);return i?e.jsxs(y,{colSpan:4,children:["Error loading vulnerabilities: ",i.message]}):o.length===0?e.jsx(y,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):o.map(n=>e.jsx(J,{issue:n},n.id||n.name))},W=({service:s,image:i})=>{const{apiClient:r,queryClient:o}=L({from:"/services/$service"}),[n,l]=t.useState(void 0),[a,x]=t.useState(void 0),h=n?{search:[n]}:void 0,c=D({apiClient:r,queryClient:o,filter:{service:[s],repository:[i.repository]},firstVulnerabilities:20,afterVulnerabilities:a,vulFilter:h});return e.jsxs(e.Fragment,{children:[e.jsxs(m,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(P,{children:"Vulnerabilities"}),e.jsx(K,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:j=>l(j||""),onClear:()=>{l("")}})]}),e.jsxs(C,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),c&&e.jsx(v,{displayErrorMessage:!0,fallbackRender:G({colspan:4}),resetKeys:[c],children:e.jsx(t.Suspense,{fallback:e.jsx(U,{colSpan:4}),children:e.jsx(Q,{issuesPromise:c})})})]}),c&&e.jsx(v,{resetKeys:[c],children:e.jsx(t.Suspense,{children:e.jsx(_,{dataPromise:c,dataNormalizationMethod:b,goToPage:x})})})]})},Y=({imagesPromise:s})=>{const i=I(),{service:r}=w({from:"/services/$service"}),{image:o}=V({from:"/services/$service"}),{data:n}=t.use(s),{images:l}=$(n),a=l.find(x=>x.repository===o);return a?e.jsx(T,{heading:`Image ${a.repository} Information`,opened:!!r,onClose:()=>i({to:"/services/$service",params:{service:r}}),size:"large",children:e.jsxs(k,{children:[e.jsxs(C,{columns:2,gridColumnTemplate:"20% auto",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Details"}),e.jsx(d,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(f,{pillKey:"repository",pillKeyLabel:"repository",pillValue:a.repository,pillValueLabel:a.repository}),a.versionsCount!==void 0&&a.versionsCount>0&&e.jsx(f,{pillKey:"versions",pillKeyLabel:"versions",pillValue:a.versionsCount.toString(),pillValueLabel:a.versionsCount.toString()})]})})]}),e.jsxs(u,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(d,{children:e.jsx(N,{counts:a.vulnerabilityCounts})})]})]}),r&&o&&a&&e.jsx(W,{service:r,image:a})]})}):null},Z=({servicePromise:s})=>{const{data:i}=t.use(s),r=z(i).services[0];return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:["Service ",r.name]}),e.jsxs(C,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Details"}),e.jsx(d,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(f,{pillKey:"service",pillKeyLabel:"service",pillValue:r.name,pillValueLabel:r.name}),r.serviceDetails?.supportGroups?.map(o=>e.jsx(f,{pillKey:"support_group",pillKeyLabel:"support_group",pillValue:o,pillValueLabel:o},o))]})})]}),e.jsxs(u,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(d,{children:e.jsx(N,{counts:r.issuesCount})})]})]})]})},ee=()=>{const s=I(),{queryClient:i,apiClient:r}=L({from:"/services/$service"}),{servicePromise:o}=F({from:"/services/$service"}),{service:n}=w({from:"/services/$service"}),{image:l}=V({from:"/services/$service"}),[a,x]=t.useState(void 0),[h,c]=t.useState(void 0);return t.useEffect(()=>{const j=D({queryClient:i,apiClient:r,filter:{service:[n]},after:a});c(j)},[a,n,i,r]),e.jsxs(e.Fragment,{children:[e.jsx(v,{displayErrorMessage:!0,children:e.jsx(t.Suspense,{fallback:e.jsx(M,{className:"mt-4"}),children:e.jsx(Z,{servicePromise:o})})}),h&&e.jsxs(e.Fragment,{children:[e.jsx(H,{selectedImage:l,imagesPromise:h,onImageItemClick:j=>{s({to:"/services/$service",params:{service:n},search:{image:j.repository}})},goToPage:x}),e.jsx(v,{children:e.jsx(t.Suspense,{children:e.jsx(Y,{imagesPromise:h})})})]})]})},ne=ee;export{ne as component};
