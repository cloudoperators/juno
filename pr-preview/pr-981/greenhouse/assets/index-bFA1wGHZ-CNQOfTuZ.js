import{g as O,j as e,f as T,S as g,i as k,k as S,q as W,d as I,u as D,X as $,c as _,l as b,e as L,T as Z,G as A,L as J,a as z,Z as G,w as V,y as p,p as X,b as K,m as M}from"./App-BTgTFDmO-Ccoy1RxZ.js";import{w as d}from"./index-DITXF-if.js";import{l as Q,j as h,d as B,Q as H,X as R,g as q,v as w,i as U,y as Y,x as F,f as C,a as ee}from"./IssueCountsPerSeverityLevel-BWGiPHRP-Cfi7O0QI.js";import"./index-CK7imIfl.js";const se=({filters:s,onChange:l})=>{var r,a;const[c,v]=d.useState(""),[o]=d.useState(""),u=(a=(r=s.find(t=>t.filterName===c))==null?void 0:r.values)==null?void 0:a.filter(t=>t),i=d.useCallback(t=>{!h.isEmpty(c)&&!h.isEmpty(t)&&l({name:c,value:t})},[c,l]);return e.jsx(g,{alignment:"center",gap:"8",children:e.jsxs(k,{children:[e.jsx(A,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:c,onChange:t=>{v(String(t))},children:s==null?void 0:s.map(({displayName:t,filterName:m})=>e.jsx(J,{value:m,label:t,"data-testid":m},m))}),e.jsx(z,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:o,onChange:i,children:u==null?void 0:u.map(t=>e.jsx(G,{value:t,label:t,"data-testid":t},t))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},le=({selectedFilters:s,onDelete:l})=>e.jsx(g,{gap:"2",wrap:!0,children:s==null?void 0:s.map(r=>e.jsx(V,{closeable:!0,pillKey:r.name,pillValue:r.value,onClose:()=>l(r)},`${name}:${r.value}`))}),re=({filters:s,filterSettings:l,onFilterChange:r,searchInputPlaceholder:a})=>{const c=o=>{var u;r({...l,selectedFilters:(u=l.selectedFilters)==null?void 0:u.filter(i=>!(i.name===o.name&&i.value===o.value))})},v=o=>{var u,i;const t=(u=l.selectedFilters)==null?void 0:u.filter(m=>m.name===o.name&&m.value===o.value);(!t||t.length==0)&&r({...l,selectedFilters:(i=l==null?void 0:l.selectedFilters)==null?void 0:i.concat(o)})};return e.jsxs(g,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(k,{children:[e.jsx(se,{filters:s,onChange:v}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>r({...l,selectedFilters:[]}),variant:"subdued"}),e.jsx(W,{placeholder:a||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",onSearch:o=>{r({...l,searchTerm:o})},onClear:()=>r({...l,searchTerm:""})})]}),l.selectedFilters&&l.selectedFilters.length>0&&e.jsx(le,{selectedFilters:l.selectedFilters,onDelete:c})]})},P={supportGroups:"support_group",region:"region",integrity:"integrity"},ae=({serviceDetails:s})=>{const l=(r,a)=>e.jsx(V,{pillKey:r,pillKeyLabel:r,pillValue:a,pillValueLabel:a},a);return e.jsx(g,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([r,a])=>Array.isArray(a)?a.map(c=>l(P[r],c)):l(P[r],a))})},te=({item:s,selected:l,onItemClick:r,onServiceDetailClick:a})=>e.jsxs(_,{className:`cursor-pointer ${l?"active":""}`,onClick:r,children:[e.jsx(p,{children:s.name}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(p,{children:e.jsx(ae,{serviceDetails:s.serviceDetails})}),e.jsx(p,{className:"cursor-default interactive",onClick:c=>c.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:a,size:"small",className:"whitespace-nowrap"})})]}),ie=({service:s,onClose:l})=>{const r=D();return e.jsx(X,{heading:`${K(s.name)} Overview`,opened:!0,onClose:l,size:"large",children:e.jsx(M,{children:e.jsx(ee,{service:s,onDetailsButtonClick:a=>r({to:"/services/$service",params:{service:s.name},search:{imageVersion:a==null?void 0:a.version}}),displayActions:!0})})})},N=8,ne=({defaultSelectService:s,services:l,loading:r,error:a,currentPage:c,totalNumberOfPages:v,goToPage:o})=>{const u=D(),[i,t]=d.useState(null),m=d.useCallback(n=>{t(f=>(f==null?void 0:f.id)===n.id?null:n),u({to:"/services",search:{service:n.name}})},[]),j=d.useCallback(()=>{t(null),u({to:"/services"})},[]),x=d.useCallback(n=>{u({to:"/services/$service",params:{service:n.name}})},[]);return d.useEffect(()=>{t(l.find(n=>n.name===s)||null)},[s,l]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:N,children:[e.jsxs(_,{children:[e.jsx(b,{children:"Service"}),e.jsx(b,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(b,{children:"Details"}),e.jsx(b,{})]}),r&&e.jsx(F,{colSpan:N,children:e.jsxs(g,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(I,{variant:"primary"})]})}),!r&&!a&&l.length>0&&l.map(n=>e.jsx(te,{item:n,selected:(i==null?void 0:i.id)===n.id,onItemClick:()=>m(n),onServiceDetailClick:()=>x(n)},n.id)),!r&&!a&&l.length===0&&e.jsx(F,{colSpan:N,children:"No services found"})]}),!!v&&e.jsx(g,{distribution:"end",className:"mt-4",children:e.jsx(L,{variant:"number",currentPage:c,onPressNext:o,onPressPrevious:o,pages:v})}),i&&e.jsx(Z,{children:e.jsx(ie,{service:i,onClose:j})})]})},ce=s=>{var l;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((l=s==null?void 0:s.values)==null?void 0:l.filter(r=>r!==null))||[]}},oe=s=>h.isEmpty(s)||h.isEmpty(s.ServiceFilterValues)?[]:h.map(h.omit(s.ServiceFilterValues,["__typename"]),ce),ue=()=>{const{data:s,previousData:l,loading:r,error:a}=Q();return{serviceFilters:oe(h.isEmpty(s)?l:s),loading:r,error:a}},de=({loading:s,error:l,counts:r})=>e.jsxs(g,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(g,{gap:"1",children:!l&&!s?e.jsx(Y,{counts:r}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(g,{alignment:"center",className:"ml-auto",children:s&&e.jsx(I,{size:"small",className:"mr-2"})})]}),me=({filterSettings:s,pageSize:l=20})=>{const r=d.useRef(null),[a,{data:c,loading:v,error:o}]=B({variables:{first:l,orderBy:[{by:R.Severity,direction:H.Desc}]},fetchPolicy:"network-only"}),{services:u,servicesIssuesCount:i,pages:t,pageNumber:m}=q(c);r.current=t;const j=d.useCallback(x=>{var n,f;if(!h.isNil(x)){const E=(f=(n=r.current)==null?void 0:n.find(y=>(y==null?void 0:y.pageNumber)===x-1))==null?void 0:f.after;a({variables:{filter:w(s),after:E}})}},[s]);return d.useEffect(()=>{a({variables:{filter:w(s)}})},[s]),{loading:v,error:U(o),services:u||[],servicesIssuesCount:i,currentPage:m,totalNumberOfPages:t.length||0,goToPage:j}},ve=s=>{var l;return{selectedFilters:((l=s==null?void 0:s.support_group)==null?void 0:l.map(r=>({name:"supportGroupCcrn",value:r})))??[],searchTerm:""}},ge=({defaultSelectService:s,initialFilters:l})=>{const{serviceFilters:r}=ue(),{addMessage:a,resetMessages:c}=T(),[v,o]=d.useState(ve(l)),{loading:u,error:i,services:t,servicesIssuesCount:m,currentPage:j,totalNumberOfPages:x,goToPage:n}=me({filterSettings:v});return d.useEffect(()=>{i?a({variant:"error",text:i}):c()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(re,{filters:r,filterSettings:v,onFilterChange:o,searchInputPlaceholder:"search term for services name"}),e.jsx(de,{counts:m,loading:u,error:i}),e.jsx(ne,{defaultSelectService:s,services:t,loading:u,error:i,currentPage:j,totalNumberOfPages:x,goToPage:n})]})},fe=function(){const s=O("/services/"),{appProps:l}=s.useRouteContext(),{service:r}=s.useSearch();return e.jsx(ge,{defaultSelectService:r,initialFilters:l.initialFilters})};export{fe as component};
