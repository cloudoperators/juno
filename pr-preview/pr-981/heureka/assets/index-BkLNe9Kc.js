import{j as e,S as h,i as P,G as A,L as z,a as G,Z as V,k as S,w as k,q as Z,c as E,y as x,u as L,p as $,b as R,m as _,X as M,l as N,d as f,e as B,T as K,f as T,g as q}from"./App-DZqad0yc.js";import{a as m}from"./index-DZpvUKe4.js";import{l as v,S as b,a as Q,E as w,u as X,I as H,b as U,O as J,c as W,g as Y,d as D,e as ee}from"./IssueCountsPerSeverityLevel-CtK_qzTH.js";const se=({filters:s,onChange:a})=>{var i,c;const[t,r]=m.useState(""),[u]=m.useState(""),d=(c=(i=s.find(n=>n.filterName===t))==null?void 0:i.values)==null?void 0:c.filter(n=>n),o=m.useCallback(n=>{!v.isEmpty(t)&&!v.isEmpty(n)&&a({name:t,value:n})},[t,a]);return e.jsx(h,{alignment:"center",gap:"8",children:e.jsxs(P,{children:[e.jsx(A,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:t,onChange:n=>{r(String(n))},children:s==null?void 0:s.map(({displayName:n,filterName:p})=>e.jsx(z,{value:p,label:n,"data-testid":p},p))}),e.jsx(G,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:u,onChange:o,children:d==null?void 0:d.map(n=>e.jsx(V,{value:n,label:n,"data-testid":n},n))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ae=({selectedFilters:s,onDelete:a})=>e.jsx(h,{gap:"2",wrap:!0,children:s==null?void 0:s.map(t=>e.jsx(k,{closeable:!0,pillKey:t.name,pillValue:t.value,onClose:()=>a(t)},`${name}:${t.value}`))}),te=({filters:s,filterSettings:a,onFilterChange:t,searchInputPlaceholder:r})=>{const u=o=>{var i;t({...a,selectedFilters:(i=a.selectedFilters)==null?void 0:i.filter(c=>!(c.name===o.name&&c.value===o.value))})},d=o=>{var c,n;const i=(c=a.selectedFilters)==null?void 0:c.filter(p=>p.name===o.name&&p.value===o.value);(!i||i.length==0)&&t({...a,selectedFilters:(n=a==null?void 0:a.selectedFilters)==null?void 0:n.concat(o)})};return e.jsxs(h,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(P,{children:[e.jsx(se,{filters:s,onChange:d}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>t({...a,selectedFilters:[]}),variant:"subdued"}),e.jsx(Z,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",onSearch:o=>{t({...a,searchTerm:o})},onClear:()=>t({...a,searchTerm:""})})]}),a.selectedFilters&&a.selectedFilters.length>0&&e.jsx(ae,{selectedFilters:a.selectedFilters,onDelete:u})]})},I={supportGroups:"support_group",region:"region",integrity:"integrity"},re=({serviceDetails:s})=>{const a=(t,r)=>e.jsx(k,{pillKey:t,pillKeyLabel:t,pillValue:r,pillValueLabel:r},r);return e.jsx(h,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([t,r])=>Array.isArray(r)?r.map(u=>a(I[t],u)):a(I[t],r))})},ne=({item:s,selected:a,onItemClick:t,onServiceDetailClick:r})=>e.jsxs(E,{className:`cursor-pointer ${a?"active":""}`,onClick:t,children:[e.jsx(x,{children:s.name}),e.jsx(x,{className:"items-center",children:e.jsx(b,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(x,{className:"items-center",children:e.jsx(b,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(x,{className:"items-center",children:e.jsx(b,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(x,{className:"items-center",children:e.jsx(b,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(x,{className:"items-center",children:e.jsx(b,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(x,{children:e.jsx(re,{serviceDetails:s.serviceDetails})}),e.jsx(x,{className:"cursor-default interactive",onClick:u=>u.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),ce=({service:s,onClose:a})=>{const t=L();return e.jsx($,{heading:`${R(s.name)} Overview`,opened:!0,onClose:a,size:"large",children:e.jsx(_,{children:e.jsx(Q,{service:s,onDetailsButtonClick:r=>t({to:"/services/$service",params:{service:s.name},search:{imageVersion:r==null?void 0:r.version}}),displayActions:!0})})})},F=8,le=({defaultSelectService:s,services:a,loading:t,error:r,currentPage:u,totalNumberOfPages:d,goToPage:o})=>{const i=L(),[c,n]=m.useState(null),p=m.useCallback(l=>{n(g=>(g==null?void 0:g.id)===l.id?null:l),i({to:"/services",search:{service:l.name}})},[]),C=m.useCallback(()=>{n(null),i({to:"/services"})},[]),j=m.useCallback(l=>{i({to:"/services/$service",params:{service:l.name}})},[]);return m.useEffect(()=>{n(a.find(l=>l.name===s)||null)},[s,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(M,{minContentColumns:[1,2,3,4,5,7],columns:F,children:[e.jsxs(E,{children:[e.jsx(N,{children:"Service"}),e.jsx(N,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(N,{children:"Details"}),e.jsx(N,{})]}),t&&e.jsx(w,{colSpan:F,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(f,{variant:"primary"})]})}),!t&&!r&&a.length>0&&a.map(l=>e.jsx(ne,{item:l,selected:(c==null?void 0:c.id)===l.id,onItemClick:()=>p(l),onServiceDetailClick:()=>j(l)},l.id)),!t&&!r&&a.length===0&&e.jsx(w,{colSpan:F,children:"No services found"})]}),!!d&&e.jsx(h,{distribution:"end",className:"mt-4",children:e.jsx(B,{variant:"number",currentPage:u,onPressNext:o,onPressPrevious:o,pages:d})}),c&&e.jsx(K,{children:e.jsx(ce,{service:c,onClose:C})})]})},oe=s=>{var a;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((a=s==null?void 0:s.values)==null?void 0:a.filter(t=>t!==null))||[]}},ie=s=>v.isEmpty(s)||v.isEmpty(s.ServiceFilterValues)?[]:v.map(v.omit(s.ServiceFilterValues,["__typename"]),oe),ue=()=>{const{data:s,previousData:a,loading:t,error:r}=X();return{serviceFilters:ie(v.isEmpty(s)?a:s),loading:t,error:r}},de=({loading:s,error:a,counts:t})=>e.jsxs(h,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(h,{gap:"1",children:!a&&!s?e.jsx(H,{counts:t}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(h,{alignment:"center",className:"ml-auto",children:s&&e.jsx(f,{size:"small",className:"mr-2"})})]}),me=({filterSettings:s,pageSize:a=20})=>{const t=m.useRef(null),[r,{data:u,loading:d,error:o}]=U({variables:{first:a,orderBy:[{by:W.Severity,direction:J.Desc}]},fetchPolicy:"network-only"}),{services:i,servicesIssuesCount:c,pages:n,pageNumber:p}=Y(u);t.current=n;const C=m.useCallback(j=>{var l,g;if(!v.isNil(j)){const O=(g=(l=t.current)==null?void 0:l.find(y=>(y==null?void 0:y.pageNumber)===j-1))==null?void 0:g.after;r({variables:{filter:D(s),after:O}})}},[s]);return m.useEffect(()=>{r({variables:{filter:D(s)}})},[s]),{loading:d,error:ee(o),services:i||[],servicesIssuesCount:c,currentPage:p,totalNumberOfPages:n.length||0,goToPage:C}},pe=s=>{var t;return{selectedFilters:((t=s==null?void 0:s.support_group)==null?void 0:t.map(r=>({name:"supportGroupCcrn",value:r})))??[],searchTerm:""}},he=({defaultSelectService:s,initialFilters:a})=>{const{serviceFilters:t}=ue(),{addMessage:r,resetMessages:u}=T(),[d,o]=m.useState(pe(a)),{loading:i,error:c,services:n,servicesIssuesCount:p,currentPage:C,totalNumberOfPages:j,goToPage:l}=me({filterSettings:d});return m.useEffect(()=>{c?r({variant:"error",text:c}):u()},[c]),e.jsxs(e.Fragment,{children:[e.jsx(te,{filters:t,filterSettings:d,onFilterChange:o,searchInputPlaceholder:"search term for services name"}),e.jsx(de,{counts:p,loading:i,error:c}),e.jsx(le,{defaultSelectService:s,services:n,loading:i,error:c,currentPage:C,totalNumberOfPages:j,goToPage:l})]})},ge=function(){const a=q("/services/"),{appProps:t}=a.useRouteContext(),{service:r}=a.useSearch();return e.jsx(he,{defaultSelectService:r,initialFilters:t.initialFilters})};export{ge as component};
