import{j as e,C as m,v as c,K as d,f as h,g as j,u as g,a as w,l as S,h as p,x as f,b as E,c as N,z as t,S as F}from"./App-CyrgeCVV.js";import{a as o}from"./index-BdmSjOCs.js";import{u as D,g as b,E as u,a as V,C as R}from"./CursorPagination-BTElDoex.js";import{I}from"./IssueTimestamp-DrOKly_G.js";import{F as L}from"./index-Du8TUHmJ.js";const P=s=>`
    border-l-2
    ${b(s||"none")}
    h-full
    pl-5
  `,k=s=>{const r=(s||"none").toLowerCase(),n=b(s||"none"),i={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(h,{icon:i[r]||"help",color:n})},T=({vulnerability:s})=>{const[r,n]=o.useState(!1),{needsExpansion:i,textRef:a}=D(s.description),l=x=>{x.preventDefault(),n(!r)};return e.jsxs(m,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:P(s.severity),children:k(s.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(h,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(I,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:a,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&i&&e.jsx("a",{href:"#",onClick:l,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(h,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},y=({vulnerabilitiesPromise:s})=>{const{error:r,data:n}=o.use(s),{vulnerabilities:i}=j(n);return r?e.jsxs(u,{colSpan:5,children:["Error loading vulnerabilities: ",r.message]}):i.length===0?e.jsx(u,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):i.map(a=>e.jsx(T,{vulnerability:a},a.name))},z=()=>{const{queryClient:s,apiClient:r}=V({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:i}=g({from:"/vulnerabilities/"}),[a,l]=o.useState(n),x=o.useCallback(v=>{const C=w({queryClient:s,apiClient:r,filterSettings:i,after:v});l(C)},[l,s,r,i]);return o.useEffect(()=>{l(n)},[l,n]),e.jsxs(e.Fragment,{children:[e.jsxs(S,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(h,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Services"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),e.jsx(o.Suspense,{fallback:e.jsx(u,{colSpan:5,children:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(f,{variant:"primary"})]})}),children:e.jsx(y,{vulnerabilitiesPromise:a})})]}),e.jsx(o.Suspense,{children:e.jsx(R,{dataPromise:a,goToPage:x,dataNormalizationMethod:j})})]})},U=()=>{const s=E(),{filters:r,filterSettings:n}=g({from:"/vulnerabilities/"}),i=o.useCallback(a=>{s({to:"/vulnerabilities",search:{...N(a)}})},[n,s]);return e.jsx(L,{filters:r,filterSettings:n,onFilterChange:i,searchInputPlaceholder:"search term for vulnerabilities name"})},M=()=>e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(f,{size:"small"})}),children:e.jsx(z,{})})]});t.object({vulnerability:t.string().optional(),searchTerm:t.preprocess(s=>typeof s=="number"?s.toString():s,t.string().optional())}).catchall(t.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(F)))return s},t.union([t.string(),t.array(t.string()),t.undefined()])));const G=M;export{G as component};
