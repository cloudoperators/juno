import{j as e,_ as b,a0 as p,a as v,c as t,V as x,d as w,Y as f,E as h,a1 as D,H as V,r as d,Q as j,a2 as C,a3 as E,a4 as k}from"./App-BXIIioxD.js";import{a as m}from"./index-DacWRTPT.js";import{S as u,E as y,g as R,L as z,C as F}from"./IssueCountsPerSeverityLevel-CjHTbWyQ.js";const O=({children:s})=>e.jsx(b,{className:"my-6",children:s}),B=({imageVersionsPromise:s})=>{const{data:r}=m.use(s),{totalImageVersions:n}=p(r);return n},L=({version:s,selected:r=!1,displayDetailsButton:n=!0,onItemClick:a,onDetailClick:i})=>e.jsxs(v,{onClick:a,className:`cursor-pointer ${r?"active":""}`,children:[e.jsx(t,{className:"service-image-versions-cell",children:e.jsxs(x,{gap:"1",direction:"vertical",children:[e.jsxs(x,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(x,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:c=>c.stopPropagation(),children:e.jsxs(x,{gap:"1.5",alignment:"center",children:[e.jsx(w,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(t,{className:"service-image-versions-cell",children:s.tag}),e.jsx(t,{className:"items-center",children:e.jsx("span",{children:s.componentInstancesCount||0})}),e.jsx(t,{className:"items-center",children:e.jsx(u,{severity:"critical",count:s.issueCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(t,{className:"items-center",children:e.jsx(u,{severity:"high",count:s.issueCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(t,{className:"items-center",children:e.jsx(u,{severity:"medium",count:s.issueCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(t,{className:"items-center",children:e.jsx(u,{severity:"low",count:s.issueCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(t,{className:"items-center",children:e.jsx(u,{severity:"unknown",count:s.issueCounts.none,tooltipContent:"None Vulnerabilities"})}),n&&e.jsx(t,{children:e.jsx(f,{size:"small",label:"Show Details",onClick:i})})]}),q=({columnSpan:s,selectedImageVersion:r,displayDetailsButton:n,imageVersionsPromise:a,onDetailsButtonClick:i,onImageVersionItemClick:c})=>{const{error:o,data:I}=m.use(a),{imageVersions:g}=p(I);return o?e.jsx(y,{colSpan:s,children:"Error loading image versions."}):g.length===0?e.jsx(y,{colSpan:s,children:"No image version found"}):g.map(l=>e.jsx(L,{version:l,selected:l.version===r,displayDetailsButton:n,onItemClick:()=>{c?.(l)},onDetailClick:S=>{S.stopPropagation(),i?.(l)}},l.version))},N=9,_=({imageVersionsPromise:s,selectedImageVersion:r,displayActions:n=!1,onImageVersionItemClick:a,onDetailsButtonClick:i,goToPage:c})=>{const o=n?N:N-1;return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:["Image Versions",e.jsx(h,{children:e.jsxs(m.Suspense,{children:["(",e.jsx(B,{imageVersionsPromise:s}),")"]})})]}),n&&e.jsx(D,{children:e.jsx(f,{size:"small",onClick:()=>i?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(V,{columns:o,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(v,{children:[e.jsx(d,{children:"Image Repository"}),e.jsx(d,{children:"Tag"}),e.jsx(d,{children:"Occurrences"}),e.jsx(d,{colSpan:5,children:"Vulnerability Counts"}),n&&e.jsx(d,{})]}),e.jsx(h,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:R({colspan:o}),children:e.jsx(m.Suspense,{fallback:e.jsx(z,{colSpan:o}),children:e.jsx(q,{columnSpan:o,displayDetailsButton:n,imageVersionsPromise:s,selectedImageVersion:r,onDetailsButtonClick:i,onImageVersionItemClick:a})})})]})}),e.jsx(h,{children:e.jsx(m.Suspense,{children:e.jsx(F,{dataNormalizationMethod:p,dataPromise:s,goToPage:c})})})]})},U=({queryClient:s,apiClient:r,service:n,after:a})=>s.ensureQueryData({queryKey:["imageVersions",n,a],queryFn:()=>r.query({query:k,variables:{filter:{serviceCcrn:[n]},filterCi:{serviceCcrn:[n]},filterIc:{serviceCcrn:[n]},orderBy:[{by:E.Severity,direction:j.Desc}],orderByCi:[{by:C.Cluster,direction:j.Asc},{by:C.Namespace,direction:j.Asc}],after:a}})});export{_ as S,O as a,U as f};
