import{j as e,x as y,u as f,e as w,i as I,c as C,l as N,C as v,h as p,f as g,K as x,g as b,a as P,d as q,I as F,v as h,k as V,b as $,z as d,S as B}from"./App-meoENsXA-CGkAqIfx.js";import{w as l}from"./index-BbqBwlr3.js";import{C as k,w as S,P as L,N as D,j as z,R as M}from"./SectionContentHeading-BrahUSTM-Dbi2TzZ6.js";import{B as U}from"./IssueTimestamp-BUuEi6H1-B-FixaKg.js";import{C as O}from"./index-C4D07lRk-DdAzM2IC.js";import"./index-fBCKs0DB.js";const _=i=>`
    border-l-2
    ${z(i||"none")}
    h-full
    pl-5
  `,E=i=>{const r=(i||"none").toLowerCase(),n=z(i||"none"),s={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(g,{icon:s[r]||"help",color:n})},K=({vulnerability:i,selected:r,onItemClick:n})=>{const[s,t]=l.useState(!1),{needsExpansion:a,textRef:o}=D(i.description),c=u=>{u.preventDefault(),u.stopPropagation(),t(!s)};return e.jsxs(v,{className:`cursor-pointer ${r?"active":""}`,onClick:n,children:[e.jsx(h,{className:"pl-0",children:e.jsx("div",{className:_(i.severity),children:E(i.severity)})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsxs(x,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(x,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx("span",{children:i.servicesCount})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx(U,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(h,{children:e.jsxs(x,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&a&&e.jsx("a",{href:"#",onClick:c,className:"link-hover",children:e.jsxs(x,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},R=({vulnerabilitiesPromise:i})=>{const r=f(),{vulnerability:n}=P({from:"/vulnerabilities/"}),{error:s,data:t}=l.use(i),{vulnerabilities:a}=b(t),o=l.useCallback(c=>{r({to:"/vulnerabilities",search:u=>({...u,vulnerability:c.name})})},[r]);return s?e.jsxs(S,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):a.length===0?e.jsx(S,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):a.map(c=>e.jsx(K,{vulnerability:c,selected:c.name===n,onItemClick:()=>o(c)},c.name))},W=({vulnerabilitiesPromise:i,vulnerabilityName:r,onServiceClick:n})=>{const s=f(),t=m=>{n?n(m):s({to:"/services/$service",params:{service:m}})},{data:a}=l.use(i),{vulnerabilities:o}=b(a),c=o.find(m=>m.name===r);if(!c)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",r]});const u=c.services||[];return(c.servicesCount||0)===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx(e.Fragment,{children:u.map((m,j)=>e.jsx(v,{className:"cursor-pointer",onClick:()=>t(m.ccrn),children:e.jsx(h,{className:"whitespace-nowrap",children:m.ccrn})},j))})},A=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:n}=l.use(i),{vulnerabilities:s}=b(n),t=s.find(o=>o.name===r),{servicesCount:a}=t||{servicesCount:0};return a},G=({vulnerabilityName:i,vulnerabilitiesPromise:r,onServiceClick:n,goToPage:s})=>e.jsxs(l.Suspense,{children:[e.jsxs(M,{children:["Services",e.jsxs(l.Suspense,{children:["(",e.jsx(A,{vulnerabilitiesPromise:r,vulnerabilityName:i}),")"]})]}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(N,{columns:1,children:[e.jsx(v,{children:e.jsx(p,{children:"Service"})}),e.jsx(l.Suspense,{fallback:e.jsx(v,{children:e.jsx(h,{colSpan:1,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(y,{variant:"primary"})]})})}),children:e.jsx(W,{vulnerabilitiesPromise:r,vulnerabilityName:i,onServiceClick:n})})]})}),e.jsx(l.Suspense,{children:e.jsx(L,{dataNormalizationMethod:$,dataPromise:r,goToPage:s})})]}),H=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:n}=l.use(i),{vulnerabilities:s}=b(n),t=s.find(a=>a.name===r);return t?e.jsx(N,{columns:2,gridColumnTemplate:"10% auto",className:"mb-6",children:e.jsxs(v,{children:[e.jsx(p,{children:"Support Groups"}),e.jsx(h,{children:e.jsx(x,{gap:"1",direction:"horizontal",wrap:!0,children:t.supportGroups?.map(a=>e.jsx(V,{pillKey:"support_group",pillKeyLabel:"support_group",pillValue:a,pillValueLabel:a},a))})})]})}):null},J=()=>{const i=f(),{queryClient:r,apiClient:n}=k({from:"/vulnerabilities/"}),{vulnerability:s}=P({from:"/vulnerabilities/"}),[t,a]=l.useState(void 0),o=l.useMemo(()=>{if(s)return C({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:s}]}})},[s,r,n]),c=l.useMemo(()=>{if(s)return C({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:s}]},afterServices:t})},[s,t,r,n]),u=l.useCallback(()=>{i({to:"/vulnerabilities",search:j=>{const{vulnerability:Z,...T}=j;return{...T}}})},[i]),m=l.useCallback(j=>{i({to:"/services/$service",params:{service:j}})},[i]);return e.jsx(q,{heading:s?`${s} Overview`:void 0,opened:!!s,onClose:u,size:"large",children:e.jsxs(F,{children:[s&&o&&e.jsx(l.Suspense,{children:e.jsx(H,{vulnerabilitiesPromise:o,vulnerabilityName:s})}),s&&c&&e.jsx(G,{vulnerabilityName:s,vulnerabilitiesPromise:c,onServiceClick:m,goToPage:a})]})})},X=()=>{const{queryClient:i,apiClient:r}=k({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:s}=w({from:"/vulnerabilities/"}),[t,a]=l.useState(n),o=l.useCallback(c=>{const u=C({queryClient:i,apiClient:r,filterSettings:s,after:c});a(u)},[a,i,r,s]);return l.useEffect(()=>{a(n)},[a,n]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(N,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(v,{children:[e.jsx(p,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Services"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),e.jsx(l.Suspense,{fallback:e.jsx(S,{colSpan:5,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(y,{variant:"primary"})]})}),children:e.jsx(R,{vulnerabilitiesPromise:t})})]}),e.jsx(l.Suspense,{children:e.jsx(L,{dataPromise:t,goToPage:o,dataNormalizationMethod:b})}),e.jsx(J,{})]})},Q=()=>{const i=f(),{filters:r,filterSettings:n}=w({from:"/vulnerabilities/"}),s=l.useCallback(t=>{i({to:"/vulnerabilities",search:{...I(t)}})},[n,i]);return e.jsx(O,{filters:r,filterSettings:n,onFilterChange:s,searchInputPlaceholder:"search term for vulnerabilities name"})},Y=()=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(y,{size:"small"})}),children:e.jsx(X,{})})]});d.object({vulnerability:d.string().optional(),searchTerm:d.preprocess(i=>typeof i=="number"?i.toString():i,d.string().optional())}).catchall(d.preprocess((i,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(B)))return i},d.union([d.string(),d.array(d.string()),d.undefined()])));const ae=Y;export{ae as component};
