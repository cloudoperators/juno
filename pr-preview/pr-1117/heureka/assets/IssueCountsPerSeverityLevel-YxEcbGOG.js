import{N as p,j as e,Z as y,y as S,T as D,A as b,C as f,v as a,K as l,f as E,R as I,U as O,l as R,h as x,x as Z,B as m,V as C,X as k,Y as L}from"./App-DWNuNdG8.js";import{a as c}from"./index-DPGwh1AC.js";import{E as j,S as V,C as z}from"./SectionContentHeading-D9f3J9ON.js";const B=({imageVersionsPromise:s})=>{const{data:r}=c.use(s),{totalImageVersions:n}=p(r);return n},i=({icon:s,count:r,variant:n,tooltipContent:t,showDashIfZero:o=!1})=>o&&r===0?e.jsx("span",{children:"â€”"}):e.jsxs(y,{triggerEvent:"hover",children:[e.jsx(S,{children:e.jsx(D,{icon:s,text:r>0?r.toString():"0",variant:r>0?n:"default"})}),e.jsx(b,{children:t})]}),F=({version:s,selected:r=!1,displayDetailsButton:n=!0,onItemClick:t,onDetailClick:o})=>e.jsxs(f,{onClick:t,className:`cursor-pointer ${r?"active":""}`,children:[e.jsx(a,{className:"service-image-versions-cell",children:e.jsxs(l,{gap:"1",direction:"vertical",children:[e.jsxs(l,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(l,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:d=>d.stopPropagation(),children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(E,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(a,{className:"service-image-versions-cell",children:s.tag}),e.jsx(a,{className:"items-center",children:e.jsx("span",{children:s.componentInstancesCount||0})}),e.jsx(a,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(a,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(a,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(a,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(a,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),n&&e.jsx(a,{children:e.jsx(I,{size:"small",label:"Show Details",onClick:o})})]}),T=({columnSpan:s,selectedImageVersion:r,displayDetailsButton:n,imageVersionsPromise:t,onDetailsButtonClick:o,onImageVersionItemClick:d})=>{const{error:u,data:N}=c.use(t),{imageVersions:g}=p(N);return u?e.jsx(j,{colSpan:s,children:"Error loading image versions."}):g.length===0?e.jsx(j,{colSpan:s,children:"No image version found"}):g.map(h=>e.jsx(F,{version:h,selected:h.version===r,displayDetailsButton:n,onItemClick:()=>{d?.(h)},onDetailClick:w=>{w.stopPropagation(),o?.(h)}},h.version))},v=9,H=({imageVersionsPromise:s,selectedImageVersion:r,displayActions:n=!1,onImageVersionItemClick:t,onDetailsButtonClick:o,goToPage:d})=>{const u=n?v:v-1;return e.jsxs(c.Suspense,{children:[e.jsxs(V,{children:["Image Versions",e.jsxs(c.Suspense,{children:["(",e.jsx(B,{imageVersionsPromise:s}),")"]})]}),n&&e.jsx(O,{children:e.jsx(I,{size:"small",onClick:()=>o?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(R,{columns:u,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(f,{children:[e.jsx(x,{children:"Image Repository"}),e.jsx(x,{children:"Tag"}),e.jsx(x,{children:"Occurrences"}),e.jsx(x,{colSpan:5,children:"Issue Counts"}),n&&e.jsx(x,{})]}),e.jsx(c.Suspense,{fallback:e.jsx(j,{colSpan:u,children:e.jsxs(l,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(Z,{variant:"primary"})]})}),children:e.jsx(T,{columnSpan:u,displayDetailsButton:n,imageVersionsPromise:s,selectedImageVersion:r,onDetailsButtonClick:o,onImageVersionItemClick:t})})]})}),e.jsx(c.Suspense,{children:e.jsx(z,{dataNormalizationMethod:p,dataPromise:s,goToPage:d})})]})},K=({queryClient:s,apiClient:r,service:n,after:t})=>s.ensureQueryData({queryKey:["imageVersions",n,t],queryFn:()=>r.query({query:L,variables:{filter:{serviceCcrn:[n]},filterCi:{serviceCcrn:[n]},filterIc:{serviceCcrn:[n]},orderBy:[{by:k.Severity,direction:m.Desc}],orderByCi:[{by:C.Cluster,direction:m.Asc},{by:C.Namespace,direction:m.Asc}],after:t}})}),P=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(l,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(i,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(i,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(i,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(i,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(i,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{P as I,H as S,i as a,K as f};
