import{j as e,C as j,v as h,K as x,f as g,u as b,a as V,g as v,l as C,h as m,x as y,b as L,k as I,c as f,d as R,I as T,e as k,i as z,z as p,S as M}from"./App-DWNuNdG8.js";import{a as t}from"./index-DPGwh1AC.js";import{u as _,g as P,E as S,S as $,C as D,a as E}from"./SectionContentHeading-D9f3J9ON.js";import{I as G}from"./IssueTimestamp-CMWqEbIM.js";import{F as K}from"./index-BCp8C5tB.js";const U=s=>`
    border-l-2
    ${P(s||"none")}
    h-full
    pl-5
  `,O=s=>{const r=(s||"none").toLowerCase(),n=P(s||"none"),i={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(g,{icon:i[r]||"help",color:n})},q=({vulnerability:s,selected:r,onItemClick:n})=>{const[i,l]=t.useState(!1),{needsExpansion:a,textRef:c}=_(s.description),o=d=>{d.preventDefault(),d.stopPropagation(),l(!i)};return e.jsxs(j,{className:`cursor-pointer ${r?"active":""}`,onClick:n,children:[e.jsx(h,{className:"pl-0",children:e.jsx("div",{className:U(s.severity),children:O(s.severity)})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsxs(x,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(x,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx(G,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(h,{children:e.jsxs(x,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:c,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&a&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(x,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},H=({vulnerabilitiesPromise:s})=>{const r=b(),{vulnerability:n}=V({from:"/vulnerabilities/"}),{error:i,data:l}=t.use(s),{vulnerabilities:a}=v(l),c=t.useCallback(o=>{r({to:"/vulnerabilities",search:d=>({...d,vulnerability:o.name})})},[r]);return i?e.jsxs(S,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):a.length===0?e.jsx(S,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):a.map(o=>e.jsx(q,{vulnerability:o,selected:o.name===n,onItemClick:()=>c(o)},o.name))},A=({vulnerabilitiesPromise:s,vulnerabilityName:r,onServiceClick:n})=>{const i=b(),l=u=>{n?n(u):i({to:"/services/$service",params:{service:u}})},{data:a}=t.use(s),{vulnerabilities:c}=v(a),o=c.find(u=>u.name===r);if(!o)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",r]});const d=o.services||[];return(o.servicesCount||0)===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx(e.Fragment,{children:d.map((u,N)=>e.jsx(j,{className:"cursor-pointer",onClick:()=>l(u.ccrn),children:e.jsx(h,{className:"whitespace-nowrap",children:u.ccrn})},N))})},W=({vulnerabilitiesPromise:s,vulnerabilityName:r})=>{const{data:n}=t.use(s),{vulnerabilities:i}=v(n),l=i.find(c=>c.name===r),{servicesCount:a}=l||{servicesCount:0};return a},X=({vulnerabilityName:s,vulnerabilitiesPromise:r,onServiceClick:n,goToPage:i})=>e.jsxs(t.Suspense,{children:[e.jsxs($,{children:["Services",e.jsxs(t.Suspense,{children:["(",e.jsx(W,{vulnerabilitiesPromise:r,vulnerabilityName:s}),")"]})]}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(C,{columns:1,children:[e.jsx(j,{children:e.jsx(m,{children:"Service"})}),e.jsx(t.Suspense,{fallback:e.jsx(j,{children:e.jsx(h,{colSpan:1,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(y,{variant:"primary"})]})})}),children:e.jsx(A,{vulnerabilitiesPromise:r,vulnerabilityName:s,onServiceClick:n})})]})}),e.jsx(t.Suspense,{children:e.jsx(D,{dataNormalizationMethod:L,dataPromise:r,goToPage:i})})]}),B=({vulnerabilitiesPromise:s,vulnerabilityName:r})=>{const{data:n}=t.use(s),{vulnerabilities:i}=v(n),l=i.find(a=>a.name===r);return l?e.jsx(C,{columns:2,gridColumnTemplate:"10% auto",className:"mb-6",children:e.jsxs(j,{children:[e.jsx(m,{children:"Support Groups"}),e.jsx(h,{children:e.jsx(x,{gap:"1",direction:"horizontal",wrap:!0,children:l.supportGroups?.map(a=>e.jsx(I,{pillKey:"support_group",pillKeyLabel:"support_group",pillValue:a,pillValueLabel:a},a))})})]})}):null},J=()=>{const s=b(),{queryClient:r,apiClient:n}=E({from:"/vulnerabilities/"}),{vulnerability:i}=V({from:"/vulnerabilities/"}),[l,a]=t.useState(void 0),c=t.useMemo(()=>{if(i)return f({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:i}]}})},[i,r,n]),o=t.useMemo(()=>{if(i)return f({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:i}]},afterServices:l})},[i,l,r,n]),d=t.useCallback(()=>{s({to:"/vulnerabilities",search:u=>{const{vulnerability:N,...F}=u;return{...F}}})},[s]),w=t.useCallback(u=>{s({to:"/services/$service",params:{service:u}})},[s]);return e.jsx(R,{heading:i?`${i} Overview`:void 0,opened:!!i,onClose:d,size:"large",children:e.jsxs(T,{children:[i&&c&&e.jsx(t.Suspense,{children:e.jsx(B,{vulnerabilitiesPromise:c,vulnerabilityName:i})}),i&&o&&e.jsx(X,{vulnerabilityName:i,vulnerabilitiesPromise:o,onServiceClick:w,goToPage:a})]})})},Q=()=>{const{queryClient:s,apiClient:r}=E({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:i}=k({from:"/vulnerabilities/"}),[l,a]=t.useState(n),c=t.useCallback(o=>{const d=f({queryClient:s,apiClient:r,filterSettings:i,after:o});a(d)},[a,s,r,i]);return t.useEffect(()=>{a(n)},[a,n]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(C,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(j,{children:[e.jsx(m,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(m,{children:"Vulnerability"}),e.jsx(m,{children:"Services"}),e.jsx(m,{children:"Target Date"}),e.jsx(m,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(S,{colSpan:5,children:e.jsxs(x,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(y,{variant:"primary"})]})}),children:e.jsx(H,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(D,{dataPromise:l,goToPage:c,dataNormalizationMethod:v})}),e.jsx(J,{})]})},Y=()=>{const s=b(),{filters:r,filterSettings:n}=k({from:"/vulnerabilities/"}),i=t.useCallback(l=>{s({to:"/vulnerabilities",search:{...z(l)}})},[n,s]);return e.jsx(K,{filters:r,filterSettings:n,onFilterChange:i,searchInputPlaceholder:"search term for vulnerabilities name"})},Z=()=>e.jsxs(e.Fragment,{children:[e.jsx(Y,{}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(y,{size:"small"})}),children:e.jsx(Q,{})})]});p.object({vulnerability:p.string().optional(),searchTerm:p.preprocess(s=>typeof s=="number"?s.toString():s,p.string().optional())}).catchall(p.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(M)))return s},p.union([p.string(),p.array(p.string()),p.undefined()])));const te=Z;export{te as component};
