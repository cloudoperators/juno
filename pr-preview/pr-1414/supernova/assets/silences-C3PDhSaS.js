import{j as e,o as d,c as i,z as b,V as x,b as T,a as m,u as V,d as A,e as F,f as D,g as N,w as P,J as _,m as E,R as z,K as S,h as B,P as J,n as u,i as k,k as G}from"./App-D4RXgEIc.js";import{r as h}from"./index-BZfmQ-vB.js";import{E as K,R as O,u as M,C as W,F as Z,p as $}from"./FirefoxCorsWarning-DEf4NCnH.js";import"./index-DYGp3ZZY.js";const v=({timestamp:s})=>{const a=r=>new Date(r).toLocaleString("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Europe/Berlin",timeZoneName:"short"});return e.jsx("div",{children:a(s)})},Q=s=>s.length>40?s.substring(0,40)+"...":s,U=({silence:s},a)=>e.jsxs(d,{children:[e.jsxs(i,{className:"whitespace-nowrap",children:[e.jsx(v,{timestamp:s?.startsAt}),e.jsx(v,{timestamp:s?.endsAt})]}),e.jsxs(i,{className:"overflow-hidden",children:[e.jsx("div",{ref:a,children:s?.comment}),e.jsxs("div",{className:"text-theme-light",children:["Silence ",s.id," created by ",s?.createdBy]}),e.jsx(b,{className:"py-2 px-0",children:e.jsx(x,{gap:"2",alignment:"start",wrap:!0,children:s?.matchers?.map((r,c)=>e.jsx(T,{pillKey:r.name,pillValue:Q(r.value)},c))})})]}),e.jsx(i,{className:"overflow-hidden",children:e.jsx("p",{children:s?.status?.state})}),e.jsx(i,{className:"overflow-hidden",children:s?.status?.state===m.SILENCE_ACTIVE||s?.status?.state===m.SILENCE_PENDING?e.jsx(K,{silence:s}):e.jsx(O,{silence:s})})]}),X=h.forwardRef(U),q=`
bg-theme-background-lvl-1
py-2
px-4
my-px
`,H=()=>{const s=V(),a=A(),[r,c]=h.useState(a),j=F(),l=D(),{setSilences:w}=N(),{addMessage:f,resetMessages:C}=P(),{data:g,isLoading:y,error:p}=M("silences");p&&(C(),p instanceof W&&f({variant:"warning",text:e.jsx(Z,{})}),f({variant:"error",text:$(p)})),h.useEffect(()=>{g&&w({items:g.silences})},[g]),h.useEffect(()=>{let t=a.filter(n=>n?.status?.state===j);try{l&&(t=t.filter(n=>JSON.stringify(n).match(new RegExp(l,"i"))))}catch(n){console.warn("search term is not a valid regex. "+n),t=t.filter(o=>JSON.stringify(o).toLowerCase().includes(l.toLowerCase))}c(t)},[j,l,a]);const R=t=>{const n=setTimeout(()=>{s({to:"/silences",search:o=>({...o,silencesRegEx:t.target.value})})},500);return()=>clearTimeout(n)},{scrollListItems:I,iterator:L}=_(r,{loadingObject:e.jsx(d,{children:e.jsx(i,{colSpan:3,children:e.jsxs(x,{gap:"3",alignment:"center",direction:"horizontal",children:["Loading...",e.jsx(E,{})]})})}),refFunction:t=>e.jsx(d,{children:e.jsx(i,{colSpan:3,className:"border-b-0 py-0",children:e.jsx("span",{ref:t})})})});return e.jsx(e.Fragment,{children:y?e.jsxs(x,{gap:"2",children:[e.jsx("span",{children:"Loading"}),e.jsx(E,{variant:"primary"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{direction:"horizontal",className:`${q}`,children:[e.jsxs(z,{className:"w-3/12",label:"Status",value:j,onChange:t=>{s({to:"/silences",search:n=>({...n,silencesStatus:t})})},children:[e.jsx(S,{value:m.SILENCE_ACTIVE}),e.jsx(S,{value:m.SILENCE_PENDING}),e.jsx(S,{value:m.SILENCE_EXPIRED})]}),e.jsx(B,{placeholder:"search term or regular expression",className:"ml-auto w-7/12",value:l||"",onChange:t=>{R(t)},onSearch:t=>{s({to:"/silences",search:n=>({...n,silencesRegEx:t})})},onClear:()=>{s({to:"/silences",search:t=>{const{silencesRegEx:n,...o}=t;return{...o}}})}})]}),e.jsx(J,{columns:4,minContentColumns:[0,2,3],cellVerticalAlignment:"top",className:"silences ",children:e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx(u,{children:"Time intervall"}),e.jsx(u,{children:"Details"}),e.jsx(u,{children:"State"}),e.jsx(u,{children:"Action"})]}),I?.length?L.map(t=>e.jsx(X,{silence:t},t.id)):e.jsx(d,{children:e.jsx(i,{colSpan:4,children:e.jsxs(x,{gap:"3",children:[e.jsx(k,{icon:"info",color:"text-theme-info"}),e.jsx("div",{children:"We couldn't find any matching silences."})]})})})]})})]})})};function ne(){const{appStateFromUrl:{silencesRegEx:s,silencesStatus:a}}=G.useRouteContext(),{setSilencesRegEx:r,setSilencesStatus:c}=N();return h.useLayoutEffect(()=>{r(s),c(a)},[s,a]),e.jsx(H,{})}export{ne as component};
