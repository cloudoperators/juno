import{j as e,M as R,P as g,r as N,c as l,V as h,d as S,Y as v,E as j,Q as I,X as D,o as p,R as b}from"./App-DauI7pcM.js";import{a as d}from"./index-Dv3En_MY.js";import{S as m,E as C,g as k,L as E,C as f}from"./IssueCountsPerSeverityLevel-BCP6gyOd.js";const U=({children:s})=>e.jsx(R,{className:"my-6",children:s}),L=({imagesPromise:s})=>{const{data:a}=d.use(s),{totalImages:t}=g(a);return t},z=({version:s,selected:a=!1,displayDetailsButton:t=!0,onItemClick:i,onDetailClick:o})=>e.jsxs(N,{onClick:i,className:`cursor-pointer ${a?"active":""}`,children:[e.jsx(l,{className:"service-image-versions-cell",children:e.jsxs(h,{gap:"1",direction:"vertical",children:[e.jsxs(h,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),s.versionsCount!==void 0&&s.versionsCount>0&&e.jsxs("span",{className:"text-sm text-theme-light",children:[s.versionsCount," version",s.versionsCount!==1?"s":""]})]}),e.jsx(h,{gap:"1",alignment:"center",children:s.imageRegistryUrl&&e.jsx("a",{href:s.imageRegistryUrl.startsWith("http://")||s.imageRegistryUrl.startsWith("https://")?s.imageRegistryUrl:`https://${s.imageRegistryUrl}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:n=>n.stopPropagation(),children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(S,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(l,{className:"service-image-versions-cell",children:s.versionsCount!==void 0?`${s.versionsCount} version${s.versionsCount!==1?"s":""}`:"-"}),e.jsx(l,{className:"items-center !px-2",children:e.jsx(m,{severity:"critical",count:s.issueCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(l,{className:"items-center !px-2",children:e.jsx(m,{severity:"high",count:s.issueCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(l,{className:"items-center !px-2",children:e.jsx(m,{severity:"medium",count:s.issueCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(l,{className:"items-center !px-2",children:e.jsx(m,{severity:"low",count:s.issueCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(l,{className:"items-center !px-2",children:e.jsx(m,{severity:"unknown",count:s.issueCounts.none,tooltipContent:"None Vulnerabilities"})}),t&&e.jsx(l,{className:"cursor-default",onClick:n=>n.stopPropagation(),children:e.jsx(v,{size:"small",label:"Show Details",onClick:o,className:"whitespace-nowrap"})})]}),M=({columnSpan:s,selectedImage:a,displayDetailsButton:t,imagesPromise:i,onDetailsButtonClick:o,onImageItemClick:n})=>{const{error:r,data:x}=d.use(i),{images:c}=g(x);return r?e.jsx(C,{colSpan:s,children:"Error loading images."}):c.length===0?e.jsx(C,{colSpan:s,children:"No image found"}):c.map(u=>e.jsx(z,{version:u,selected:u.repository===a,displayDetailsButton:t,onItemClick:()=>{n?.(u)},onDetailClick:w=>{w.stopPropagation(),o?.(u)}},u.repository))},y=8,$=({imagesPromise:s,selectedImage:a,displayActions:t=!1,onImageItemClick:i,onDetailsButtonClick:o,goToPage:n})=>{const r=t?y:y-1;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:["Images"," ",e.jsx(j,{children:e.jsxs(d.Suspense,{children:["(",e.jsx(L,{imagesPromise:s}),")"]})})]}),t&&e.jsx(I,{children:e.jsx(v,{size:"small",onClick:()=>o?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(D,{columns:r,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(N,{children:[e.jsx(p,{children:"Image Repository"}),e.jsx(p,{children:"Versions"}),e.jsx(p,{colSpan:5,children:"Vulnerability Counts"}),t&&e.jsx(p,{})]}),e.jsx(j,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:k({colspan:r}),children:e.jsx(d.Suspense,{fallback:e.jsx(E,{colSpan:r}),children:e.jsx(M,{columnSpan:r,displayDetailsButton:t,imagesPromise:s,selectedImage:a,onDetailsButtonClick:o,onImageItemClick:i})})})]})}),e.jsx(j,{children:e.jsx(d.Suspense,{children:e.jsx(f,{dataNormalizationMethod:g,dataPromise:s,goToPage:n})})})]})},H=({queryClient:s,apiClient:a,filter:t,after:i,first:o=10,firstVulnerabilities:n,afterVulnerabilities:r,firstVersions:x,afterVersions:c})=>s.ensureQueryData({queryKey:["images",t,i,n,r,x,c],queryFn:()=>a.query({query:b,variables:{filter:t,first:o,after:i,firstVulnerabilities:n,afterVulnerabilities:r,firstVersions:x,afterVersions:c}})});export{$ as S,U as a,H as f};
