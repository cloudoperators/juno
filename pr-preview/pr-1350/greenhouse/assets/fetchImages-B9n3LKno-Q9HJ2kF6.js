import{R as V,j as e,E as h,Q as k,Y as v,X as b,r as f,o as x,P as j,M as I,c as o,V as g,d as D}from"./App-Cn3phfZU-BdE6eHxY.js";import{G as u}from"./_extensionId._-DIB4E47L.js";import{L as P,S,R as w,d as C,i as d}from"./IssueCountsPerSeverityLevel-CJXpYsmh-QHLnmXjx.js";const R=({children:s})=>e.jsx(I,{className:"my-6",children:s}),B=({imagesPromise:s})=>{const{data:r}=u.use(s),{totalImages:i}=j(r);return i},$=({version:s,selected:r=!1,displayDetailsButton:i=!0,onItemClick:a,onDetailClick:l})=>e.jsxs(f,{onClick:a,className:`cursor-pointer ${r?"active":""}`,children:[e.jsx(o,{className:"service-image-versions-cell",children:e.jsxs(g,{gap:"1",direction:"vertical",children:[e.jsxs(g,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),s.versionsCount!==void 0&&s.versionsCount>0&&e.jsxs("span",{className:"text-sm text-theme-light",children:[s.versionsCount," version",s.versionsCount!==1?"s":""]})]}),e.jsx(g,{gap:"1",alignment:"center",children:s.imageRegistryUrl&&e.jsx("a",{href:s.imageRegistryUrl.startsWith("http://")||s.imageRegistryUrl.startsWith("https://")?s.imageRegistryUrl:`https://${s.imageRegistryUrl}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:t=>t.stopPropagation(),children:e.jsxs(g,{gap:"1.5",alignment:"center",children:[e.jsx(D,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(o,{className:"service-image-versions-cell",children:s.versionsCount!==void 0?`${s.versionsCount} version${s.versionsCount!==1?"s":""}`:"-"}),e.jsx(o,{className:"items-center !px-2",children:e.jsx(d,{severity:"critical",count:s.issueCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(o,{className:"items-center !px-2",children:e.jsx(d,{severity:"high",count:s.issueCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(o,{className:"items-center !px-2",children:e.jsx(d,{severity:"medium",count:s.issueCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(o,{className:"items-center !px-2",children:e.jsx(d,{severity:"low",count:s.issueCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(o,{className:"items-center !px-2",children:e.jsx(d,{severity:"unknown",count:s.issueCounts.none,tooltipContent:"None Vulnerabilities"})}),i&&e.jsx(o,{className:"cursor-default",onClick:t=>t.stopPropagation(),children:e.jsx(v,{size:"small",label:"Show Details",onClick:l,className:"whitespace-nowrap"})})]}),q=({columnSpan:s,selectedImage:r,displayDetailsButton:i,imagesPromise:a,onDetailsButtonClick:l,onImageItemClick:t})=>{const{error:n,data:p}=u.use(a),{images:c}=j(p);return n?e.jsx(C,{colSpan:s,children:"Error loading images."}):c.length===0?e.jsx(C,{colSpan:s,children:"No image found"}):c.map(m=>e.jsx($,{version:m,selected:m.repository===r,displayDetailsButton:i,onItemClick:()=>{t?.(m)},onDetailClick:N=>{N.stopPropagation(),l?.(m)}},m.repository))},y=8,E=({imagesPromise:s,selectedImage:r,displayActions:i=!1,onImageItemClick:a,onDetailsButtonClick:l,goToPage:t})=>{const n=i?y:y-1;return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:["Images"," ",e.jsx(h,{children:e.jsxs(u.Suspense,{children:["(",e.jsx(B,{imagesPromise:s}),")"]})})]}),i&&e.jsx(k,{children:e.jsx(v,{size:"small",onClick:()=>l?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(b,{columns:n,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(f,{children:[e.jsx(x,{children:"Image Repository"}),e.jsx(x,{children:"Versions"}),e.jsx(x,{colSpan:5,children:"Vulnerability Counts"}),i&&e.jsx(x,{})]}),e.jsx(h,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:P({colspan:n}),children:e.jsx(u.Suspense,{fallback:e.jsx(S,{colSpan:n}),children:e.jsx(q,{columnSpan:n,displayDetailsButton:i,imagesPromise:s,selectedImage:r,onDetailsButtonClick:l,onImageItemClick:a})})})]})}),e.jsx(h,{children:e.jsx(u.Suspense,{children:e.jsx(w,{dataNormalizationMethod:j,dataPromise:s,goToPage:t})})})]})},K=({queryClient:s,apiClient:r,filter:i,after:a,first:l=10,firstVulnerabilities:t,afterVulnerabilities:n,firstVersions:p,afterVersions:c})=>s.ensureQueryData({queryKey:["images",i,a,t,n,p,c],queryFn:()=>r.query({query:V,variables:{filter:i,first:l,after:a,firstVulnerabilities:t,afterVulnerabilities:n,firstVersions:p,afterVersions:c}})});export{E as $,K as H,R as U};
