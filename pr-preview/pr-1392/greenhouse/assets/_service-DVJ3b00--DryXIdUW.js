import{b as C,p as D,K as V,e as S,j as e,n as v,m as K,z as k,$ as y,i as u,o as p,c as d,V as m,E as g,M as z,k as E,l as I,P as T,J as F,d as f,I as q,u as M,g as w,a as Q}from"./App-BIl2uH6y-DtImtl56.js";import{G as o}from"./_extensionId._-B1_OLbUK.js";import{S as N,M as P,D as $,L as U,V as _,d as b}from"./IssueCountsPerSeverityLevel-BXhpJp1b-D42xP1gq.js";import{F as L,q as G,U as R}from"./fetchImages-QrQBX5Kc-CXX3dnuf.js";import{s as A}from"./IssueTimestamp-DxM4P8Fr-Ga12J2NH.js";import"./index-bt2JxNsL.js";import"./Shell-CoqfXW7T.js";import"./index-BATxWg5G.js";const H=s=>{const i=s.toLowerCase(),r=w(i);return e.jsx(f,{icon:Q[i]||"help",color:r})},O=({severity:s})=>H(s),X=s=>`
    border-l-2
    ${w(s.toLowerCase())}
    h-full
    pl-5
  `,Y=({issue:s})=>{const[i,r]=o.useState(!1),{needsExpansion:a,textRef:n}=M(s.description),t=l=>{l.preventDefault(),r(!i)};return e.jsxs(u,{children:[e.jsx(d,{className:"pl-0",children:e.jsx("div",{className:X(s.severity),children:e.jsx(O,{severity:s.severity})})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(m,{gap:"1.5",alignment:"center",children:[e.jsx(f,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsx(A,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(d,{children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:n,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&a&&e.jsx("a",{href:"#",onClick:t,className:"link-hover",children:e.jsxs(m,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(f,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},Z=({issuesPromise:s})=>{const{error:i,data:r}=o.use(s),{vulnerabilities:a}=q(r);return i?e.jsxs(b,{colSpan:4,children:["Error loading vulnerabilities: ",i.message]}):a.length===0?e.jsx(b,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):a.map(n=>e.jsx(Y,{issue:n},n.id||n.name))},B=({service:s,image:i})=>{const{apiClient:r,queryClient:a}=N({from:"/services/$service"}),[n,t]=o.useState(void 0),[l,x]=o.useState(void 0),j=n?{search:[n]}:void 0,c=L({apiClient:r,queryClient:a,filter:{service:[s],repository:[i.repository]},firstVulnerabilities:20,afterVulnerabilities:l,vulFilter:j});return e.jsxs(e.Fragment,{children:[e.jsxs(m,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(T,{children:"Vulnerabilities"}),e.jsx(F,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:h=>t(h||""),onClear:()=>{t("")}})]}),e.jsxs(y,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(u,{children:[e.jsx(p,{children:e.jsx(f,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),c&&e.jsx(v,{displayErrorMessage:!0,fallbackRender:$({colspan:4}),resetKeys:[c],children:e.jsx(o.Suspense,{fallback:e.jsx(U,{colSpan:4}),children:e.jsx(Z,{issuesPromise:c})})})]}),c&&e.jsx(v,{resetKeys:[c],children:e.jsx(o.Suspense,{children:e.jsx(_,{dataPromise:c,dataNormalizationMethod:q,goToPage:x})})})]})},J=({imagesPromise:s})=>{const i=C(),{service:r}=V({from:"/services/$service"}),{image:a}=S({from:"/services/$service"}),{data:n}=o.use(s),{images:t}=z(n),l=t.find(x=>x.repository===a);return l?e.jsx(E,{heading:`Image ${l.repository} Information`,opened:!!r,onClose:()=>i({to:"/services/$service",params:{service:r}}),size:"large",children:e.jsxs(I,{children:[e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Details"}),e.jsx(d,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(g,{pillKey:"repository",pillKeyLabel:"repository",pillValue:l.repository,pillValueLabel:l.repository}),l.versionsCount!==void 0&&l.versionsCount>0&&e.jsx(g,{pillKey:"versions",pillKeyLabel:"versions",pillValue:l.versionsCount.toString(),pillValueLabel:l.versionsCount.toString()})]})})]}),e.jsxs(u,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(d,{children:e.jsx(P,{counts:l.vulnerabilityCounts})})]})]}),r&&a&&l&&e.jsx(B,{service:r,image:l})]})}):null},W=({servicePromise:s})=>{const{data:i}=o.use(s),r=k(i).services[0];return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:["Service ",r.name]}),e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(u,{children:[e.jsx(p,{children:"Details"}),e.jsx(d,{children:e.jsxs(m,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(g,{pillKey:"service",pillKeyLabel:"service",pillValue:r.name,pillValueLabel:r.name}),r.serviceDetails?.supportGroups?.map(a=>e.jsx(g,{pillKey:"support_group",pillKeyLabel:"support_group",pillValue:a,pillValueLabel:a},a))]})})]}),e.jsxs(u,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(d,{children:e.jsx(P,{counts:r.issuesCount})})]})]})]})},ee=()=>{const s=C(),{queryClient:i,apiClient:r}=N({from:"/services/$service"}),{servicePromise:a}=D({from:"/services/$service"}),{service:n}=V({from:"/services/$service"}),{image:t}=S({from:"/services/$service"}),[l,x]=o.useState(void 0),[j,c]=o.useState(void 0);return o.useEffect(()=>{const h=L({queryClient:i,apiClient:r,filter:{service:[n]},after:l});c(h)},[l,n,i,r]),e.jsxs(e.Fragment,{children:[e.jsx(v,{displayErrorMessage:!0,children:e.jsx(o.Suspense,{fallback:e.jsx(K,{className:"mt-4"}),children:e.jsx(W,{servicePromise:a})})}),j&&e.jsxs(e.Fragment,{children:[e.jsx(G,{selectedImage:t,imagesPromise:j,onImageItemClick:h=>{s({to:"/services/$service",params:{service:n},search:{image:h.repository}})},goToPage:x}),e.jsx(v,{children:e.jsx(o.Suspense,{children:e.jsx(J,{imagesPromise:j})})})]})]})},ce=ee;export{ce as component};
