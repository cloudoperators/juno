import{j as e,Z as v,M as j,o as N,c,V as p,d as S,Y as w,E as g,X as R,P as I,n as h,Q as f}from"./App-BYWSYmHr.js";import{r as d}from"./index-B-sT0Ze4.js";import{S as u,E as C,g as D,L as k,C as E}from"./IssueCountsPerSeverityLevel-CAa_BBHP.js";const U=({children:s})=>e.jsx(v,{className:"my-6",children:s}),z=({imagesPromise:s,className:r})=>{const{data:t}=d.use(s),{totalImages:n}=j(t);return e.jsx("span",{className:r,children:n})},L=({version:s,selected:r=!1,displayDetailsButton:t=!0,onItemClick:n,onDetailClick:l})=>e.jsxs(N,{onClick:n,className:"cursor-pointer",isSelected:r,children:[e.jsx(c,{className:"service-image-versions-cell",children:e.jsxs(p,{gap:"1",direction:"vertical",children:[e.jsxs(p,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),s.versionsCount!==void 0&&s.versionsCount>0&&e.jsxs("span",{className:"text-sm text-theme-light",children:[s.versionsCount," version",s.versionsCount!==1?"s":""]})]}),e.jsx(p,{gap:"1",alignment:"center",children:s.imageRegistryUrl&&e.jsx("a",{href:s.imageRegistryUrl.startsWith("http://")||s.imageRegistryUrl.startsWith("https://")?s.imageRegistryUrl:`https://${s.imageRegistryUrl}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:a=>a.stopPropagation(),"aria-label":`Open image registry for ${s.repository} (opens in a new tab)`,title:`Open image registry for ${s.repository} (opens in a new tab)`,children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(S,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(c,{className:"service-image-versions-cell",children:s.versionsCount!==void 0?`${s.versionsCount} version${s.versionsCount!==1?"s":""}`:"-"}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(u,{severity:"critical",count:s.vulnerabilityCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(u,{severity:"high",count:s.vulnerabilityCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(u,{severity:"medium",count:s.vulnerabilityCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(u,{severity:"low",count:s.vulnerabilityCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(u,{severity:"unknown",count:s.vulnerabilityCounts.none,tooltipContent:"None Vulnerabilities"})}),t&&e.jsx(c,{className:"cursor-default",onClick:a=>a.stopPropagation(),children:e.jsx(w,{size:"small",label:"Show Details",onClick:l,className:"whitespace-nowrap"})})]}),M=({columnSpan:s,selectedImage:r,displayDetailsButton:t,imagesPromise:n,onDetailsButtonClick:l,onImageItemClick:a})=>{const{error:i,data:x}=d.use(n),{images:m}=j(x);return i?e.jsx(C,{colSpan:s,children:"Error loading images."}):m.length===0?e.jsx(C,{colSpan:s,children:"No image found"}):m.map(o=>e.jsx(L,{version:o,selected:o.repository===r,displayDetailsButton:t,onItemClick:()=>{a?.(o)},onDetailClick:b=>{b.stopPropagation(),l?.(o)}},o.repository))},y=8,F=({imagesPromise:s,selectedImage:r,displayActions:t=!1,onImageItemClick:n,onDetailsButtonClick:l,goToPage:a})=>{const i=t?y:y-1;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:["Images",e.jsx(g,{children:e.jsxs(d.Suspense,{children:["(",e.jsx(z,{imagesPromise:s,className:"ml-1"}),")"]})})]}),t&&e.jsx(R,{children:e.jsx(w,{size:"small",onClick:()=>l?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(I,{columns:i,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(N,{children:[e.jsx(h,{children:"Image Repository"}),e.jsx(h,{children:"Versions"}),e.jsx(h,{colSpan:5,children:"Vulnerability Counts"}),t&&e.jsx(h,{})]}),e.jsx(g,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:D({colspan:i}),children:e.jsx(d.Suspense,{fallback:e.jsx(k,{colSpan:i}),children:e.jsx(M,{columnSpan:i,displayDetailsButton:t,imagesPromise:s,selectedImage:r,onDetailsButtonClick:l,onImageItemClick:n})})})]})}),e.jsx(g,{children:e.jsx(d.Suspense,{children:e.jsx(E,{dataNormalizationMethod:j,dataPromise:s,goToPage:a})})})]})},O=({queryClient:s,apiClient:r,filter:t,after:n,first:l=10,firstVulnerabilities:a,afterVulnerabilities:i,firstVersions:x,afterVersions:m,vulFilter:o})=>s.ensureQueryData({queryKey:["images",t,n,a,i,x,m,o],queryFn:()=>r.query({query:f,variables:{imgFilter:t,vulFilter:o,first:l,after:n,firstVulnerabilities:a,afterVulnerabilities:i,firstVersions:x,afterVersions:m}})});export{F as S,U as a,O as f};
