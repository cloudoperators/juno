import{g as O,j as e,q as z,v,Y as D,I as S,a as A,t as L,u as _,d as $,T as V,D as N,L as K,o as Z,p as w,y as F,z as E,A as p,N as B,c as Q,b as G}from"./App-CoPdHd6Y-BLM1jH_L.js";import{w as m}from"./index-jXMxgA6D.js";import{l as J,j as h,d as M,Q as R,J as H,g as Y,v as P,i as q,y as U,x as k,f as C,a as X}from"./IssueCountsPerSeverityLevel-iCGZVPyk-0eeEQpVn.js";import"./index-DFeYv5wi.js";const W=({filters:s,onChange:l})=>{var a;const[r,o]=m.useState(""),[n,c]=m.useState(""),u=(a=s.find(i=>i.filterName===r))==null?void 0:a.values,d=m.useCallback(i=>{!h.isEmpty(r)&&!h.isEmpty(i)&&(l({name:r,value:i}),o(""),c(""))},[r,l]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(D,{children:[e.jsx(w,{className:"filter-label-select w-64 mb-0",name:"filter",label:"Filter",value:r,onChange:o,children:s==null?void 0:s.map(({displayName:i,filterName:g})=>e.jsx(F,{value:g,label:i},g))}),e.jsx(w,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue",value:n,onChange:d,children:u==null?void 0:u.map(i=>e.jsx(F,{value:i},i))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ee=({selectedFilters:s,onDelete:l})=>e.jsx(v,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(E,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>l(a)},`${name}:${a.value}`))}),se=({filters:s,filterSettings:l,onFilterChange:a,searchInputPlaceholder:r})=>{const o=m.useCallback(n=>{var c;a({...l,selectedFilters:(c=l.selectedFilters)==null?void 0:c.filter(u=>!(u.name===n.name&&u.value===n.value))})},[l,a]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(D,{children:[e.jsx(W,{filters:s,onChange:n=>{var c;a({...l,selectedFilters:(c=l==null?void 0:l.selectedFilters)==null?void 0:c.concat(n)})}}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>a({...l,selectedFilters:[]}),variant:"subdued"}),e.jsx(A,{placeholder:r||"search term for",className:"w-96 ml-auto",onSearch:n=>{a({...l,searchTerm:n})},onClear:()=>a({...l,searchTerm:""})})]}),l.selectedFilters&&l.selectedFilters.length>0&&e.jsx(ee,{selectedFilters:l.selectedFilters,onDelete:o})]})},I={supportGroups:"support_group",region:"region",integrity:"integrity"},le=({serviceDetails:s})=>{const l=(a,r)=>e.jsx(E,{pillKey:a,pillKeyLabel:a,pillValue:r,pillValueLabel:r},r);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,r])=>Array.isArray(r)?r.map(o=>l(I[a],o)):l(I[a],r))})},ae=({item:s,selected:l,onItemClick:a,onServiceDetailClick:r})=>e.jsxs(V,{className:`cursor-pointer ${l?"active":""}`,onClick:a,children:[e.jsx(p,{children:s.name}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(p,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(p,{children:e.jsx(le,{serviceDetails:s.serviceDetails})}),e.jsx(p,{className:"cursor-default interactive",onClick:o=>o.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),re=({service:s,onClose:l})=>{const a=_();return e.jsx(B,{heading:`${Q(s.name)} Overview`,opened:!0,onClose:l,size:"large",children:e.jsx(G,{children:e.jsx(X,{service:s,onDetailsButtonClick:r=>a({to:"/services/$service",params:{service:s.name},search:{imageVersion:r==null?void 0:r.version}}),displayActions:!0})})})},b=8,ie=({defaultSelectService:s,services:l,loading:a,error:r,currentPage:o,totalNumberOfPages:n,goToPage:c})=>{const u=_(),[d,i]=m.useState(null),g=m.useCallback(t=>{i(f=>(f==null?void 0:f.id)===t.id?null:t),u({to:"/services",search:{service:t.name}})},[]),j=m.useCallback(()=>{i(null),u({to:"/services"})},[]),x=m.useCallback(t=>{u({to:"/services/$service",params:{service:t.name}})},[]);return m.useEffect(()=>{i(l.find(t=>t.name===s)||null)},[s,l]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:b,children:[e.jsxs(V,{children:[e.jsx(N,{children:"Service"}),e.jsx(N,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(N,{children:"Details"}),e.jsx(N,{})]}),a&&e.jsx(k,{colSpan:b,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),!a&&!r&&l.length>0&&l.map(t=>e.jsx(ae,{item:t,selected:(d==null?void 0:d.id)===t.id,onItemClick:()=>g(t),onServiceDetailClick:()=>x(t)},t.id)),!a&&!r&&l.length===0&&e.jsx(k,{colSpan:b,children:"No services found"})]}),!!n&&e.jsx(v,{distribution:"end",className:"mt-4",children:e.jsx(K,{variant:"number",currentPage:o,onPressNext:c,onPressPrevious:c,pages:n})}),d&&e.jsx(Z,{children:e.jsx(re,{service:d,onClose:j})})]})},te=s=>{var l;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((l=s==null?void 0:s.values)==null?void 0:l.filter(a=>a!==null))||[]}},ne=s=>h.isEmpty(s)||h.isEmpty(s.ServiceFilterValues)?[]:h.map(h.omit(s.ServiceFilterValues,["__typename"]),te),oe=()=>{const{data:s,previousData:l,loading:a,error:r}=J();return{serviceFilters:ne(h.isEmpty(s)?l:s),loading:a,error:r}},ce=({loading:s,error:l,counts:a})=>e.jsxs(v,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(v,{gap:"1",children:!l&&!s?e.jsx(U,{counts:a}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(v,{alignment:"center",className:"ml-auto",children:s&&e.jsx(L,{size:"small",className:"mr-2"})})]}),ue=({filterSettings:s,pageSize:l=20})=>{const a=m.useRef(null),[r,{data:o,loading:n,error:c}]=M({variables:{first:l,orderBy:[{by:H.Severity,direction:R.Desc}]},fetchPolicy:"network-only"}),{services:u,servicesIssuesCount:d,pages:i,pageNumber:g}=Y(o);a.current=i;const j=m.useCallback(x=>{var t,f;if(!h.isNil(x)){const T=(f=(t=a.current)==null?void 0:t.find(y=>(y==null?void 0:y.pageNumber)===x-1))==null?void 0:f.after;r({variables:{filter:P(s),after:T}})}},[s]);return m.useEffect(()=>{r({variables:{filter:P(s)}})},[s]),{loading:n,error:q(c),services:u||[],servicesIssuesCount:d,currentPage:g,totalNumberOfPages:i.length||0,goToPage:j}},de=s=>{var l;return{selectedFilters:((l=s==null?void 0:s.support_group)==null?void 0:l.map(a=>({name:"supportGroupCcrn",value:a})))??[],searchTerm:""}},me=({defaultSelectService:s,initialFilters:l})=>{const{serviceFilters:a}=oe(),{addMessage:r,resetMessages:o}=z(),[n,c]=m.useState(de(l)),{loading:u,error:d,services:i,servicesIssuesCount:g,currentPage:j,totalNumberOfPages:x,goToPage:t}=ue({filterSettings:n});return m.useEffect(()=>{d?r({variant:"error",text:d}):o()},[d]),e.jsxs(e.Fragment,{children:[e.jsx(se,{filters:a,filterSettings:n,onFilterChange:c,searchInputPlaceholder:"search term for services name"}),e.jsx(ce,{counts:g,loading:u,error:d}),e.jsx(ie,{defaultSelectService:s,services:i,loading:u,error:d,currentPage:j,totalNumberOfPages:x,goToPage:t})]})},xe=function(){const s=O("/services/"),{appProps:l}=s.useRouteContext(),{service:a}=s.useSearch();return e.jsx(me,{defaultSelectService:a,initialFilters:l.initialFilters})};export{xe as component};
