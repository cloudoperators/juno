import{n as E,j as e,k as Z,R as v,o as I,b as S,c as $,h as L,u as _,z,l as T,f as b,p as A,i as B,V as w,a as F,m as V,q as h,d as K,e as M,g as Q}from"./App-BwS1iU6P-Dh5XgPq_.js";import{n as m}from"./index-RuzxpGWG.js";import{c as R,j as g,p as G,Q as q,Z as Y,d as H,g as k,r as W,x as J,a as P,f as C,m as U}from"./IssueCountsPerSeverityLevel-ho8GJLfi-CMjaMhmR.js";import"./index-CuX3uObj.js";const X=({filters:s,onChange:l})=>{var a;const[r,o]=m.useState(""),[n,c]=m.useState(""),u=(a=s.find(i=>i.filterName===r))==null?void 0:a.values,d=m.useCallback(i=>{!g.isEmpty(r)&&!g.isEmpty(i)&&(l({name:r,value:i}),o(""),c(""))},[r,l]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(w,{className:"filter-label-select w-64 mb-0",name:"filter",label:"Filter",value:r,onChange:o,children:s==null?void 0:s.map(({displayName:i,filterName:p})=>e.jsx(F,{value:p,label:i},p))}),e.jsx(w,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue",value:n,onChange:d,children:u==null?void 0:u.map(i=>e.jsx(F,{value:i},i))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ee=({selectedFilters:s,onDelete:l})=>e.jsx(v,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(V,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>l(a)},`${name}:${a.value}`))}),se=({filters:s,filterSettings:l,onFilterChange:a,searchInputPlaceholder:r})=>{const o=m.useCallback(n=>{var c;a({...l,selectedFilters:(c=l.selectedFilters)==null?void 0:c.filter(u=>!(u.name===n.name&&u.value===n.value))})},[l,a]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(X,{filters:s,onChange:n=>{var c;a({...l,selectedFilters:(c=l==null?void 0:l.selectedFilters)==null?void 0:c.concat(n)})}}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>a({...l,selectedFilters:[]}),variant:"subdued"}),e.jsx($,{placeholder:r||"search term for",className:"w-96 ml-auto",onSearch:n=>{a({...l,searchTerm:n})},onClear:()=>a({...l,searchTerm:""})})]}),l.selectedFilters&&l.selectedFilters.length>0&&e.jsx(ee,{selectedFilters:l.selectedFilters,onDelete:o})]})},D={supportGroups:"support_group",region:"region",integrity:"integrity"},le=({serviceDetails:s})=>{const l=(a,r)=>e.jsx(V,{pillKey:a,pillKeyLabel:a,pillValue:r,pillValueLabel:r},r);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,r])=>Array.isArray(r)?r.map(o=>l(D[a],o)):l(D[a],r))})},ae=({item:s,selected:l,onItemClick:a,onServiceDetailClick:r})=>e.jsxs(T,{className:`cursor-pointer ${l?"active":""}`,onClick:a,children:[e.jsx(h,{children:s.name}),e.jsx(h,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(C,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(h,{children:e.jsx(le,{serviceDetails:s.serviceDetails})}),e.jsx(h,{className:"cursor-default interactive",onClick:o=>o.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),re=({service:s,onClose:l})=>{const a=_();return e.jsx(K,{heading:`${M(s.name)} Overview`,opened:!0,onClose:l,size:"large",children:e.jsx(Q,{children:e.jsx(U,{service:s,onDetailsButtonClick:r=>a({to:"/services/$service",params:{service:s.name},search:{imageVersion:r==null?void 0:r.version}}),displayActions:!0})})})},N=8,ie=({defaultSelectService:s,services:l,loading:a,error:r,currentPage:o,totalNumberOfPages:n,goToPage:c})=>{const u=_(),[d,i]=m.useState(null),p=m.useCallback(t=>{i(f=>(f==null?void 0:f.id)===t.id?null:t),u({to:"/services",search:{service:t.name}})},[]),j=m.useCallback(()=>{i(null),u({to:"/services"})},[]),x=m.useCallback(t=>{u({to:"/services/$service",params:{service:t.name}})},[]);return m.useEffect(()=>{i(l.find(t=>t.name===s)||null)},[s,l]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(z,{minContentColumns:[1,2,3,4,5,7],columns:N,children:[e.jsxs(T,{children:[e.jsx(b,{children:"Service"}),e.jsx(b,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(b,{children:"Details"}),e.jsx(b,{})]}),a&&e.jsx(P,{colSpan:N,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),!a&&!r&&l.length>0&&l.map(t=>e.jsx(ae,{item:t,selected:(d==null?void 0:d.id)===t.id,onItemClick:()=>p(t),onServiceDetailClick:()=>x(t)},t.id)),!a&&!r&&l.length===0&&e.jsx(P,{colSpan:N,children:"No services found"})]}),!!n&&e.jsx(v,{distribution:"end",className:"mt-4",children:e.jsx(A,{variant:"number",currentPage:o,onPressNext:c,onPressPrevious:c,pages:n})}),d&&e.jsx(B,{children:e.jsx(re,{service:d,onClose:j})})]})},te=s=>{var l;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((l=s==null?void 0:s.values)==null?void 0:l.filter(a=>a!==null))||[]}},ne=s=>g.isEmpty(s)||g.isEmpty(s.ServiceFilterValues)?[]:g.map(g.omit(s.ServiceFilterValues,["__typename"]),te),oe=()=>{const{data:s,previousData:l,loading:a,error:r}=R();return{serviceFilters:ne(g.isEmpty(s)?l:s),loading:a,error:r}},ce=({loading:s,error:l,counts:a})=>e.jsxs(v,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(v,{gap:"1",children:!l&&!s?e.jsx(J,{counts:a}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(v,{alignment:"center",className:"ml-auto",children:s&&e.jsx(L,{size:"small",className:"mr-2"})})]}),ue=({filterSettings:s,pageSize:l=20})=>{const a=m.useRef(),[r,{data:o,loading:n,error:c}]=G({variables:{first:l,orderBy:[{by:Y.Severity,direction:q.Desc}]},fetchPolicy:"network-only"}),{services:u,servicesIssuesCount:d,pages:i,pageNumber:p}=H(o);a.current=i;const j=m.useCallback(x=>{var t,f;if(!g.isNil(x)){const O=(f=(t=a.current)==null?void 0:t.find(y=>(y==null?void 0:y.pageNumber)===x-1))==null?void 0:f.after;r({variables:{filter:k(s),after:O}})}},[s]);return m.useEffect(()=>{r({variables:{filter:k(s)}})},[s]),{loading:n,error:W(c),services:u||[],servicesIssuesCount:d,currentPage:p,totalNumberOfPages:i.length||0,goToPage:j}},de=s=>{var l;return{selectedFilters:((l=s==null?void 0:s.support_group)==null?void 0:l.map(a=>({name:"supportGroupCcrn",value:a})))??[],searchTerm:""}},me=({defaultSelectService:s,initialFilters:l})=>{const{serviceFilters:a}=oe(),{addMessage:r,resetMessages:o}=Z(),[n,c]=m.useState(de(l)),{loading:u,error:d,services:i,servicesIssuesCount:p,currentPage:j,totalNumberOfPages:x,goToPage:t}=ue({filterSettings:n});return m.useEffect(()=>{d?r({variant:"error",text:d}):o()},[d]),e.jsxs(e.Fragment,{children:[e.jsx(se,{filters:a,filterSettings:n,onFilterChange:c,searchInputPlaceholder:"search term for services name"}),e.jsx(ce,{counts:p,loading:u,error:d}),e.jsx(ie,{defaultSelectService:s,services:i,loading:u,error:d,currentPage:j,totalNumberOfPages:x,goToPage:t})]})},xe=function(){const s=E("/services/"),{appProps:l}=s.useRouteContext(),{service:a}=s.useSearch();return e.jsx(me,{defaultSelectService:a,initialFilters:l.initialFilters})};export{xe as component};
