import{j as e,v as p,Y as E,p as w,y as D,I as F,z as A,a as G,T as L,A as h,u as z,N as $,c as R,b as V,d as T,D as y,t as O,L as Z,o as _,q as M,g as B}from"./App-BeFtTSCj.js";import{a as u}from"./index-DgHDWG7v.js";import{l as x,S as N,a as K,E as I,u as q,I as Q,b as Y,O as H,c as U,g as J,d as P,e as W}from"./IssueCountsPerSeverityLevel-CSzWI60_.js";const X=({filters:s,onChange:r})=>{var i;const[a,t]=u.useState(""),[d,l]=u.useState(""),o=(i=s.find(n=>n.filterName===a))==null?void 0:i.values,m=u.useCallback(n=>{!x.isEmpty(a)&&!x.isEmpty(n)&&(r({name:a,value:n}),t(""),l(""))},[a,r]);return e.jsx(p,{alignment:"center",gap:"8",children:e.jsxs(E,{children:[e.jsx(w,{className:"filter-label-select w-64 mb-0",name:"filter",label:"Filter",value:a,onChange:t,children:s==null?void 0:s.map(({displayName:n,filterName:v})=>e.jsx(D,{value:v,label:n},v))}),e.jsx(w,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue",value:d,onChange:m,children:o==null?void 0:o.map(n=>e.jsx(D,{value:n},n))}),e.jsx(F,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},ee=({selectedFilters:s,onDelete:r})=>e.jsx(p,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(A,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>r(a)},`${name}:${a.value}`))}),se=({filters:s,filterSettings:r,onFilterChange:a,searchInputPlaceholder:t})=>{const d=u.useCallback(l=>{var o;a({...r,selectedFilters:(o=r.selectedFilters)==null?void 0:o.filter(m=>!(m.name===l.name&&m.value===l.value))})},[r,a]);return e.jsxs(p,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(E,{children:[e.jsx(X,{filters:s,onChange:l=>{var o;a({...r,selectedFilters:(o=r==null?void 0:r.selectedFilters)==null?void 0:o.concat(l)})}}),e.jsx(F,{label:"Clear all",className:"ml-4",onClick:()=>a({...r,selectedFilters:[]}),variant:"subdued"}),e.jsx(G,{placeholder:t||"search term for",className:"w-96 ml-auto",onSearch:l=>{a({...r,searchTerm:l})},onClear:()=>a({...r,searchTerm:""})})]}),r.selectedFilters&&r.selectedFilters.length>0&&e.jsx(ee,{selectedFilters:r.selectedFilters,onDelete:d})]})},k={supportGroups:"support_group",region:"region",integrity:"integrity"},ae=({serviceDetails:s})=>{const r=(a,t)=>e.jsx(A,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(p,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,t])=>Array.isArray(t)?t.map(d=>r(k[a],d)):r(k[a],t))})},re=({item:s,selected:r,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(L,{className:`cursor-pointer ${r?"active":""}`,onClick:a,children:[e.jsx(h,{children:s.name}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(h,{children:e.jsx(ae,{serviceDetails:s.serviceDetails})}),e.jsx(h,{className:"cursor-default interactive",onClick:d=>d.stopPropagation(),children:e.jsx(F,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),te=({service:s,onClose:r})=>{const a=z();return e.jsx($,{heading:`${R(s.name)} Overview`,opened:!0,onClose:r,size:"large",children:e.jsx(V,{children:e.jsx(K,{service:s,onDetailsButtonClick:t=>a({to:"/services/$service",params:{service:s.name},search:{imageVersion:t==null?void 0:t.version}}),displayActions:!0})})})},S=8,ne=({defaultSelectService:s,services:r,loading:a,error:t,currentPage:d,totalNumberOfPages:l,goToPage:o})=>{const m=z(),[i,n]=u.useState(null),v=u.useCallback(c=>{n(g=>(g==null?void 0:g.id)===c.id?null:c),m({to:"/services",search:{service:c.name}})},[]),C=u.useCallback(()=>{n(null),m({to:"/services"})},[]),j=u.useCallback(c=>{m({to:"/services/$service",params:{service:c.name}})},[]);return u.useEffect(()=>{n(r.find(c=>c.name===s)||null)},[s,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(T,{minContentColumns:[1,2,3,4,5,7],columns:S,children:[e.jsxs(L,{children:[e.jsx(y,{children:"Service"}),e.jsx(y,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(y,{children:"Details"}),e.jsx(y,{})]}),a&&e.jsx(I,{colSpan:S,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(O,{variant:"primary"})]})}),!a&&!t&&r.length>0&&r.map(c=>e.jsx(re,{item:c,selected:(i==null?void 0:i.id)===c.id,onItemClick:()=>v(c),onServiceDetailClick:()=>j(c)},c.id)),!a&&!t&&r.length===0&&e.jsx(I,{colSpan:S,children:"No services found"})]}),!!l&&e.jsx(p,{distribution:"end",className:"mt-4",children:e.jsx(Z,{variant:"number",currentPage:d,onPressNext:o,onPressPrevious:o,pages:l})}),i&&e.jsx(_,{children:e.jsx(te,{service:i,onClose:C})})]})},ce=s=>{var r;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((r=s==null?void 0:s.values)==null?void 0:r.filter(a=>a!==null))||[]}},le=s=>x.isEmpty(s)||x.isEmpty(s.ServiceFilterValues)?[]:x.map(x.omit(s.ServiceFilterValues,["__typename"]),ce),oe=()=>{const{data:s,previousData:r,loading:a,error:t}=q();return{serviceFilters:le(x.isEmpty(s)?r:s),loading:a,error:t}},ie=({loading:s,error:r,counts:a})=>e.jsxs(p,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(p,{gap:"1",children:!r&&!s?e.jsx(Q,{counts:a}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(p,{alignment:"center",className:"ml-auto",children:s&&e.jsx(O,{size:"small",className:"mr-2"})})]}),ue=({filterSettings:s,pageSize:r=20})=>{const a=u.useRef(null),[t,{data:d,loading:l,error:o}]=Y({variables:{first:r,orderBy:[{by:U.Severity,direction:H.Desc}]},fetchPolicy:"network-only"}),{services:m,servicesIssuesCount:i,pages:n,pageNumber:v}=J(d);a.current=n;const C=u.useCallback(j=>{var c,g;if(!x.isNil(j)){const f=(g=(c=a.current)==null?void 0:c.find(b=>(b==null?void 0:b.pageNumber)===j-1))==null?void 0:g.after;t({variables:{filter:P(s),after:f}})}},[s]);return u.useEffect(()=>{t({variables:{filter:P(s)}})},[s]),{loading:l,error:W(o),services:m||[],servicesIssuesCount:i,currentPage:v,totalNumberOfPages:n.length||0,goToPage:C}},de=s=>{var a;return{selectedFilters:((a=s==null?void 0:s.support_group)==null?void 0:a.map(t=>({name:"supportGroupCcrn",value:t})))??[],searchTerm:""}},me=({defaultSelectService:s,initialFilters:r})=>{const{serviceFilters:a}=oe(),{addMessage:t,resetMessages:d}=M(),[l,o]=u.useState(de(r)),{loading:m,error:i,services:n,servicesIssuesCount:v,currentPage:C,totalNumberOfPages:j,goToPage:c}=ue({filterSettings:l});return u.useEffect(()=>{i?t({variant:"error",text:i}):d()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(se,{filters:a,filterSettings:l,onFilterChange:o,searchInputPlaceholder:"search term for services name"}),e.jsx(ie,{counts:v,loading:m,error:i}),e.jsx(ne,{defaultSelectService:s,services:n,loading:m,error:i,currentPage:C,totalNumberOfPages:j,goToPage:c})]})},xe=function(){const r=B("/services/"),{appProps:a}=r.useRouteContext(),{service:t}=r.useSearch();return e.jsx(me,{defaultSelectService:t,initialFilters:a.initialFilters})};export{xe as component};
