import{j as e,R as p,o as E,V as F,a as D,b as S,m as O,c as f,l as z,q as v,u as A,d as V,g as G,z as $,e as b,f as L,p as Z,i as _,h as M,k as B}from"./App-VjLWdcAA.js";import{b as u}from"./index-o-ddHxI9.js";import{l as x,S as N,a as K,E as I,u as T,I as q,b as Q,O as U,c as H,g as J,d as P,e as W}from"./IssueCountsPerSeverityLevel-DUsEb1bA.js";const X=({filters:s,onChange:r})=>{var i;const[a,t]=u.useState(""),[m,l]=u.useState(""),o=(i=s.find(n=>n.filterName===a))==null?void 0:i.values,d=u.useCallback(n=>{!x.isEmpty(a)&&!x.isEmpty(n)&&(r({name:a,value:n}),t(""),l(""))},[a,r]);return e.jsx(p,{alignment:"center",gap:"8",children:e.jsxs(E,{children:[e.jsx(F,{className:"filter-label-select w-64 mb-0",name:"filter",label:"Filter",value:a,onChange:t,children:s==null?void 0:s.map(({displayName:n,filterName:h})=>e.jsx(D,{value:h,label:n},h))}),e.jsx(F,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue",value:m,onChange:d,children:o==null?void 0:o.map(n=>e.jsx(D,{value:n},n))}),e.jsx(S,{icon:"filterAlt",className:"py-[0.3rem]"})]})})},Y=({selectedFilters:s,onDelete:r})=>e.jsx(p,{gap:"2",wrap:!0,children:s==null?void 0:s.map(a=>e.jsx(O,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>r(a)},`${name}:${a.value}`))}),ee=({filters:s,filterSettings:r,onFilterChange:a,searchInputPlaceholder:t})=>{const m=u.useCallback(l=>{var o;a({...r,selectedFilters:(o=r.selectedFilters)==null?void 0:o.filter(d=>!(d.name===l.name&&d.value===l.value))})},[r,a]);return e.jsxs(p,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(E,{children:[e.jsx(X,{filters:s,onChange:l=>{var o;a({...r,selectedFilters:(o=r==null?void 0:r.selectedFilters)==null?void 0:o.concat(l)})}}),e.jsx(S,{label:"Clear all",className:"ml-4",onClick:()=>a({...r,selectedFilters:[]}),variant:"subdued"}),e.jsx(f,{placeholder:t||"search term for",className:"w-96 ml-auto",onSearch:l=>{a({...r,searchTerm:l})},onClear:()=>a({...r,searchTerm:""})})]}),r.selectedFilters&&r.selectedFilters.length>0&&e.jsx(Y,{selectedFilters:r.selectedFilters,onDelete:m})]})},k={supportGroups:"support_group",region:"region",integrity:"integrity"},se=({serviceDetails:s})=>{const r=(a,t)=>e.jsx(O,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(p,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([a,t])=>Array.isArray(t)?t.map(m=>r(k[a],m)):r(k[a],t))})},ae=({item:s,selected:r,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(z,{className:`cursor-pointer ${r?"active":""}`,onClick:a,children:[e.jsx(v,{children:s.name}),e.jsx(v,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(N,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(v,{children:e.jsx(se,{serviceDetails:s.serviceDetails})}),e.jsx(v,{className:"cursor-default interactive",onClick:m=>m.stopPropagation(),children:e.jsx(S,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),re=s=>s.charAt(0).toUpperCase()+s.slice(1),te=({service:s,onClose:r})=>{const a=A();return e.jsx(V,{heading:`${re(s.name)} Overview`,opened:!0,onClose:r,size:"large",children:e.jsx(G,{children:e.jsx(K,{service:s,onDetailsButtonClick:t=>a({to:"/services/$service",params:{service:s.name},search:{imageVersion:t==null?void 0:t.version}}),displayActions:!0})})})},w=8,ne=({defaultSelectService:s,services:r,loading:a,error:t,currentPage:m,totalNumberOfPages:l,goToPage:o})=>{const d=A(),[i,n]=u.useState(null),h=u.useCallback(c=>{n(g=>(g==null?void 0:g.id)===c.id?null:c),d({to:"/services",search:{service:c.name}})},[]),C=u.useCallback(()=>{n(null),d({to:"/services"})},[]),j=u.useCallback(c=>{d({to:"/services/$service",params:{service:c.name}})},[]);return u.useEffect(()=>{n(r.find(c=>c.name===s)||null)},[s,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:w,children:[e.jsxs(z,{children:[e.jsx(b,{children:"Service"}),e.jsx(b,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(b,{children:"Details"}),e.jsx(b,{})]}),a&&e.jsx(I,{colSpan:w,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),!a&&!t&&r.length>0&&r.map(c=>e.jsx(ae,{item:c,selected:(i==null?void 0:i.id)===c.id,onItemClick:()=>h(c),onServiceDetailClick:()=>j(c)},c.id)),!a&&!t&&r.length===0&&e.jsx(I,{colSpan:w,children:"No services found"})]}),!!l&&e.jsx(p,{distribution:"end",className:"mt-4",children:e.jsx(Z,{variant:"number",currentPage:m,onPressNext:o,onPressPrevious:o,pages:l})}),i&&e.jsx(_,{children:e.jsx(te,{service:i,onClose:C})})]})},ce=s=>{var r;return{displayName:(s==null?void 0:s.displayName)||"",filterName:(s==null?void 0:s.filterName)||"",values:((r=s==null?void 0:s.values)==null?void 0:r.filter(a=>a!==null))||[]}},le=s=>x.isEmpty(s)||x.isEmpty(s.ServiceFilterValues)?[]:x.map(x.omit(s.ServiceFilterValues,["__typename"]),ce),oe=()=>{const{data:s,previousData:r,loading:a,error:t}=T();return{serviceFilters:le(x.isEmpty(s)?r:s),loading:a,error:t}},ie=({loading:s,error:r,counts:a})=>e.jsxs(p,{className:"status-bar bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:[e.jsx(p,{gap:"1",children:!r&&!s?e.jsx(q,{counts:a}):e.jsx("div",{className:"font-bold",children:"All issues: --"})}),e.jsx(p,{alignment:"center",className:"ml-auto",children:s&&e.jsx(L,{size:"small",className:"mr-2"})})]}),ue=({filterSettings:s,pageSize:r=20})=>{const a=u.useRef(),[t,{data:m,loading:l,error:o}]=Q({variables:{first:r,orderBy:[{by:H.Severity,direction:U.Desc}]},fetchPolicy:"network-only"}),{services:d,servicesIssuesCount:i,pages:n,pageNumber:h}=J(m);a.current=n;const C=u.useCallback(j=>{var c,g;if(!x.isNil(j)){const R=(g=(c=a.current)==null?void 0:c.find(y=>(y==null?void 0:y.pageNumber)===j-1))==null?void 0:g.after;t({variables:{filter:P(s),after:R}})}},[s]);return u.useEffect(()=>{t({variables:{filter:P(s)}})},[s]),{loading:l,error:W(o),services:d||[],servicesIssuesCount:i,currentPage:h,totalNumberOfPages:n.length||0,goToPage:C}},me=s=>{var a;return{selectedFilters:((a=s==null?void 0:s.support_group)==null?void 0:a.map(t=>({name:"supportGroupCcrn",value:t})))??[],searchTerm:""}},de=({defaultSelectService:s,initialFilters:r})=>{const{serviceFilters:a}=oe(),{addMessage:t,resetMessages:m}=M(),[l,o]=u.useState(me(r)),{loading:d,error:i,services:n,servicesIssuesCount:h,currentPage:C,totalNumberOfPages:j,goToPage:c}=ue({filterSettings:l});return u.useEffect(()=>{i?t({variant:"error",text:i}):m()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(ee,{filters:a,filterSettings:l,onFilterChange:o,searchInputPlaceholder:"search term for services name"}),e.jsx(ie,{counts:h,loading:d,error:i}),e.jsx(ne,{defaultSelectService:s,services:n,loading:d,error:i,currentPage:C,totalNumberOfPages:j,goToPage:c})]})},xe=function(){const r=B("/services/"),{appProps:a}=r.useRouteContext(),{service:t}=r.useSearch();return e.jsx(de,{defaultSelectService:t,initialFilters:a.initialFilters})};export{xe as component};
