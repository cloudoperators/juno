import{k as Z,g as v,j as e,u as b,d as V,e as T,f as A,w as F,J as Q,o as d,c as r,V as h,m as S,R as D,K as f,a as x,h as _,P as z,n as j,i as B,z as J,b as O}from"./App-DPncueQy-iSYcmA0w.js";import{Q as m}from"./_extensionId._-CbRjxH1W.js";import{o as P,Z as G,c as K,l as X,r as k,a as H}from"./FirefoxCorsWarning-AP5GTa1t-Dy4SJbOL.js";import"./index-DL4u4PVY.js";import"./Shell-qT7kTQyw.js";import"./index-TkDO45_u.js";const N=({timestamp:s})=>{const n=i=>new Date(i).toLocaleString("en-GB",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Europe/Berlin",timeZoneName:"short"});return e.jsx("div",{children:n(s)})},M=s=>s.length>40?s.substring(0,40)+"...":s,U=({silence:s},n)=>e.jsxs(d,{children:[e.jsxs(r,{className:"whitespace-nowrap",children:[e.jsx(N,{timestamp:s?.startsAt}),e.jsx(N,{timestamp:s?.endsAt})]}),e.jsxs(r,{className:"overflow-hidden",children:[e.jsx("div",{ref:n,children:s?.comment}),e.jsxs("div",{className:"text-theme-light",children:["Silence ",s.id," created by ",s?.createdBy]}),e.jsx(J,{className:"py-2 px-0",children:e.jsx(h,{gap:"2",alignment:"start",wrap:!0,children:s?.matchers?.map((i,l)=>e.jsx(O,{pillKey:i.name,pillValue:M(i.value)},l))})})]}),e.jsx(r,{className:"overflow-hidden",children:e.jsx("p",{children:s?.status?.state})}),e.jsx(r,{className:"overflow-hidden",children:s?.status?.state===x.SILENCE_ACTIVE||s?.status?.state===x.SILENCE_PENDING?e.jsx(k,{silence:s}):e.jsx(H,{silence:s})})]}),q=m.forwardRef(U),W=`
bg-theme-background-lvl-1
py-2
px-4
my-px
`,Y=()=>{const s=b(),n=V(),[i,l]=m.useState(n),u=T(),c=A(),{setSilences:w}=v(),{addMessage:E,resetMessages:y}=F(),{data:g,isLoading:C,error:p}=P("silences");p&&(y(),p instanceof G&&E({variant:"warning",text:e.jsx(K,{})}),E({variant:"error",text:X(p)})),m.useEffect(()=>{g&&w({items:g.silences})},[g]),m.useEffect(()=>{let a=n.filter(t=>t?.status?.state===u);try{c&&(a=a.filter(t=>JSON.stringify(t).match(new RegExp(c,"i"))))}catch(t){console.warn("search term is not a valid regex. "+t),a=a.filter(o=>JSON.stringify(o).toLowerCase().includes(c.toLowerCase))}l(a)},[u,c,n]);const L=a=>{const t=setTimeout(()=>{s({to:"/silences",search:o=>({...o,silencesRegEx:a.target.value})})},500);return()=>clearTimeout(t)},{scrollListItems:I,iterator:R}=Q(i,{loadingObject:e.jsx(d,{children:e.jsx(r,{colSpan:3,children:e.jsxs(h,{gap:"3",alignment:"center",direction:"horizontal",children:["Loading...",e.jsx(S,{})]})})}),refFunction:a=>e.jsx(d,{children:e.jsx(r,{colSpan:3,className:"border-b-0 py-0",children:e.jsx("span",{ref:a})})})});return e.jsx(e.Fragment,{children:C?e.jsxs(h,{gap:"2",children:[e.jsx("span",{children:"Loading"}),e.jsx(S,{variant:"primary"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(h,{direction:"horizontal",className:`${W}`,children:[e.jsxs(D,{className:"w-3/12",label:"Status",value:u,onChange:a=>{s({to:"/silences",search:t=>({...t,silencesStatus:a})})},children:[e.jsx(f,{value:x.SILENCE_ACTIVE}),e.jsx(f,{value:x.SILENCE_PENDING}),e.jsx(f,{value:x.SILENCE_EXPIRED})]}),e.jsx(_,{placeholder:"search term or regular expression",className:"ml-auto w-7/12",value:c||"",onChange:a=>{L(a)},onSearch:a=>{s({to:"/silences",search:t=>({...t,silencesRegEx:a})})},onClear:()=>{s({to:"/silences",search:a=>{const{silencesRegEx:t,...o}=a;return{...o}}})}})]}),e.jsx(z,{columns:4,minContentColumns:[0,2,3],cellVerticalAlignment:"top",className:"silences ",children:e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx(j,{children:"Time intervall"}),e.jsx(j,{children:"Details"}),e.jsx(j,{children:"State"}),e.jsx(j,{children:"Action"})]}),I?.length?R.map(a=>e.jsx(q,{silence:a},a.id)):e.jsx(d,{children:e.jsx(r,{colSpan:4,children:e.jsxs(h,{gap:"3",children:[e.jsx(B,{icon:"info",color:"text-theme-info"}),e.jsx("div",{children:"We couldn't find any matching silences."})]})})})]})})]})})};function ie(){const{appStateFromUrl:{silencesRegEx:s,silencesStatus:n}}=Z.useRouteContext(),{setSilencesRegEx:i,setSilencesStatus:l}=v();return m.useLayoutEffect(()=>{i(s),l(n)},[s,n]),e.jsx(Y,{})}export{ie as component};
