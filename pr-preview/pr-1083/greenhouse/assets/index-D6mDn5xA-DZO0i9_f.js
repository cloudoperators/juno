import{j as e,x as g,u as f,d as C,m as $,K as p,f as T,l as Z,C as y,h as x,g as b,i as I,R as F,W as q,a as D,b as A,c as E,I as K,e as S,H as L,r as G,n as Q,o as B,k as P,v as d,z as m,S as M}from"./App-Cmxj1ugv-vmCNZ_JP.js";import{w as n,G as O}from"./index-DIP52GzV.js";import{K as z,p as j,U as H,Q as U,G as W,_,i as v}from"./IssueCountsPerSeverityLevel-B0zooCAX-CimgpUlH.js";import"./index-Cm7KwiB1.js";const J=i=>i.charAt(0).toUpperCase()+i.slice(1),R=()=>{const i=f(),{queryClient:s,apiClient:a}=z({from:"/services/"}),{service:r}=D({from:"/services/"}),[c,l]=O.useState(void 0),o=r?W({queryClient:s,apiClient:a,service:r,after:c}):void 0,h=n.useCallback(()=>{i({to:"/services",search:u=>{const{service:oe,...V}=u;return{...V}}})},[i]),t=n.useCallback(u=>{r&&i({to:"/services/$service",params:{service:r},search:{imageVersion:u?.version}})},[i,r]);return e.jsx(A,{children:e.jsx(E,{heading:r?`${J(r)} Overview`:void 0,opened:!!r,onClose:h,size:"large",children:e.jsx(K,{children:r&&o&&e.jsx(_,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:t,goToPage:l})})})})},N={supportGroups:"support_group",region:"region",integrity:"integrity"},X=({serviceDetails:i})=>{const s=(a,r)=>e.jsx(P,{pillKey:a,pillKeyLabel:a,pillValue:r,pillValueLabel:r},r);return e.jsx(p,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(i).map(([a,r])=>Array.isArray(r)?r.map(c=>s(N[a],c)):s(N[a],r))})},Y=({item:i,selected:s,onItemClick:a,onServiceDetailClick:r})=>e.jsxs(y,{className:`cursor-pointer ${s?"active":""}`,onClick:a,children:[e.jsx(d,{children:i.name}),e.jsx(d,{className:"items-center",children:e.jsx(v,{showDashIfZero:!0,count:i.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(v,{showDashIfZero:!0,count:i.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(v,{showDashIfZero:!0,count:i.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(v,{showDashIfZero:!0,count:i.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(v,{showDashIfZero:!0,count:i.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(d,{children:e.jsx(X,{serviceDetails:i.serviceDetails})}),e.jsx(d,{className:"cursor-default interactive",onClick:c=>c.stopPropagation(),children:e.jsx(F,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),k=8,ee=({servicesPromise:i})=>{const s=f(),{service:a}=D({from:"/services/"}),{error:r,data:c}=n.use(i),{services:l}=b(c),o=n.useCallback(t=>{s({to:"/services",search:u=>({...u,service:t.name})})},[]),h=n.useCallback(t=>{s({to:"/services/$service",params:{service:t.name}})},[]);return r?e.jsx(j,{colSpan:k,children:"Error loading services"}):l.length===0?e.jsx(j,{colSpan:k,children:"No service found"}):l.map(t=>e.jsx(Y,{item:t,selected:t.name===a,onItemClick:()=>o(t),onServiceDetailClick:()=>h(t)},t.id))},w=8,se=()=>{const{queryClient:i,apiClient:s}=z({from:"/services/"}),{servicesPromise:a,filterSettings:r}=C({from:"/services/"}),[c,l]=n.useState(a),o=n.useCallback(h=>{const t=T({queryClient:i,apiClient:s,filterSettings:r,after:h});l(t)},[l,i,s,r]);return n.useEffect(()=>{l(a)},[l,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(Z,{minContentColumns:[1,2,3,4,5,7],columns:w,children:[e.jsxs(y,{children:[e.jsx(x,{children:"Service"}),e.jsx(x,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(x,{children:"Details"}),e.jsx(x,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(j,{colSpan:w,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(ee,{servicesPromise:c})})]}),e.jsx(n.Suspense,{children:e.jsx(H,{dataPromise:c,goToPage:o,dataNormalizationMethod:b})}),e.jsx(R,{})]})},ae=({servicesPromise:i})=>{const{error:s,data:a}=n.use(i),{servicesIssuesCount:r}=b(a);return e.jsx(p,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(U,{counts:r})})},ie=()=>{const{servicesPromise:i}=C({from:"/services/"});return e.jsx(p,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(g,{size:"small"}),children:e.jsx(ae,{servicesPromise:i})})})},re=({filters:i,onChange:s})=>{const[a,r]=n.useState(""),[c,l]=n.useState(""),o=i.find(t=>t.filterName===a)?.values?.filter(t=>t),h=n.useCallback(t=>{l(t),!S.isEmpty(a)&&!S.isEmpty(t)&&s({name:a,value:t}),setTimeout(()=>{l("")},0)},[a,l,s]);return e.jsx(p,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(L,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:t=>{r(String(t))},children:i?.map(({displayName:t,filterName:u})=>e.jsx(G,{value:u,label:t,"data-testid":u},u))}),e.jsx(Q,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,disabled:!a,onChange:h,children:o?.map(t=>e.jsx(B,{value:t,label:t,"data-testid":t},t))})]})})},te=({selectedFilters:i,onDelete:s})=>e.jsx(p,{gap:"2",wrap:!0,children:i?.map(a=>e.jsx(P,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>s(a)},`${name}:${a.value}`))}),le=({filters:i,filterSettings:s,onFilterChange:a,searchInputPlaceholder:r})=>{const c=n.useCallback(l=>{a({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===l.name&&o.value===l.value))})},[s,a]);return e.jsxs(p,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(re,{filters:i,onChange:l=>{s.selectedFilters?.some(o=>o.name===l.name&&o.value===l.value)||a({...s,selectedFilters:[...s.selectedFilters||[],l]})}}),e.jsx(F,{label:"Clear all",className:"ml-4",onClick:()=>a({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(q,{placeholder:r||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:l=>{a({...s,searchTerm:l})},onClear:()=>a({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(te,{selectedFilters:s.selectedFilters,onDelete:c})]})},ne=()=>{const i=f(),{filters:s,filterSettings:a}=C({from:"/services/"}),r=n.useCallback(c=>{i({to:"/services",search:{...$(c)}})},[a,i]);return e.jsx(le,{filters:s,filterSettings:a,onFilterChange:r,searchInputPlaceholder:"search term for services name"})},ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:[e.jsx(ie,{}),e.jsx(se,{})]})]});m.object({service:m.string().optional(),searchTerm:m.string().optional()}).catchall(m.preprocess((i,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(M)))return i},m.union([m.string(),m.array(m.string()),m.undefined()])));const pe=ce;export{pe as component};
