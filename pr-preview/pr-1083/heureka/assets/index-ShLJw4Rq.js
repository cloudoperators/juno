import{u as g,a as P,j as e,b as V,c as R,I as T,C as D,v,R as k,K as h,k as y,g as C,d as f,f as z,l as A,h as x,x as b,e as S,i as F,H as O,r as $,n as K,o as Z,W as _,m as M,z as m,S as U}from"./App-BTdNZR1z.js";import{R as H,a as c}from"./index-xGyvcSP1.js";import{u as E,f as W,S as q,a as p,E as j,C as G,I as B}from"./IssueCountsPerSeverityLevel-Cs4rZlgJ.js";const X=r=>r.charAt(0).toUpperCase()+r.slice(1),J=()=>{const r=g(),{queryClient:s,apiClient:a}=E({from:"/services/"}),{service:t}=P({from:"/services/"}),[l,i]=H.useState(void 0),o=t?W({queryClient:s,apiClient:a,service:t,after:l}):void 0,u=c.useCallback(()=>{r({to:"/services",search:d=>{const{service:oe,...L}=d;return{...L}}})},[r]),n=c.useCallback(d=>{t&&r({to:"/services/$service",params:{service:t},search:{imageVersion:d?.version}})},[r,t]);return e.jsx(V,{children:e.jsx(R,{heading:t?`${X(t)} Overview`:void 0,opened:!!t,onClose:u,size:"large",children:e.jsx(T,{children:t&&o&&e.jsx(q,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:n,goToPage:i})})})})},N={supportGroups:"support_group",region:"region",integrity:"integrity"},Q=({serviceDetails:r})=>{const s=(a,t)=>e.jsx(y,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(h,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(r).map(([a,t])=>Array.isArray(t)?t.map(l=>s(N[a],l)):s(N[a],t))})},Y=({item:r,selected:s,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(D,{className:`cursor-pointer ${s?"active":""}`,onClick:a,children:[e.jsx(v,{children:r.name}),e.jsx(v,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(v,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(v,{children:e.jsx(Q,{serviceDetails:r.serviceDetails})}),e.jsx(v,{className:"cursor-default interactive",onClick:l=>l.stopPropagation(),children:e.jsx(k,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),w=8,ee=({servicesPromise:r})=>{const s=g(),{service:a}=P({from:"/services/"}),{error:t,data:l}=c.use(r),{services:i}=C(l),o=c.useCallback(n=>{s({to:"/services",search:d=>({...d,service:n.name})})},[]),u=c.useCallback(n=>{s({to:"/services/$service",params:{service:n.name}})},[]);return t?e.jsx(j,{colSpan:w,children:"Error loading services"}):i.length===0?e.jsx(j,{colSpan:w,children:"No service found"}):i.map(n=>e.jsx(Y,{item:n,selected:n.name===a,onItemClick:()=>o(n),onServiceDetailClick:()=>u(n)},n.id))},I=8,se=()=>{const{queryClient:r,apiClient:s}=E({from:"/services/"}),{servicesPromise:a,filterSettings:t}=f({from:"/services/"}),[l,i]=c.useState(a),o=c.useCallback(u=>{const n=z({queryClient:r,apiClient:s,filterSettings:t,after:u});i(n)},[i,r,s,t]);return c.useEffect(()=>{i(a)},[i,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(A,{minContentColumns:[1,2,3,4,5,7],columns:I,children:[e.jsxs(D,{children:[e.jsx(x,{children:"Service"}),e.jsx(x,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(x,{children:"Details"}),e.jsx(x,{})]}),e.jsx(c.Suspense,{fallback:e.jsx(j,{colSpan:I,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]})}),children:e.jsx(ee,{servicesPromise:l})})]}),e.jsx(c.Suspense,{children:e.jsx(G,{dataPromise:l,goToPage:o,dataNormalizationMethod:C})}),e.jsx(J,{})]})},ae=({servicesPromise:r})=>{const{error:s,data:a}=c.use(r),{servicesIssuesCount:t}=C(a);return e.jsx(h,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(B,{counts:t})})},re=()=>{const{servicesPromise:r}=f({from:"/services/"});return e.jsx(h,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(c.Suspense,{fallback:e.jsx(b,{size:"small"}),children:e.jsx(ae,{servicesPromise:r})})})},te=({filters:r,onChange:s})=>{const[a,t]=c.useState(""),[l,i]=c.useState(""),o=r.find(n=>n.filterName===a)?.values?.filter(n=>n),u=c.useCallback(n=>{i(n),!S.isEmpty(a)&&!S.isEmpty(n)&&s({name:a,value:n}),setTimeout(()=>{i("")},0)},[a,i,s]);return e.jsx(h,{alignment:"center",gap:"8",children:e.jsxs(F,{children:[e.jsx(O,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:n=>{t(String(n))},children:r?.map(({displayName:n,filterName:d})=>e.jsx($,{value:d,label:n,"data-testid":d},d))}),e.jsx(K,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:l,disabled:!a,onChange:u,children:o?.map(n=>e.jsx(Z,{value:n,label:n,"data-testid":n},n))})]})})},ne=({selectedFilters:r,onDelete:s})=>e.jsx(h,{gap:"2",wrap:!0,children:r?.map(a=>e.jsx(y,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>s(a)},`${name}:${a.value}`))}),ie=({filters:r,filterSettings:s,onFilterChange:a,searchInputPlaceholder:t})=>{const l=c.useCallback(i=>{a({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===i.name&&o.value===i.value))})},[s,a]);return e.jsxs(h,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(F,{children:[e.jsx(te,{filters:r,onChange:i=>{s.selectedFilters?.some(u=>u.name===i.name&&u.value===i.value)||a({...s,selectedFilters:[...s.selectedFilters||[],i]})}}),e.jsx(k,{label:"Clear all",className:"ml-4",onClick:()=>a({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(_,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:i=>{a({...s,searchTerm:i})},onClear:()=>a({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(ne,{selectedFilters:s.selectedFilters,onDelete:l})]})},ce=()=>{const r=g(),{filters:s,filterSettings:a}=f({from:"/services/"}),t=c.useCallback(l=>{r({to:"/services",search:{...M(l)}})},[a,r]);return e.jsx(ie,{filters:s,filterSettings:a,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},le=()=>e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsxs(c.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(b,{size:"small"})}),children:[e.jsx(re,{}),e.jsx(se,{})]})]});m.object({service:m.string().optional(),searchTerm:m.string().optional()}).catchall(m.preprocess((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(U)))return r},m.union([m.string(),m.array(m.string()),m.undefined()])));const ve=le;export{ve as component};
