import{R as N,j as e,E as h,Q as k,Y as v,X as V,r as f,o as g,P as j,M as I,c,V as x,d as D}from"./App-DOVw5gBi-t-iqWZq_.js";import{G as u}from"./_extensionId._-BvijEq6s.js";import{D as S,L as w,S as P,d as y,i as d}from"./IssueCountsPerSeverityLevel-BBXE3HGH-CHB4yq3a.js";const q=({children:s})=>e.jsx(I,{className:"my-6",children:s}),F=({imagesPromise:s,className:n})=>{const{data:i}=u.use(s),{totalImages:t}=j(i);return e.jsx("span",{className:n,children:t})},R=({version:s,selected:n=!1,displayDetailsButton:i=!0,onItemClick:t,onDetailClick:l})=>e.jsxs(f,{onClick:t,className:"cursor-pointer",isSelected:n,children:[e.jsx(c,{className:"service-image-versions-cell",children:e.jsxs(x,{gap:"1",direction:"vertical",children:[e.jsxs(x,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),s.versionsCount!==void 0&&s.versionsCount>0&&e.jsxs("span",{className:"text-sm text-theme-light",children:[s.versionsCount," version",s.versionsCount!==1?"s":""]})]}),e.jsx(x,{gap:"1",alignment:"center",children:s.imageRegistryUrl&&e.jsx("a",{href:s.imageRegistryUrl.startsWith("http://")||s.imageRegistryUrl.startsWith("https://")?s.imageRegistryUrl:`https://${s.imageRegistryUrl}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:r=>r.stopPropagation(),"aria-label":`Open image registry for ${s.repository} (opens in a new tab)`,title:`Open image registry for ${s.repository} (opens in a new tab)`,children:e.jsxs(x,{gap:"1.5",alignment:"center",children:[e.jsx(D,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(c,{className:"service-image-versions-cell",children:s.versionsCount!==void 0?`${s.versionsCount} version${s.versionsCount!==1?"s":""}`:"-"}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(d,{severity:"critical",count:s.vulnerabilityCounts.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(d,{severity:"high",count:s.vulnerabilityCounts.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(d,{severity:"medium",count:s.vulnerabilityCounts.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(d,{severity:"low",count:s.vulnerabilityCounts.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(c,{className:"items-center !px-2",children:e.jsx(d,{severity:"unknown",count:s.vulnerabilityCounts.none,tooltipContent:"None Vulnerabilities"})}),i&&e.jsx(c,{className:"cursor-default",onClick:r=>r.stopPropagation(),children:e.jsx(v,{size:"small",label:"Show Details",onClick:l,className:"whitespace-nowrap"})})]}),z=({columnSpan:s,selectedImage:n,displayDetailsButton:i,imagesPromise:t,onDetailsButtonClick:l,onImageItemClick:r})=>{const{error:a,data:p}=u.use(t),{images:m}=j(p);return a?e.jsx(y,{colSpan:s,children:"Error loading images."}):m.length===0?e.jsx(y,{colSpan:s,children:"No image found"}):m.map(o=>e.jsx(R,{version:o,selected:o.repository===n,displayDetailsButton:i,onItemClick:()=>{r?.(o)},onDetailClick:b=>{b.stopPropagation(),l?.(o)}},o.repository))},C=8,M=({imagesPromise:s,selectedImage:n,displayActions:i=!1,onImageItemClick:t,onDetailsButtonClick:l,goToPage:r})=>{const a=i?C:C-1;return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:["Images",e.jsx(h,{children:e.jsxs(u.Suspense,{children:["(",e.jsx(F,{imagesPromise:s,className:"ml-1"}),")"]})})]}),i&&e.jsx(k,{children:e.jsx(v,{size:"small",onClick:()=>l?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(V,{columns:a,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(f,{children:[e.jsx(g,{children:"Image Repository"}),e.jsx(g,{children:"Versions"}),e.jsx(g,{colSpan:5,children:"Vulnerability Counts"}),i&&e.jsx(g,{})]}),e.jsx(h,{displayErrorMessage:!0,resetKeys:[s],fallbackRender:S({colspan:a}),children:e.jsx(u.Suspense,{fallback:e.jsx(w,{colSpan:a}),children:e.jsx(z,{columnSpan:a,displayDetailsButton:i,imagesPromise:s,selectedImage:n,onDetailsButtonClick:l,onImageItemClick:t})})})]})}),e.jsx(h,{children:e.jsx(u.Suspense,{children:e.jsx(P,{dataNormalizationMethod:j,dataPromise:s,goToPage:r})})})]})},E=({queryClient:s,apiClient:n,filter:i,after:t,first:l=10,firstVulnerabilities:r,afterVulnerabilities:a,firstVersions:p,afterVersions:m,vulFilter:o})=>s.ensureQueryData({queryKey:["images",i,t,r,a,p,m,o],queryFn:()=>n.query({query:N,variables:{imgFilter:i,vulFilter:o,first:l,after:t,firstVulnerabilities:r,afterVulnerabilities:a,firstVersions:p,afterVersions:m}})});export{M as F,E as O,q as U};
