import{j as o,aN as Z,aO as le,aP as ue,v as A,aJ as D,aB as T,aM as X,aC as N,f as Y,a as ee,e as te,c as se,B as re,C as ie,z as de,D as pe,V as fe,w as me,F as ye,I as F,J as be,Q as ge,Y as ve,W as we,aw as ae,az as P,aK as L,aL as xe,ax as _,ay as w,aA as R,aD as B,aE as Ce,aF as I,aG as Ee,aH as Oe,aI as Q}from"./App-DNvk_pO2-B_MJqMgy.js";import{j as d}from"./_extensionId._-C6Yl7hjT.js";var Se=class extends ae{constructor(e,t){super(),this.options=t,this.#s=e,this.#o=null,this.#n=_(),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#r=void 0;#t=void 0;#i;#a;#n;#o;#m;#d;#p;#h;#l;#c;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),$(this.#e,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return U(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return U(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#x(),this.#e.removeObserver(this)}setOptions(e){const t=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof w(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#e.setOptions(this.options),t._defaulted&&!P(this.options,t)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const s=this.hasListeners();s&&K(this.#e,r,this.options,t)&&this.#u(),this.updateResult(),s&&(this.#e!==r||w(this.options.enabled,this.#e)!==w(t.enabled,this.#e)||R(this.options.staleTime,this.#e)!==R(t.staleTime,this.#e))&&this.#y();const i=this.#b();s&&(this.#e!==r||w(this.options.enabled,this.#e)!==w(t.enabled,this.#e)||i!==this.#c)&&this.#g(i)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),r=this.createResult(t,e);return Re(this,r)&&(this.#t=r,this.#a=this.options,this.#i=this.#e.state),r}getCurrentResult(){return this.#t}trackResult(e,t){return new Proxy(e,{get:(r,s)=>(this.trackProp(s),t?.(s),s==="promise"&&!this.options.experimental_prefetchInRender&&this.#n.status==="pending"&&this.#n.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(r,s))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),r=this.#s.getQueryCache().build(this.#s,t);return r.fetch().then(()=>this.createResult(r,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#u(e){this.#C();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(T)),t}#y(){this.#w();const e=R(this.options.staleTime,this.#e);if(N||this.#t.isStale||!B(e))return;const t=Ce(this.#t.dataUpdatedAt,e)+1;this.#h=I.setTimeout(()=>{this.#t.isStale||this.updateResult()},t)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#x(),this.#c=e,!(N||w(this.options.enabled,this.#e)===!1||!B(this.#c)||this.#c===0)&&(this.#l=I.setInterval(()=>{(this.options.refetchIntervalInBackground||Ee.isFocused())&&this.#u()},this.#c))}#v(){this.#y(),this.#g(this.#b())}#w(){this.#h&&(I.clearTimeout(this.#h),this.#h=void 0)}#x(){this.#l&&(I.clearInterval(this.#l),this.#l=void 0)}createResult(e,t){const r=this.#e,s=this.options,i=this.#t,h=this.#i,a=this.#a,p=e!==r?e.state:this.#r,{state:u}=e;let n={...u},m=!1,l;if(t._optimisticResults){const f=this.hasListeners(),E=!f&&$(e,t),O=f&&K(e,r,t,s);(E||O)&&(n={...n,...Oe(u.data,e.options)}),t._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:v,errorUpdatedAt:x,status:y}=n;l=n.data;let k=!1;if(t.placeholderData!==void 0&&l===void 0&&y==="pending"){let f;i?.isPlaceholderData&&t.placeholderData===a?.placeholderData?(f=i.data,k=!0):f=typeof t.placeholderData=="function"?t.placeholderData(this.#p?.state.data,this.#p):t.placeholderData,f!==void 0&&(y="success",l=Q(i?.data,f,t),m=!0)}if(t.select&&l!==void 0&&!k)if(i&&l===h?.data&&t.select===this.#m)l=this.#d;else try{this.#m=t.select,l=t.select(l),l=Q(i?.data,l,t),this.#d=l,this.#o=null}catch(f){this.#o=f}this.#o&&(v=this.#o,l=this.#d,x=Date.now(),y="error");const S=n.fetchStatus==="fetching",j=y==="pending",C=y==="error",c=j&&S,g=l!==void 0,b={status:y,fetchStatus:n.fetchStatus,isPending:j,isSuccess:y==="success",isError:C,isInitialLoading:c,isLoading:c,data:l,dataUpdatedAt:n.dataUpdatedAt,error:v,errorUpdatedAt:x,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>p.dataUpdateCount||n.errorUpdateCount>p.errorUpdateCount,isFetching:S,isRefetching:S&&!j,isLoadingError:C&&!g,isPaused:n.fetchStatus==="paused",isPlaceholderData:m,isRefetchError:C&&g,isStale:M(e,t),refetch:this.refetch,promise:this.#n,isEnabled:w(t.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const f=q=>{b.status==="error"?q.reject(b.error):b.data!==void 0&&q.resolve(b.data)},E=()=>{const q=this.#n=b.promise=_();f(q)},O=this.#n;switch(O.status){case"pending":e.queryHash===r.queryHash&&f(O);break;case"fulfilled":(b.status==="error"||b.data!==O.value)&&E();break;case"rejected":(b.status!=="error"||b.error!==O.reason)&&E();break}}return b}updateResult(){const e=this.#t,t=this.createResult(this.#e,this.options);if(this.#i=this.#e.state,this.#a=this.options,this.#i.data!==void 0&&(this.#p=this.#e),P(t,e))return;this.#t=t;const r=()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!this.#f.size)return!0;const h=new Set(i??this.#f);return this.options.throwOnError&&h.add("error"),Object.keys(this.#t).some(a=>{const p=a;return this.#t[p]!==e[p]&&h.has(p)})};this.#E({listeners:r()})}#C(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#E(e){D.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function je(e,t){return w(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function $(e,t){return je(e,t)||e.state.data!==void 0&&U(e,t,t.refetchOnMount)}function U(e,t,r){if(w(t.enabled,e)!==!1&&R(t.staleTime,e)!=="static"){const s=typeof r=="function"?r(e):r;return s==="always"||s!==!1&&M(e,t)}return!1}function K(e,t,r,s){return(e!==t||w(s.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&M(e,r)}function M(e,t){return w(t.enabled,e)!==!1&&e.isStaleByTime(R(t.staleTime,e))}function Re(e,t){return!P(e.getCurrentResult(),t)}var ke=class extends ae{#s;#e=void 0;#r;#t;constructor(e,t){super(),this.#s=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#s.defaultMutationOptions(e),P(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&L(t.mutationKey)!==L(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#a()}mutate(e,t){return this.#t=t,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){const e=this.#r?.state??xe();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){D.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#e.variables,r=this.#e.context,s={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#t.onSuccess?.(e.data,t,r,s),this.#t.onSettled?.(e.data,null,t,r,s)):e?.type==="error"&&(this.#t.onError?.(e.error,t,r,s),this.#t.onSettled?.(void 0,e.error,t,r,s))}this.listeners.forEach(t=>{t(this.#e)})})}},ne=d.createContext(!1),qe=()=>d.useContext(ne);ne.Provider;function Ie(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Te=d.createContext(Ie()),Pe=()=>d.useContext(Te),Ae=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},De=e=>{d.useEffect(()=>{e.clearReset()},[e])},Fe=({result:e,errorResetBoundary:t,throwOnError:r,query:s,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&s&&(i&&e.data===void 0||X(r,[e.error,s])),Ne=e=>{if(e.suspense){const t=s=>s==="static"?s:Math.max(s??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...s)=>t(r(...s)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Ue=(e,t)=>e.isLoading&&e.isFetching&&!t,Me=(e,t)=>e?.suspense&&t.isPending,J=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()}),H={};function Le(e,t,r){if(H.NODE_ENV!=="production"&&(typeof e!="object"||Array.isArray(e)))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const s=qe(),i=Pe(),h=A(),a=h.defaultQueryOptions(e);h.getDefaultOptions().queries?._experimental_beforeQuery?.(a),H.NODE_ENV!=="production"&&(a.queryFn||console.error(`[${a.queryHash}]: No queryFn was passed as an option, and no default queryFn was found. The queryFn parameter is only optional when using a default queryFn. More info here: https://tanstack.com/query/latest/docs/framework/react/guides/default-query-function`)),a._optimisticResults=s?"isRestoring":"optimistic",Ne(a),Ae(a,i),De(i);const p=!h.getQueryCache().get(a.queryHash),[u]=d.useState(()=>new t(h,a)),n=u.getOptimisticResult(a),m=!s&&e.subscribed!==!1;if(d.useSyncExternalStore(d.useCallback(l=>{const v=m?u.subscribe(D.batchCalls(l)):T;return u.updateResult(),v},[u,m]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),d.useEffect(()=>{u.setOptions(a)},[a,u]),Me(a,n))throw J(a,u,i);if(Fe({result:n,errorResetBoundary:i,throwOnError:a.throwOnError,query:h.getQueryCache().get(a.queryHash),suspense:a.suspense}))throw n.error;return h.getDefaultOptions().queries?._experimental_afterQuery?.(a,n),a.experimental_prefetchInRender&&!N&&Ue(n,s)&&(p?J(a,u,i):h.getQueryCache().get(a.queryHash)?.promise)?.catch(T).finally(()=>{u.updateResult()}),a.notifyOnChangeProps?n:u.trackResult(n)}function _e(e,t){return Le(e,Se)}function Be(e,t){const r=A(),[s]=d.useState(()=>new ke(r,e));d.useEffect(()=>{s.setOptions(e)},[s,e]);const i=d.useSyncExternalStore(d.useCallback(a=>s.subscribe(D.batchCalls(a)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),h=d.useCallback((a,p)=>{s.mutate(a,p).catch(T)},[s]);if(i.error&&X(s.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:h,mutateAsync:i.mutate}}const oe=e=>typeof e=="string"?e.includes("Failed to fetch")?"Could not reach endpoint. Possible causes could include network issues, incorrect URL, or server outages.":Qe(e):typeof e=="object"&&e?.message?(e?.code?`API: ${e.code}, `:"")+e?.message:"An error occurred",Qe=e=>{let t=e;try{t=JSON.parse(e),t?.message&&(t=(t?.code?`API: ${t.code}, `:"")+t?.message)}catch(r){return console.warn(r),e}return t},ce=(e,t)=>{let r;return function(...s){const i=this;clearTimeout(r),r=setTimeout(()=>e.apply(i,s),t)}},$e=async e=>{try{const t=await fetch(`${e}/silences`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});return{silences:await t.json()}}catch(t){throw console.error(t),t}},Ke=async e=>{try{const t=await fetch(`${e.endpoint}/silence/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok){const r=await t.json().catch(()=>null),s=r?.message||r||`Error ${t.status}: ${t.statusText}`;throw new Error(s)}return await t}catch(t){throw console.error(t),t}},Je=async e=>{try{const t=await fetch(`${e.endpoint}/silences`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e.silence)});if(!t.ok){const r=await t.json().catch(()=>null),s=r?.message||r||`Error ${t.status}: ${t.statusText}`;throw new Error(s)}return await t.json()}catch(t){throw console.error(t),t}},He={deleteSilences:Ke,createSilences:Je},he=(e,t={})=>{const r=Z(),s=He[e];if(!s)throw new Error(`No mutation function mapped for key: ${e}`);return Be({mutationFn:i=>s({...i,endpoint:r}),onError:t?.onError,...t})},tt=e=>{const{addMessage:t}=Y(),r=e.silence,[s,i]=d.useState(!1),h=A(),a=ee(),{setSilences:p}=te(),{mutate:u}=he("deleteSilences",{onSuccess:m=>{h.cancelQueries({queryKey:["silences"]});const l=a.filter(y=>y.id===m.id);let v=l.length>0?l[0]:null;v={...v,status:{state:se.SILENCE_EXPIRED}};const x=[...a.filter(y=>y?.id!==m?.id),v];p({items:x}),t({variant:"success",text:"Silence expired successfully. Please note that it may take up to 5 minutes for the silence to show up as expired."})},onError:m=>{t({variant:"error",text:oe(m)})},onSettled:()=>{h.invalidateQueries({queryKey:["silences"]})}}),n=ce(()=>{u({id:r.id}),i(!1)},200);return o.jsxs(o.Fragment,{children:[o.jsx(re,{onClick:()=>i(!0),children:"Expire"}),s&&o.jsxs(ie,{cancelButtonLabel:"Cancel",confirmButtonLabel:"Expire Silence",onCancel:()=>i(!1),onConfirm:n,open:!0,title:"Confirmation needed",children:[o.jsxs("p",{children:["Do you really want to expire the silence ",o.jsx("b",{children:r.id}),"?"]}),o.jsxs("p",{children:["Comment for the silence: ",o.jsx("b",{children:r?.comment})]})]})]})},V=[{label:"2 hours",value:2},{label:"12 hours",value:12},{label:"1 day",value:24},{label:"3 days",value:72},{label:"7 days",value:168}],st=e=>{if(e?.length>0)return e.sort((t,r)=>new Date(r.endsAt).getTime()-new Date(t.endsAt).getTime())[0].endsAt},Ve=e=>{if(!e)return{items:V};const t=new Date,r=(new Date(e).getTime()-t.getTime())/(1e3*60*60),s=V.map(h=>h.value<=r?{...h,label:h.label+" (covered with the existing silence)",covered:!0}:h),i=s.find(h=>!h?.covered);return{items:s,firstNotCovered:i}},rt=(e,t=[],r=[])=>{if(!e||!t)return;const s=[];return Object.keys(e).forEach(i=>{const h=e?.[i];if(h){const a={name:i,value:h,isRegex:!1,excluded:!1,configurable:!1};r.includes(i)||(t.includes(i)?s.push({...a,excluded:!0,configurable:!0}):s.push(a))}}),s},ze=e=>{const t={};return e?.comment?.length<3&&(t.comment||(t.comment=[]),t.comment.push("Please enter at least 3 characters")),e?.createdBy?.length<1&&(t.createdBy||(t.createdBy=[]),t.createdBy.push("Please enter a name")),t},z=e=>e.map((t,r)=>o.jsx("span",{className:"block text-theme-danger ",children:t},r)),G={duration:2,comment:""},it=e=>{const t=e.silence,{addMessage:r}=Y(),s=de(),i=ee(),{setSilences:h}=te(),a=A(),[p,u]=d.useState(!1),[n,m]=d.useState(G),[l,v]=d.useState({}),[x,y]=d.useState(null);d.useLayoutEffect(()=>{p&&(m({...n,...G,createdBy:s||"",matchers:t.matchers,comment:t.comment}),y(null),v({}))},[p]);const k=d.useMemo(()=>{const c=Ve(0);return c.firstNotCovered&&m({...n,duration:c.firstNotCovered.value}),c.items},[]),{mutate:S}=he("createSilences",{onMutate:c=>{a.cancelQueries({queryKey:["silences"]});const g={...c.silence,status:{state:se.SILENCE_ACTIVE}},b=[...i,g];h({items:b}),u(!1)},onSuccess:c=>{r({variant:"success",text:`A silence object with id ${c?.silenceID} was created successfully. Please note that it may
            take up to 5 minutes for the alert to show up as silenced.`})},onError:c=>{r({variant:"error",text:oe(c)})},onSettled:()=>{a.invalidateQueries({queryKey:["silences"]})}}),j=ce(()=>{y(null);const c=ze(n);if(v(c),Object.keys(c).length>0)return;const g={...n},b=new Date,f=new Date;f.setHours(f.getHours()+Number.parseInt(g.duration||4));const E={...g,startsAt:b.toISOString(),endsAt:f.toISOString()};S({silence:E})},200),C=({key:c,value:g})=>{g&&m({...n,[c]:g})};return o.jsxs(o.Fragment,{children:[o.jsx(re,{onClick:c=>{c.stopPropagation(),u(!p)},children:"Recreate"}),p&&o.jsxs(ie,{title:"New Silence for",size:"large",open:!0,confirmButtonLabel:"Save",onCancel:()=>u(!1),onConfirm:j,children:[x&&o.jsx(pe,{text:x,variant:"danger"}),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"advanced-area overflow-hidden",children:[o.jsx("p",{className:"mt-2",children:"Matchers attached to this silence"}),o.jsx(fe,{gap:"2",alignment:"start",wrap:!0,className:"mt-2",children:n?.matchers&&Object.keys(n?.matchers).map((c,g)=>o.jsx(me,{pillKey:t?.matchers[c]?.name,pillKeyLabel:t?.matchers[c]?.name,pillValue:t?.matchers[c]?.value,pillValueLabel:t?.matchers[c]?.value},g))})]}),o.jsxs(ye,{className:"mt-6",children:[o.jsx(F,{children:o.jsx(be,{required:!0,label:"Silenced by",value:n.createdBy,disabled:!!s,onChange:c=>C({key:"createdBy",value:c.target.value}),errortext:l.createdBy&&z(l.createdBy)})}),o.jsx(F,{children:o.jsx(ge,{className:"h-20",label:"Description",value:n.comment,onChange:c=>C({key:"comment",value:c.target.value}),errortext:l.comment&&z(l.comment),required:!0})}),o.jsx(F,{children:o.jsx(ve,{required:!0,label:"Duration",value:n.duration,onChange:c=>C({key:"duration",value:c}),children:k?.map(c=>o.jsx(we,{label:c.label,value:String(c.value)},c.value))})})]})]})]})]})};let W;const Ge=async e=>{try{const t=await fetch(`${e}/alerts`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});const r=await t.json(),s=le(r);s.forEach(h=>{h.labels&&(h.labels.status=h.status?.state)});const i=JSON.stringify(s);return W!==i?(W=i,{alerts:s,counts:ue(s)}):null}catch(t){throw console.error(t),t}},We={alerts:Ge,silences:$e};class Ze extends Error{constructor(t){super(t.message),this.name="CorsNetworkError",t.stack&&(this.stack=t.stack)}}function Xe(e){if(!(e instanceof TypeError))return!1;const t=e.message||"";return!!(navigator.userAgent.includes("Firefox")&&t.includes("NetworkError"))}const at=(e,{options:t}={})=>{const r=Z(),s=We[e];if(!s)throw new Error(`No fetch function mapped for key: ${e}`);return _e({queryKey:[e],queryFn:()=>s(r).catch(i=>{throw Xe(i)?new Ze(i):i}),...t})},nt=()=>o.jsxs("p",{children:["Firefox detected. Please ensure that you have activated ",o.jsx("b",{children:"allow_client_cert"})," to enable the retrieval of alerts and silences from the API.",o.jsxs("ul",{children:[o.jsx("li",{children:"1. Go to about:config (via address bar)"}),o.jsxs("li",{children:["2. Change ",o.jsx("b",{children:"network.cors_preflight.allow_client_cert"})," to ",o.jsx("b",{children:"true"})]}),o.jsx("li",{children:"3. Reload Greenhouse"})]})]});export{Ve as G,Ze as Z,it as a,nt as c,he as h,rt as i,oe as l,st as n,at as o,tt as r,ce as u};
