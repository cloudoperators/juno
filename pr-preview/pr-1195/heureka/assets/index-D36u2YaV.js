import{j as e,n as b,l as m,V as p,d as g,u as f,a as k,g as x,m as v,p as E,f as y,b as L,c as F,Z as P,t as h,e as w,h as I,o as R,i as V,s as j,S as z,k as M,q as $,r as G}from"./App-B9v5QdSZ.js";import{a as t}from"./index-CR5Sx1hp.js";import{u as U,g as D,i as q,E as S,a as T,C as A,I as B}from"./IssueCountsPerSeverityLevel-bvoqr0D1.js";import{I as _}from"./IssueTimestamp-rgZAPPWW.js";import{F as O}from"./index-Dpgh-Doy.js";const Z=s=>`
    border-l-2
    ${D(s.toLowerCase()||"none")}
    h-full
    pl-5
  `,H=s=>{const n=(s||"none").toLowerCase(),r=D(n||"none");return e.jsx(g,{icon:q[n]||"help",color:r})},W=({vulnerability:s,selected:n,onItemClick:r})=>{const[i,l]=t.useState(!1),{needsExpansion:a,textRef:c}=U(s.description),o=u=>{u.preventDefault(),u.stopPropagation(),l(!i)};return e.jsxs(b,{className:`cursor-pointer ${n?"active":""}`,onClick:r,children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:Z(s.severity),children:H(s.severity)})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx(_,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:c,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&a&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},X=({vulnerabilitiesPromise:s})=>{const n=f(),{vulnerability:r}=k({from:"/vulnerabilities/"}),{error:i,data:l}=t.use(s),{vulnerabilities:a}=x(l),c=t.useCallback(o=>{n({to:"/vulnerabilities",search:u=>({...u,vulnerability:o.name})})},[n]);return i?e.jsxs(S,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):a.length===0?e.jsx(S,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):a.map(o=>e.jsx(W,{vulnerability:o,selected:o.name===r,onItemClick:()=>c(o)},o.name))},J=({vulnerabilityName:s,vulnerabilitiesPromise:n,onServiceClick:r})=>{const i=f(),l=d=>{r?r(d):i({to:"/services/$service",params:{service:d}})},{data:a}=t.use(n),{vulnerabilities:c}=x(a),o=c.find(d=>d.name===s);if(!o)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",s]});const u=o.services||[];return u.length===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx("div",{className:"mb-4",children:e.jsx(t.Suspense,{fallback:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(v,{variant:"primary"})]}),children:e.jsx(p,{gap:"4",direction:"horizontal",wrap:!0,children:u.map((d,N)=>e.jsx("a",{href:"#",onClick:C=>{C.preventDefault(),l(d.ccrn)},className:"link-hover",children:d.ccrn},N))})})})},K=({vulnerabilitiesPromise:s,vulnerabilityName:n})=>{const{data:r}=t.use(s),{vulnerabilities:i}=x(r),l=i.find(a=>a.name===n);return l?e.jsx(p,{gap:"1",direction:"horizontal",wrap:!0,children:e.jsx(t.Suspense,{fallback:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(v,{variant:"primary"})]}),children:l.supportGroups?.map(a=>e.jsx(E,{pillValue:a,pillValueLabel:a},a))})}):null},Q=({vulnerabilitiesPromise:s,vulnerabilityName:n})=>{const{data:r}=t.use(s),{vulnerabilities:i}=x(r),l=i.find(c=>c.name===n),{servicesCount:a}=l||{servicesCount:0};return a},Y=()=>{const s=f(),{queryClient:n,apiClient:r}=T({from:"/vulnerabilities/"}),{vulnerability:i}=k({from:"/vulnerabilities/"}),[l]=t.useState(void 0),a=t.useMemo(()=>{if(i)return y({queryClient:n,apiClient:r,filterSettings:{selectedFilters:[{name:"name",value:i}]}})},[i,n,r]),c=t.useMemo(()=>{if(i)return y({queryClient:n,apiClient:r,filterSettings:{selectedFilters:[{name:"name",value:i}]},afterServices:l})},[i,l,n,r]),o=t.useCallback(()=>{s({to:"/vulnerabilities",search:d=>{const{vulnerability:N,...C}=d;return{...C}}})},[s]),u=t.useCallback(d=>{s({to:"/services/$service",params:{service:d}})},[s]);return e.jsx(L,{heading:i?`${i} Overview`:void 0,opened:!!i,onClose:o,size:"large",children:e.jsx(F,{children:i&&a&&c&&e.jsx(t.Suspense,{children:e.jsxs(P,{columns:2,gridColumnTemplate:"15% auto",minContentColumns:[1],className:"mb-6",children:[e.jsxs(b,{children:[e.jsx(h,{className:"whitespace-nowrap",children:"Support Groups"}),e.jsx(m,{children:e.jsx(K,{vulnerabilitiesPromise:a,vulnerabilityName:i})})]}),e.jsxs(b,{children:[e.jsxs(h,{className:"whitespace-nowrap",children:["Services (",e.jsx(t.Suspense,{children:e.jsx(Q,{vulnerabilitiesPromise:a,vulnerabilityName:i})}),")"]}),e.jsx(m,{children:e.jsx(J,{vulnerabilityName:i,vulnerabilitiesPromise:c,onServiceClick:u})})]})]})})})})},ee=()=>{const{queryClient:s,apiClient:n}=T({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:r,filterSettings:i}=w({from:"/vulnerabilities/"}),[l,a]=t.useState(r),c=t.useCallback(o=>{const u=y({queryClient:s,apiClient:n,filterSettings:i,after:o});a(u)},[a,s,n,i]);return t.useEffect(()=>{a(r)},[a,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(P,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(b,{children:[e.jsx(h,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(h,{children:"Vulnerability"}),e.jsx(h,{children:"Services"}),e.jsx(h,{children:"Target Date"}),e.jsx(h,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(S,{colSpan:5,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(v,{variant:"primary"})]})}),children:e.jsx(X,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(A,{dataPromise:l,goToPage:c,dataNormalizationMethod:x})}),e.jsx(Y,{})]})},se=()=>{const s=f(),{filters:n,filterSettings:r}=w({from:"/vulnerabilities/"}),i=t.useCallback(l=>{s({to:"/vulnerabilities",search:{...I(l)}})},[r,s]);return e.jsx(O,{filters:n,filterSettings:r,onFilterChange:i,searchInputPlaceholder:"search term for vulnerabilities name"})},ie=({vulnerabilitiesPromise:s})=>{const{error:n,data:r}=t.use(s),{vulnerabilitiesCounts:i}=x(r);return e.jsx(p,{gap:"1",children:n?e.jsx("div",{className:"font-bold",children:"All vulnerabilities: --"}):e.jsx(B,{counts:i})})},ne=()=>{const{vulnerabilitiesPromise:s}=w({from:"/vulnerabilities/"});return e.jsx(p,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(t.Suspense,{fallback:e.jsx(v,{size:"small"}),children:e.jsx(ie,{vulnerabilitiesPromise:s})})})},re=()=>e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsxs(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(v,{size:"small"})}),children:[e.jsx(ne,{}),e.jsx(ee,{})]})]});R({vulnerability:j().optional(),searchTerm:V(s=>typeof s=="number"?s.toString():s,j().optional())}).catchall(V((s,n)=>{if(!(n.path.length>0&&typeof n.path[0]=="string"&&!n.path[0].startsWith(z)))return s},M([j(),$(j()),G()])));const ue=re;export{ue as component};
