import{j as e,r as g,u as f,b as C,h as z,M as p,f as Z,e as $,d as y,A as v,g as b,c as I,U as D,G as A,a as F,F as E,C as L,E as q,l as S,N as G,H as K,P as H,X as M,y as P,x as d,z as m,S as O}from"./App-D0nRkdx3-CJLqNrnM.js";import{w as n,G as X}from"./index-C6RJDc66.js";import{T,p as j,q as _,_ as U,K as W,G as B,i as x}from"./IssueCountsPerSeverityLevel-Bu7fRuNk-ZE6x0Gc-.js";import"./index-CXQPSgXN.js";const J=a=>a.charAt(0).toUpperCase()+a.slice(1),Q=()=>{const a=f(),{queryClient:s,apiClient:r}=T({from:"/services/"}),{service:t}=F({from:"/services/"}),[c,l]=X.useState(void 0),o=t?W({queryClient:s,apiClient:r,service:t,after:c}):void 0,h=n.useCallback(()=>{a({to:"/services",search:u=>{const{service:oe,...V}=u;return{...V}}})},[a]),i=n.useCallback(u=>{t&&a({to:"/services/$service",params:{service:t},search:{imageVersion:u?.version}})},[a,t]);return e.jsx(E,{children:e.jsx(L,{heading:t?`${J(t)} Overview`:void 0,opened:!!t,onClose:h,size:"large",children:e.jsx(q,{children:t&&o&&e.jsx(B,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:i,goToPage:l})})})})},N={supportGroups:"support_group",region:"region",integrity:"integrity"},Y=({serviceDetails:a})=>{const s=(r,t)=>e.jsx(P,{pillKey:r,pillKeyLabel:r,pillValue:t,pillValueLabel:t},t);return e.jsx(p,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(a).map(([r,t])=>Array.isArray(t)?t.map(c=>s(N[r],c)):s(N[r],t))})},R=({item:a,selected:s,onItemClick:r,onServiceDetailClick:t})=>e.jsxs(y,{className:`cursor-pointer ${s?"active":""}`,onClick:r,children:[e.jsx(d,{children:a.name}),e.jsx(d,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:a.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:a.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:a.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:a.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(d,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:a.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(d,{children:e.jsx(Y,{serviceDetails:a.serviceDetails})}),e.jsx(d,{className:"cursor-default interactive",onClick:c=>c.stopPropagation(),children:e.jsx(D,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),k=8,ee=({servicesPromise:a})=>{const s=f(),{service:r}=F({from:"/services/"}),{error:t,data:c}=n.use(a),{services:l}=b(c),o=n.useCallback(i=>{s({to:"/services",search:u=>({...u,service:i.name})})},[]),h=n.useCallback(i=>{s({to:"/services/$service",params:{service:i.name}})},[]);return t?e.jsx(j,{colSpan:k,children:"Error loading services"}):l.length===0?e.jsx(j,{colSpan:k,children:"No service found"}):l.map(i=>e.jsx(R,{item:i,selected:i.name===r,onItemClick:()=>o(i),onServiceDetailClick:()=>h(i)},i.id))},w=8,se=()=>{const{queryClient:a,apiClient:s}=T({from:"/services/"}),{servicesPromise:r,filterSettings:t}=C({from:"/services/"}),[c,l]=n.useState(r),o=n.useCallback(h=>{const i=Z({queryClient:a,apiClient:s,filterSettings:t,after:h});l(i)},[l,a,s,t]);return n.useEffect(()=>{l(r)},[l,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:w,children:[e.jsxs(y,{children:[e.jsx(v,{children:"Service"}),e.jsx(v,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(v,{children:"Details"}),e.jsx(v,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(j,{colSpan:w,children:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(ee,{servicesPromise:c})})]}),e.jsx(n.Suspense,{children:e.jsx(_,{dataPromise:c,goToPage:o,dataNormalizationMethod:b})}),e.jsx(Q,{})]})},re=({servicesPromise:a})=>{const{error:s,data:r}=n.use(a),{servicesIssuesCount:t}=b(r);return e.jsx(p,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(U,{counts:t})})},ae=()=>{const{servicesPromise:a}=C({from:"/services/"});return e.jsx(p,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(g,{size:"small"}),children:e.jsx(re,{servicesPromise:a})})})},te=({filters:a,onChange:s})=>{const[r,t]=n.useState(""),[c,l]=n.useState(""),o=a.find(i=>i.filterName===r)?.values?.filter(i=>i),h=n.useCallback(i=>{l(i),!S.isEmpty(r)&&!S.isEmpty(i)&&s({name:r,value:i}),setTimeout(()=>{l("")},0)},[r,l,s]);return e.jsx(p,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(G,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:r,onChange:i=>{t(String(i))},children:a?.map(({displayName:i,filterName:u})=>e.jsx(K,{value:u,label:i,"data-testid":u},u))}),e.jsx(H,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,disabled:!r,onChange:h,children:o?.map(i=>e.jsx(M,{value:i,label:i,"data-testid":i},i))})]})})},ie=({selectedFilters:a,onDelete:s})=>e.jsx(p,{gap:"2",wrap:!0,children:a?.map(r=>e.jsx(P,{closeable:!0,pillKey:r.name,pillValue:r.value,onClose:()=>s(r)},`${name}:${r.value}`))}),le=({filters:a,filterSettings:s,onFilterChange:r,searchInputPlaceholder:t})=>{const c=n.useCallback(l=>{r({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===l.name&&o.value===l.value))})},[s,r]);return e.jsxs(p,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(te,{filters:a,onChange:l=>{s.selectedFilters?.some(o=>o.name===l.name&&o.value===l.value)||r({...s,selectedFilters:[...s.selectedFilters||[],l]})}}),e.jsx(D,{label:"Clear all",className:"ml-4",onClick:()=>r({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(A,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:l=>{r({...s,searchTerm:l})},onClear:()=>r({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(ie,{selectedFilters:s.selectedFilters,onDelete:c})]})},ne=()=>{const a=f(),{filters:s,filterSettings:r}=C({from:"/services/"}),t=n.useCallback(c=>{a({to:"/services",search:{...z(c)}})},[r,a]);return e.jsx(le,{filters:s,filterSettings:r,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},ce=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:[e.jsx(ae,{}),e.jsx(se,{})]})]});m.object({service:m.string().optional(),searchTerm:m.string().optional()}).catchall(m.preprocess((a,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(O)))return a},m.union([m.string(),m.array(m.string()),m.undefined()])));const pe=ce;export{pe as component};
