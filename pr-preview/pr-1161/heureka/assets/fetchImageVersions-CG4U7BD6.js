import{j as e,H as I,M as p,S as v,B as r,K as h,g as S,R as w,Q as D,C as b,U as d,y as V,A as x,T as C,W as k,X as B}from"./App-CTodUKzm.js";import{a as o}from"./index-l1TArCPn.js";import{S as u,E as j,C as R}from"./IssueCountsPerSeverityLevel-BrwGznf7.js";const E=({children:s})=>e.jsx(I,{className:"my-6",children:s}),O=({imageVersionsPromise:s})=>{const{data:t}=o.use(s),{totalImageVersions:n}=p(t);return n},U=({version:s,selected:t=!1,displayDetailsButton:n=!0,onItemClick:i,onDetailClick:a})=>e.jsxs(v,{onClick:i,className:`cursor-pointer ${t?"active":""}`,children:[e.jsx(r,{className:"service-image-versions-cell",children:e.jsxs(h,{gap:"1",direction:"vertical",children:[e.jsxs(h,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(h,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:c=>c.stopPropagation(),children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(S,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(r,{className:"service-image-versions-cell",children:s.tag}),e.jsx(r,{className:"items-center",children:e.jsx("span",{children:s.componentInstancesCount||0})}),e.jsx(r,{className:"items-center",children:e.jsx(u,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"severityCritical",color:"text-theme-severity-critical",variant:"danger",tooltipContent:"Critical Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(u,{showDashIfZero:!0,count:s.issueCounts.high,icon:"severityHigh",color:"text-theme-severity-high",variant:"warning",tooltipContent:"High Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(u,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"severityMedium",color:"text-theme-severity-medium",variant:"warning",tooltipContent:"Medium Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(u,{showDashIfZero:!0,count:s.issueCounts.low,icon:"severityLow",color:"text-theme-severity-low",variant:"info",tooltipContent:"Low Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(u,{showDashIfZero:!0,count:s.issueCounts.none,icon:"severityUnknown",color:"text-theme-severity-unknown",variant:"default",tooltipContent:"None Vulnerabilities"})}),n&&e.jsx(r,{children:e.jsx(w,{size:"small",label:"Show Details",onClick:a})})]}),z=({columnSpan:s,selectedImageVersion:t,displayDetailsButton:n,imageVersionsPromise:i,onDetailsButtonClick:a,onImageVersionItemClick:c})=>{const{error:l,data:f}=o.use(i),{imageVersions:g}=p(f);return l?e.jsx(j,{colSpan:s,children:"Error loading image versions."}):g.length===0?e.jsx(j,{colSpan:s,children:"No image version found"}):g.map(m=>e.jsx(U,{version:m,selected:m.version===t,displayDetailsButton:n,onItemClick:()=>{c?.(m)},onDetailClick:N=>{N.stopPropagation(),a?.(m)}},m.version))},y=9,T=({imageVersionsPromise:s,selectedImageVersion:t,displayActions:n=!1,onImageVersionItemClick:i,onDetailsButtonClick:a,goToPage:c})=>{const l=n?y:y-1;return e.jsxs(o.Suspense,{children:[e.jsxs(E,{children:["Image Versions",e.jsxs(o.Suspense,{children:["(",e.jsx(O,{imageVersionsPromise:s}),")"]})]}),n&&e.jsx(D,{children:e.jsx(w,{size:"small",onClick:()=>a?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(b,{columns:l,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(v,{children:[e.jsx(d,{children:"Image Repository"}),e.jsx(d,{children:"Tag"}),e.jsx(d,{children:"Occurrences"}),e.jsx(d,{colSpan:5,children:"Vulnerability Counts"}),n&&e.jsx(d,{})]}),e.jsx(o.Suspense,{fallback:e.jsx(j,{colSpan:l,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(V,{variant:"primary"})]})}),children:e.jsx(z,{columnSpan:l,displayDetailsButton:n,imageVersionsPromise:s,selectedImageVersion:t,onDetailsButtonClick:a,onImageVersionItemClick:i})})]})}),e.jsx(o.Suspense,{children:e.jsx(R,{dataNormalizationMethod:p,dataPromise:s,goToPage:c})})]})},Z=({queryClient:s,apiClient:t,service:n,after:i})=>s.ensureQueryData({queryKey:["imageVersions",n,i],queryFn:()=>t.query({query:B,variables:{filter:{serviceCcrn:[n]},filterCi:{serviceCcrn:[n]},filterIc:{serviceCcrn:[n]},orderBy:[{by:k.Severity,direction:x.Desc}],orderByCi:[{by:C.Cluster,direction:x.Asc},{by:C.Namespace,direction:x.Asc}],after:i}})});export{T as S,E as a,Z as f};
