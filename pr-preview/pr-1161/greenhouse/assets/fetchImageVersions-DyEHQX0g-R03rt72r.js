import{A as x,T as v,W as N,X as w,j as e,Q as D,R as y,C as k,S as I,U as d,K as u,y as S,M as j,H as b,B as r,g as B}from"./App-5QZ6Tqma-UVZWEVq6.js";import{w as a}from"./_extensionId._-DPzBSSPm.js";import{N as g,P,o as h}from"./IssueCountsPerSeverityLevel-y8q_NwLn-DajY6OPu.js";const Z=({children:s})=>e.jsx(b,{className:"my-6",children:s}),q=({imageVersionsPromise:s})=>{const{data:n}=a.use(s),{totalImageVersions:i}=j(n);return i},z=({version:s,selected:n=!1,displayDetailsButton:i=!0,onItemClick:t,onDetailClick:o})=>e.jsxs(I,{onClick:t,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(r,{className:"service-image-versions-cell",children:e.jsxs(u,{gap:"1",direction:"vertical",children:[e.jsxs(u,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(u,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:l=>l.stopPropagation(),children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(B,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(r,{className:"service-image-versions-cell",children:s.tag}),e.jsx(r,{className:"items-center",children:e.jsx("span",{children:s.componentInstancesCount||0})}),e.jsx(r,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"severityCritical",color:"text-theme-severity-critical",variant:"danger",tooltipContent:"Critical Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issueCounts.high,icon:"severityHigh",color:"text-theme-severity-high",variant:"warning",tooltipContent:"High Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"severityMedium",color:"text-theme-severity-medium",variant:"warning",tooltipContent:"Medium Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issueCounts.low,icon:"severityLow",color:"text-theme-severity-low",variant:"info",tooltipContent:"Low Vulnerabilities"})}),e.jsx(r,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:s.issueCounts.none,icon:"severityUnknown",color:"text-theme-severity-unknown",variant:"default",tooltipContent:"None Vulnerabilities"})}),i&&e.jsx(r,{children:e.jsx(y,{size:"small",label:"Show Details",onClick:o})})]}),M=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:i,imageVersionsPromise:t,onDetailsButtonClick:o,onImageVersionItemClick:l})=>{const{error:c,data:f}=a.use(t),{imageVersions:p}=j(f);return c?e.jsx(g,{colSpan:s,children:"Error loading image versions."}):p.length===0?e.jsx(g,{colSpan:s,children:"No image version found"}):p.map(m=>e.jsx(z,{version:m,selected:m.version===n,displayDetailsButton:i,onItemClick:()=>{l?.(m)},onDetailClick:V=>{V.stopPropagation(),o?.(m)}},m.version))},C=9,E=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:i=!1,onImageVersionItemClick:t,onDetailsButtonClick:o,goToPage:l})=>{const c=i?C:C-1;return e.jsxs(a.Suspense,{children:[e.jsxs(Z,{children:["Image Versions",e.jsxs(a.Suspense,{children:["(",e.jsx(q,{imageVersionsPromise:s}),")"]})]}),i&&e.jsx(D,{children:e.jsx(y,{size:"small",onClick:()=>o?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(k,{columns:c,minContentColumns:[2,3,4,5,6,7],children:[e.jsxs(I,{children:[e.jsx(d,{children:"Image Repository"}),e.jsx(d,{children:"Tag"}),e.jsx(d,{children:"Occurrences"}),e.jsx(d,{colSpan:5,children:"Vulnerability Counts"}),i&&e.jsx(d,{})]}),e.jsx(a.Suspense,{fallback:e.jsx(g,{colSpan:c,children:e.jsxs(u,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]})}),children:e.jsx(M,{columnSpan:c,displayDetailsButton:i,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:o,onImageVersionItemClick:t})})]})}),e.jsx(a.Suspense,{children:e.jsx(P,{dataNormalizationMethod:j,dataPromise:s,goToPage:l})})]})},H=({queryClient:s,apiClient:n,service:i,after:t})=>s.ensureQueryData({queryKey:["imageVersions",i,t],queryFn:()=>n.query({query:w,variables:{filter:{serviceCcrn:[i]},filterCi:{serviceCcrn:[i]},filterIc:{serviceCcrn:[i]},orderBy:[{by:N.Severity,direction:x.Desc}],orderByCi:[{by:v.Cluster,direction:x.Asc},{by:v.Namespace,direction:x.Asc}],after:t}})});export{Z as E,E as T,H as Z};
