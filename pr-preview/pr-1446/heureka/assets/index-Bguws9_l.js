import{a as j,b as C,y as L,j as e,k as I,p as T,E as d,o as N,c as u,Y as R,V as f,f as A,z as S,l as y,A as V,P as O,n as h,m as z,B as k,S as D,C as M,D as U,r as _,s as x,t as $,v as B,w as K}from"./App-DF6s0DME.js";import{r as n}from"./index-CIqucCPB.js";import{u as P,S as m,E as b,g as q,L as G,C as W,I as Y}from"./IssueCountsPerSeverityLevel-B0hJoiDS.js";import{S as H}from"./index-Dz9Eh7fT.js";import{F as X}from"./index-Daxe8GZ5.js";import"./SectionContentHeading-B07e7atI.js";const J=s=>s.charAt(0).toUpperCase()+s.slice(1),Q=()=>{const s=j(),{queryClient:i,apiClient:t}=P({from:"/services/"}),{service:r}=C({from:"/services/"}),[a,l]=n.useState(void 0),c=n.useMemo(()=>{if(r)return L({queryClient:i,apiClient:t,filter:{service:[r]},after:a})},[r,a,i,t]),p=n.useCallback(()=>{s({to:"/services",search:v=>{const{service:ce,...E}=v;return{...E}}})},[s]),o=n.useCallback(v=>{r&&s(v?{to:"/services/$service/images/$image",params:{service:r,image:v.repository}}:{to:"/services/$service",params:{service:r}})},[s,r]);return e.jsx(I,{heading:r?`${J(r)} Overview`:void 0,opened:!!r,onClose:p,size:"large",children:e.jsx(T,{children:e.jsx(d,{displayErrorMessage:!0,children:r&&c&&e.jsx(H,{displayActions:!0,imagesPromise:c,onDetailsButtonClick:o,goToPage:l})})})})},w={supportGroups:"support_group",region:"region",integrity:"integrity"},Z=({serviceDetails:s})=>{const i=(t,r)=>e.jsx(A,{pillKey:t,pillKeyLabel:t,pillValue:r,pillValueLabel:r},r);return e.jsx(f,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([t,r])=>Array.isArray(r)?r.map(a=>i(w[t],a)):i(w[t],r))})},ee=({item:s,selected:i,onItemClick:t,onServiceDetailClick:r})=>e.jsxs(N,{className:"cursor-pointer",isSelected:i,onClick:t,children:[e.jsx(u,{children:s.name}),e.jsx(u,{className:"!px-2",children:e.jsx(m,{severity:"critical",count:s.issuesCount.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(u,{className:"!px-2",children:e.jsx(m,{severity:"high",count:s.issuesCount.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(u,{className:"!px-2",children:e.jsx(m,{severity:"medium",count:s.issuesCount.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(u,{className:"!px-2",children:e.jsx(m,{severity:"low",count:s.issuesCount.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(u,{className:"!px-2",children:e.jsx(m,{severity:"unknown",count:s.issuesCount.none,tooltipContent:"None Vulnerabilities"})}),e.jsx(u,{children:e.jsx(Z,{serviceDetails:s.serviceDetails})}),e.jsx(u,{className:"cursor-default interactive",onClick:a=>a.stopPropagation(),children:e.jsx(R,{label:"Show Details",onClick:r,size:"small",className:"whitespace-nowrap"})})]}),F=8,se=({servicesPromise:s})=>{const i=j(),{service:t}=C({from:"/services/"}),{error:r,data:a}=n.use(s),{services:l}=S(a),c=n.useCallback(o=>{i({to:"/services",search:v=>({...v,service:o.name})})},[]),p=n.useCallback(o=>{i({to:"/services/$service",params:{service:o.name}})},[]);return r?e.jsx(b,{colSpan:F,children:"Error loading services"}):l.length===0?e.jsx(b,{colSpan:F,children:"No service found"}):l.map(o=>e.jsx(ee,{item:o,selected:o.name===t,onItemClick:()=>c(o),onServiceDetailClick:()=>p(o)},o.id))},g=8,re=()=>{const{queryClient:s,apiClient:i}=P({from:"/services/"}),{servicesPromise:t,filterSettings:r}=y({from:"/services/"}),[a,l]=n.useState(t),c=n.useCallback(p=>{const o=V({queryClient:s,apiClient:i,filterSettings:r,after:p});l(o)},[l,s,i,r]);return n.useEffect(()=>{l(t)},[l,t]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(O,{minContentColumns:[1,2,3,4,5,7],columns:g,children:[e.jsxs(N,{children:[e.jsx(h,{children:"Service"}),e.jsx(h,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(h,{children:"Details"}),e.jsx(h,{})]}),e.jsx(d,{displayErrorMessage:!0,fallbackRender:q({colspan:g}),resetKeys:[a],children:e.jsx(n.Suspense,{fallback:e.jsx(G,{colSpan:g}),children:e.jsx(se,{servicesPromise:a})})})]}),e.jsx(d,{children:e.jsx(n.Suspense,{children:e.jsx(W,{dataPromise:a,goToPage:c,dataNormalizationMethod:S})})}),e.jsx(Q,{})]})},te=({servicesPromise:s})=>{const{error:i,data:t}=n.use(s),{servicesIssuesCount:r}=S(t);return e.jsx(f,{gap:"1",children:i?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(Y,{counts:r})})},ie=()=>{const{servicesPromise:s}=y({from:"/services/"});return e.jsx(d,{children:e.jsx(f,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(z,{size:"small"}),children:e.jsx(te,{servicesPromise:s})})})})},ae=()=>{const s=j(),{filtersPromise:i,filterSettings:t}=y({from:"/services/"}),r=n.useCallback(a=>{s({to:"/services",search:l=>{const c=k(a);return{...Object.fromEntries(Object.entries(l).filter(([o])=>!o.startsWith(D))),...c}}})},[s]);return e.jsx(X,{filtersPromise:i,filterSettings:t,onFilterChange:r,searchInputPlaceholder:"search term for services name"})},ne=()=>e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsxs(d,{children:[e.jsx(ie,{}),e.jsx(re,{})]})]}),oe=_([x(),$(x()),B()]);K({service:x().optional(),searchTerm:x().optional()}).catchall(oe);function he(){const s=j(),{appProps:i}=P({from:"/services/"}),t=C({from:"/services/"}),{hasAppliedInitialFilters:r,markInitialFiltersApplied:a}=M();return n.useLayoutEffect(()=>{if(r)return;if(!Object.keys(t).some(c=>c.startsWith(D))&&i?.initialFilters?.support_group?.length){const c=U(i.initialFilters);c.length>0&&(s({to:"/services",search:k({searchTerm:"",selectedFilters:c}),replace:!0}),a())}},[s,i,r,a,t]),e.jsx(ne,{})}export{he as component};
