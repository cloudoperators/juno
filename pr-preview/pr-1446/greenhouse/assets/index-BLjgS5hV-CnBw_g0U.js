import{a as v,b as g,C as F,j as e,S as N,D as A,B as w,E as h,l as C,V as y,m as q,A as O,P as z,o as D,n as x,z as b,y as I,k as L,p as M,c as m,Y as T,f as $,r as K,s as j,t as Q,v as W,w as G}from"./App-CqATQXMd-DyLlMiQC.js";import{G as n}from"./_extensionId._-CzV2jCo4.js";import{R as k,D as R,L as B,S as H,M as J,d as S,i as d}from"./IssueCountsPerSeverityLevel-DPj33mSF-B9ebVUZc.js";import{O as U}from"./index-B6Lj_-mW-BhfOJEoV.js";import{K as Z}from"./index-tfbbcljd-melnp5zy.js";import"./index-CbREhYRW.js";import"./Shell-DhkRjDTY.js";import"./index-D97tSSdg.js";import"./SectionContentHeading-C42ZyXk_-DZbkEavN.js";const _=i=>i.charAt(0).toUpperCase()+i.slice(1),X=()=>{const i=v(),{queryClient:t,apiClient:r}=k({from:"/services/"}),{service:s}=g({from:"/services/"}),[a,l]=n.useState(void 0),o=n.useMemo(()=>{if(s)return I({queryClient:t,apiClient:r,filter:{service:[s]},after:a})},[s,a,t,r]),u=n.useCallback(()=>{i({to:"/services",search:p=>{const{service:ce,...E}=p;return{...E}}})},[i]),c=n.useCallback(p=>{s&&i(p?{to:"/services/$service/images/$image",params:{service:s,image:p.repository}}:{to:"/services/$service",params:{service:s}})},[i,s]);return e.jsx(L,{heading:s?`${_(s)} Overview`:void 0,opened:!!s,onClose:u,size:"large",children:e.jsx(M,{children:e.jsx(h,{displayErrorMessage:!0,children:s&&o&&e.jsx(U,{displayActions:!0,imagesPromise:o,onDetailsButtonClick:c,goToPage:l})})})})},V={supportGroups:"support_group",region:"region",integrity:"integrity"},Y=({serviceDetails:i})=>{const t=(r,s)=>e.jsx($,{pillKey:r,pillKeyLabel:r,pillValue:s,pillValueLabel:s},s);return e.jsx(y,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(i).map(([r,s])=>Array.isArray(s)?s.map(a=>t(V[r],a)):t(V[r],s))})},ee=({item:i,selected:t,onItemClick:r,onServiceDetailClick:s})=>e.jsxs(D,{className:"cursor-pointer",isSelected:t,onClick:r,children:[e.jsx(m,{children:i.name}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"critical",count:i.issuesCount.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"high",count:i.issuesCount.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"medium",count:i.issuesCount.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"low",count:i.issuesCount.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"unknown",count:i.issuesCount.none,tooltipContent:"None Vulnerabilities"})}),e.jsx(m,{children:e.jsx(Y,{serviceDetails:i.serviceDetails})}),e.jsx(m,{className:"cursor-default interactive",onClick:a=>a.stopPropagation(),children:e.jsx(T,{label:"Show Details",onClick:s,size:"small",className:"whitespace-nowrap"})})]}),P=8,se=({servicesPromise:i})=>{const t=v(),{service:r}=g({from:"/services/"}),{error:s,data:a}=n.use(i),{services:l}=b(a),o=n.useCallback(c=>{t({to:"/services",search:p=>({...p,service:c.name})})},[]),u=n.useCallback(c=>{t({to:"/services/$service",params:{service:c.name}})},[]);return s?e.jsx(S,{colSpan:P,children:"Error loading services"}):l.length===0?e.jsx(S,{colSpan:P,children:"No service found"}):l.map(c=>e.jsx(ee,{item:c,selected:c.name===r,onItemClick:()=>o(c),onServiceDetailClick:()=>u(c)},c.id))},f=8,ie=()=>{const{queryClient:i,apiClient:t}=k({from:"/services/"}),{servicesPromise:r,filterSettings:s}=C({from:"/services/"}),[a,l]=n.useState(r),o=n.useCallback(u=>{const c=O({queryClient:i,apiClient:t,filterSettings:s,after:u});l(c)},[l,i,t,s]);return n.useEffect(()=>{l(r)},[l,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(z,{minContentColumns:[1,2,3,4,5,7],columns:f,children:[e.jsxs(D,{children:[e.jsx(x,{children:"Service"}),e.jsx(x,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(x,{children:"Details"}),e.jsx(x,{})]}),e.jsx(h,{displayErrorMessage:!0,fallbackRender:R({colspan:f}),resetKeys:[a],children:e.jsx(n.Suspense,{fallback:e.jsx(B,{colSpan:f}),children:e.jsx(se,{servicesPromise:a})})})]}),e.jsx(h,{children:e.jsx(n.Suspense,{children:e.jsx(H,{dataPromise:a,goToPage:o,dataNormalizationMethod:b})})}),e.jsx(X,{})]})},re=({servicesPromise:i})=>{const{error:t,data:r}=n.use(i),{servicesIssuesCount:s}=b(r);return e.jsx(y,{gap:"1",children:t?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(J,{counts:s})})},te=()=>{const{servicesPromise:i}=C({from:"/services/"});return e.jsx(h,{children:e.jsx(y,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(q,{size:"small"}),children:e.jsx(re,{servicesPromise:i})})})})},ae=()=>{const i=v(),{filtersPromise:t,filterSettings:r}=C({from:"/services/"}),s=n.useCallback(a=>{i({to:"/services",search:l=>{const o=w(a);return{...Object.fromEntries(Object.entries(l).filter(([u])=>!u.startsWith(N))),...o}}})},[i]);return e.jsx(Z,{filtersPromise:t,filterSettings:r,onFilterChange:s,searchInputPlaceholder:"search term for services name"})},le=()=>e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsxs(h,{children:[e.jsx(te,{}),e.jsx(ie,{})]})]}),ne=K([j(),Q(j()),W()]);G({service:j().optional(),searchTerm:j().optional()}).catchall(ne);function fe(){const i=v(),{appProps:t}=k({from:"/services/"}),r=g({from:"/services/"}),{hasAppliedInitialFilters:s,markInitialFiltersApplied:a}=F();return n.useLayoutEffect(()=>{if(!s&&!Object.keys(r).some(l=>l.startsWith(N))&&t?.initialFilters?.support_group?.length){const l=A(t.initialFilters);l.length>0&&(i({to:"/services",search:w({searchTerm:"",selectedFilters:l}),replace:!0}),a())}},[i,t,s,a,r]),e.jsx(le,{})}export{fe as component};
