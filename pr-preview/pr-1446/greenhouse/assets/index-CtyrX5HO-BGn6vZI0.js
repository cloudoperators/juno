import{j as e,E as v,a as g,l as N,q,S as E,V as m,m as S,h as y,P,o as j,n as h,d as b,e as p,b as D,k as M,p as z,c as x,u as G,g as K,f as V,i as I,r as T,s as f,t as A,_ as F,v as O,w as R}from"./App-U_ea0FzH-Bu31ZtrS.js";import{G as a}from"./_extensionId._-BcAzG5tt.js";import{R as L,D as _,L as U,S as Q,M as W,d as w}from"./IssueCountsPerSeverityLevel-DtZ145Ot-C-kTDtkv.js";import{s as X}from"./IssueTimestamp-F8i6naeK-DQsFt1pY.js";import{D as H}from"./index-BQFRP1vh-BSgl1wNr.js";import"./index-CYpR0rXa.js";import"./Shell-cocSLQ3A.js";import"./index-Ba6vtSL6.js";const J=i=>`
    border-l-2
    ${K(i.toLowerCase()||"none")}
    h-full
    pl-5
  `,Y=i=>{const r=(i||"none").toLowerCase(),l=K(r||"none");return e.jsx(b,{icon:I[r]||"help",color:l})},Z=({vulnerability:i,selected:r,onItemClick:l})=>{const[s,t]=a.useState(!1),{needsExpansion:n,textRef:o}=G(i.description),c=u=>{u.preventDefault(),u.stopPropagation(),t(!s)};return e.jsxs(j,{className:`cursor-pointer ${r?"active":""}`,onClick:l,children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:J(i.severity),children:Y(i.severity)})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(m,{gap:"1.5",alignment:"center",children:[e.jsx(b,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx("span",{children:i.servicesCount})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(X,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(m,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&n&&e.jsx("a",{href:"#",onClick:c,className:"link-hover",children:e.jsxs(m,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(b,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})})]})},B=({vulnerabilitiesPromise:i})=>{const r=g(),{vulnerability:l}=D({from:"/vulnerabilities/"}),{error:s,data:t}=a.use(i),{vulnerabilities:n}=p(t),o=a.useCallback(c=>{r({to:"/vulnerabilities",search:u=>({...u,vulnerability:c.name})})},[r]);return s?e.jsxs(w,{colSpan:5,children:["Error loading vulnerabilities: ",s.message]}):n.length===0?e.jsx(w,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(c=>e.jsx(Z,{vulnerability:c,selected:c.name===l,onItemClick:()=>o(c)},c.name))},$=({vulnerabilityName:i,vulnerabilitiesPromise:r,onServiceClick:l})=>{const s=g(),t=d=>{l?l(d):s({to:"/services/$service",params:{service:d}})},{data:n}=a.use(r),{vulnerabilities:o}=p(n),c=o.find(d=>d.name===i);if(!c)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",i]});const u=c.services||[];return u.length===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx("div",{className:"mb-4",children:e.jsx(a.Suspense,{fallback:e.jsxs(m,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]}),children:e.jsx(m,{gap:"4",direction:"horizontal",wrap:!0,children:u.map((d,k)=>e.jsx("a",{href:"#",onClick:C=>{C.preventDefault(),t(d.ccrn)},className:"link-hover",children:d.ccrn},k))})})})},ee=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:l}=a.use(i),{vulnerabilities:s}=p(l),t=s.find(n=>n.name===r);return t?e.jsx(m,{gap:"1",direction:"horizontal",wrap:!0,children:e.jsx(a.Suspense,{fallback:e.jsxs(m,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]}),children:t.supportGroups?.map(n=>e.jsx(V,{pillValue:n,pillValueLabel:n},n))})}):null},ie=({vulnerabilitiesPromise:i,vulnerabilityName:r})=>{const{data:l}=a.use(i),{vulnerabilities:s}=p(l),t=s.find(o=>o.name===r),{servicesCount:n}=t||{servicesCount:0};return n},se=()=>{const i=g(),{queryClient:r,apiClient:l}=L({from:"/vulnerabilities/"}),{vulnerability:s}=D({from:"/vulnerabilities/"}),[t]=a.useState(void 0),n=a.useMemo(()=>{if(s)return y({queryClient:r,apiClient:l,filterSettings:{selectedFilters:[{name:"name",value:s}]}})},[s,r,l]),o=a.useMemo(()=>{if(s)return y({queryClient:r,apiClient:l,filterSettings:{selectedFilters:[{name:"name",value:s}]},afterServices:t})},[s,t,r,l]),c=a.useCallback(()=>{i({to:"/vulnerabilities",search:d=>{const{vulnerability:k,...C}=d;return{...C}}})},[i]),u=a.useCallback(d=>{i({to:"/services/$service",params:{service:d}})},[i]);return e.jsx(M,{heading:s?`${s} Overview`:void 0,opened:!!s,onClose:c,size:"large",children:e.jsx(z,{children:e.jsx(v,{displayErrorMessage:!0,children:s&&n&&o&&e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsxs(P,{columns:2,gridColumnTemplate:"15% auto",minContentColumns:[1],className:"mb-6",children:[e.jsxs(j,{children:[e.jsx(h,{className:"whitespace-nowrap",children:"Support Groups"}),e.jsx(x,{children:e.jsx(ee,{vulnerabilitiesPromise:n,vulnerabilityName:s})})]}),e.jsxs(j,{children:[e.jsxs(h,{className:"whitespace-nowrap",children:["Services (",e.jsx(ie,{vulnerabilitiesPromise:n,vulnerabilityName:s}),")"]}),e.jsx(x,{children:e.jsx($,{vulnerabilityName:s,vulnerabilitiesPromise:o,onServiceClick:u})})]})]})})})})})},re=()=>{const{queryClient:i,apiClient:r}=L({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:l,filterSettings:s}=N({from:"/vulnerabilities/"}),[t,n]=a.useState(l),o=a.useCallback(c=>{const u=y({queryClient:i,apiClient:r,filterSettings:s,after:c});n(u)},[n,i,r,s]);return a.useEffect(()=>{n(l)},[n,l]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(P,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(j,{children:[e.jsx(h,{children:e.jsx(b,{icon:"monitorHeart"})}),e.jsx(h,{children:"Vulnerability"}),e.jsx(h,{children:"Services"}),e.jsx(h,{children:"Target Date"}),e.jsx(h,{children:"Description"})]}),e.jsx(v,{displayErrorMessage:!0,resetKeys:[t],fallbackRender:_({colspan:5}),children:e.jsx(a.Suspense,{fallback:e.jsx(U,{colSpan:5}),children:e.jsx(B,{vulnerabilitiesPromise:t})})})]}),e.jsx(v,{children:e.jsx(a.Suspense,{children:e.jsx(Q,{dataPromise:t,goToPage:o,dataNormalizationMethod:p})})}),e.jsx(se,{})]})},le=()=>{const i=g(),{filtersPromise:r,filterSettings:l}=N({from:"/vulnerabilities/"}),s=a.useCallback(t=>{i({to:"/vulnerabilities",search:n=>{const o=q(t);return{...Object.fromEntries(Object.entries(n).filter(([c])=>!c.startsWith(E))),...o}}})},[i]);return e.jsx(H,{filtersPromise:r,filterSettings:l,onFilterChange:s,searchInputPlaceholder:"search term for vulnerabilities name"})},ne=({vulnerabilitiesPromise:i})=>{const{error:r,data:l}=a.use(i),{vulnerabilitiesCounts:s}=p(l);return e.jsx(m,{gap:"1",children:r?e.jsx("div",{className:"font-bold",children:"All vulnerabilities: --"}):e.jsx(W,{counts:s})})},ae=()=>{const{vulnerabilitiesPromise:i}=N({from:"/vulnerabilities/"});return e.jsx(v,{children:e.jsx(m,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(a.Suspense,{fallback:e.jsx(S,{size:"small"}),children:e.jsx(ne,{vulnerabilitiesPromise:i})})})})},te=()=>e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsxs(v,{children:[e.jsx(ae,{}),e.jsx(re,{})]})]}),ce=T([f(),A(f()),F()]);O({vulnerability:f().optional(),searchTerm:R(i=>typeof i=="number"?i.toString():i,f().optional())}).catchall(ce);const je=te;export{je as component};
