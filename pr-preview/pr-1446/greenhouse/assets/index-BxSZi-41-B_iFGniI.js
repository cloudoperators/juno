import{a as j,b as g,B as V,j as e,S as D,C as E,A as w,E as x,l as C,V as b,m as F,z as M,P as O,o as A,n as h,y,x as $,k as q,p as G,c as m,Y as I,f as z,r as L,s as v,t as _,_ as T,v as B}from"./App-U_ea0FzH-Bu31ZtrS.js";import{G as n}from"./_extensionId._-BcAzG5tt.js";import{R as k,D as Q,L as R,S as W,M as H,d as S,i as d}from"./IssueCountsPerSeverityLevel-DtZ145Ot-C-kTDtkv.js";import{O as J}from"./index-uQ3wFPwn-Bl3aS_Rw.js";import{D as U}from"./index-BQFRP1vh-BSgl1wNr.js";import"./index-CYpR0rXa.js";import"./Shell-cocSLQ3A.js";import"./index-Ba6vtSL6.js";import"./SectionContentHeading-DnE_qCfv-CyN_aapb.js";const X=i=>i.charAt(0).toUpperCase()+i.slice(1),Y=()=>{const i=j(),{queryClient:t,apiClient:r}=k({from:"/services/"}),{service:s}=g({from:"/services/"}),[a,l]=n.useState(void 0),o=n.useMemo(()=>{if(s)return $({queryClient:t,apiClient:r,filter:{service:[s]},after:a})},[s,a,t,r]),u=n.useCallback(()=>{i({to:"/services",search:p=>{const{service:ce,...K}=p;return{...K}}})},[i]),c=n.useCallback(p=>{s&&i(p?{to:"/services/$service/images/$image",params:{service:s,image:p.repository}}:{to:"/services/$service",params:{service:s}})},[i,s]);return e.jsx(q,{heading:s?`${X(s)} Overview`:void 0,opened:!!s,onClose:u,size:"large",children:e.jsx(G,{children:e.jsx(x,{displayErrorMessage:!0,children:s&&o&&e.jsx(J,{displayActions:!0,imagesPromise:o,onDetailsButtonClick:c,goToPage:l})})})})},P={supportGroups:"support_group",region:"region",integrity:"integrity"},Z=({serviceDetails:i})=>{const t=(r,s)=>e.jsx(z,{pillKey:r,pillKeyLabel:r,pillValue:s,pillValueLabel:s},s);return e.jsx(b,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(i).map(([r,s])=>Array.isArray(s)?s.map(a=>t(P[r],a)):t(P[r],s))})},ee=({item:i,selected:t,onItemClick:r,onServiceDetailClick:s})=>e.jsxs(A,{className:"cursor-pointer",isSelected:t,onClick:r,children:[e.jsx(m,{children:i.name}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"critical",count:i.issuesCount.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"high",count:i.issuesCount.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"medium",count:i.issuesCount.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"low",count:i.issuesCount.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(d,{severity:"unknown",count:i.issuesCount.none,tooltipContent:"None Vulnerabilities"})}),e.jsx(m,{children:e.jsx(Z,{serviceDetails:i.serviceDetails})}),e.jsx(m,{className:"cursor-default interactive",onClick:a=>a.stopPropagation(),children:e.jsx(I,{label:"Show Details",onClick:s,size:"small",className:"whitespace-nowrap"})})]}),N=8,se=({servicesPromise:i})=>{const t=j(),{service:r}=g({from:"/services/"}),{error:s,data:a}=n.use(i),{services:l}=y(a),o=n.useCallback(c=>{t({to:"/services",search:p=>({...p,service:c.name})})},[]),u=n.useCallback(c=>{t({to:"/services/$service",params:{service:c.name}})},[]);return s?e.jsx(S,{colSpan:N,children:"Error loading services"}):l.length===0?e.jsx(S,{colSpan:N,children:"No service found"}):l.map(c=>e.jsx(ee,{item:c,selected:c.name===r,onItemClick:()=>o(c),onServiceDetailClick:()=>u(c)},c.id))},f=8,ie=()=>{const{queryClient:i,apiClient:t}=k({from:"/services/"}),{servicesPromise:r,filterSettings:s}=C({from:"/services/"}),[a,l]=n.useState(r),o=n.useCallback(u=>{const c=M({queryClient:i,apiClient:t,filterSettings:s,after:u});l(c)},[l,i,t,s]);return n.useEffect(()=>{l(r)},[l,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(O,{minContentColumns:[1,2,3,4,5,7],columns:f,children:[e.jsxs(A,{children:[e.jsx(h,{children:"Service"}),e.jsx(h,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(h,{children:"Details"}),e.jsx(h,{})]}),e.jsx(x,{displayErrorMessage:!0,fallbackRender:Q({colspan:f}),resetKeys:[a],children:e.jsx(n.Suspense,{fallback:e.jsx(R,{colSpan:f}),children:e.jsx(se,{servicesPromise:a})})})]}),e.jsx(x,{children:e.jsx(n.Suspense,{children:e.jsx(W,{dataPromise:a,goToPage:o,dataNormalizationMethod:y})})}),e.jsx(Y,{})]})},re=({servicesPromise:i})=>{const{error:t,data:r}=n.use(i),{servicesIssuesCount:s}=y(r);return e.jsx(b,{gap:"1",children:t?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(H,{counts:s})})},te=()=>{const{servicesPromise:i}=C({from:"/services/"});return e.jsx(x,{children:e.jsx(b,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(F,{size:"small"}),children:e.jsx(re,{servicesPromise:i})})})})},ae=()=>{const i=j(),{filtersPromise:t,filterSettings:r}=C({from:"/services/"}),s=n.useCallback(a=>{i({to:"/services",search:l=>{const o=w(a);return{...Object.fromEntries(Object.entries(l).filter(([u])=>!u.startsWith(D))),...o}}})},[i]);return e.jsx(U,{filtersPromise:t,filterSettings:r,onFilterChange:s,searchInputPlaceholder:"search term for services name"})},le=()=>e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsxs(x,{children:[e.jsx(te,{}),e.jsx(ie,{})]})]}),ne=L([v(),_(v()),T()]);B({service:v().optional(),searchTerm:v().optional()}).catchall(ne);function fe(){const i=j(),{appProps:t}=k({from:"/services/"}),r=g({from:"/services/"}),{hasAppliedInitialFilters:s,markInitialFiltersApplied:a}=V();return n.useLayoutEffect(()=>{if(!s&&!Object.keys(r).some(l=>l.startsWith(D))&&t?.initialFilters?.support_group?.length){const l=E(t.initialFilters);l.length>0&&(i({to:"/services",search:w({searchTerm:"",selectedFilters:l}),replace:!0}),a())}},[i,t,s,a,r]),e.jsx(le,{})}export{fe as component};
