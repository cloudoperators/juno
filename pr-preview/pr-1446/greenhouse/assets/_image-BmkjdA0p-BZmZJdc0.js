import{T as j,j as e,E as h,m as w,M as N,P as y,o as x,n as c,c as d,V as p,f as g,y as P,Z as D,I as L,d as u,Q as f,u as k,g as V,i as E}from"./App-CqATQXMd-DyLlMiQC.js";import{G as o}from"./_extensionId._-CzV2jCo4.js";import{M as K,R as M,D as R,L as q,S as T,d as v}from"./IssueCountsPerSeverityLevel-DPj33mSF-B9ebVUZc.js";import{o as U}from"./SectionContentHeading-C42ZyXk_-DZbkEavN.js";import{s as z}from"./IssueTimestamp-ZUz5YpuX-IzKDg0l8.js";import"./index-CbREhYRW.js";import"./Shell-DhkRjDTY.js";import"./index-D97tSSdg.js";const F=s=>{const r=s.toLowerCase(),a=V(r);return e.jsx(u,{icon:E[r]||"help",color:a})},G=({severity:s})=>F(s),I=s=>`
    border-l-2
    ${V(s.toLowerCase())}
    h-full
    pl-5
  `,Q=({issue:s})=>{const[r,a]=o.useState(!1),{needsExpansion:n,textRef:l}=k(s.description),i=m=>{m.preventDefault(),a(!r)};return e.jsxs(x,{children:[e.jsx(d,{className:"pl-0",children:e.jsx("div",{className:I(s.severity),children:e.jsx(G,{severity:s.severity})})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(u,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(d,{className:"whitespace-nowrap",children:e.jsx(z,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(d,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:l,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&n&&e.jsx("a",{href:"#",onClick:i,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(u,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},W=({issuesPromise:s})=>{const{error:r,data:a}=o.use(s),{vulnerabilities:n}=f(a);return r?e.jsxs(v,{colSpan:4,children:["Error loading vulnerabilities: ",r.message]}):n.length===0?e.jsx(v,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):n.map(l=>e.jsx(Q,{issue:l},l.id||l.name))},Z=({service:s,image:r})=>{const{apiClient:a,queryClient:n}=M({from:"/services/$service"}),[l,i]=o.useState(void 0),[m,b]=o.useState(void 0),C=l?{search:[l]}:void 0,t=P({apiClient:a,queryClient:n,filter:{service:[s],repository:[r.repository]},firstVulnerabilities:20,afterVulnerabilities:m,vulFilter:C});return e.jsxs(e.Fragment,{children:[e.jsxs(p,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(D,{children:"Vulnerabilities"}),e.jsx(L,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:S=>i(S||""),onClear:()=>{i("")}})]}),e.jsxs(y,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(x,{children:[e.jsx(c,{children:e.jsx(u,{icon:"monitorHeart"})}),e.jsx(c,{children:"Vulnerability"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),t&&e.jsx(h,{displayErrorMessage:!0,fallbackRender:R({colspan:4}),resetKeys:[t],children:e.jsx(o.Suspense,{fallback:e.jsx(q,{colSpan:4}),children:e.jsx(W,{issuesPromise:t})})})]}),t&&e.jsx(h,{resetKeys:[t],children:e.jsx(o.Suspense,{children:e.jsx(T,{dataPromise:t,dataNormalizationMethod:f,goToPage:b})})})]})},A=({imagesPromise:s,imageRepository:r,service:a})=>{const{data:n}=o.use(s),{images:l}=N(n),i=l.find(m=>m.repository===r);return i?e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:["Image ",i.repository]}),e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(x,{children:[e.jsx(c,{children:"Details"}),e.jsx(d,{children:e.jsxs(p,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(g,{pillKey:"repository",pillKeyLabel:"repository",pillValue:i.repository,pillValueLabel:i.repository}),i.versionsCount!==void 0&&i.versionsCount>0&&e.jsx(g,{pillKey:"versions",pillKeyLabel:"versions",pillValue:i.versionsCount.toString(),pillValueLabel:i.versionsCount.toString()})]})})]}),e.jsxs(x,{children:[e.jsx(c,{children:"Vulnerabilities Counts"}),e.jsx(d,{children:e.jsx(K,{counts:i.vulnerabilityCounts})})]})]}),a&&r&&i&&e.jsx(Z,{service:a,image:i})]}):null};function ee(){const{imagesPromise:s}=j.useLoaderData(),{service:r,image:a}=j.useParams();return e.jsx(h,{displayErrorMessage:!0,children:e.jsx(o.Suspense,{fallback:e.jsx(w,{className:"mt-4"}),children:e.jsx(A,{imagesPromise:s,imageRepository:a,service:r})})})}export{ee as component};
