import{u as R,j as e,R as b,a as m,K as p,g,b as V,i as F,c as f,d as E,e as x,x as S,X as I,f as y,Z as M,L as z,E as j,M as D,Q as h,h as w,k as B,S as L,o as $,p as P,s as v,l as G,m as O,n as U}from"./App-9CBx-09A.js";import{a}from"./index-D_aEHqRi.js";import{E as k,u as T,g as A,L as K,C as X,I as _}from"./IssueCountsPerSeverityLevel-C5UtLk9_.js";import{I as q}from"./IssueTimestamp-C1WHGQ-B.js";import{F as Q}from"./index-BJ5Ok-pW.js";const W=s=>`
    border-l-2
    ${V(s.toLowerCase()||"none")}
    h-full
    pl-5
  `,Z=s=>{const i=(s||"none").toLowerCase(),n=V(i||"none");return e.jsx(g,{icon:F[i]||"help",color:n})},H=({vulnerability:s,selected:i,onItemClick:n})=>{const[r,l]=a.useState(!1),{needsExpansion:t,textRef:c}=R(s.description),o=u=>{u.preventDefault(),u.stopPropagation(),l(!r)};return e.jsxs(b,{className:`cursor-pointer ${i?"active":""}`,onClick:n,children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:W(s.severity),children:Z(s.severity)})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(g,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx(q,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:c,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&t&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(g,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},J=({vulnerabilitiesPromise:s})=>{const i=f(),{vulnerability:n}=E({from:"/vulnerabilities/"}),{error:r,data:l}=a.use(s),{vulnerabilities:t}=x(l),c=a.useCallback(o=>{i({to:"/vulnerabilities",search:u=>({...u,vulnerability:o.name})})},[i]);return r?e.jsxs(k,{colSpan:5,children:["Error loading vulnerabilities: ",r.message]}):t.length===0?e.jsx(k,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):t.map(o=>e.jsx(H,{vulnerability:o,selected:o.name===n,onItemClick:()=>c(o)},o.name))},Y=({vulnerabilityName:s,vulnerabilitiesPromise:i,onServiceClick:n})=>{const r=f(),l=d=>{n?n(d):r({to:"/services/$service",params:{service:d}})},{data:t}=a.use(i),{vulnerabilities:c}=x(t),o=c.find(d=>d.name===s);if(!o)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",s]});const u=o.services||[];return u.length===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx("div",{className:"mb-4",children:e.jsx(a.Suspense,{fallback:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]}),children:e.jsx(p,{gap:"4",direction:"horizontal",wrap:!0,children:u.map((d,N)=>e.jsx("a",{href:"#",onClick:C=>{C.preventDefault(),l(d.ccrn)},className:"link-hover",children:d.ccrn},N))})})})},ee=({vulnerabilitiesPromise:s,vulnerabilityName:i})=>{const{data:n}=a.use(s),{vulnerabilities:r}=x(n),l=r.find(t=>t.name===i);return l?e.jsx(p,{gap:"1",direction:"horizontal",wrap:!0,children:e.jsx(a.Suspense,{fallback:e.jsxs(p,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]}),children:l.supportGroups?.map(t=>e.jsx(I,{pillValue:t,pillValueLabel:t},t))})}):null},se=({vulnerabilitiesPromise:s,vulnerabilityName:i})=>{const{data:n}=a.use(s),{vulnerabilities:r}=x(n),l=r.find(c=>c.name===i),{servicesCount:t}=l||{servicesCount:0};return t},re=()=>{const s=f(),{queryClient:i,apiClient:n}=T({from:"/vulnerabilities/"}),{vulnerability:r}=E({from:"/vulnerabilities/"}),[l]=a.useState(void 0),t=a.useMemo(()=>{if(r)return y({queryClient:i,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:r}]}})},[r,i,n]),c=a.useMemo(()=>{if(r)return y({queryClient:i,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:r}]},afterServices:l})},[r,l,i,n]),o=a.useCallback(()=>{s({to:"/vulnerabilities",search:d=>{const{vulnerability:N,...C}=d;return{...C}}})},[s]),u=a.useCallback(d=>{s({to:"/services/$service",params:{service:d}})},[s]);return e.jsx(M,{heading:r?`${r} Overview`:void 0,opened:!!r,onClose:o,size:"large",children:e.jsx(z,{children:e.jsx(j,{displayErrorMessage:!0,children:r&&t&&c&&e.jsx(a.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsxs(D,{columns:2,gridColumnTemplate:"15% auto",minContentColumns:[1],className:"mb-6",children:[e.jsxs(b,{children:[e.jsx(h,{className:"whitespace-nowrap",children:"Support Groups"}),e.jsx(m,{children:e.jsx(ee,{vulnerabilitiesPromise:t,vulnerabilityName:r})})]}),e.jsxs(b,{children:[e.jsxs(h,{className:"whitespace-nowrap",children:["Services (",e.jsx(se,{vulnerabilitiesPromise:t,vulnerabilityName:r}),")"]}),e.jsx(m,{children:e.jsx(Y,{vulnerabilityName:r,vulnerabilitiesPromise:c,onServiceClick:u})})]})]})})})})})},ie=()=>{const{queryClient:s,apiClient:i}=T({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:r}=w({from:"/vulnerabilities/"}),[l,t]=a.useState(n),c=a.useCallback(o=>{const u=y({queryClient:s,apiClient:i,filterSettings:r,after:o});t(u)},[t,s,i,r]);return a.useEffect(()=>{t(n)},[t,n]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(D,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(b,{children:[e.jsx(h,{children:e.jsx(g,{icon:"monitorHeart"})}),e.jsx(h,{children:"Vulnerability"}),e.jsx(h,{children:"Services"}),e.jsx(h,{children:"Target Date"}),e.jsx(h,{children:"Description"})]}),e.jsx(j,{displayErrorMessage:!0,resetKeys:[l],fallbackRender:A({colspan:5}),children:e.jsx(a.Suspense,{fallback:e.jsx(K,{colSpan:5}),children:e.jsx(J,{vulnerabilitiesPromise:l})})})]}),e.jsx(j,{children:e.jsx(a.Suspense,{children:e.jsx(X,{dataPromise:l,goToPage:c,dataNormalizationMethod:x})})}),e.jsx(re,{})]})},ne=()=>{const s=f(),{filtersPromise:i,filterSettings:n}=w({from:"/vulnerabilities/"}),r=a.useCallback(l=>{s({to:"/vulnerabilities",search:t=>{const c=B(l);return{...Object.fromEntries(Object.entries(t).filter(([u])=>!u.startsWith(L))),...c}}})},[s]);return e.jsx(Q,{filtersPromise:i,filterSettings:n,onFilterChange:r,searchInputPlaceholder:"search term for vulnerabilities name"})},te=({vulnerabilitiesPromise:s})=>{const{error:i,data:n}=a.use(s),{vulnerabilitiesCounts:r}=x(n);return e.jsx(p,{gap:"1",children:i?e.jsx("div",{className:"font-bold",children:"All vulnerabilities: --"}):e.jsx(_,{counts:r})})},ae=()=>{const{vulnerabilitiesPromise:s}=w({from:"/vulnerabilities/"});return e.jsx(j,{children:e.jsx(p,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(a.Suspense,{fallback:e.jsx(S,{size:"small"}),children:e.jsx(te,{vulnerabilitiesPromise:s})})})})},le=()=>e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs(j,{children:[e.jsx(ae,{}),e.jsx(ie,{})]})]});$({vulnerability:v().optional(),searchTerm:P(s=>typeof s=="number"?s.toString():s,v().optional())}).catchall(P((s,i)=>{if(!(i.path.length>0&&typeof i.path[0]=="string"&&!i.path[0].startsWith(L)))return s},G([v(),O(v()),U()])));const me=le;export{me as component};
