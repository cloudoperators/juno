import{j as e,D as y,p,R as f,T as D,W as k,Q as V,U as N,e as P,d as v,A as g,k as u,r as S,B as C,y as r,M as b,w as B,V as Z,K as q,J as z,o as A,m as M}from"./App-CMLQf3XH-CXPesA_a.js";import{w as d}from"./index-XlggDiY3.js";function W(s){return y({...s,select:n=>s.select?s.select(n.context):n.context})}const j=({colSpan:s,children:n})=>e.jsx(v,{children:e.jsx(r,{colSpan:s,children:n})}),T=({children:s})=>e.jsx(B,{className:"my-6",children:s}),H=({imageVersionsPromise:s})=>{const{data:n}=d.use(s),{totalImageVersions:i}=C(n);return i},a=({icon:s,count:n,variant:i,tooltipContent:o,showDashIfZero:t=!1})=>t&&n===0?e.jsx("span",{children:"â€”"}):e.jsxs(Z,{triggerEvent:"hover",children:[e.jsx(q,{children:e.jsx(z,{icon:s,text:n>0?n.toString():"0",variant:n>0?i:"default"})}),e.jsx(A,{children:o})]}),K=({version:s,selected:n=!1,displayDetailsButton:i=!0,onItemClick:o,onDetailClick:t})=>e.jsxs(v,{onClick:o,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(r,{className:"service-image-versions-cell",children:e.jsxs(u,{gap:"1",direction:"vertical",children:[e.jsxs(u,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(u,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:l=>l.stopPropagation(),children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(M,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(r,{className:"service-image-versions-cell",children:s.tag}),e.jsx(r,{className:"items-center",children:e.jsx(a,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(a,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(a,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(a,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(r,{className:"items-center",children:e.jsx(a,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),i&&e.jsx(r,{children:e.jsx(N,{size:"small",label:"Show Details",onClick:t})})]}),$=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:i,imageVersionsPromise:o,onDetailsButtonClick:t,onImageVersionItemClick:l})=>{const{error:c,data:m}=d.use(o),{imageVersions:h}=C(m);return c?e.jsx(j,{colSpan:s,children:"Error loading image versions."}):h.length===0?e.jsx(j,{colSpan:s,children:"No image version found"}):h.map(x=>e.jsx(K,{version:x,selected:x.version===n,displayDetailsButton:i,onItemClick:()=>{l==null||l(x)},onDetailClick:w=>{w.stopPropagation(),t==null||t(x)}},x.version))},F=({dataPromise:s,goToPage:n,dataNormalizationMethod:i})=>{const{data:o}=d.use(s),{pages:t,pageNumber:l}=i(o),c=d.useCallback(m=>{if(m){const h=t[m-2];n(m===1||h==null?void 0:h.after)}},[t,n]);return e.jsx(u,{distribution:"end",className:"mt-4",children:e.jsx(b,{variant:"number",currentPage:l,onPressNext:c,onPressPrevious:c,pages:t.length})})},I=8,_=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:i=!1,onImageVersionItemClick:o,onDetailsButtonClick:t,goToPage:l})=>{const c=i?I:I-1;return e.jsxs(d.Suspense,{children:[e.jsxs(T,{children:["Image Versions",e.jsxs(d.Suspense,{children:["(",e.jsx(H,{imageVersionsPromise:s}),")"]})]}),i&&e.jsx(V,{children:e.jsx(N,{size:"small",onClick:()=>t==null?void 0:t(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(P,{columns:c,minContentColumns:[2,3,4,5,6],children:[e.jsxs(v,{children:[e.jsx(g,{children:"Image Repository"}),e.jsx(g,{children:"Tag"}),e.jsx(g,{colSpan:5,children:"Issue Counts"}),i&&e.jsx(g,{})]}),e.jsx(d.Suspense,{fallback:e.jsx(j,{colSpan:c,children:e.jsxs(u,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(S,{variant:"primary"})]})}),children:e.jsx($,{columnSpan:c,displayDetailsButton:i,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:t,onImageVersionItemClick:o})})]})}),e.jsx(d.Suspense,{children:e.jsx(F,{dataNormalizationMethod:C,dataPromise:s,goToPage:l})})]})},E=({queryClient:s,apiClient:n,service:i,after:o})=>s.ensureQueryData({queryKey:["imageVersions",i,o],queryFn:()=>n.query({query:k,variables:{filter:{serviceCcrn:[i]},filterCi:{serviceCcrn:[i]},filterIc:{serviceCcrn:[i]},orderBy:[{by:D.Severity,direction:p.Desc}],orderByCi:[{by:f.Cluster,direction:p.Asc},{by:f.Namespace,direction:p.Asc}],after:o}})}),J=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(u,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(a,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(a,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(a,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(a,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(a,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{J as $,F as H,W as K,E as Q,T as V,_,a as i,j as p};
