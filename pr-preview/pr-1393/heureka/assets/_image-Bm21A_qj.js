import{g as f,j as e,d as u,a as I,u as N,i as x,c,V as d,Q as y,y as D,R as E,J as V,$ as C,o as p,n as h,P as R,E as j,U as g,m as L}from"./App-CrVDFx3J.js";import{r as i}from"./index-MuIW1o-7.js";import{E as v,u as P,g as T,L as k,C as K,I as z}from"./IssueCountsPerSeverityLevel-CvQ-tVtI.js";import{S as M}from"./SectionContentHeading-CtyDOWdC.js";import{I as F}from"./IssueTimestamp-CWEz603q.js";const U=s=>{const r=s.toLowerCase(),n=f(r);return e.jsx(u,{icon:I[r]||"help",color:n})},$=({severity:s})=>U(s),H=s=>`
    border-l-2
    ${f(s.toLowerCase())}
    h-full
    pl-5
  `,J=({issue:s})=>{const[r,n]=i.useState(!1),{needsExpansion:t,textRef:o}=N(s.description),a=m=>{m.preventDefault(),n(!r)};return e.jsxs(x,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:H(s.severity),children:e.jsx($,{severity:s.severity})})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(u,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(F,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&t&&e.jsx("a",{href:"#",onClick:a,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(u,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})})]})},q=({issuesPromise:s})=>{const{error:r,data:n}=i.use(s),{vulnerabilities:t}=y(n);return r?e.jsxs(v,{colSpan:4,children:["Error loading vulnerabilities: ",r.message]}):t.length===0?e.jsx(v,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):t.map(o=>e.jsx(J,{issue:o},o.id||o.name))},A=({service:s,image:r})=>{const{apiClient:n,queryClient:t}=P({from:"/services/$service"}),[o,a]=i.useState(void 0),[m,b]=i.useState(void 0),w=o?{search:[o]}:void 0,l=D({apiClient:n,queryClient:t,filter:{service:[s],repository:[r.repository]},firstVulnerabilities:20,afterVulnerabilities:m,vulFilter:w});return e.jsxs(e.Fragment,{children:[e.jsxs(d,{gap:"2",className:"mb-4 mt-8",children:[e.jsx(E,{children:"Vulnerabilities"}),e.jsx(V,{placeholder:"Search for CVE number",className:"w-96 ml-auto",onSearch:S=>a(S||""),onClear:()=>{a("")}})]}),e.jsxs(C,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(u,{icon:"monitorHeart"})}),e.jsx(p,{children:"Vulnerability"}),e.jsx(p,{children:"Target Date"}),e.jsx(p,{children:"Description"})]}),l&&e.jsx(h,{displayErrorMessage:!0,fallbackRender:T({colspan:4}),resetKeys:[l],children:e.jsx(i.Suspense,{fallback:e.jsx(k,{colSpan:4}),children:e.jsx(q,{issuesPromise:l})})})]}),l&&e.jsx(h,{resetKeys:[l],children:e.jsx(i.Suspense,{children:e.jsx(K,{dataPromise:l,dataNormalizationMethod:y,goToPage:b})})})]})},B=({imagesPromise:s,imageRepository:r,service:n})=>{const{data:t}=i.use(s),{images:o}=R(t),a=o.find(m=>m.repository===r);return a?e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:["Image ",a.repository]}),e.jsxs(C,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(x,{children:[e.jsx(p,{children:"Details"}),e.jsx(c,{children:e.jsxs(d,{gap:"1",direction:"horizontal",wrap:!0,children:[e.jsx(j,{pillKey:"repository",pillKeyLabel:"repository",pillValue:a.repository,pillValueLabel:a.repository}),a.versionsCount!==void 0&&a.versionsCount>0&&e.jsx(j,{pillKey:"versions",pillKeyLabel:"versions",pillValue:a.versionsCount.toString(),pillValueLabel:a.versionsCount.toString()})]})})]}),e.jsxs(x,{children:[e.jsx(p,{children:"Vulnerabilities Counts"}),e.jsx(c,{children:e.jsx(z,{counts:a.vulnerabilityCounts})})]})]}),n&&r&&a&&e.jsx(A,{service:n,image:a})]}):null};function X(){const{imagesPromise:s}=g.useLoaderData(),{service:r,image:n}=g.useParams();return e.jsx(h,{displayErrorMessage:!0,children:e.jsx(i.Suspense,{fallback:e.jsx(L,{className:"mt-4"}),children:e.jsx(B,{imagesPromise:s,imageRepository:n,service:r})})})}export{X as component};
