import{j as e,S as g,B as h,K as d,g as f,u as C,a as V,b as v,y as b,J as L,f as S,q as F,V as I,C as P,U as x,c as w,d as T,z as m,e as R}from"./App-Cuvr0AXa.js";import{a as t}from"./index-DJvjIZDG.js";import{u as z,g as k,i as B,E as y,a as D,C as U,I as M}from"./IssueCountsPerSeverityLevel-BOZNF_vJ.js";import{I as $}from"./IssueTimestamp-4GOb7EOj.js";import{F as q}from"./index-CXrZn8Ly.js";const G=s=>`
    border-l-2
    ${k(s.toLowerCase()||"none")}
    h-full
    pl-5
  `,A=s=>{const r=(s||"none").toLowerCase(),n=k(r||"none");return e.jsx(f,{icon:B[r]||"help",color:n})},_=({vulnerability:s,selected:r,onItemClick:n})=>{const[i,l]=t.useState(!1),{needsExpansion:a,textRef:c}=z(s.description),o=u=>{u.preventDefault(),u.stopPropagation(),l(!i)};return e.jsxs(g,{className:`cursor-pointer ${r?"active":""}`,onClick:n,children:[e.jsx(h,{className:"pl-0",children:e.jsx("div",{className:G(s.severity),children:A(s.severity)})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(d,{gap:"1.5",alignment:"center",children:[e.jsx(f,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(h,{className:"whitespace-nowrap",children:e.jsx($,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(h,{children:e.jsxs(d,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:c,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&a&&e.jsx("a",{href:"#",onClick:o,className:"link-hover",children:e.jsxs(d,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(f,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},J=({vulnerabilitiesPromise:s})=>{const r=C(),{vulnerability:n}=V({from:"/vulnerabilities/"}),{error:i,data:l}=t.use(s),{vulnerabilities:a}=v(l),c=t.useCallback(o=>{r({to:"/vulnerabilities",search:u=>({...u,vulnerability:o.name})})},[r]);return i?e.jsxs(y,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):a.length===0?e.jsx(y,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):a.map(o=>e.jsx(_,{vulnerability:o,selected:o.name===n,onItemClick:()=>c(o)},o.name))},K=({vulnerabilityName:s,vulnerabilitiesPromise:r,onServiceClick:n})=>{const i=C(),l=p=>{n?n(p):i({to:"/services/$service",params:{service:p}})},{data:a}=t.use(r),{vulnerabilities:c}=v(a),o=c.find(p=>p.name===s);if(!o)return e.jsxs("div",{className:"text-sm text-theme-light",children:["Vulnerability not found: ",s]});const u=o.services||[];return u.length===0?e.jsx("div",{className:"text-sm text-theme-light",children:"No services affected by this vulnerability."}):e.jsx("div",{className:"mb-4",children:e.jsx(t.Suspense,{fallback:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]}),children:e.jsx(d,{gap:"4",direction:"horizontal",wrap:!0,children:u.map((p,j)=>e.jsx("a",{href:"#",onClick:N=>{N.preventDefault(),l(p.ccrn)},className:"link-hover",children:p.ccrn},j))})})})},O=({vulnerabilitiesPromise:s,vulnerabilityName:r})=>{const{data:n}=t.use(s),{vulnerabilities:i}=v(n),l=i.find(a=>a.name===r);return l?e.jsx(d,{gap:"1",direction:"horizontal",wrap:!0,children:e.jsx(t.Suspense,{fallback:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]}),children:l.supportGroups?.map(a=>e.jsx(L,{pillValue:a,pillValueLabel:a},a))})}):null},H=({vulnerabilitiesPromise:s,vulnerabilityName:r})=>{const{data:n}=t.use(s),{vulnerabilities:i}=v(n),l=i.find(c=>c.name===r),{servicesCount:a}=l||{servicesCount:0};return a},W=()=>{const s=C(),{queryClient:r,apiClient:n}=D({from:"/vulnerabilities/"}),{vulnerability:i}=V({from:"/vulnerabilities/"}),[l,a]=t.useState(void 0),c=t.useMemo(()=>{if(i)return S({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:i}]}})},[i,r,n]),o=t.useMemo(()=>{if(i)return S({queryClient:r,apiClient:n,filterSettings:{selectedFilters:[{name:"name",value:i}]},afterServices:l})},[i,l,r,n]),u=t.useCallback(()=>{s({to:"/vulnerabilities",search:j=>{const{vulnerability:N,...E}=j;return{...E}}})},[s]),p=t.useCallback(j=>{s({to:"/services/$service",params:{service:j}})},[s]);return e.jsx(F,{heading:i?`${i} Overview`:void 0,opened:!!i,onClose:u,size:"large",children:e.jsx(I,{children:i&&c&&o&&e.jsx(t.Suspense,{children:e.jsxs(P,{columns:2,gridColumnTemplate:"15% auto",minContentColumns:[1],className:"mb-6",children:[e.jsxs(g,{children:[e.jsx(x,{className:"whitespace-nowrap",children:"Support Groups"}),e.jsx(h,{children:e.jsx(O,{vulnerabilitiesPromise:c,vulnerabilityName:i})})]}),e.jsxs(g,{children:[e.jsxs(x,{className:"whitespace-nowrap",children:["Services (",e.jsx(t.Suspense,{children:e.jsx(H,{vulnerabilitiesPromise:c,vulnerabilityName:i})}),")"]}),e.jsx(h,{children:e.jsx(K,{vulnerabilityName:i,vulnerabilitiesPromise:o,onServiceClick:p})})]})]})})})})},X=()=>{const{queryClient:s,apiClient:r}=D({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:n,filterSettings:i}=w({from:"/vulnerabilities/"}),[l,a]=t.useState(n),c=t.useCallback(o=>{const u=S({queryClient:s,apiClient:r,filterSettings:i,after:o});a(u)},[a,s,r,i]);return t.useEffect(()=>{a(n)},[a,n]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(P,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(g,{children:[e.jsx(x,{children:e.jsx(f,{icon:"monitorHeart"})}),e.jsx(x,{children:"Vulnerability"}),e.jsx(x,{children:"Services"}),e.jsx(x,{children:"Target Date"}),e.jsx(x,{children:"Description"})]}),e.jsx(t.Suspense,{fallback:e.jsx(y,{colSpan:5,children:e.jsxs(d,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(b,{variant:"primary"})]})}),children:e.jsx(J,{vulnerabilitiesPromise:l})})]}),e.jsx(t.Suspense,{children:e.jsx(U,{dataPromise:l,goToPage:c,dataNormalizationMethod:v})}),e.jsx(W,{})]})},Q=()=>{const s=C(),{filters:r,filterSettings:n}=w({from:"/vulnerabilities/"}),i=t.useCallback(l=>{s({to:"/vulnerabilities",search:{...T(l)}})},[n,s]);return e.jsx(q,{filters:r,filterSettings:n,onFilterChange:i,searchInputPlaceholder:"search term for vulnerabilities name"})},Y=({vulnerabilitiesPromise:s})=>{const{error:r,data:n}=t.use(s),{vulnerabilitiesCounts:i}=v(n);return e.jsx(d,{gap:"1",children:r?e.jsx("div",{className:"font-bold",children:"All vulnerabilities: --"}):e.jsx(M,{counts:i})})},Z=()=>{const{vulnerabilitiesPromise:s}=w({from:"/vulnerabilities/"});return e.jsx(d,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(t.Suspense,{fallback:e.jsx(b,{size:"small"}),children:e.jsx(Y,{vulnerabilitiesPromise:s})})})},ee=()=>e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsxs(t.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(b,{size:"small"})}),children:[e.jsx(Z,{}),e.jsx(X,{})]})]});m.object({vulnerability:m.string().optional(),searchTerm:m.preprocess(s=>typeof s=="number"?s.toString():s,m.string().optional())}).catchall(m.preprocess((s,r)=>{if(!(r.path.length>0&&typeof r.path[0]=="string"&&!r.path[0].startsWith(R)))return s},m.union([m.string(),m.array(m.string()),m.undefined()])));const ae=ee;export{ae as component};
