import{j as o,aL as J,aM as oe,aN as ce,x as D,aI as I,aC as A,s as z,a as G,e as V,c as X,U as Y,T as ee,D as he,Y as le,K as ue,O as de,H as pe,M as U,I as fe,J as me,A as ye,h as be,aw as te,az as T,aJ as N,aK as ge,ax as F,ay as v,aA as k,aB as ve,aD as M,aE as we,aF as xe,aG as Ce,aH as Q}from"./App-De9YMIZw-BDqQU9m9.js";import{j as d}from"./_extensionId._-Dzcs6pzI.js";var je=class extends te{constructor(e,t){super(),this.options=t,this.#s=e,this.#a=null,this.#o=F(),this.options.experimental_prefetchInRender||this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}#s;#e=void 0;#r=void 0;#t=void 0;#i;#n;#o;#a;#m;#d;#p;#h;#l;#c;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),_(this.#e,this.options)?this.#u():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return P(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return P(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#x(),this.#e.removeObserver(this)}setOptions(e,t){const s=this.options,r=this.#e;if(this.options=this.#s.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof v(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#C(),this.#e.setOptions(this.options),s._defaulted&&!T(this.options,s)&&this.#s.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const i=this.hasListeners();i&&B(this.#e,r,this.options,s)&&this.#u(),this.updateResult(t),i&&(this.#e!==r||v(this.options.enabled,this.#e)!==v(s.enabled,this.#e)||k(this.options.staleTime,this.#e)!==k(s.staleTime,this.#e))&&this.#y();const c=this.#b();i&&(this.#e!==r||v(this.options.enabled,this.#e)!==v(s.enabled,this.#e)||c!==this.#c)&&this.#g(c)}getOptimisticResult(e){const t=this.#s.getQueryCache().build(this.#s,e),s=this.createResult(t,e);return Ee(this,s)&&(this.#t=s,this.#n=this.options,this.#i=this.#e.state),s}getCurrentResult(){return this.#t}trackResult(e,t){const s={};return Object.keys(e).forEach(r=>{Object.defineProperty(s,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),t?.(r),e[r])})}),s}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#e}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const t=this.#s.defaultQueryOptions(e),s=this.#s.getQueryCache().build(this.#s,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#u({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#u(e){this.#C();let t=this.#e.fetch(this.options,e);return e?.throwOnError||(t=t.catch(ve)),t}#y(){this.#w();const e=k(this.options.staleTime,this.#e);if(A||this.#t.isStale||!M(e))return;const t=we(this.#t.dataUpdatedAt,e)+1;this.#h=setTimeout(()=>{this.#t.isStale||this.updateResult()},t)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#g(e){this.#x(),this.#c=e,!(A||v(this.options.enabled,this.#e)===!1||!M(this.#c)||this.#c===0)&&(this.#l=setInterval(()=>{(this.options.refetchIntervalInBackground||xe.isFocused())&&this.#u()},this.#c))}#v(){this.#y(),this.#g(this.#b())}#w(){this.#h&&(clearTimeout(this.#h),this.#h=void 0)}#x(){this.#l&&(clearInterval(this.#l),this.#l=void 0)}createResult(e,t){const s=this.#e,r=this.options,i=this.#t,c=this.#i,n=this.#n,m=e!==s?e.state:this.#r,{state:l}=e;let a={...l},b=!1,u;if(t._optimisticResults){const f=this.hasListeners(),g=!f&&_(e,t),x=f&&B(e,s,t,r);(g||x)&&(a={...a,...Ce(l.data,e.options)}),t._optimisticResults==="isRestoring"&&(a.fetchStatus="idle")}let{error:w,errorUpdatedAt:C,status:y}=a;if(t.select&&a.data!==void 0)if(i&&a.data===c?.data&&t.select===this.#m)u=this.#d;else try{this.#m=t.select,u=t.select(a.data),u=Q(i?.data,u,t),this.#d=u,this.#a=null}catch(f){this.#a=f}else u=a.data;if(t.placeholderData!==void 0&&u===void 0&&y==="pending"){let f;if(i?.isPlaceholderData&&t.placeholderData===n?.placeholderData)f=i.data;else if(f=typeof t.placeholderData=="function"?t.placeholderData(this.#p?.state.data,this.#p):t.placeholderData,t.select&&f!==void 0)try{f=t.select(f),this.#a=null}catch(g){this.#a=g}f!==void 0&&(y="success",u=Q(i?.data,f,t),b=!0)}this.#a&&(w=this.#a,u=this.#d,C=Date.now(),y="error");const O=a.fetchStatus==="fetching",E=y==="pending",S=y==="error",j=E&&O,h=u!==void 0,p={status:y,fetchStatus:a.fetchStatus,isPending:E,isSuccess:y==="success",isError:S,isInitialLoading:j,isLoading:j,data:u,dataUpdatedAt:a.dataUpdatedAt,error:w,errorUpdatedAt:C,failureCount:a.fetchFailureCount,failureReason:a.fetchFailureReason,errorUpdateCount:a.errorUpdateCount,isFetched:a.dataUpdateCount>0||a.errorUpdateCount>0,isFetchedAfterMount:a.dataUpdateCount>m.dataUpdateCount||a.errorUpdateCount>m.errorUpdateCount,isFetching:O,isRefetching:O&&!E,isLoadingError:S&&!h,isPaused:a.fetchStatus==="paused",isPlaceholderData:b,isRefetchError:S&&h,isStale:L(e,t),refetch:this.refetch,promise:this.#o};if(this.options.experimental_prefetchInRender){const f=R=>{p.status==="error"?R.reject(p.error):p.data!==void 0&&R.resolve(p.data)},g=()=>{const R=this.#o=p.promise=F();f(R)},x=this.#o;switch(x.status){case"pending":e.queryHash===s.queryHash&&f(x);break;case"fulfilled":(p.status==="error"||p.data!==x.value)&&g();break;case"rejected":(p.status!=="error"||p.error!==x.reason)&&g();break}}return p}updateResult(e){const t=this.#t,s=this.createResult(this.#e,this.options);if(this.#i=this.#e.state,this.#n=this.options,this.#i.data!==void 0&&(this.#p=this.#e),T(s,t))return;this.#t=s;const r={},i=()=>{if(!t)return!0;const{notifyOnChangeProps:c}=this.options,n=typeof c=="function"?c():c;if(n==="all"||!n&&!this.#f.size)return!0;const m=new Set(n??this.#f);return this.options.throwOnError&&m.add("error"),Object.keys(this.#t).some(l=>{const a=l;return this.#t[a]!==t[a]&&m.has(a)})};e?.listeners!==!1&&i()&&(r.listeners=!0),this.#j({...r,...e})}#C(){const e=this.#s.getQueryCache().build(this.#s,this.options);if(e===this.#e)return;const t=this.#e;this.#e=e,this.#r=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#j(e){I.batch(()=>{e.listeners&&this.listeners.forEach(t=>{t(this.#t)}),this.#s.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function Oe(e,t){return v(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function _(e,t){return Oe(e,t)||e.state.data!==void 0&&P(e,t,t.refetchOnMount)}function P(e,t,s){if(v(t.enabled,e)!==!1){const r=typeof s=="function"?s(e):s;return r==="always"||r!==!1&&L(e,t)}return!1}function B(e,t,s,r){return(e!==t||v(r.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&L(e,s)}function L(e,t){return v(t.enabled,e)!==!1&&e.isStaleByTime(k(t.staleTime,e))}function Ee(e,t){return!T(e.getCurrentResult(),t)}var Se=class extends te{#s;#e=void 0;#r;#t;constructor(e,t){super(),this.#s=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#s.defaultMutationOptions(e),T(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&N(t.mutationKey)!==N(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#n(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#n()}mutate(e,t){return this.#t=t,this.#r?.removeObserver(this),this.#r=this.#s.getMutationCache().build(this.#s,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){const e=this.#r?.state??ge();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#n(e){I.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#e.variables,s=this.#e.context;e?.type==="success"?(this.#t.onSuccess?.(e.data,t,s),this.#t.onSettled?.(e.data,null,t,s)):e?.type==="error"&&(this.#t.onError?.(e.error,t,s),this.#t.onSettled?.(void 0,e.error,t,s))}this.listeners.forEach(t=>{t(this.#e)})})}},se=d.createContext(!1),Re=()=>d.useContext(se);se.Provider;function ke(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Te=d.createContext(ke()),De=()=>d.useContext(Te);function re(e,t){return typeof e=="function"?e(...t):!!e}function q(){}var Ie=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},Ue=e=>{d.useEffect(()=>{e.clearReset()},[e])},Ae=({result:e,errorResetBoundary:t,throwOnError:s,query:r})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&re(s,[e.error,r]),Pe=e=>{e.suspense&&(e.staleTime===void 0&&(e.staleTime=1e3),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3)))},qe=(e,t)=>e.isLoading&&e.isFetching&&!t,Le=(e,t)=>e?.suspense&&t.isPending,$=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()}),Ne={};function Fe(e,t,s){if(Ne.NODE_ENV!=="production"&&(typeof e!="object"||Array.isArray(e)))throw new Error('Bad argument type. Starting with v5, only the "Object" form is allowed when calling query related functions. Please use the error stack to find the culprit call. More info here: https://tanstack.com/query/latest/docs/react/guides/migrating-to-v5#supports-a-single-signature-one-object');const r=D(),i=Re(),c=De(),n=r.defaultQueryOptions(e);r.getDefaultOptions().queries?._experimental_beforeQuery?.(n),n._optimisticResults=i?"isRestoring":"optimistic",Pe(n),Ie(n,c),Ue(c);const m=!r.getQueryCache().get(n.queryHash),[l]=d.useState(()=>new t(r,n)),a=l.getOptimisticResult(n);if(d.useSyncExternalStore(d.useCallback(b=>{const u=i?q:l.subscribe(I.batchCalls(b));return l.updateResult(),u},[l,i]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),d.useEffect(()=>{l.setOptions(n,{listeners:!1})},[n,l]),Le(n,a))throw $(n,l,c);if(Ae({result:a,errorResetBoundary:c,throwOnError:n.throwOnError,query:r.getQueryCache().get(n.queryHash)}))throw a.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(n,a),n.experimental_prefetchInRender&&!A&&qe(a,i)&&(m?$(n,l,c):r.getQueryCache().get(n.queryHash)?.promise)?.catch(q).finally(()=>{l.updateResult()}),n.notifyOnChangeProps?a:l.trackResult(a)}function Me(e,t){return Fe(e,je)}function Qe(e,t){const s=D(),[r]=d.useState(()=>new Se(s,e));d.useEffect(()=>{r.setOptions(e)},[r,e]);const i=d.useSyncExternalStore(d.useCallback(n=>r.subscribe(I.batchCalls(n)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),c=d.useCallback((n,m)=>{r.mutate(n,m).catch(q)},[r]);if(i.error&&re(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:c,mutateAsync:i.mutate}}const ie=e=>typeof e=="string"?e.includes("Failed to fetch")?"Could not reach endpoint. Possible causes could include network issues, incorrect URL, or server outages.":_e(e):typeof e=="object"&&e?.message?(e?.code?`API: ${e.code}, `:"")+e?.message:"An error occurred",_e=e=>{let t=e;try{t=JSON.parse(e),t?.message&&(t=(t?.code?`API: ${t.code}, `:"")+t?.message)}catch(s){return console.warn(s),e}return t},ae=(e,t)=>{let s;return function(...r){const i=this;clearTimeout(s),s=setTimeout(()=>e.apply(i,r),t)}},Be=async e=>{try{const t=await fetch(`${e}/silences`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});return{silences:await t.json()}}catch(t){throw console.error(t),t}},$e=async e=>{try{const t=await fetch(`${e.endpoint}/silence/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!t.ok){const s=await t.json().catch(()=>null),r=s?.message||s||`Error ${t.status}: ${t.statusText}`;throw new Error(r)}return await t}catch(t){throw console.error(t),t}},Ke=async e=>{try{const t=await fetch(`${e.endpoint}/silences`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e.silence)});if(!t.ok){const s=await t.json().catch(()=>null),r=s?.message||s||`Error ${t.status}: ${t.statusText}`;throw new Error(r)}return await t.json()}catch(t){throw console.error(t),t}},He={deleteSilences:$e,createSilences:Ke},ne=(e,t={})=>{const s=J(),r=He[e];if(!r)throw new Error(`No mutation function mapped for key: ${e}`);return Qe({mutationFn:i=>r({...i,endpoint:s}),onError:t?.onError,...t})},et=e=>{const{addMessage:t}=z(),s=e.silence,[r,i]=d.useState(!1),c=D(),n=G(),{setSilences:m}=V(),{mutate:l}=ne("deleteSilences",{onSuccess:b=>{c.cancelQueries({queryKey:["silences"]});const u=n.filter(y=>y.id===b.id);let w=u.length>0?u[0]:null;w={...w,status:{state:X.SILENCE_EXPIRED}};const C=[...n.filter(y=>y?.id!==b?.id),w];m({items:C}),t({variant:"success",text:"Silence expired successfully. Please note that it may take up to 5 minutes for the silence to show up as expired."})},onError:b=>{t({variant:"error",text:ie(b)})},onSettled:()=>{c.invalidateQueries({queryKey:["silences"]})}}),a=ae(()=>{l({id:s.id}),i(!1)},200);return o.jsxs(o.Fragment,{children:[o.jsx(Y,{onClick:()=>i(!0),children:"Expire"}),r&&o.jsxs(ee,{cancelButtonLabel:"Cancel",confirmButtonLabel:"Expire Silence",onCancel:()=>i(!1),onConfirm:a,open:!0,title:"Confirmation needed",children:[o.jsxs("p",{children:["Do you really want to expire the silence ",o.jsx("b",{children:s.id}),"?"]}),o.jsxs("p",{children:["Comment for the silence: ",o.jsx("b",{children:s?.comment})]})]})]})},K=[{label:"2 hours",value:2},{label:"12 hours",value:12},{label:"1 day",value:24},{label:"3 days",value:72},{label:"7 days",value:168}],tt=e=>{if(e?.length>0)return e.sort((t,s)=>new Date(s.endsAt).getTime()-new Date(t.endsAt).getTime())[0].endsAt},Ze=e=>{if(!e)return{items:K};const t=new Date,s=(new Date(e).getTime()-t.getTime())/(1e3*60*60),r=K.map(c=>c.value<=s?{...c,label:c.label+" (covered with the existing silence)",covered:!0}:c),i=r.find(c=>!c?.covered);return{items:r,firstNotCovered:i}},st=(e,t=[],s=[])=>{if(!e||!t)return;const r=[];return Object.keys(e).forEach(i=>{const c=e?.[i];if(c){const n={name:i,value:c,isRegex:!1,excluded:!1,configurable:!1};s.includes(i)||(t.includes(i)?r.push({...n,excluded:!0,configurable:!0}):r.push(n))}}),r},We=e=>{const t={};return e?.comment?.length<3&&(t.comment||(t.comment=[]),t.comment.push("Please enter at least 3 characters")),e?.createdBy?.length<1&&(t.createdBy||(t.createdBy=[]),t.createdBy.push("Please enter a name")),t},H=e=>e.map((t,s)=>o.jsx("span",{className:"block text-theme-danger ",children:t},s)),Z={duration:2,comment:""},rt=e=>{const t=e.silence,{addMessage:s}=z(),r=he(),i=G(),{setSilences:c}=V(),n=D(),[m,l]=d.useState(!1),[a,b]=d.useState(Z),[u,w]=d.useState({}),[C,y]=d.useState(null);d.useLayoutEffect(()=>{m&&(b({...a,...Z,createdBy:r||"",matchers:t.matchers,comment:t.comment}),y(null),w({}))},[m]);const O=d.useMemo(()=>{const h=Ze(0);return h.firstNotCovered&&b({...a,duration:h.firstNotCovered.value}),h.items},[]),{mutate:E}=ne("createSilences",{onMutate:h=>{n.cancelQueries({queryKey:["silences"]});const p={...h.silence,status:{state:X.SILENCE_ACTIVE}},f=[...i,p];c({items:f}),l(!1)},onSuccess:h=>{s({variant:"success",text:`A silence object with id ${h?.silenceID} was created successfully. Please note that it may
            take up to 5 minutes for the alert to show up as silenced.`})},onError:h=>{s({variant:"error",text:ie(h)})},onSettled:()=>{n.invalidateQueries({queryKey:["silences"]})}}),S=ae(()=>{y(null);const h=We(a);if(w(h),Object.keys(h).length>0)return;const p={...a},f=new Date,g=new Date;g.setHours(g.getHours()+Number.parseInt(p.duration||4));const x={...p,startsAt:f.toISOString(),endsAt:g.toISOString()};E({silence:x})},200),j=({key:h,value:p})=>{p&&b({...a,[h]:p})};return o.jsxs(o.Fragment,{children:[o.jsx(Y,{onClick:h=>{h.stopPropagation(),l(!m)},children:"Recreate"}),m&&o.jsxs(ee,{title:"New Silence for",size:"large",open:!0,confirmButtonLabel:"Save",onCancel:()=>l(!1),onConfirm:S,children:[C&&o.jsx(le,{text:C,variant:"danger"}),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"advanced-area overflow-hidden",children:[o.jsx("p",{className:"mt-2",children:"Matchers attached to this silence"}),o.jsx(ue,{gap:"2",alignment:"start",wrap:!0,className:"mt-2",children:a?.matchers&&Object.keys(a?.matchers).map((h,p)=>o.jsx(de,{pillKey:t?.matchers[h]?.name,pillKeyLabel:t?.matchers[h]?.name,pillValue:t?.matchers[h]?.value,pillValueLabel:t?.matchers[h]?.value},p))})]}),o.jsxs(pe,{className:"mt-6",children:[o.jsx(U,{children:o.jsx(fe,{required:!0,label:"Silenced by",value:a.createdBy,disabled:!!r,onChange:h=>j({key:"createdBy",value:h.target.value}),errortext:u.createdBy&&H(u.createdBy)})}),o.jsx(U,{children:o.jsx(me,{className:"h-20",label:"Description",value:a.comment,onChange:h=>j({key:"comment",value:h.target.value}),errortext:u.comment&&H(u.comment),required:!0})}),o.jsx(U,{children:o.jsx(ye,{required:!0,label:"Duration",value:a.duration,onChange:h=>j({key:"duration",value:h}),children:O?.map(h=>o.jsx(be,{label:h.label,value:String(h.value)},h.value))})})]})]})]})]})};let W;const Je=async e=>{try{const t=await fetch(`${e}/alerts`);if(!t.ok)throw await t.json().catch(()=>{throw new Error("Unexpected error: Unable to parse error response.")});const s=await t.json(),r=oe(s);r.forEach(c=>{c.labels&&(c.labels.status=c.status?.state)});const i=JSON.stringify(r);return W!==i?(W=i,{alerts:r,counts:ce(r)}):null}catch(t){throw console.error(t),t}},ze={alerts:Je,silences:Be};class Ge extends Error{constructor(t){super(t.message),this.name="CorsNetworkError",t.stack&&(this.stack=t.stack)}}function Ve(e){if(!(e instanceof TypeError))return!1;const t=e.message||"";return!!(navigator.userAgent.includes("Firefox")&&t.includes("NetworkError"))}const it=(e,{options:t}={})=>{const s=J(),r=ze[e];if(!r)throw new Error(`No fetch function mapped for key: ${e}`);return Me({queryKey:[e],queryFn:()=>r(s).catch(i=>{throw Ve(i)?new Ge(i):i}),...t})},at=()=>o.jsxs("p",{children:["Firefox detected. Please ensure that you have activated ",o.jsx("b",{children:"allow_client_cert"})," to enable the retrieval of alerts and silences from the API.",o.jsxs("ul",{children:[o.jsx("li",{children:"1. Go to about:config (via address bar)"}),o.jsxs("li",{children:["2. Change ",o.jsx("b",{children:"network.cors_preflight.allow_client_cert"})," to ",o.jsx("b",{children:"true"})]}),o.jsx("li",{children:"3. Reload Greenhouse"})]})]});export{Ze as G,Ge as X,it as a,ie as b,ne as c,ae as d,rt as i,st as n,at as o,tt as r,et as s};
