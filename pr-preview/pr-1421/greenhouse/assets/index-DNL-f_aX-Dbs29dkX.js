import{u as E,j as e,o as H,c as x,g as k,V as l,d as C,U as P,W as q,Z as D,i as U,ai as z,aj as K,ak as L,Y as b,al as Q,am as R}from"./App-vF9zOeeO-BmUu5RcU.js";import{G as j}from"./_extensionId._-CZlsEEn1.js";import{s as V}from"./IssueTimestamp-CafW-tA7-BwjKj1X7.js";import{C as $}from"./IssueCountsPerSeverityLevel-CaILDW4D-U8NTBIX4.js";const A=i=>{const a=i.toLowerCase(),r=k(a);return e.jsx(C,{icon:U[a]||"help",color:r})},G=({severity:i})=>A(i),I="Mark as False Positive",M="Cancel",Y=({open:i,onClose:a,onConfirm:r,vulnerability:c,service:v,image:g})=>{const[s,d]=j.useState(""),[w,t]=j.useState(!1),[p,o]=j.useState(""),f=async()=>{if(!s.trim()){o("Description is required");return}o(""),t(!0);try{const n={type:Q.FalsePositive,vulnerability:c,service:v,image:g,description:s.trim()};await r(n),d("")}catch(n){console.error("Failed to create remediation:",n)}finally{t(!1)}},m=()=>{d(""),o(""),a()},y=n=>{d(n.target.value),p&&o("")};return e.jsx(z,{title:"Mark as False Positive",open:i,onCancel:m,modalFooter:e.jsx(L,{children:e.jsxs(l,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(b,{onClick:m,label:M,disabled:w}),e.jsx(b,{onClick:f,label:I,variant:"primary",disabled:w||!s.trim()})]})}),children:e.jsxs(l,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",v]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",g]}),e.jsx("div",{children:e.jsx(K,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:s,onChange:y,rows:4,required:!0,invalid:!!p,errortext:p||""})})]})})},B=async({apiClient:i,input:a})=>{const r=await i.mutate({mutation:R,variables:{input:a}});if(!r.data?.createRemediation)throw new Error("Failed to create remediation");return r.data.createRemediation},_=i=>`
    border-l-2
    ${k(i.toLowerCase())}
    h-full
    pl-5
  `,J=({issue:i,service:a,image:r,showFalsePositiveAction:c=!0,onFalsePositiveSuccess:v,onFalsePositiveError:g})=>{const[s,d]=j.useState(!1),[w,t]=j.useState(!1),{needsExpansion:p,textRef:o}=E(i?.description||""),{apiClient:f,queryClient:m}=$({from:"/services/$service"});if(!i||!i.name)return null;const y=h=>{h.preventDefault(),d(!s)},n=()=>{t(!0)},F=async h=>{try{await B({apiClient:f,input:h}),t(!1),m.invalidateQueries({queryKey:["images"]}),m.invalidateQueries({queryKey:["remediations"]});const u=i?.name||"unknown";v?.(u)}catch(u){console.error("Failed to create remediation:",u);const S=i?.name||"unknown";g?.(u instanceof Error?u:new Error("Failed to create remediation"),S)}},N=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:_(i.severity),children:e.jsx(G,{severity:i.severity})})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(C,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(V,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&p&&e.jsx("a",{href:"#",onClick:y,className:"link-hover",children:e.jsxs(l,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(C,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})}),c&&e.jsx(x,{className:"cursor-default interactive",onClick:h=>h.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(q,{children:e.jsx(D,{label:"False-positive",onClick:n})})})})]}),c&&e.jsx(Y,{open:w,onClose:N,onConfirm:F,vulnerability:i.name,service:a,image:r})]})};export{J as H};
