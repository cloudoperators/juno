import{ai as v,j as e,E as f,m as E,ah as P,a8 as w,P as y,o as x,n as t,c as j,V as p,f as h,d as u,ag as C,ab as L,ac as K,ad as H,ae as D,af as S}from"./App-D2RrjzBc-CtlFNKLV.js";import{G as m}from"./_extensionId._-8V-6klNq.js";import{E as k,f as A,b as O,a as b}from"./IssueCountsPerSeverityLevel-BgSE3hJ9-DTQ5TLvO.js";import{n as F}from"./SectionContentHeading-B0HlvpMy-Drntvsjo.js";import{a as X}from"./index-2Wu8hwef-KYNNcWMp.js";import"./index-D1U2VCB5.js";import"./Shell-BADX8tyo.js";import"./index-Di10iGng.js";import"./IssueTimestamp-ttrvf95_-UHDHRigR.js";const I=({instance:s})=>e.jsxs(L,{className:"text-sm text-theme-light",children:[e.jsxs(p,{children:[e.jsx("div",{className:"text-sm whitespace-nowrap overflow-hidden text-ellipsis w-full",children:s?.pod||"--"}),e.jsxs(K,{triggerEvent:"hover",children:[e.jsx(H,{children:e.jsx(u,{icon:"info",size:"18",className:"cursor-pointer hover:text-theme-primary"})}),e.jsxs(D,{children:[e.jsxs("span",{children:[" Namespace: ",s?.namespace||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Region: ",s?.region||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Cluster: ",s?.cluster||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Container: ",s?.container||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Pod: ",s?.pod||"--"]})]})]})]}),e.jsx("div",{className:"text-sm whitespace-nowrap",children:s?.cluster||"--"})]}),M=s=>{const i={};return s.forEach(a=>{const r=a.namespace||"Unknown",o=a.container||"All";i[r]||(i[r]={}),i[r][o]||(i[r][o]=[]),i[r][o].push(a)}),i},R=({imageVersion:s})=>{const[i,a]=m.useState(!1),r=s.componentInstances||[],o=M(r);m.useEffect(()=>{a(!1)},[s]);const c=l=>{l.preventDefault(),a(!i)};return e.jsxs(e.Fragment,{children:[i&&o&&Object.entries(o).map(([l,n])=>e.jsx("div",{children:Object.entries(n).map(([d,V])=>e.jsxs("div",{className:"my-2",children:[e.jsxs("div",{className:"mb-4",children:["Namespace ",e.jsx("b",{children:l})," - Container ",e.jsx("b",{children:d})]}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,_minmax(240px,_1fr))] gap-2",children:V.map((g,N)=>e.jsx(I,{instance:g},g.id||N))})]},`${l}-${d}`))},l)),e.jsx("div",{className:"advance-link",children:e.jsx("a",{href:"#",rel:"noopener noreferrer",onClick:c,children:e.jsxs(p,{alignment:"center",children:[i?"Hide Occurrences":"Display Occurrences",e.jsx(u,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})})]})},G=({issuesPromise:s,service:i,image:a})=>{const{error:r,data:o}=m.use(s),{imageVersion:c}=S(o);return r?e.jsxs(b,{colSpan:4,children:["Error loading vulnerabilities: ",r.message]}):!c||!c.vulnerabilities||c.vulnerabilities.length===0?e.jsx(b,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):e.jsx(e.Fragment,{children:c.vulnerabilities.map(l=>e.jsx(X,{issue:l,service:i,image:a,showFalsePositiveAction:!1},l.id||l.name))})},T=({issuesPromise:s,service:i,image:a})=>e.jsxs(e.Fragment,{children:[e.jsx(p,{gap:"2",className:"mb-4 mt-8",children:e.jsx(C,{children:"Vulnerabilities"})}),e.jsxs(y,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(x,{children:[e.jsx(t,{children:e.jsx(u,{icon:"monitorHeart"})}),e.jsx(t,{children:"Vulnerability"}),e.jsx(t,{children:"Target Date"}),e.jsx(t,{children:"Description"})]}),s&&e.jsx(f,{displayErrorMessage:!0,fallbackRender:A({colspan:4}),resetKeys:[s],children:e.jsx(m.Suspense,{fallback:e.jsx(O,{colSpan:4}),children:e.jsx(G,{issuesPromise:s,service:i,image:a})})})]})]}),z=({imageVersionsPromise:s,imageVersion:i,service:a,imageRepository:r})=>{const{data:o,error:c}=m.use(s);if(c)return e.jsxs("div",{children:["Error loading image version: ",c.message]});const{imageVersions:l}=P(o),n=l[0];return n?e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:["Image ",n.repository||r," - Version ",w(n.version)]}),e.jsxs(y,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(x,{children:[e.jsx(t,{children:"Details"}),e.jsx(j,{children:e.jsxs(p,{gap:"1",direction:"horizontal",wrap:!0,children:[n.tag&&e.jsx(h,{pillKey:"tag",pillKeyLabel:"tag",pillValue:n.tag,pillValueLabel:n.tag}),e.jsx(h,{pillKey:"repository",pillKeyLabel:"repository",pillValue:n.repository||r,pillValueLabel:n.repository||r}),e.jsx(h,{pillKey:"version",pillKeyLabel:"version",pillValue:n.version,pillValueLabel:n.version})]})})]}),e.jsxs(x,{children:[e.jsx(t,{children:"Vulnerabilities Counts"}),e.jsx(j,{children:e.jsx(k,{counts:n.issueCounts})})]}),e.jsxs(x,{children:[e.jsx(t,{className:"whitespace-nowrap",children:`Occurrences (${n.componentInstancesCount||0})`}),e.jsx(j,{children:e.jsx(R,{imageVersion:n})})]})]}),a&&i&&n&&e.jsx(T,{issuesPromise:s,service:a,image:n.repository||r})]}):e.jsxs("div",{children:[e.jsxs("p",{children:["Image version not found: ",i]}),e.jsxs("p",{children:["Available versions: ",l.map(d=>d.version).join(", ")||"none"]}),e.jsxs("p",{children:["Data: ",JSON.stringify(o,null,2)]})]})};function Z(){const{imageVersionsPromise:s}=v.useLoaderData(),{service:i,image:a,version:r}=v.useParams();return e.jsx(f,{displayErrorMessage:!0,children:e.jsx(m.Suspense,{fallback:e.jsx(E,{className:"mt-4"}),children:e.jsx(z,{imageVersionsPromise:s,imageVersion:r,service:i,imageRepository:a})})})}export{Z as component};
