import{a as x,b as g,C as L,j as e,S as C,D as F,B as E,E as u,l as y,V as b,m as D,A as H,P as I,o as V,n as v,z as S,y as K,k as $,p as z,c as m,f as M,r as O,t as d,s as q,v as G,w as T,x as X}from"./App-BQk8RP7q-CnbQkqTu.js";import{G as l}from"./_extensionId._-C6qpIImd.js";import{C as k,f as W,b as B,E as J,a as P,i as p}from"./IssueCountsPerSeverityLevel-BfkLaxaZ-C4QMKi9f.js";import{P as Y}from"./index-CMw9rrl2-D_n_t8EC.js";import{g as _}from"./CursorPagination-uK4EcnKd-Kk617Nsi.js";import{K as Q}from"./index-UFH-DFux-DidwcdjQ.js";import"./index-Dix4Az1T.js";import"./Shell-CWncoRB9.js";import"./index-CK2QkhwD.js";import"./SectionContentHeading-DkaJxedS-kEX7qM4H.js";const R=s=>s.charAt(0).toUpperCase()+s.slice(1),U=()=>{const s=x(),{queryClient:i,apiClient:t}=k({from:"/services/"}),{service:r}=g({from:"/services/"}),[n,a]=l.useState(void 0),c=l.useMemo(()=>{if(r)return K({queryClient:i,apiClient:t,filter:{service:[r]},after:n})},[r,n,i,t]),o=l.useCallback(()=>{s({to:"/services",search:h=>{const{service:le,...A}=h;return{...A}}})},[s]),j=l.useCallback(h=>{r&&s(h?{to:"/services/$service/images/$image",params:{service:r,image:h.repository}}:{to:"/services/$service",params:{service:r}})},[s,r]);return e.jsx($,{heading:r?`${R(r)} Overview`:void 0,opened:!!r,onClose:o,size:"large",children:e.jsx(z,{children:e.jsx(u,{displayErrorMessage:!0,children:r&&c&&e.jsx(Y,{displayActions:!0,imagesPromise:c,onDetailsButtonClick:j,goToPage:a})})})})},N={supportGroups:"support_group",region:"region",integrity:"integrity"},Z=({serviceDetails:s})=>{const i=(t,r)=>e.jsx(M,{pillKey:t,pillKeyLabel:t,pillValue:r,pillValueLabel:r},r);return e.jsx(b,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([t,r])=>Array.isArray(r)?r.map(n=>i(N[t],n)):i(N[t],r))})},ee=({item:s,selected:i,onItemClick:t})=>e.jsxs(V,{className:"cursor-pointer",isSelected:i,onClick:t,children:[e.jsx(m,{children:s.name}),e.jsx(m,{className:"!px-2",children:e.jsx(p,{severity:"critical",count:s.issuesCount.critical,tooltipContent:"Critical Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(p,{severity:"high",count:s.issuesCount.high,tooltipContent:"High Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(p,{severity:"medium",count:s.issuesCount.medium,tooltipContent:"Medium Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(p,{severity:"low",count:s.issuesCount.low,tooltipContent:"Low Vulnerabilities"})}),e.jsx(m,{className:"!px-2",children:e.jsx(p,{severity:"unknown",count:s.issuesCount.none,tooltipContent:"None Vulnerabilities"})}),e.jsx(m,{children:e.jsx(Z,{serviceDetails:s.serviceDetails})})]}),w=7,se=({servicesPromise:s})=>{const i=x(),{service:t}=g({from:"/services/"}),{error:r,data:n}=l.use(s),{services:a}=S(n),c=l.useCallback(o=>{i({to:"/services/$service",params:{service:o.name}})},[i]);return r?e.jsx(P,{colSpan:w,children:"Error loading services"}):a.length===0?e.jsx(P,{colSpan:w,children:"No service found"}):a.map(o=>e.jsx(ee,{item:o,selected:o.name===t,onItemClick:()=>c(o)},o.id))},f=7,re=()=>{const{queryClient:s,apiClient:i}=k({from:"/services/"}),{servicesPromise:t,filterSettings:r}=y({from:"/services/"}),[n,a]=l.useState(t),c=l.useCallback(o=>{const j=H({queryClient:s,apiClient:i,filterSettings:r,after:o});a(j)},[a,s,i,r]);return l.useEffect(()=>{a(t)},[a,t]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(I,{minContentColumns:[1,2,3,4,5,7],columns:f,children:[e.jsxs(V,{children:[e.jsx(v,{children:"Service"}),e.jsx(v,{colSpan:5,className:"whitespace-nowrap",children:"Vulnerability Counts"}),e.jsx(v,{children:"Details"})]}),e.jsx(u,{displayErrorMessage:!0,fallbackRender:W({colspan:f}),resetKeys:[n],children:e.jsx(l.Suspense,{fallback:e.jsx(B,{colSpan:f}),children:e.jsx(se,{servicesPromise:n})})})]}),e.jsx(u,{children:e.jsx(l.Suspense,{children:e.jsx(_,{dataPromise:n,goToPage:c,dataNormalizationMethod:S})})}),e.jsx(U,{})]})},ie=({servicesPromise:s})=>{const{error:i,data:t}=l.use(s),{servicesIssuesCount:r}=S(t);return e.jsx(b,{gap:"1",children:i?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(J,{counts:r})})},te=()=>{const{servicesPromise:s}=y({from:"/services/"});return e.jsx(u,{children:e.jsx(b,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(l.Suspense,{fallback:e.jsx(D,{size:"small"}),children:e.jsx(ie,{servicesPromise:s})})})})},ae=()=>{const s=x(),{filtersPromise:i,filterSettings:t}=y({from:"/services/"}),r=l.useCallback(n=>{s({to:"/services",search:a=>{const c=E(n);return{...Object.fromEntries(Object.entries(a).filter(([o])=>!o.startsWith(C))),...c}}})},[s]);return e.jsx(Q,{filtersPromise:i,filterSettings:t,onFilterChange:r,searchInputPlaceholder:"search term for services name"})},ne=()=>e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsxs(u,{children:[e.jsx(te,{}),e.jsx(re,{})]})]});O({service:d().optional(),searchTerm:d().optional()}).catchall(q((s,i)=>{if(!(i.path.length>0&&typeof i.path[0]=="string"&&!i.path[0].startsWith(C)))return s},G([d(),T(d()),X()])));function fe(){const s=x(),{appProps:i}=k({from:"/services/"}),t=g({from:"/services/"}),{hasAppliedInitialFilters:r,markInitialFiltersApplied:n}=L();return l.useLayoutEffect(()=>{if(!r&&!Object.keys(t).some(a=>a.startsWith(C))&&i?.initialFilters?.support_group?.length){const a=F(i.initialFilters);a.length>0&&(s({to:"/services",search:E({searchTerm:"",selectedFilters:a}),replace:!0}),n())}},[s,i,r,n,t]),e.jsx(ne,{})}export{fe as component};
