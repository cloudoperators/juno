import{u as S,j as e,o as E,c as x,g as F,V as o,d as C,U as P,W as H,Z as q,i as D,ag as R,ah as U,ai as G,Y as b,aj as L,ak as Q}from"./App-BW_MrYFG-a2Mle5AC.js";import{G as u}from"./_extensionId._-DPGachgW.js";import{s as V}from"./IssueTimestamp-B9KuuRci-DUa9cBt4.js";import{C as z}from"./IssueCountsPerSeverityLevel-DP0ME6BC-DmX74uNM.js";const A=i=>{const a=i.toLowerCase(),r=F(a);return e.jsx(C,{icon:D[a]||"help",color:r})},I=({severity:i})=>A(i),K="Mark as False Positive",M="Cancel",Y=({open:i,onClose:a,onConfirm:r,vulnerability:c,service:j,image:v})=>{const[s,d]=u.useState(""),[f,n]=u.useState(!1),[p,l]=u.useState(""),g=async()=>{if(!s.trim()){l("Description is required");return}l(""),n(!0);try{const t={type:L.FalsePositive,vulnerability:c,service:j,image:v,description:s.trim()};await r(t),d("")}catch(t){console.error("Failed to create remediation:",t)}finally{n(!1)}},h=()=>{d(""),l(""),a()},w=t=>{d(t.target.value),p&&l("")};return e.jsx(R,{title:"Mark as False Positive",open:i,onCancel:h,modalFooter:e.jsx(G,{children:e.jsxs(o,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(b,{onClick:h,label:M,disabled:f}),e.jsx(b,{onClick:g,label:K,variant:"primary",disabled:f||!s.trim()})]})}),children:e.jsxs(o,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",j]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",v]}),e.jsx("div",{children:e.jsx(U,{label:"Description *",placeholder:"Add a description explaining why this is a false positive...",value:s,onChange:w,rows:4,required:!0,invalid:!!p,errortext:p||""})})]})})},_=async({apiClient:i,input:a})=>{const r=await i.mutate({mutation:Q,variables:{input:a}});if(!r.data?.createRemediation)throw new Error("Failed to create remediation");return r.data.createRemediation},$=i=>`
    border-l-2
    ${F(i.toLowerCase())}
    h-full
    pl-5
  `,Z=({issue:i,service:a,image:r,showFalsePositiveAction:c=!0,onFalsePositiveSuccess:j,onFalsePositiveError:v})=>{const[s,d]=u.useState(!1),[f,n]=u.useState(!1),{needsExpansion:p,textRef:l}=S(i.description),{apiClient:g,queryClient:h}=z({from:"/services/$service"}),w=m=>{m.preventDefault(),d(!s)},t=()=>{n(!0)},k=async m=>{try{await _({apiClient:g,input:m}),n(!1),h.invalidateQueries({queryKey:["images"]}),h.invalidateQueries({queryKey:["remediations"]}),j?.()}catch(y){console.error("Failed to create remediation:",y),v?.(y instanceof Error?y:new Error("Failed to create remediation"))}},N=()=>{n(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:$(i.severity),children:e.jsx(I,{severity:i.severity})})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(o,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(o,{gap:"1.5",alignment:"center",children:[e.jsx(C,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(V,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(o,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:l,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&p&&e.jsx("a",{href:"#",onClick:w,className:"link-hover",children:e.jsxs(o,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(C,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})}),c&&e.jsx(x,{className:"cursor-default interactive",onClick:m=>m.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(H,{children:e.jsx(q,{label:"False-positive",onClick:t})})})})]}),c&&e.jsx(Y,{open:f,onClose:N,onConfirm:k,vulnerability:i.name,service:a,image:r})]})};export{Z as G};
