import{u as X,j as e,o as D,c as x,g as F,V as u,d as k,Z as P,_ as E,$ as K,i as M,aj as q,a6 as L,ak as U,al as H,am as O,Y as N,an as R,ap as V,ao as $}from"./App-D2RrjzBc-CtlFNKLV.js";import{G as o}from"./_extensionId._-8V-6klNq.js";import{s as z}from"./IssueTimestamp-ttrvf95_-UHDHRigR.js";import{C as A}from"./IssueCountsPerSeverityLevel-BgSE3hJ9-DTQ5TLvO.js";const G=i=>{const a=i.toLowerCase(),r=F(a);return e.jsx(k,{icon:M[a]||"help",color:r})},I=({severity:i})=>G(i),Q="Mark as False Positive",Y="Cancel",_=i=>{if(!i)return;const a=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();return Object.values($).includes(a)?a:void 0},T=({open:i,onClose:a,onConfirm:r,vulnerability:h,severity:v,service:n,image:j,errorMessage:g})=>{const[t,p]=o.useState(""),[l,m]=o.useState(null),[f,y]=o.useState(!1),[c,d]=o.useState(""),b=async()=>{if(!t.trim()){d("Description is required");return}d(""),y(!0);try{const s={type:R.FalsePositive,vulnerability:h,service:n,image:j,description:t.trim(),...v&&{severity:_(v)},...l&&{expirationDate:l.toISOString()}};await r(s),p(""),m(null)}catch(s){console.error("Failed to create remediation:",s)}finally{y(!1)}},w=()=>{p(""),m(null),d(""),a()},S=s=>{p(s.target.value),c&&d("")};return e.jsx(q,{title:"Mark as False Positive",open:i,onCancel:w,modalFooter:e.jsx(O,{children:e.jsxs(u,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(N,{onClick:w,label:Y,disabled:f}),e.jsx(N,{onClick:b,label:Q,variant:"primary",disabled:f||!t.trim()})]})}),children:e.jsxs(u,{gap:"4",direction:"vertical",children:[g&&e.jsx(L,{text:g,variant:"error"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",h]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",n]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",j]}),e.jsx("div",{children:e.jsx(U,{label:"Expiration Date",value:l??void 0,onChange:s=>m(s?.[0]??null),minDate:"today",helptext:"Optional. When this false positive should no longer be considered valid."})}),e.jsx("div",{children:e.jsx(H,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:t,onChange:S,rows:4,required:!0,invalid:!!c,errortext:c||""})})]})})},W=async({apiClient:i,input:a})=>{const r=await i.mutate({mutation:V,variables:{input:a}});if(!r.data?.createRemediation)throw new Error("Failed to create remediation");return r.data.createRemediation},Z=i=>`
    border-l-2
    ${F(i.toLowerCase())}
    h-full
    pl-5
  `,se=({issue:i,service:a,image:r,showFalsePositiveAction:h=!0,onFalsePositiveSuccess:v})=>{const[n,j]=o.useState(!1),[g,t]=o.useState(!1),[p,l]=o.useState(null),{needsExpansion:m,textRef:f}=X(i?.description||""),{apiClient:y,queryClient:c}=A({from:"/services/$service"});if(!i||!i.name)return null;const d=s=>{s.preventDefault(),j(!n)},b=()=>{t(!0)},w=async s=>{l(null);try{await W({apiClient:y,input:s}),t(!1),c.invalidateQueries({queryKey:["images"]}),c.invalidateQueries({queryKey:["remediations"]});const C=i?.name||"unknown";v?.(C)}catch(C){l(C instanceof Error?C.message:"Failed to create remediation")}},S=()=>{l(null),t(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:Z(i.severity),children:e.jsx(I,{severity:i.severity})})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(u,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(k,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(z,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(u,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:f,className:n?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&m&&e.jsx("a",{href:"#",onClick:d,className:"link-hover",children:e.jsxs(u,{alignment:"center",children:[n?"Show less":"Show more",e.jsx(k,{color:"global-text",icon:n?"expandLess":"expandMore"})]})})]})}),h&&e.jsx(x,{className:"cursor-default interactive",onClick:s=>s.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(E,{children:e.jsx(K,{label:"Mark False Positive",onClick:b})})})})]}),h&&e.jsx(T,{open:g,onClose:S,onConfirm:w,vulnerability:i.name,severity:i.severity,service:a,image:r,errorMessage:p})]})};export{I as K,se as a};
