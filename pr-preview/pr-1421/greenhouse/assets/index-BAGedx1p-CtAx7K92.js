import{u as S,j as e,o as P,c as x,g as F,V as c,d as b,al as q,am as L,an as D,i as K,af as X,ag as G,ah as H,Y as k,ai as M,ak as R,aj as U}from"./App-BQk8RP7q-CnbQkqTu.js";import{G as v}from"./_extensionId._-C6qpIImd.js";import{s as V}from"./IssueTimestamp-LJ96Sk7H-BnG4TUVY.js";import{C as $}from"./IssueCountsPerSeverityLevel-BfkLaxaZ-C4QMKi9f.js";const z=i=>{const s=i.toLowerCase(),a=F(s);return e.jsx(b,{icon:K[s]||"help",color:a})},A=({severity:i})=>z(i),I="Mark as False Positive",Q="Cancel",Y=i=>{if(!i)return;const s=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();return Object.values(U).includes(s)?s:void 0},Z=({open:i,onClose:s,onConfirm:a,vulnerability:d,severity:j,service:f,image:r})=>{const[t,p]=v.useState(""),[o,g]=v.useState(!1),[m,l]=v.useState(""),w=async()=>{if(!t.trim()){l("Description is required");return}l(""),g(!0);try{const n={type:M.FalsePositive,vulnerability:d,service:f,image:r,description:t.trim(),...j&&{severity:Y(j)}};await a(n),p("")}catch(n){console.error("Failed to create remediation:",n)}finally{g(!1)}},y=()=>{p(""),l(""),s()},C=n=>{p(n.target.value),m&&l("")};return e.jsx(X,{title:"Mark as False Positive",open:i,onCancel:y,modalFooter:e.jsx(H,{children:e.jsxs(c,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(k,{onClick:y,label:Q,disabled:o}),e.jsx(k,{onClick:w,label:I,variant:"primary",disabled:o||!t.trim()})]})}),children:e.jsxs(c,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",d]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",f]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",r]}),e.jsx("div",{children:e.jsx(G,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:t,onChange:C,rows:4,required:!0,invalid:!!m,errortext:m||""})})]})})},_=async({apiClient:i,input:s})=>{const a=await i.mutate({mutation:R,variables:{input:s}});if(!a.data?.createRemediation)throw new Error("Failed to create remediation");return a.data.createRemediation},B=i=>`
    border-l-2
    ${F(i.toLowerCase())}
    h-full
    pl-5
  `,ee=({issue:i,service:s,image:a,showFalsePositiveAction:d=!0,onFalsePositiveSuccess:j,onFalsePositiveError:f})=>{const[r,t]=v.useState(!1),[p,o]=v.useState(!1),{needsExpansion:g,textRef:m}=S(i?.description||""),{apiClient:l,queryClient:w}=$({from:"/services/$service"});if(!i||!i.name)return null;const y=u=>{u.preventDefault(),t(!r)},C=()=>{o(!0)},n=async u=>{try{await _({apiClient:l,input:u}),o(!1),w.invalidateQueries({queryKey:["images"]}),w.invalidateQueries({queryKey:["remediations"]});const h=i?.name||"unknown";j?.(h)}catch(h){console.error("Failed to create remediation:",h);const E=i?.name||"unknown";f?.(h instanceof Error?h:new Error("Failed to create remediation"),E)}},N=()=>{o(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:B(i.severity),children:e.jsx(A,{severity:i.severity})})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(c,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(c,{gap:"1.5",alignment:"center",children:[e.jsx(b,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(V,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(c,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:m,className:r?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&g&&e.jsx("a",{href:"#",onClick:y,className:"link-hover",children:e.jsxs(c,{alignment:"center",children:[r?"Show less":"Show more",e.jsx(b,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})]})}),d&&e.jsx(x,{className:"cursor-default interactive",onClick:u=>u.stopPropagation(),children:e.jsx(q,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(L,{children:e.jsx(D,{label:"False-positive",onClick:C})})})})]}),d&&e.jsx(Z,{open:p,onClose:N,onConfirm:n,vulnerability:i.name,severity:i.severity,service:s,image:a})]})};export{A as B,ee as e};
