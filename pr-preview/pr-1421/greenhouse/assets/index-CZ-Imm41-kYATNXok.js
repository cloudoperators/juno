import{u as X,j as e,o as D,c as m,g as F,V as u,d as k,am as P,an as E,ao as K,i as M,af as q,a2 as L,ag as U,ah as G,ai as H,Y as N,aj as O,al as R,ak as V}from"./App-D0qakPoK-HBqtXR5n.js";import{G as o}from"./_extensionId._-C53Sdkf5.js";import{s as $}from"./IssueTimestamp-11SAcU2M-DSJt3Aze.js";import{C as z}from"./IssueCountsPerSeverityLevel-BBMgaNdT-C2FcxF0N.js";const A=i=>{const s=i.toLowerCase(),r=F(s);return e.jsx(k,{icon:M[s]||"help",color:r})},I=({severity:i})=>A(i),Q="Mark as False Positive",Y="Cancel",T=i=>{if(!i)return;const s=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase();return Object.values(V).includes(s)?s:void 0},W=({open:i,onClose:s,onConfirm:r,vulnerability:p,severity:v,service:n,image:j,errorMessage:g})=>{const[t,h]=o.useState(""),[l,x]=o.useState(null),[f,y]=o.useState(!1),[c,d]=o.useState(""),b=async()=>{if(!t.trim()){d("Description is required");return}d(""),y(!0);try{const a={type:O.FalsePositive,vulnerability:p,service:n,image:j,description:t.trim(),...v&&{severity:T(v)},...l&&{expirationDate:l.toISOString()}};await r(a),h(""),x(null)}catch(a){console.error("Failed to create remediation:",a)}finally{y(!1)}},w=()=>{h(""),x(null),d(""),s()},S=a=>{h(a.target.value),c&&d("")};return e.jsx(q,{title:"Mark as False Positive",open:i,onCancel:w,modalFooter:e.jsx(H,{children:e.jsxs(u,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(N,{onClick:w,label:Y,disabled:f}),e.jsx(N,{onClick:b,label:Q,variant:"primary",disabled:f||!t.trim()})]})}),children:e.jsxs(u,{gap:"4",direction:"vertical",children:[g&&e.jsx(L,{text:g,variant:"error"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",p]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",n]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",j]}),e.jsx("div",{children:e.jsx(U,{label:"Expiration Date",value:l??void 0,onChange:a=>x(a?.[0]??null),minDate:"today",helptext:"Optional. When this false positive should no longer be considered valid."})}),e.jsx("div",{children:e.jsx(G,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:t,onChange:S,rows:4,required:!0,invalid:!!c,errortext:c||""})})]})})},_=async({apiClient:i,input:s})=>{const r=await i.mutate({mutation:R,variables:{input:s}});if(!r.data?.createRemediation)throw new Error("Failed to create remediation");return r.data.createRemediation},B=i=>`
    border-l-2
    ${F(i.toLowerCase())}
    h-full
    pl-5
  `,ae=({issue:i,service:s,image:r,showFalsePositiveAction:p=!0,onFalsePositiveSuccess:v})=>{const[n,j]=o.useState(!1),[g,t]=o.useState(!1),[h,l]=o.useState(null),{needsExpansion:x,textRef:f}=X(i?.description||""),{apiClient:y,queryClient:c}=z({from:"/services/$service"});if(!i||!i.name)return null;const d=a=>{a.preventDefault(),j(!n)},b=()=>{t(!0)},w=async a=>{l(null);try{await _({apiClient:y,input:a}),t(!1),c.invalidateQueries({queryKey:["images"]}),c.invalidateQueries({queryKey:["remediations"]});const C=i?.name||"unknown";v?.(C)}catch(C){l(C instanceof Error?C.message:"Failed to create remediation")}},S=()=>{l(null),t(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:B(i.severity),children:e.jsx(I,{severity:i.severity})})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(u,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(k,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx($,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(u,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:f,className:n?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&x&&e.jsx("a",{href:"#",onClick:d,className:"link-hover",children:e.jsxs(u,{alignment:"center",children:[n?"Show less":"Show more",e.jsx(k,{color:"global-text",icon:n?"expandLess":"expandMore"})]})})]})}),p&&e.jsx(m,{className:"cursor-default interactive",onClick:a=>a.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(E,{children:e.jsx(K,{label:"Mark False Positive",onClick:b})})})})]}),p&&e.jsx(W,{open:g,onClose:S,onConfirm:w,vulnerability:i.name,severity:i.severity,service:s,image:r,errorMessage:h})]})};export{I as Q,ae as a};
