import{u as S,j as e,o as E,c as x,g as k,V as l,d as C,U as P,W as V,Z as q,i as D,ai as G,aj as K,ak as L,Y as b,al as U,am as $}from"./App-EQetwAh9-DvJWg9Tw.js";import{G as j}from"./_extensionId._-c8efW6my.js";import{s as R}from"./IssueTimestamp-KM2OGVG8-DTAv-gmw.js";import{C as z}from"./IssueCountsPerSeverityLevel-BaDxAc66-B4_Kx2mv.js";const I=i=>{const a=i.toLowerCase(),r=k(a);return e.jsx(C,{icon:D[a]||"help",color:r})},M=({severity:i})=>I(i),Q="Mark as False Positive",A="Cancel",T=({open:i,onClose:a,onConfirm:r,vulnerability:c,service:v,image:f})=>{const[s,d]=j.useState(""),[g,t]=j.useState(!1),[p,o]=j.useState(""),w=async()=>{if(!s.trim()){o("Description is required");return}o(""),t(!0);try{const n={type:U.FalsePositive,vulnerability:c,service:v,image:f,description:s.trim()};await r(n),d("")}catch(n){console.error("Failed to create remediation:",n)}finally{t(!1)}},m=()=>{d(""),o(""),a()},y=n=>{d(n.target.value),p&&o("")};return e.jsx(G,{title:"Mark as False Positive",open:i,onCancel:m,modalFooter:e.jsx(L,{children:e.jsxs(l,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(b,{onClick:m,label:A,disabled:g}),e.jsx(b,{onClick:w,label:Q,variant:"primary",disabled:g||!s.trim()})]})}),children:e.jsxs(l,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",v]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",f]}),e.jsx("div",{children:e.jsx(K,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:s,onChange:y,rows:4,required:!0,invalid:!!p,errortext:p||""})})]})})},Y=async({apiClient:i,input:a})=>{const r=await i.mutate({mutation:$,variables:{input:a}});if(!r.data?.createRemediation)throw new Error("Failed to create remediation");return r.data.createRemediation},_=i=>`
    border-l-2
    ${k(i.toLowerCase())}
    h-full
    pl-5
  `,O=({issue:i,service:a,image:r,showFalsePositiveAction:c=!0,onFalsePositiveSuccess:v,onFalsePositiveError:f})=>{const[s,d]=j.useState(!1),[g,t]=j.useState(!1),{needsExpansion:p,textRef:o}=S(i?.description||""),{apiClient:w,queryClient:m}=z({from:"/services/$service"});if(!i||!i.name)return null;const y=h=>{h.preventDefault(),d(!s)},n=()=>{t(!0)},F=async h=>{try{await Y({apiClient:w,input:h}),t(!1),m.invalidateQueries({queryKey:["images"]}),m.invalidateQueries({queryKey:["remediations"]});const u=i?.name||"unknown";v?.(u)}catch(u){console.error("Failed to create remediation:",u);const H=i?.name||"unknown";f?.(u instanceof Error?u:new Error("Failed to create remediation"),H)}},N=()=>{t(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx(x,{className:"pl-0",children:e.jsx("div",{className:_(i.severity),children:e.jsx(M,{severity:i.severity})})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:i.name}),i.sourceUrl&&i.sourceUrl!=="-"&&e.jsx("a",{href:i.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(C,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(x,{className:"whitespace-nowrap",children:e.jsx(R,{targetDate:i.earliestTargetRemediationDate})}),e.jsx(x,{children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:s?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:i.description}),i.description&&p&&e.jsx("a",{href:"#",onClick:y,className:"link-hover",children:e.jsxs(l,{alignment:"center",children:[s?"Show less":"Show more",e.jsx(C,{color:"global-text",icon:s?"expandLess":"expandMore"})]})})]})}),c&&e.jsx(x,{className:"cursor-default interactive",onClick:h=>h.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(V,{children:e.jsx(q,{label:"False-positive",onClick:n})})})})]}),c&&e.jsx(T,{open:g,onClose:N,onConfirm:F,vulnerability:i.name,service:a,image:r})]})};export{O as H};
