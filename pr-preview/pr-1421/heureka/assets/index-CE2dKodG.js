import{g as N,j as e,d as b,i as F,af as I,V as c,ag as D,ah as R,Y as S,ai as L,aj as M,ak as V,u as q,o as A,c as u,al as O,am as P,an as z}from"./App-rUQfPDVE.js";import{r as j}from"./index-VGGW3vk0.js";import{I as T}from"./IssueTimestamp-DL6thSJc.js";import{u as U}from"./IssueCountsPerSeverityLevel-CPnDd2IM.js";const _=r=>{const s=r.toLowerCase(),a=N(s);return e.jsx(b,{icon:F[s]||"help",color:a})},B=({severity:r})=>_(r),K="Mark as False Positive",Q="Cancel",Y=r=>{if(!r)return;const a=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase();return Object.values(M).includes(a)?a:void 0},$=({open:r,onClose:s,onConfirm:a,vulnerability:d,severity:v,service:f,image:t})=>{const[i,p]=j.useState(""),[o,C]=j.useState(!1),[m,l]=j.useState(""),w=async()=>{if(!i.trim()){l("Description is required");return}l(""),C(!0);try{const n={type:L.FalsePositive,vulnerability:d,service:f,image:t,description:i.trim(),...v&&{severity:Y(v)}};await a(n),p("")}catch(n){console.error("Failed to create remediation:",n)}finally{C(!1)}},g=()=>{p(""),l(""),s()},y=n=>{p(n.target.value),m&&l("")};return e.jsx(I,{title:"Mark as False Positive",open:r,onCancel:g,modalFooter:e.jsx(R,{children:e.jsxs(c,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(S,{onClick:g,label:Q,disabled:o}),e.jsx(S,{onClick:w,label:K,variant:"primary",disabled:o||!i.trim()})]})}),children:e.jsxs(c,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",d]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",f]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",t]}),e.jsx("div",{children:e.jsx(D,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:i,onChange:y,rows:4,required:!0,invalid:!!m,errortext:m||""})})]})})},X=async({apiClient:r,input:s})=>{const a=await r.mutate({mutation:V,variables:{input:s}});if(!a.data?.createRemediation)throw new Error("Failed to create remediation");return a.data.createRemediation},G=r=>`
    border-l-2
    ${N(r.toLowerCase())}
    h-full
    pl-5
  `,ee=({issue:r,service:s,image:a,showFalsePositiveAction:d=!0,onFalsePositiveSuccess:v,onFalsePositiveError:f})=>{const[t,i]=j.useState(!1),[p,o]=j.useState(!1),{needsExpansion:C,textRef:m}=q(r?.description||""),{apiClient:l,queryClient:w}=U({from:"/services/$service"});if(!r||!r.name)return null;const g=h=>{h.preventDefault(),i(!t)},y=()=>{o(!0)},n=async h=>{try{await X({apiClient:l,input:h}),o(!1),w.invalidateQueries({queryKey:["images"]}),w.invalidateQueries({queryKey:["remediations"]});const x=r?.name||"unknown";v?.(x)}catch(x){console.error("Failed to create remediation:",x);const E=r?.name||"unknown";f?.(x instanceof Error?x:new Error("Failed to create remediation"),E)}},k=()=>{o(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(u,{className:"pl-0",children:e.jsx("div",{className:G(r.severity),children:e.jsx(B,{severity:r.severity})})}),e.jsx(u,{className:"whitespace-nowrap",children:e.jsxs(c,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(c,{gap:"1.5",alignment:"center",children:[e.jsx(b,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(u,{className:"whitespace-nowrap",children:e.jsx(T,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(u,{children:e.jsxs(c,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:m,className:t?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&C&&e.jsx("a",{href:"#",onClick:g,className:"link-hover",children:e.jsxs(c,{alignment:"center",children:[t?"Show less":"Show more",e.jsx(b,{color:"global-text",icon:t?"expandLess":"expandMore"})]})})]})}),d&&e.jsx(u,{className:"cursor-default interactive",onClick:h=>h.stopPropagation(),children:e.jsx(O,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(P,{children:e.jsx(z,{label:"False-positive",onClick:y})})})})]}),d&&e.jsx($,{open:p,onClose:k,onConfirm:n,vulnerability:r.name,severity:r.severity,service:s,image:a})]})};export{ee as I,B as a};
