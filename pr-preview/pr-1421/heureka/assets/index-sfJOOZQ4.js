import{g as N,j as e,d as y,i as F,ai as I,V as l,aj as D,ak as R,Y as b,al as M,am as L,u as V,o as q,c as u,U as P,W as A,Z as O}from"./App-BbqoobHA.js";import{r as j}from"./index-CLcfsAyo.js";import{I as T}from"./IssueTimestamp-DdbnaeP_.js";import{u as U}from"./IssueCountsPerSeverityLevel-CSSUyX9U.js";const _=r=>{const s=r.toLowerCase(),t=N(s);return e.jsx(y,{icon:F[s]||"help",color:t})},z=({severity:r})=>_(r),B="Mark as False Positive",K="Cancel",Q=({open:r,onClose:s,onConfirm:t,vulnerability:c,service:v,image:f})=>{const[a,d]=j.useState(""),[C,i]=j.useState(!1),[p,o]=j.useState(""),w=async()=>{if(!a.trim()){o("Description is required");return}o(""),i(!0);try{const n={type:M.FalsePositive,vulnerability:c,service:v,image:f,description:a.trim()};await t(n),d("")}catch(n){console.error("Failed to create remediation:",n)}finally{i(!1)}},m=()=>{d(""),o(""),s()},g=n=>{d(n.target.value),p&&o("")};return e.jsx(I,{title:"Mark as False Positive",open:r,onCancel:m,modalFooter:e.jsx(R,{children:e.jsxs(l,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(b,{onClick:m,label:K,disabled:C}),e.jsx(b,{onClick:w,label:B,variant:"primary",disabled:C||!a.trim()})]})}),children:e.jsxs(l,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",v]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",f]}),e.jsx("div",{children:e.jsx(D,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:a,onChange:g,rows:4,required:!0,invalid:!!p,errortext:p||""})})]})})},Y=async({apiClient:r,input:s})=>{const t=await r.mutate({mutation:L,variables:{input:s}});if(!t.data?.createRemediation)throw new Error("Failed to create remediation");return t.data.createRemediation},$=r=>`
    border-l-2
    ${N(r.toLowerCase())}
    h-full
    pl-5
  `,H=({issue:r,service:s,image:t,showFalsePositiveAction:c=!0,onFalsePositiveSuccess:v,onFalsePositiveError:f})=>{const[a,d]=j.useState(!1),[C,i]=j.useState(!1),{needsExpansion:p,textRef:o}=V(r?.description||""),{apiClient:w,queryClient:m}=U({from:"/services/$service"});if(!r||!r.name)return null;const g=h=>{h.preventDefault(),d(!a)},n=()=>{i(!0)},k=async h=>{try{await Y({apiClient:w,input:h}),i(!1),m.invalidateQueries({queryKey:["images"]}),m.invalidateQueries({queryKey:["remediations"]});const x=r?.name||"unknown";v?.(x)}catch(x){console.error("Failed to create remediation:",x);const S=r?.name||"unknown";f?.(x instanceof Error?x:new Error("Failed to create remediation"),S)}},E=()=>{i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(q,{children:[e.jsx(u,{className:"pl-0",children:e.jsx("div",{className:$(r.severity),children:e.jsx(z,{severity:r.severity})})}),e.jsx(u,{className:"whitespace-nowrap",children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(y,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(u,{className:"whitespace-nowrap",children:e.jsx(T,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(u,{children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:a?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&p&&e.jsx("a",{href:"#",onClick:g,className:"link-hover",children:e.jsxs(l,{alignment:"center",children:[a?"Show less":"Show more",e.jsx(y,{color:"global-text",icon:a?"expandLess":"expandMore"})]})})]})}),c&&e.jsx(u,{className:"cursor-default interactive",onClick:h=>h.stopPropagation(),children:e.jsx(P,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(A,{children:e.jsx(O,{label:"False-positive",onClick:n})})})})]}),c&&e.jsx(Q,{open:C,onClose:E,onConfirm:k,vulnerability:r.name,service:s,image:t})]})};export{H as I};
