import{g as k,j as e,d as E,i as I,aj as N,V as p,a6 as F,ak as M,al as R,am as L,Y as D,an as V,ao as O,ap as P,u as q,o as A,c as m,Z as z,_ as T,$ as U}from"./App-CC4g3d3p.js";import{r as l}from"./index-B9fEeEr3.js";import{I as _}from"./IssueTimestamp-Gb9m-ugM.js";import{u as $}from"./IssueCountsPerSeverityLevel-L3XVUWb8.js";const B=r=>{const s=r.toLowerCase(),a=k(s);return e.jsx(E,{icon:I[s]||"help",color:a})},K=({severity:r})=>B(r),Q="Mark as False Positive",Y="Cancel",H=r=>{if(!r)return;const a=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase();return Object.values(O).includes(a)?a:void 0},W=({open:r,onClose:s,onConfirm:a,vulnerability:x,severity:j,service:i,image:v,errorMessage:C})=>{const[n,h]=l.useState(""),[o,u]=l.useState(null),[f,g]=l.useState(!1),[c,d]=l.useState(""),b=async()=>{if(!n.trim()){d("Description is required");return}d(""),g(!0);try{const t={type:V.FalsePositive,vulnerability:x,service:i,image:v,description:n.trim(),...j&&{severity:H(j)},...o&&{expirationDate:o.toISOString()}};await a(t),h(""),u(null)}catch(t){console.error("Failed to create remediation:",t)}finally{g(!1)}},y=()=>{h(""),u(null),d(""),s()},S=t=>{h(t.target.value),c&&d("")};return e.jsx(N,{title:"Mark as False Positive",open:r,onCancel:y,modalFooter:e.jsx(L,{children:e.jsxs(p,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(D,{onClick:y,label:Y,disabled:f}),e.jsx(D,{onClick:b,label:Q,variant:"primary",disabled:f||!n.trim()})]})}),children:e.jsxs(p,{gap:"4",direction:"vertical",children:[C&&e.jsx(F,{text:C,variant:"error"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",x]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",i]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",v]}),e.jsx("div",{children:e.jsx(M,{label:"Expiration Date",value:o??void 0,onChange:t=>u(t?.[0]??null),minDate:"today",helptext:"Optional. When this false positive should no longer be considered valid."})}),e.jsx("div",{children:e.jsx(R,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:n,onChange:S,rows:4,required:!0,invalid:!!c,errortext:c||""})})]})})},X=async({apiClient:r,input:s})=>{const a=await r.mutate({mutation:P,variables:{input:s}});if(!a.data?.createRemediation)throw new Error("Failed to create remediation");return a.data.createRemediation},Z=r=>`
    border-l-2
    ${k(r.toLowerCase())}
    h-full
    pl-5
  `,te=({issue:r,service:s,image:a,showFalsePositiveAction:x=!0,onFalsePositiveSuccess:j})=>{const[i,v]=l.useState(!1),[C,n]=l.useState(!1),[h,o]=l.useState(null),{needsExpansion:u,textRef:f}=q(r?.description||""),{apiClient:g,queryClient:c}=$({from:"/services/$service"});if(!r||!r.name)return null;const d=t=>{t.preventDefault(),v(!i)},b=()=>{n(!0)},y=async t=>{o(null);try{await X({apiClient:g,input:t}),n(!1),c.invalidateQueries({queryKey:["images"]}),c.invalidateQueries({queryKey:["remediations"]});const w=r?.name||"unknown";j?.(w)}catch(w){o(w instanceof Error?w.message:"Failed to create remediation")}},S=()=>{o(null),n(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:Z(r.severity),children:e.jsx(K,{severity:r.severity})})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(E,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx(_,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:f,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&u&&e.jsx("a",{href:"#",onClick:d,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(E,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})}),x&&e.jsx(m,{className:"cursor-default interactive",onClick:t=>t.stopPropagation(),children:e.jsx(z,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(T,{children:e.jsx(U,{label:"Mark False Positive",onClick:b})})})})]}),x&&e.jsx(W,{open:C,onClose:S,onConfirm:y,vulnerability:r.name,severity:r.severity,service:s,image:a,errorMessage:h})]})};export{te as I,K as a};
