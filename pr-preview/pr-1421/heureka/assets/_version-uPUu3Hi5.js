import{j as e,V as j,d as u,ab as I,ac as N,ad as D,ae as C,af as E,ag as S,P as b,o as p,n as c,E as V,ah as L,a8 as R,c as m,f as h,ai as v,m as O}from"./App-CC4g3d3p.js";import{r as d}from"./index-B9fEeEr3.js";import{E as f,g as k,L as K,I as P}from"./IssueCountsPerSeverityLevel-L3XVUWb8.js";import{S as F}from"./SectionContentHeading-CfKUwpU0.js";import{I as z}from"./index-BBEeH9Zk.js";import"./IssueTimestamp-Gb9m-ugM.js";const A=({instance:s})=>e.jsxs(I,{className:"text-sm text-theme-light",children:[e.jsxs(j,{children:[e.jsx("div",{className:"text-sm whitespace-nowrap overflow-hidden text-ellipsis w-full",children:s?.pod||"--"}),e.jsxs(N,{triggerEvent:"hover",children:[e.jsx(D,{children:e.jsx(u,{icon:"info",size:"18",className:"cursor-pointer hover:text-theme-primary"})}),e.jsxs(C,{children:[e.jsxs("span",{children:[" Namespace: ",s?.namespace||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Region: ",s?.region||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Cluster: ",s?.cluster||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Container: ",s?.container||"--"]}),e.jsx("br",{}),e.jsxs("span",{children:[" Pod: ",s?.pod||"--"]})]})]})]}),e.jsx("div",{className:"text-sm whitespace-nowrap",children:s?.cluster||"--"})]}),M=s=>{const r={};return s.forEach(i=>{const n=i.namespace||"Unknown",o=i.container||"All";r[n]||(r[n]={}),r[n][o]||(r[n][o]=[]),r[n][o].push(i)}),r},T=({imageVersion:s})=>{const[r,i]=d.useState(!1),n=s.componentInstances||[],o=M(n);d.useEffect(()=>{i(!1)},[s]);const t=l=>{l.preventDefault(),i(!r)};return e.jsxs(e.Fragment,{children:[r&&o&&Object.entries(o).map(([l,a])=>e.jsx("div",{children:Object.entries(a).map(([x,y])=>e.jsxs("div",{className:"my-2",children:[e.jsxs("div",{className:"mb-4",children:["Namespace ",e.jsx("b",{children:l})," - Container ",e.jsx("b",{children:x})]}),e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,_minmax(240px,_1fr))] gap-2",children:y.map((g,w)=>e.jsx(A,{instance:g},g.id||w))})]},`${l}-${x}`))},l)),e.jsx("div",{className:"advance-link",children:e.jsx("a",{href:"#",rel:"noopener noreferrer",onClick:t,children:e.jsxs(j,{alignment:"center",children:[r?"Hide Occurrences":"Display Occurrences",e.jsx(u,{color:"global-text",icon:r?"expandLess":"expandMore"})]})})})]})},H=({issuesPromise:s,service:r,image:i})=>{const{error:n,data:o}=d.use(s),{imageVersion:t}=E(o);return n?e.jsxs(f,{colSpan:4,children:["Error loading vulnerabilities: ",n.message]}):!t||!t.vulnerabilities||t.vulnerabilities.length===0?e.jsx(f,{colSpan:4,children:"No vulnerabilities found! ðŸš€"}):e.jsx(e.Fragment,{children:t.vulnerabilities.map(l=>e.jsx(z,{issue:l,service:r,image:i,showFalsePositiveAction:!1},l.id||l.name))})},$=({issuesPromise:s,service:r,image:i})=>e.jsxs(e.Fragment,{children:[e.jsx(j,{gap:"2",className:"mb-4 mt-8",children:e.jsx(S,{children:"Vulnerabilities"})}),e.jsxs(b,{columns:4,minContentColumns:[0,1,2],cellVerticalAlignment:"top",children:[e.jsxs(p,{children:[e.jsx(c,{children:e.jsx(u,{icon:"monitorHeart"})}),e.jsx(c,{children:"Vulnerability"}),e.jsx(c,{children:"Target Date"}),e.jsx(c,{children:"Description"})]}),s&&e.jsx(V,{displayErrorMessage:!0,fallbackRender:k({colspan:4}),resetKeys:[s],children:e.jsx(d.Suspense,{fallback:e.jsx(K,{colSpan:4}),children:e.jsx(H,{issuesPromise:s,service:r,image:i})})})]})]}),B=({imageVersionsPromise:s,imageVersion:r,service:i,imageRepository:n})=>{const{data:o,error:t}=d.use(s);if(t)return e.jsxs("div",{children:["Error loading image version: ",t.message]});const{imageVersions:l}=L(o),a=l[0];return a?e.jsxs(e.Fragment,{children:[e.jsxs(F,{children:["Image ",a.repository||n," - Version ",R(a.version)]}),e.jsxs(b,{columns:2,gridColumnTemplate:"20% auto",className:"mb-6",children:[e.jsxs(p,{children:[e.jsx(c,{children:"Details"}),e.jsx(m,{children:e.jsxs(j,{gap:"1",direction:"horizontal",wrap:!0,children:[a.tag&&e.jsx(h,{pillKey:"tag",pillKeyLabel:"tag",pillValue:a.tag,pillValueLabel:a.tag}),e.jsx(h,{pillKey:"repository",pillKeyLabel:"repository",pillValue:a.repository||n,pillValueLabel:a.repository||n}),e.jsx(h,{pillKey:"version",pillKeyLabel:"version",pillValue:a.version,pillValueLabel:a.version})]})})]}),e.jsxs(p,{children:[e.jsx(c,{children:"Vulnerabilities Counts"}),e.jsx(m,{children:e.jsx(P,{counts:a.issueCounts})})]}),e.jsxs(p,{children:[e.jsx(c,{className:"whitespace-nowrap",children:`Occurrences (${a.componentInstancesCount||0})`}),e.jsx(m,{children:e.jsx(T,{imageVersion:a})})]})]}),i&&r&&a&&e.jsx($,{issuesPromise:s,service:i,image:a.repository||n})]}):e.jsxs("div",{children:[e.jsxs("p",{children:["Image version not found: ",r]}),e.jsxs("p",{children:["Available versions: ",l.map(x=>x.version).join(", ")||"none"]}),e.jsxs("p",{children:["Data: ",JSON.stringify(o,null,2)]})]})};function Z(){const{imageVersionsPromise:s}=v.useLoaderData(),{service:r,image:i,version:n}=v.useParams();return e.jsx(V,{displayErrorMessage:!0,children:e.jsx(d.Suspense,{fallback:e.jsx(O,{className:"mt-4"}),children:e.jsx(B,{imageVersionsPromise:s,imageVersion:n,service:r,imageRepository:i})})})}export{Z as component};
