import{g as E,j as e,d as y,i as I,ag as N,V as l,ah as k,ai as D,Y as b,aj as R,ak as M,u as L,o as V,c as m,U as q,W as P,Z as A}from"./App-xfI2Ebgt.js";import{r as j}from"./index-65vcCzFS.js";import{I as O}from"./IssueTimestamp-D7okumt5.js";import{u as T}from"./IssueCountsPerSeverityLevel-Bad6Z3EJ.js";const U=r=>{const s=r.toLowerCase(),t=E(s);return e.jsx(y,{icon:I[s]||"help",color:t})},_=({severity:r})=>U(r),z="Mark as False Positive",B="Cancel",K=({open:r,onClose:s,onConfirm:t,vulnerability:c,service:u,image:v})=>{const[a,d]=j.useState(""),[f,n]=j.useState(!1),[p,o]=j.useState(""),C=async()=>{if(!a.trim()){o("Description is required");return}o(""),n(!0);try{const i={type:R.FalsePositive,vulnerability:c,service:u,image:v,description:a.trim()};await t(i),d("")}catch(i){console.error("Failed to create remediation:",i)}finally{n(!1)}},h=()=>{d(""),o(""),s()},g=i=>{d(i.target.value),p&&o("")};return e.jsx(N,{title:"Mark as False Positive",open:r,onCancel:h,modalFooter:e.jsx(D,{children:e.jsxs(l,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(b,{onClick:h,label:B,disabled:f}),e.jsx(b,{onClick:C,label:z,variant:"primary",disabled:f||!a.trim()})]})}),children:e.jsxs(l,{gap:"4",direction:"vertical",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",c]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",u]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",v]}),e.jsx("div",{children:e.jsx(k,{label:"Description *",placeholder:"Add a description explaining why this is a false positive...",value:a,onChange:g,rows:4,required:!0,invalid:!!p,errortext:p||""})})]})})},Q=async({apiClient:r,input:s})=>{const t=await r.mutate({mutation:M,variables:{input:s}});if(!t.data?.createRemediation)throw new Error("Failed to create remediation");return t.data.createRemediation},Y=r=>`
    border-l-2
    ${E(r.toLowerCase())}
    h-full
    pl-5
  `,G=({issue:r,service:s,image:t,showFalsePositiveAction:c=!0,onFalsePositiveSuccess:u,onFalsePositiveError:v})=>{const[a,d]=j.useState(!1),[f,n]=j.useState(!1),{needsExpansion:p,textRef:o}=L(r.description),{apiClient:C,queryClient:h}=T({from:"/services/$service"}),g=x=>{x.preventDefault(),d(!a)},i=()=>{n(!0)},S=async x=>{try{await Q({apiClient:C,input:x}),n(!1),h.invalidateQueries({queryKey:["images"]}),h.invalidateQueries({queryKey:["remediations"]}),u?.()}catch(w){console.error("Failed to create remediation:",w),v?.(w instanceof Error?w:new Error("Failed to create remediation"))}},F=()=>{n(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:Y(r.severity),children:e.jsx(_,{severity:r.severity})})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(l,{gap:"1.5",alignment:"center",children:[e.jsx(y,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx(O,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(l,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:o,className:a?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&p&&e.jsx("a",{href:"#",onClick:g,className:"link-hover",children:e.jsxs(l,{alignment:"center",children:[a?"Show less":"Show more",e.jsx(y,{color:"global-text",icon:a?"expandLess":"expandMore"})]})})]})}),c&&e.jsx(m,{className:"cursor-default interactive",onClick:x=>x.stopPropagation(),children:e.jsx(q,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(P,{children:e.jsx(A,{label:"False-positive",onClick:i})})})})]}),c&&e.jsx(K,{open:f,onClose:F,onConfirm:S,vulnerability:r.name,service:s,image:t})]})};export{G as I};
