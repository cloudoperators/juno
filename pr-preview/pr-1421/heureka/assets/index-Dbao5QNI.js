import{g as k,j as e,d as E,i as I,af as N,V as p,a2 as F,ag as M,ah as R,ai as L,Y as D,aj as V,ak as O,al as P,u as q,o as A,c as m,am as z,an as T,ao as U}from"./App-DSoREZdQ.js";import{r as l}from"./index-CcXZx4YX.js";import{I as _}from"./IssueTimestamp-RMXTj89r.js";import{u as B}from"./IssueCountsPerSeverityLevel-CFi-XCtT.js";const K=r=>{const s=r.toLowerCase(),t=k(s);return e.jsx(E,{icon:I[s]||"help",color:t})},Q=({severity:r})=>K(r),Y="Mark as False Positive",$="Cancel",H=r=>{if(!r)return;const t=r.charAt(0).toUpperCase()+r.slice(1).toLowerCase();return Object.values(O).includes(t)?t:void 0},W=({open:r,onClose:s,onConfirm:t,vulnerability:h,severity:j,service:i,image:v,errorMessage:f})=>{const[n,x]=l.useState(""),[o,u]=l.useState(null),[C,g]=l.useState(!1),[c,d]=l.useState(""),b=async()=>{if(!n.trim()){d("Description is required");return}d(""),g(!0);try{const a={type:V.FalsePositive,vulnerability:h,service:i,image:v,description:n.trim(),...j&&{severity:H(j)},...o&&{expirationDate:o.toISOString()}};await t(a),x(""),u(null)}catch(a){console.error("Failed to create remediation:",a)}finally{g(!1)}},y=()=>{x(""),u(null),d(""),s()},S=a=>{x(a.target.value),c&&d("")};return e.jsx(N,{title:"Mark as False Positive",open:r,onCancel:y,modalFooter:e.jsx(L,{children:e.jsxs(p,{direction:"horizontal",gap:"2",distribution:"end",className:"w-full",children:[e.jsx(D,{onClick:y,label:$,disabled:C}),e.jsx(D,{onClick:b,label:Y,variant:"primary",disabled:C||!n.trim()})]})}),children:e.jsxs(p,{gap:"4",direction:"vertical",children:[f&&e.jsx(F,{text:f,variant:"error"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vulnerability:"})," ",h]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service:"})," ",i]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Image:"})," ",v]}),e.jsx("div",{children:e.jsx(M,{label:"Expiration Date",value:o??void 0,onChange:a=>u(a?.[0]??null),minDate:"today",helptext:"Optional. When this false positive should no longer be considered valid."})}),e.jsx("div",{children:e.jsx(R,{label:"Description",placeholder:"Add a description explaining why this is a false positive...",value:n,onChange:S,rows:4,required:!0,invalid:!!c,errortext:c||""})})]})})},X=async({apiClient:r,input:s})=>{const t=await r.mutate({mutation:P,variables:{input:s}});if(!t.data?.createRemediation)throw new Error("Failed to create remediation");return t.data.createRemediation},G=r=>`
    border-l-2
    ${k(r.toLowerCase())}
    h-full
    pl-5
  `,ae=({issue:r,service:s,image:t,showFalsePositiveAction:h=!0,onFalsePositiveSuccess:j})=>{const[i,v]=l.useState(!1),[f,n]=l.useState(!1),[x,o]=l.useState(null),{needsExpansion:u,textRef:C}=q(r?.description||""),{apiClient:g,queryClient:c}=B({from:"/services/$service"});if(!r||!r.name)return null;const d=a=>{a.preventDefault(),v(!i)},b=()=>{n(!0)},y=async a=>{o(null);try{await X({apiClient:g,input:a}),n(!1),c.invalidateQueries({queryKey:["images"]}),c.invalidateQueries({queryKey:["remediations"]});const w=r?.name||"unknown";j?.(w)}catch(w){o(w instanceof Error?w.message:"Failed to create remediation")}},S=()=>{o(null),n(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(m,{className:"pl-0",children:e.jsx("div",{className:G(r.severity),children:e.jsx(Q,{severity:r.severity})})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:r.name}),r.sourceUrl&&r.sourceUrl!=="-"&&e.jsx("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(p,{gap:"1.5",alignment:"center",children:[e.jsx(E,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Vulnerability source"})]})})]})}),e.jsx(m,{className:"whitespace-nowrap",children:e.jsx(_,{targetDate:r.earliestTargetRemediationDate})}),e.jsx(m,{children:e.jsxs(p,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:C,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:r.description}),r.description&&u&&e.jsx("a",{href:"#",onClick:d,className:"link-hover",children:e.jsxs(p,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(E,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})}),h&&e.jsx(m,{className:"cursor-default interactive",onClick:a=>a.stopPropagation(),children:e.jsx(z,{icon:"moreVert",className:"whitespace-nowrap",children:e.jsx(T,{children:e.jsx(U,{label:"Mark False Positive",onClick:b})})})})]}),h&&e.jsx(W,{open:f,onClose:S,onConfirm:y,vulnerability:r.name,severity:r.severity,service:s,image:t,errorMessage:x})]})};export{ae as I,Q as a};
