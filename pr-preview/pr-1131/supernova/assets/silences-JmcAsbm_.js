import{j as e,C as o,v as r,i as A,K as d,k as F,c as x,u as D,a as H,b as V,d as _,e as k,s as O,H as W,x as v,f as K,r as f,W as P,l as z,h,g as B}from"./App-DdSHVjh8.js";import{r as m}from"./index-B_xNVYjs.js";import{D as N,E as G,R as J,u as M,C as Q,F as $,p as X}from"./FirefoxCorsWarning-CE9pP0AU.js";import"./index-r8wpTUZQ.js";const C=({timestamp:s})=>{let n;s.includes("T")?n=N.fromISO(s):n=N.fromSQL(s);const i=n.toFormat("yyyy-LL-dd HH:mm Z");return e.jsx("div",{children:i})},Z=s=>s.length>40?s.substring(0,40)+"...":s,q=({silence:s},n)=>e.jsxs(o,{children:[e.jsxs(r,{className:"whitespace-nowrap",children:[e.jsx(C,{timestamp:s?.startsAt}),e.jsx(C,{timestamp:s?.endsAt})]}),e.jsxs(r,{className:"overflow-hidden",children:[e.jsx("div",{ref:n,children:s?.comment}),e.jsxs("div",{className:"text-theme-light",children:["Silence ",s.id," created by ",s?.createdBy]}),e.jsx(A,{className:"py-2 px-0",children:e.jsx(d,{gap:"2",alignment:"start",wrap:!0,children:s?.matchers?.map((i,u)=>e.jsx(F,{pillKey:i.name,pillValue:Z(i.value)},u))})})]}),e.jsx(r,{className:"overflow-hidden",children:e.jsx("p",{children:s?.status?.state})}),e.jsx(r,{className:"overflow-hidden",children:s?.status?.state===x.SILENCE_ACTIVE||s?.status?.state===x.SILENCE_PENDING?e.jsx(G,{silence:s}):e.jsx(J,{silence:s})})]}),U=m.forwardRef(q),Y=`
bg-theme-background-lvl-1
py-2
px-4
my-px
`,ee=()=>{const s=D(),n=H(),[i,u]=m.useState(n),j=V(),c=_(),{setSilences:y,setSilencesStatus:I,setSilencesRegEx:g}=k(),{addMessage:E,resetMessages:L}=O(),{data:p,isLoading:w,error:S}=M("silences");S&&(L(),S instanceof Q&&E({variant:"warning",text:e.jsx($,{})}),E({variant:"error",text:X(S)})),m.useEffect(()=>{p&&y({items:p.silences})},[p]),m.useEffect(()=>{let t=n.filter(a=>a?.status?.state===j);try{c&&(t=t.filter(a=>JSON.stringify(a).match(new RegExp(c,"i"))))}catch(a){console.warn("search term is not a valid regex. "+a),t=t.filter(l=>JSON.stringify(l).toLowerCase().includes(c.toLowerCase))}u(t)},[j,c,n]);const b=t=>{const a=setTimeout(()=>{g(t.target.value),s({to:"/silences",search:l=>({...l,silencesRegEx:t.target.value})})},500);return()=>clearTimeout(a)},{scrollListItems:R,iterator:T}=W(i,{loadingObject:e.jsx(o,{children:e.jsx(r,{colSpan:3,children:e.jsxs(d,{gap:"3",alignment:"center",direction:"horizontal",children:["Loading...",e.jsx(v,{})]})})}),refFunction:t=>e.jsx(o,{children:e.jsx(r,{colSpan:3,className:"border-b-0 py-0",children:e.jsx("span",{ref:t})})})});return e.jsx(e.Fragment,{children:w?e.jsxs(d,{gap:"2",children:[e.jsx("span",{children:"Loading"}),e.jsx(v,{variant:"primary"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{direction:"horizontal",className:`${Y}`,children:[e.jsxs(K,{className:"w-3/12",label:"Status",value:j,onChange:t=>{I(t),s({to:"/silences",search:a=>({...a,silencesStatus:t})})},children:[e.jsx(f,{value:x.SILENCE_ACTIVE}),e.jsx(f,{value:x.SILENCE_PENDING}),e.jsx(f,{value:x.SILENCE_EXPIRED})]}),e.jsx(P,{placeholder:"search term or regular expression",className:"ml-auto w-7/12",value:c||"",onChange:t=>{b(t)},onSearch:t=>{g(t),s({to:"/silences",search:a=>({...a,silencesRegEx:t})})},onClear:()=>{g(null),s({to:"/silences",search:t=>{const{silencesRegEx:a,...l}=t;return{...l}}})}})]}),e.jsx(z,{columns:4,minContentColumns:[0,2,3],cellVerticalAlignment:"top",className:"silences ",children:e.jsxs(e.Fragment,{children:[e.jsxs(o,{children:[e.jsx(h,{children:"Time intervall"}),e.jsx(h,{children:"Details"}),e.jsx(h,{children:"State"}),e.jsx(h,{children:"Action"})]}),R?.length?T.map(t=>e.jsx(U,{silence:t},t.id)):e.jsx(o,{children:e.jsx(r,{colSpan:4,children:e.jsxs(d,{gap:"3",children:[e.jsx(B,{icon:"info",color:"text-theme-info"}),e.jsx("div",{children:"We couldn't find any matching silences."})]})})})]})})]})})};function re(){return e.jsx(ee,{})}export{re as component};
