import{j as e,r as g,u as f,b as C,h as A,M as h,f as V,e as E,d as y,A as v,g as b,c as I,U as F,G,a as D,F as $,C as M,E as Z,l as S,N as q,H as K,P as L,X as W,y as P,x as m,o as H,s as x,p as O,S as B,i as U,k as _,m as R}from"./App-BfxVJ-Yq-BZ_yPVwr.js";import{w as n,G as X}from"./index-Ckel8dkJ.js";import{T,p as j,A as J,_ as Q,K as Y,G as ee,i as p}from"./IssueCountsPerSeverityLevel-AhJxusIE-Dzyw4dkA.js";import"./index-BxPbwDfP.js";const se=r=>r.charAt(0).toUpperCase()+r.slice(1),ae=()=>{const r=f(),{queryClient:s,apiClient:a}=T({from:"/services/"}),{service:t}=D({from:"/services/"}),[c,l]=X.useState(void 0),o=t?Y({queryClient:s,apiClient:a,service:t,after:c}):void 0,d=n.useCallback(()=>{r({to:"/services",search:u=>{const{service:pe,...z}=u;return{...z}}})},[r]),i=n.useCallback(u=>{t&&r({to:"/services/$service",params:{service:t},search:{imageVersion:u?.version}})},[r,t]);return e.jsx($,{children:e.jsx(M,{heading:t?`${se(t)} Overview`:void 0,opened:!!t,onClose:d,size:"large",children:e.jsx(Z,{children:t&&o&&e.jsx(ee,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:i,goToPage:l})})})})},w={supportGroups:"support_group",region:"region",integrity:"integrity"},re=({serviceDetails:r})=>{const s=(a,t)=>e.jsx(P,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(h,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(r).map(([a,t])=>Array.isArray(t)?t.map(c=>s(w[a],c)):s(w[a],t))})},te=({item:r,selected:s,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(y,{className:`cursor-pointer ${s?"active":""}`,onClick:a,children:[e.jsx(m,{children:r.name}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:r.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(m,{children:e.jsx(re,{serviceDetails:r.serviceDetails})}),e.jsx(m,{className:"cursor-default interactive",onClick:c=>c.stopPropagation(),children:e.jsx(F,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),N=8,ie=({servicesPromise:r})=>{const s=f(),{service:a}=D({from:"/services/"}),{error:t,data:c}=n.use(r),{services:l}=b(c),o=n.useCallback(i=>{s({to:"/services",search:u=>({...u,service:i.name})})},[]),d=n.useCallback(i=>{s({to:"/services/$service",params:{service:i.name}})},[]);return t?e.jsx(j,{colSpan:N,children:"Error loading services"}):l.length===0?e.jsx(j,{colSpan:N,children:"No service found"}):l.map(i=>e.jsx(te,{item:i,selected:i.name===a,onItemClick:()=>o(i),onServiceDetailClick:()=>d(i)},i.id))},k=8,le=()=>{const{queryClient:r,apiClient:s}=T({from:"/services/"}),{servicesPromise:a,filterSettings:t}=C({from:"/services/"}),[c,l]=n.useState(a),o=n.useCallback(d=>{const i=V({queryClient:r,apiClient:s,filterSettings:t,after:d});l(i)},[l,r,s,t]);return n.useEffect(()=>{l(a)},[l,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(E,{minContentColumns:[1,2,3,4,5,7],columns:k,children:[e.jsxs(y,{children:[e.jsx(v,{children:"Service"}),e.jsx(v,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(v,{children:"Details"}),e.jsx(v,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(j,{colSpan:k,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(ie,{servicesPromise:c})})]}),e.jsx(n.Suspense,{children:e.jsx(J,{dataPromise:c,goToPage:o,dataNormalizationMethod:b})}),e.jsx(ae,{})]})},ne=({servicesPromise:r})=>{const{error:s,data:a}=n.use(r),{servicesIssuesCount:t}=b(a);return e.jsx(h,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(Q,{counts:t})})},ce=()=>{const{servicesPromise:r}=C({from:"/services/"});return e.jsx(h,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(g,{size:"small"}),children:e.jsx(ne,{servicesPromise:r})})})},oe=({filters:r,onChange:s})=>{const[a,t]=n.useState(""),[c,l]=n.useState(""),o=r.find(i=>i.filterName===a)?.values?.filter(i=>i),d=n.useCallback(i=>{l(i),!S.isEmpty(a)&&!S.isEmpty(i)&&s({name:a,value:i}),setTimeout(()=>{l("")},0)},[a,l,s]);return e.jsx(h,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(q,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:i=>{t(String(i))},children:r?.map(({displayName:i,filterName:u})=>e.jsx(K,{value:u,label:i,"data-testid":u},u))}),e.jsx(L,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,disabled:!a,onChange:d,children:o?.map(i=>e.jsx(W,{value:i,label:i,"data-testid":i},i))})]})})},ue=({selectedFilters:r,onDelete:s})=>e.jsx(h,{gap:"2",wrap:!0,children:r?.map(a=>e.jsx(P,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>s(a)},`${name}:${a.value}`))}),me=({filters:r,filterSettings:s,onFilterChange:a,searchInputPlaceholder:t})=>{const c=n.useCallback(l=>{a({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===l.name&&o.value===l.value))})},[s,a]);return e.jsxs(h,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(oe,{filters:r,onChange:l=>{s.selectedFilters?.some(o=>o.name===l.name&&o.value===l.value)||a({...s,selectedFilters:[...s.selectedFilters||[],l]})}}),e.jsx(F,{label:"Clear all",className:"ml-4",onClick:()=>a({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(G,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:l=>{a({...s,searchTerm:l})},onClear:()=>a({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(ue,{selectedFilters:s.selectedFilters,onDelete:c})]})},de=()=>{const r=f(),{filters:s,filterSettings:a}=C({from:"/services/"}),t=n.useCallback(c=>{r({to:"/services",search:{...A(c)}})},[a,r]);return e.jsx(me,{filters:s,filterSettings:a,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},he=()=>e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:[e.jsx(ce,{}),e.jsx(le,{})]})]});H({service:x().optional(),searchTerm:x().optional()}).catchall(O((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(B)))return r},U([x(),_(x()),R()])));const fe=he;export{fe as component};
