import{j as e,r as C,u as b,c as S,i as T,k as v,f as $,e as E,d as F,A as j,g as w,h as I,U as P,G as Z,a as V,F as q,C as G,E as K,l as N,N as L,H as B,P as H,X as M,b as z,y as h,o as O,s as g,p as Q,S as U,m as W,n as X,q as _}from"./App-G6BY77uz-u20npU_1.js";import{w as n,G as Y}from"./index-2ZV7CgxY.js";import{K as A,p as f,H as J,Q as R,$ as ee,_ as se,i as x}from"./IssueCountsPerSeverityLevel-CaOe50Or-BEZGLjeX.js";import"./index-D-g9RX4D.js";const ae=s=>s.charAt(0).toUpperCase()+s.slice(1),re=()=>{const s=b(),{queryClient:a,apiClient:r}=A({from:"/services/"}),{service:i}=V({from:"/services/"}),[l,t]=Y.useState(void 0),d=i?ee({queryClient:a,apiClient:r,service:i,after:l}):void 0,u=n.useCallback(()=>{s({to:"/services",search:m=>{const{service:c,...p}=m;return{...p}}})},[s]),o=n.useCallback(m=>{i&&s({to:"/services/$service",params:{service:i},search:{imageVersion:m==null?void 0:m.version}})},[s,i]);return e.jsx(q,{children:e.jsx(G,{heading:i?`${ae(i)} Overview`:void 0,opened:!!i,onClose:u,size:"large",children:e.jsx(K,{children:i&&d&&e.jsx(se,{displayActions:!0,imageVersionsPromise:d,onDetailsButtonClick:o,goToPage:t})})})})},k={supportGroups:"support_group",region:"region",integrity:"integrity"},ie=({serviceDetails:s})=>{const a=(r,i)=>e.jsx(z,{pillKey:r,pillKeyLabel:r,pillValue:i,pillValueLabel:i},i);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(s).map(([r,i])=>Array.isArray(i)?i.map(l=>a(k[r],l)):a(k[r],i))})},le=({item:s,selected:a,onItemClick:r,onServiceDetailClick:i})=>e.jsxs(F,{className:`cursor-pointer ${a?"active":""}`,onClick:r,children:[e.jsx(h,{children:s.name}),e.jsx(h,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:s.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:s.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:s.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:s.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(h,{className:"items-center",children:e.jsx(x,{showDashIfZero:!0,count:s.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(h,{children:e.jsx(ie,{serviceDetails:s.serviceDetails})}),e.jsx(h,{className:"cursor-default interactive",onClick:l=>l.stopPropagation(),children:e.jsx(P,{label:"Show Details",onClick:i,size:"small",className:"whitespace-nowrap"})})]}),y=8,te=({servicesPromise:s})=>{const a=b(),{service:r}=V({from:"/services/"}),{error:i,data:l}=n.use(s),{services:t}=w(l),d=n.useCallback(o=>{a({to:"/services",search:m=>({...m,service:o.name})})},[]),u=n.useCallback(o=>{a({to:"/services/$service",params:{service:o.name}})},[]);return i?e.jsx(f,{colSpan:y,children:"Error loading services"}):t.length===0?e.jsx(f,{colSpan:y,children:"No service found"}):t.map(o=>e.jsx(le,{item:o,selected:o.name===r,onItemClick:()=>d(o),onServiceDetailClick:()=>u(o)},o.id))},D=8,ne=()=>{const{queryClient:s,apiClient:a}=A({from:"/services/"}),{servicesPromise:r,filterSettings:i}=S({from:"/services/"}),[l,t]=n.useState(r),d=n.useCallback(u=>{const o=$({queryClient:s,apiClient:a,filterSettings:i,after:u});t(o)},[t,s,a,i]);return n.useEffect(()=>{t(r)},[t,r]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(E,{minContentColumns:[1,2,3,4,5,7],columns:D,children:[e.jsxs(F,{children:[e.jsx(j,{children:"Service"}),e.jsx(j,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(j,{children:"Details"}),e.jsx(j,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(f,{colSpan:D,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(C,{variant:"primary"})]})}),children:e.jsx(te,{servicesPromise:l})})]}),e.jsx(n.Suspense,{children:e.jsx(J,{dataPromise:l,goToPage:d,dataNormalizationMethod:w})}),e.jsx(re,{})]})},ce=({servicesPromise:s})=>{const{error:a,data:r}=n.use(s),{servicesIssuesCount:i}=w(r);return e.jsx(v,{gap:"1",children:a?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(R,{counts:i})})},oe=()=>{const{servicesPromise:s}=S({from:"/services/"});return e.jsx(v,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(C,{size:"small"}),children:e.jsx(ce,{servicesPromise:s})})})},ue=({filters:s,onChange:a})=>{var r,i;const[l,t]=n.useState(""),[d,u]=n.useState(""),o=(i=(r=s.find(c=>c.filterName===l))==null?void 0:r.values)==null?void 0:i.filter(c=>c),m=n.useCallback(c=>{u(c),!N.isEmpty(l)&&!N.isEmpty(c)&&a({name:l,value:c}),setTimeout(()=>{u("")},0)},[l,u,a]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(L,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:l,onChange:c=>{t(String(c))},children:s==null?void 0:s.map(({displayName:c,filterName:p})=>e.jsx(B,{value:p,label:c,"data-testid":p},p))}),e.jsx(H,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:d,disabled:!l,onChange:m,children:o==null?void 0:o.map(c=>e.jsx(M,{value:c,label:c,"data-testid":c},c))})]})})},de=({selectedFilters:s,onDelete:a})=>e.jsx(v,{gap:"2",wrap:!0,children:s==null?void 0:s.map(r=>e.jsx(z,{closeable:!0,pillKey:r.name,pillValue:r.value,onClose:()=>a(r)},`${name}:${r.value}`))}),me=({filters:s,filterSettings:a,onFilterChange:r,searchInputPlaceholder:i})=>{const l=n.useCallback(t=>{var d;r({...a,selectedFilters:(d=a.selectedFilters)==null?void 0:d.filter(u=>!(u.name===t.name&&u.value===t.value))})},[a,r]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(ue,{filters:s,onChange:t=>{var d;(d=a.selectedFilters)!=null&&d.some(u=>u.name===t.name&&u.value===t.value)||r({...a,selectedFilters:[...a.selectedFilters||[],t]})}}),e.jsx(P,{label:"Clear all",className:"ml-4",onClick:()=>r({...a,selectedFilters:[]}),variant:"subdued"}),e.jsx(Z,{placeholder:i||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:a.searchTerm,onSearch:t=>{r({...a,searchTerm:t})},onClear:()=>r({...a,searchTerm:""})})]}),a.selectedFilters&&a.selectedFilters.length>0&&e.jsx(de,{selectedFilters:a.selectedFilters,onDelete:l})]})},he=()=>{const s=b(),{filters:a,filterSettings:r}=S({from:"/services/"}),i=n.useCallback(l=>{s({to:"/services",search:{...T(l)}})},[r,s]);return e.jsx(me,{filters:a,filterSettings:r,onFilterChange:i,searchInputPlaceholder:"search term for services name"})},ve=()=>e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(C,{size:"small"})}),children:[e.jsx(oe,{}),e.jsx(ne,{})]})]});O({service:g().optional(),searchTerm:g().optional()}).catchall(Q((s,a)=>{if(!(a.path.length>0&&typeof a.path[0]=="string"&&!a.path[0].startsWith(U)))return s},W([g(),X(g()),_()])));const fe=ve;export{fe as component};
