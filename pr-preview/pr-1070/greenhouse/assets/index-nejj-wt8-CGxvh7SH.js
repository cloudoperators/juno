import{j as e,x as u,b as C,u as f,c as y,a as N,l as k,C as g,h as o,f as d,K as h,g as v,v as c,o as P,p as j,s as p,S as z,d as D,e as U,i as q}from"./App-D6CnX1DN-RZ02rbno.js";import{w as l}from"./index-GaZV-7Ok.js";import{v as E,C as m,P as I,j as M,E as b}from"./CursorPagination-DpSSAZj8-CcBn05Dt.js";import{B as R}from"./IssueTimestamp-BtEGGrBa-COO_f93E.js";import{C as T}from"./index-Dl72gK37-CBy9vTf7.js";import"./index-CbPVk0hP.js";const $=s=>`
    border-l-2
    ${b(s)}
    h-full
    pl-5
  `,A=s=>{const i=s.toLowerCase(),r=b(s),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(d,{icon:n[i]||"help",color:r})},B=({vulnerability:s})=>{const[i,r]=l.useState(!1),{needsExpansion:n,textRef:a}=M(s.description),t=x=>{x.preventDefault(),r(!i)};return e.jsxs(g,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:$(s.severity),children:A(s.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(d,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(R,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:a,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&n&&e.jsx("a",{href:"#",onClick:t,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(d,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},F=({vulnerabilitiesPromise:s})=>{const{error:i,data:r}=l.use(s),{vulnerabilities:n}=v(r);return i?e.jsxs(m,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):n.length===0?e.jsx(m,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(B,{vulnerability:a},a.name))},L=()=>{const{queryClient:s,apiClient:i}=E({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:r,filterSettings:n}=f({from:"/vulnerabilities/"}),[a,t]=l.useState(r),x=l.useCallback(w=>{const S=N({queryClient:s,apiClient:i,filterSettings:n,after:w});t(S)},[t,s,i,n]);return l.useEffect(()=>{t(r)},[t,r]),e.jsxs(e.Fragment,{children:[e.jsxs(k,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(g,{children:[e.jsx(o,{children:e.jsx(d,{icon:"monitorHeart"})}),e.jsx(o,{children:"Vulnerability"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(l.Suspense,{fallback:e.jsx(m,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(u,{variant:"primary"})]})}),children:e.jsx(F,{vulnerabilitiesPromise:a})})]}),e.jsx(l.Suspense,{children:e.jsx(I,{dataPromise:a,goToPage:x,dataNormalizationMethod:v})})]})},_=()=>{const s=C(),{filters:i,filterSettings:r}=f({from:"/vulnerabilities/"}),n=l.useCallback(a=>{s({to:"/vulnerabilities",search:{...y(a)}})},[r,s]);return e.jsx(T,{filters:i,filterSettings:r,onFilterChange:n,searchInputPlaceholder:"search term for vulnerabilities name"})},K=()=>e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(u,{size:"small"})}),children:e.jsx(L,{})})]});P({vulnerability:p().optional(),searchTerm:j(s=>typeof s=="number"?s.toString():s,p().optional())}).catchall(j((s,i)=>{if(!(i.path.length>0&&typeof i.path[0]=="string"&&!i.path[0].startsWith(z)))return s},D([p(),U(p()),q()])));const Q=K;export{Q as component};
