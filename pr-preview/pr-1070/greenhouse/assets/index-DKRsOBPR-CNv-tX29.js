import{j as e,x as u,b as C,u as f,c as y,a as N,l as k,C as g,h as o,f as p,K as h,g as v,v as c,o as P,p as m,s as d,S as z,d as D,e as E,i as U}from"./App-BBLKOFGN-CJj-CNCq.js";import{w as l}from"./index-BCKsL2e2.js";import{v as q,C as j,P as M,j as T,E as b}from"./CursorPagination-XkDB8VaD-VRqGaND-.js";import{B}from"./IssueTimestamp-CtkPEzAm-Dg0KBR_m.js";import{C as F}from"./index-BLWAIXbk-Tiy2APKz.js";import"./index-BhI8EAF-.js";const I=s=>`
    border-l-2
    ${b(s)}
    h-full
    pl-5
  `,L=s=>{const i=s.toLowerCase(),r=b(s),n={critical:"danger",high:"warning",medium:"errorOutline",low:"info",none:"help"};return e.jsx(p,{icon:n[i]||"help",color:r})},V=({vulnerability:s})=>{const[i,r]=l.useState(!1),{needsExpansion:n,textRef:a}=T(s.description),t=x=>{x.preventDefault(),r(!i)};return e.jsxs(g,{children:[e.jsx(c,{className:"pl-0",children:e.jsx("div",{className:I(s.severity),children:L(s.severity)})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{children:s.name}),s.sourceUrl&&s.sourceUrl!=="-"&&e.jsx("a",{href:s.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"link-hover",children:e.jsxs(h,{gap:"1.5",alignment:"center",children:[e.jsx(p,{icon:"openInNew",size:"16"}),e.jsx("span",{children:"Issue source"})]})})]})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx("span",{children:s.servicesCount})}),e.jsx(c,{className:"whitespace-nowrap",children:e.jsx(B,{targetDate:s.earliestTargetRemediationDate})}),e.jsx(c,{children:e.jsxs(h,{gap:"2",direction:"vertical",children:[e.jsx("span",{ref:a,className:i?"":"whitespace-nowrap overflow-hidden text-ellipsis",children:s.description}),s.description&&n&&e.jsx("a",{href:"#",onClick:t,className:"link-hover",children:e.jsxs(h,{alignment:"center",children:[i?"Show less":"Show more",e.jsx(p,{color:"global-text",icon:i?"expandLess":"expandMore"})]})})]})})]})},X=({vulnerabilitiesPromise:s})=>{const{error:i,data:r}=l.use(s),{vulnerabilities:n}=v(r);return i?e.jsxs(j,{colSpan:5,children:["Error loading vulnerabilities: ",i.message]}):n.length===0?e.jsx(j,{colSpan:5,children:"No vulnerabilities found! ðŸš€"}):n.map(a=>e.jsx(V,{vulnerability:a},a.name))},_=()=>{const{queryClient:s,apiClient:i}=q({from:"/vulnerabilities/"}),{vulnerabilitiesPromise:r,filterSettings:n}=f({from:"/vulnerabilities/"}),[a,t]=l.useState(r),x=l.useCallback(S=>{const w=N({queryClient:s,apiClient:i,filterSettings:n,after:S});t(w)},[t,s,i,n]);return l.useEffect(()=>{t(r)},[t,r]),e.jsxs(e.Fragment,{children:[e.jsxs(k,{columns:5,minContentColumns:[0,1,2,3],cellVerticalAlignment:"top",children:[e.jsxs(g,{children:[e.jsx(o,{children:e.jsx(p,{icon:"monitorHeart"})}),e.jsx(o,{children:"Vulnerability"}),e.jsx(o,{children:"Services"}),e.jsx(o,{children:"Target Date"}),e.jsx(o,{children:"Description"})]}),e.jsx(l.Suspense,{fallback:e.jsx(j,{colSpan:5,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading vulnerabilities"}),e.jsx(u,{variant:"primary"})]})}),children:e.jsx(X,{vulnerabilitiesPromise:a})})]}),e.jsx(l.Suspense,{children:e.jsx(M,{dataPromise:a,goToPage:x,dataNormalizationMethod:v})})]})},$=()=>{const s=C(),{filters:i,filterSettings:r}=f({from:"/vulnerabilities/"}),n=l.useCallback(a=>{s({to:"/vulnerabilities",search:{...y(a)}})},[r,s]);return e.jsx(F,{filters:i,filterSettings:r,onFilterChange:n,searchInputPlaceholder:"search term for vulnerabilities name"})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(u,{size:"small"})}),children:e.jsx(_,{})})]});P({vulnerability:d().optional(),searchTerm:m(s=>typeof s=="number"?s.toString():s,d().optional())}).catchall(m((s,i)=>{if(!(i.path.length>0&&typeof i.path[0]=="string"&&!i.path[0].startsWith(z)))return s},D([d(),E(d()),U()])));const G=A;export{G as component};
