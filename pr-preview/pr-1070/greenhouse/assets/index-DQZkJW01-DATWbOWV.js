import{j as e,x as g,u as f,d as C,m as A,K as h,f as V,l as $,C as y,h as v,g as b,i as I,R as D,W as q,a as F,b as Z,c as E,I as K,e as w,H as B,r as L,n as M,o as O,k as P,v as m,p as G,s as x,q as U,S as H,t as R,w as W,y as _}from"./App-Rnpjj2eu-C4DGVtVR.js";import{w as n,G as J}from"./index-DIcGejIK.js";import{K as T,p as j,U as Q,A as X,$ as Y,T as ee,i as p}from"./IssueCountsPerSeverityLevel-xyXnFNhr-B4ys7_wN.js";import"./index-Vzep-Pw6.js";const se=i=>i.charAt(0).toUpperCase()+i.slice(1),ae=()=>{const i=f(),{queryClient:s,apiClient:a}=T({from:"/services/"}),{service:t}=F({from:"/services/"}),[c,l]=J.useState(void 0),o=t?Y({queryClient:s,apiClient:a,service:t,after:c}):void 0,d=n.useCallback(()=>{i({to:"/services",search:u=>{const{service:pe,...z}=u;return{...z}}})},[i]),r=n.useCallback(u=>{t&&i({to:"/services/$service",params:{service:t},search:{imageVersion:u?.version}})},[i,t]);return e.jsx(Z,{children:e.jsx(E,{heading:t?`${se(t)} Overview`:void 0,opened:!!t,onClose:d,size:"large",children:e.jsx(K,{children:t&&o&&e.jsx(ee,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:r,goToPage:l})})})})},S={supportGroups:"support_group",region:"region",integrity:"integrity"},ie=({serviceDetails:i})=>{const s=(a,t)=>e.jsx(P,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(h,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(i).map(([a,t])=>Array.isArray(t)?t.map(c=>s(S[a],c)):s(S[a],t))})},te=({item:i,selected:s,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(y,{className:`cursor-pointer ${s?"active":""}`,onClick:a,children:[e.jsx(m,{children:i.name}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:i.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:i.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:i.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:i.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(p,{showDashIfZero:!0,count:i.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(m,{children:e.jsx(ie,{serviceDetails:i.serviceDetails})}),e.jsx(m,{className:"cursor-default interactive",onClick:c=>c.stopPropagation(),children:e.jsx(D,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),k=8,re=({servicesPromise:i})=>{const s=f(),{service:a}=F({from:"/services/"}),{error:t,data:c}=n.use(i),{services:l}=b(c),o=n.useCallback(r=>{s({to:"/services",search:u=>({...u,service:r.name})})},[]),d=n.useCallback(r=>{s({to:"/services/$service",params:{service:r.name}})},[]);return t?e.jsx(j,{colSpan:k,children:"Error loading services"}):l.length===0?e.jsx(j,{colSpan:k,children:"No service found"}):l.map(r=>e.jsx(te,{item:r,selected:r.name===a,onItemClick:()=>o(r),onServiceDetailClick:()=>d(r)},r.id))},N=8,le=()=>{const{queryClient:i,apiClient:s}=T({from:"/services/"}),{servicesPromise:a,filterSettings:t}=C({from:"/services/"}),[c,l]=n.useState(a),o=n.useCallback(d=>{const r=V({queryClient:i,apiClient:s,filterSettings:t,after:d});l(r)},[l,i,s,t]);return n.useEffect(()=>{l(a)},[l,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs($,{minContentColumns:[1,2,3,4,5,7],columns:N,children:[e.jsxs(y,{children:[e.jsx(v,{children:"Service"}),e.jsx(v,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(v,{children:"Details"}),e.jsx(v,{})]}),e.jsx(n.Suspense,{fallback:e.jsx(j,{colSpan:N,children:e.jsxs(h,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(g,{variant:"primary"})]})}),children:e.jsx(re,{servicesPromise:c})})]}),e.jsx(n.Suspense,{children:e.jsx(Q,{dataPromise:c,goToPage:o,dataNormalizationMethod:b})}),e.jsx(ae,{})]})},ne=({servicesPromise:i})=>{const{error:s,data:a}=n.use(i),{servicesIssuesCount:t}=b(a);return e.jsx(h,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(X,{counts:t})})},ce=()=>{const{servicesPromise:i}=C({from:"/services/"});return e.jsx(h,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(n.Suspense,{fallback:e.jsx(g,{size:"small"}),children:e.jsx(ne,{servicesPromise:i})})})},oe=({filters:i,onChange:s})=>{const[a,t]=n.useState(""),[c,l]=n.useState(""),o=i.find(r=>r.filterName===a)?.values?.filter(r=>r),d=n.useCallback(r=>{l(r),!w.isEmpty(a)&&!w.isEmpty(r)&&s({name:a,value:r}),setTimeout(()=>{l("")},0)},[a,l,s]);return e.jsx(h,{alignment:"center",gap:"8",children:e.jsxs(I,{children:[e.jsx(B,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:r=>{t(String(r))},children:i?.map(({displayName:r,filterName:u})=>e.jsx(L,{value:u,label:r,"data-testid":u},u))}),e.jsx(M,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:c,disabled:!a,onChange:d,children:o?.map(r=>e.jsx(O,{value:r,label:r,"data-testid":r},r))})]})})},ue=({selectedFilters:i,onDelete:s})=>e.jsx(h,{gap:"2",wrap:!0,children:i?.map(a=>e.jsx(P,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>s(a)},`${name}:${a.value}`))}),me=({filters:i,filterSettings:s,onFilterChange:a,searchInputPlaceholder:t})=>{const c=n.useCallback(l=>{a({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===l.name&&o.value===l.value))})},[s,a]);return e.jsxs(h,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(I,{children:[e.jsx(oe,{filters:i,onChange:l=>{s.selectedFilters?.some(o=>o.name===l.name&&o.value===l.value)||a({...s,selectedFilters:[...s.selectedFilters||[],l]})}}),e.jsx(D,{label:"Clear all",className:"ml-4",onClick:()=>a({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(q,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:l=>{a({...s,searchTerm:l})},onClear:()=>a({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(ue,{selectedFilters:s.selectedFilters,onDelete:c})]})},de=()=>{const i=f(),{filters:s,filterSettings:a}=C({from:"/services/"}),t=n.useCallback(c=>{i({to:"/services",search:{...A(c)}})},[a,i]);return e.jsx(me,{filters:s,filterSettings:a,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},he=()=>e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs(n.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(g,{size:"small"})}),children:[e.jsx(ce,{}),e.jsx(le,{})]})]});G({service:x().optional(),searchTerm:x().optional()}).catchall(U((i,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(H)))return i},R([x(),W(x()),_()])));const fe=he;export{fe as component};
