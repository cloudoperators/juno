import{u as g,a as I,j as e,b as L,c as V,I as R,C as P,v as m,R as D,K as v,k,g as C,d as f,f as A,l as z,h as p,x as b,e as S,i as F,H as O,r as $,n as K,o as Z,W as _,m as M,p as U,s as x,q,S as H,t as W,w as G,y as B}from"./App-CF-z39gP.js";import{R as X,a as c}from"./index-ry8huH8S.js";import{u as E,f as J,S as Q,a as h,E as j,C as Y,I as ee}from"./IssueCountsPerSeverityLevel-lsLs-k5H.js";const se=r=>r.charAt(0).toUpperCase()+r.slice(1),ae=()=>{const r=g(),{queryClient:s,apiClient:a}=E({from:"/services/"}),{service:t}=I({from:"/services/"}),[l,i]=X.useState(void 0),o=t?J({queryClient:s,apiClient:a,service:t,after:l}):void 0,u=c.useCallback(()=>{r({to:"/services",search:d=>{const{service:he,...T}=d;return{...T}}})},[r]),n=c.useCallback(d=>{t&&r({to:"/services/$service",params:{service:t},search:{imageVersion:d?.version}})},[r,t]);return e.jsx(L,{children:e.jsx(V,{heading:t?`${se(t)} Overview`:void 0,opened:!!t,onClose:u,size:"large",children:e.jsx(R,{children:t&&o&&e.jsx(Q,{displayActions:!0,imageVersionsPromise:o,onDetailsButtonClick:n,goToPage:i})})})})},y={supportGroups:"support_group",region:"region",integrity:"integrity"},re=({serviceDetails:r})=>{const s=(a,t)=>e.jsx(k,{pillKey:a,pillKeyLabel:a,pillValue:t,pillValueLabel:t},t);return e.jsx(v,{gap:"2",alignment:"start",wrap:!0,children:Object.entries(r).map(([a,t])=>Array.isArray(t)?t.map(l=>s(y[a],l)):s(y[a],t))})},te=({item:r,selected:s,onItemClick:a,onServiceDetailClick:t})=>e.jsxs(P,{className:`cursor-pointer ${s?"active":""}`,onClick:a,children:[e.jsx(m,{children:r.name}),e.jsx(m,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:r.issuesCount.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:r.issuesCount.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:r.issuesCount.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:r.issuesCount.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(m,{className:"items-center",children:e.jsx(h,{showDashIfZero:!0,count:r.issuesCount.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),e.jsx(m,{children:e.jsx(re,{serviceDetails:r.serviceDetails})}),e.jsx(m,{className:"cursor-default interactive",onClick:l=>l.stopPropagation(),children:e.jsx(D,{label:"Show Details",onClick:t,size:"small",className:"whitespace-nowrap"})})]}),N=8,ne=({servicesPromise:r})=>{const s=g(),{service:a}=I({from:"/services/"}),{error:t,data:l}=c.use(r),{services:i}=C(l),o=c.useCallback(n=>{s({to:"/services",search:d=>({...d,service:n.name})})},[]),u=c.useCallback(n=>{s({to:"/services/$service",params:{service:n.name}})},[]);return t?e.jsx(j,{colSpan:N,children:"Error loading services"}):i.length===0?e.jsx(j,{colSpan:N,children:"No service found"}):i.map(n=>e.jsx(te,{item:n,selected:n.name===a,onItemClick:()=>o(n),onServiceDetailClick:()=>u(n)},n.id))},w=8,ie=()=>{const{queryClient:r,apiClient:s}=E({from:"/services/"}),{servicesPromise:a,filterSettings:t}=f({from:"/services/"}),[l,i]=c.useState(a),o=c.useCallback(u=>{const n=A({queryClient:r,apiClient:s,filterSettings:t,after:u});i(n)},[i,r,s,t]);return c.useEffect(()=>{i(a)},[i,a]),e.jsxs("div",{className:"datagrid-hover",children:[e.jsxs(z,{minContentColumns:[1,2,3,4,5,7],columns:w,children:[e.jsxs(P,{children:[e.jsx(p,{children:"Service"}),e.jsx(p,{colSpan:5,className:"whitespace-nowrap",children:"Issue Counts"}),e.jsx(p,{children:"Details"}),e.jsx(p,{})]}),e.jsx(c.Suspense,{fallback:e.jsx(j,{colSpan:w,children:e.jsxs(v,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(b,{variant:"primary"})]})}),children:e.jsx(ne,{servicesPromise:l})})]}),e.jsx(c.Suspense,{children:e.jsx(Y,{dataPromise:l,goToPage:o,dataNormalizationMethod:C})}),e.jsx(ae,{})]})},ce=({servicesPromise:r})=>{const{error:s,data:a}=c.use(r),{servicesIssuesCount:t}=C(a);return e.jsx(v,{gap:"1",children:s?e.jsx("div",{className:"font-bold",children:"All issues: --"}):e.jsx(ee,{counts:t})})},le=()=>{const{servicesPromise:r}=f({from:"/services/"});return e.jsx(v,{className:"bg-theme-background-lvl-1 py-1.5 px-4 my-px text-theme-light",alignment:"center",children:e.jsx(c.Suspense,{fallback:e.jsx(b,{size:"small"}),children:e.jsx(ce,{servicesPromise:r})})})},oe=({filters:r,onChange:s})=>{const[a,t]=c.useState(""),[l,i]=c.useState(""),o=r.find(n=>n.filterName===a)?.values?.filter(n=>n),u=c.useCallback(n=>{i(n),!S.isEmpty(a)&&!S.isEmpty(n)&&s({name:a,value:n}),setTimeout(()=>{i("")},0)},[a,i,s]);return e.jsx(v,{alignment:"center",gap:"8",children:e.jsxs(F,{children:[e.jsx(O,{className:"filter-label-select w-64 mb-0",name:"filter","data-testid":"select-filterValue",label:"Filter",value:a,onChange:n=>{t(String(n))},children:r?.map(({displayName:n,filterName:d})=>e.jsx($,{value:d,label:n,"data-testid":d},d))}),e.jsx(K,{className:"filter-value-select w-64 bg-theme-background-lvl-0",name:"filterValue","data-testid":"combobox-filterValue",value:l,disabled:!a,onChange:u,children:o?.map(n=>e.jsx(Z,{value:n,label:n,"data-testid":n},n))})]})})},ue=({selectedFilters:r,onDelete:s})=>e.jsx(v,{gap:"2",wrap:!0,children:r?.map(a=>e.jsx(k,{closeable:!0,pillKey:a.name,pillValue:a.value,onClose:()=>s(a)},`${name}:${a.value}`))}),de=({filters:r,filterSettings:s,onFilterChange:a,searchInputPlaceholder:t})=>{const l=c.useCallback(i=>{a({...s,selectedFilters:s.selectedFilters?.filter(o=>!(o.name===i.name&&o.value===i.value))})},[s,a]);return e.jsxs(v,{direction:"vertical",gap:"4",className:"bg-theme-background-lvl-1 py-2 px-4 ",children:[e.jsxs(F,{children:[e.jsx(oe,{filters:r,onChange:i=>{s.selectedFilters?.some(u=>u.name===i.name&&u.value===i.value)||a({...s,selectedFilters:[...s.selectedFilters||[],i]})}}),e.jsx(D,{label:"Clear all",className:"ml-4",onClick:()=>a({...s,selectedFilters:[]}),variant:"subdued"}),e.jsx(_,{placeholder:t||"search term for",className:"w-96 ml-auto","data-testid":"searchbar",value:s.searchTerm,onSearch:i=>{a({...s,searchTerm:i})},onClear:()=>a({...s,searchTerm:""})})]}),s.selectedFilters&&s.selectedFilters.length>0&&e.jsx(ue,{selectedFilters:s.selectedFilters,onDelete:l})]})},me=()=>{const r=g(),{filters:s,filterSettings:a}=f({from:"/services/"}),t=c.useCallback(l=>{r({to:"/services",search:{...M(l)}})},[a,r]);return e.jsx(de,{filters:s,filterSettings:a,onFilterChange:t,searchInputPlaceholder:"search term for services name"})},ve=()=>e.jsxs(e.Fragment,{children:[e.jsx(me,{}),e.jsxs(c.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center h-full pt-10",children:e.jsx(b,{size:"small"})}),children:[e.jsx(le,{}),e.jsx(ie,{})]})]});U({service:x().optional(),searchTerm:x().optional()}).catchall(q((r,s)=>{if(!(s.path.length>0&&typeof s.path[0]=="string"&&!s.path[0].startsWith(H)))return r},W([x(),G(x()),B()])));const ge=ve;export{ge as component};
