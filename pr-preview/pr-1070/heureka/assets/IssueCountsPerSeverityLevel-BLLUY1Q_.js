import{V as y,j as e,C as v,v as o,N as S,Q as C,Z as D,A as b,X as E,B as R,K as u,z as k,R as N,Y as z,_ as P,l as Z,h as j,x as L,D as g,$ as f,a0 as O,a1 as V}from"./App-DNB4R_r8.js";import{a as c}from"./index-v_a6IHs6.js";function K(s){return y({...s,select:n=>s.select?s.select(n.context):n.context})}const p=({colSpan:s,children:n})=>e.jsx(v,{children:e.jsx(o,{colSpan:s,children:n})}),B=({children:s})=>e.jsx(S,{className:"my-6",children:s}),F=({imageVersionsPromise:s})=>{const{data:n}=c.use(s),{totalImageVersions:t}=C(n);return t},i=({icon:s,count:n,variant:t,tooltipContent:r,showDashIfZero:a=!1})=>a&&n===0?e.jsx("span",{children:"â€”"}):e.jsxs(D,{triggerEvent:"hover",children:[e.jsx(b,{children:e.jsx(E,{icon:s,text:n>0?n.toString():"0",variant:n>0?t:"default"})}),e.jsx(R,{children:r})]}),M=({version:s,selected:n=!1,displayDetailsButton:t=!0,onItemClick:r,onDetailClick:a})=>e.jsxs(v,{onClick:r,className:`cursor-pointer ${n?"active":""}`,children:[e.jsx(o,{className:"service-image-versions-cell",children:e.jsxs(u,{gap:"1",direction:"vertical",children:[e.jsxs(u,{gap:"0.5",direction:"vertical",children:[e.jsx("span",{children:s.repository}),e.jsx("span",{className:"text-sm text-theme-light",children:s.version})]}),e.jsx(u,{gap:"1",alignment:"center",children:e.jsx("a",{href:`https://${s.ccrn}`,target:"_blank",rel:"noopener noreferrer",className:"hover:underline text-sm",onClick:d=>d.stopPropagation(),children:e.jsxs(u,{gap:"1.5",alignment:"center",children:[e.jsx(k,{icon:"openInNew",size:"16",color:"global-text"}),e.jsx("span",{children:"Image registry"})]})})})]})}),e.jsx(o,{className:"service-image-versions-cell",children:s.tag}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.critical,icon:"danger",variant:"danger",tooltipContent:"Critical Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.high,icon:"warning",variant:"warning",tooltipContent:"High Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.medium,icon:"errorOutline",variant:"warning",tooltipContent:"Medium Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.low,icon:"info",variant:"info",tooltipContent:"Low Issues"})}),e.jsx(o,{className:"items-center",children:e.jsx(i,{showDashIfZero:!0,count:s.issueCounts.none,icon:"help",variant:"default",tooltipContent:"None Issues"})}),t&&e.jsx(o,{children:e.jsx(N,{size:"small",label:"Show Details",onClick:a})})]}),q=({columnSpan:s,selectedImageVersion:n,displayDetailsButton:t,imageVersionsPromise:r,onDetailsButtonClick:a,onImageVersionItemClick:d})=>{const{error:l,data:h}=c.use(r),{imageVersions:m}=C(h);return l?e.jsx(p,{colSpan:s,children:"Error loading image versions."}):m.length===0?e.jsx(p,{colSpan:s,children:"No image version found"}):m.map(x=>e.jsx(M,{version:x,selected:x.version===n,displayDetailsButton:t,onItemClick:()=>{d?.(x)},onDetailClick:w=>{w.stopPropagation(),a?.(x)}},x.version))},U=({dataPromise:s,goToPage:n,dataNormalizationMethod:t})=>{const{data:r}=c.use(s),{pages:a,pageNumber:d}=t(r),l=c.useCallback(h=>{if(h){const m=a[h-2];n(h===1?void 0:m?.after)}},[a,n]);return e.jsx(u,{distribution:"end",className:"mt-4",children:e.jsx(z,{variant:"number",currentPage:d,onPressNext:l,onPressPrevious:l,pages:a.length})})},I=8,T=({imageVersionsPromise:s,selectedImageVersion:n,displayActions:t=!1,onImageVersionItemClick:r,onDetailsButtonClick:a,goToPage:d})=>{const l=t?I:I-1;return e.jsxs(c.Suspense,{children:[e.jsxs(B,{children:["Image Versions",e.jsxs(c.Suspense,{children:["(",e.jsx(F,{imageVersionsPromise:s}),")"]})]}),t&&e.jsx(P,{children:e.jsx(N,{size:"small",onClick:()=>a?.(void 0),className:"whitespace-nowrap",children:"Full Details"})}),e.jsx("div",{className:"datagrid-hover",children:e.jsxs(Z,{columns:l,minContentColumns:[2,3,4,5,6],children:[e.jsxs(v,{children:[e.jsx(j,{children:"Image Repository"}),e.jsx(j,{children:"Tag"}),e.jsx(j,{colSpan:5,children:"Issue Counts"}),t&&e.jsx(j,{})]}),e.jsx(c.Suspense,{fallback:e.jsx(p,{colSpan:l,children:e.jsxs(u,{gap:"2",alignment:"center",children:[e.jsx("div",{children:"Loading"}),e.jsx(L,{variant:"primary"})]})}),children:e.jsx(q,{columnSpan:l,displayDetailsButton:t,imageVersionsPromise:s,selectedImageVersion:n,onDetailsButtonClick:a,onImageVersionItemClick:r})})]})}),e.jsx(c.Suspense,{children:e.jsx(U,{dataNormalizationMethod:C,dataPromise:s,goToPage:d})})]})},$=({queryClient:s,apiClient:n,service:t,after:r})=>s.ensureQueryData({queryKey:["imageVersions",t,r],queryFn:()=>n.query({query:V,variables:{filter:{serviceCcrn:[t]},filterCi:{serviceCcrn:[t]},filterIc:{serviceCcrn:[t]},orderBy:[{by:O.Severity,direction:g.Desc}],orderByCi:[{by:f.Cluster,direction:g.Asc},{by:f.Namespace,direction:g.Asc}],after:r}})}),A=({counts:s})=>s.total===0?e.jsx("div",{children:"No issues found! ðŸš€"}):e.jsxs(u,{gap:"1",children:[e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-bold",children:"All issues:"}),e.jsx("div",{className:"font-bold mr-2",children:s.total})]}),e.jsx(i,{icon:"danger",count:s.critical,variant:s.critical>0?"danger":"default",tooltipContent:"Critical Issues"}),e.jsx(i,{icon:"warning",count:s.high,variant:s.high>0?"warning":"default",tooltipContent:"High Issues"}),e.jsx(i,{icon:"errorOutline",count:s.medium,variant:s.medium>0?"warning":"default",tooltipContent:"Medium Issues"}),e.jsx(i,{icon:"info",count:s.low,variant:s.low>0?"info":"default",tooltipContent:"Low Issues"}),e.jsx(i,{icon:"help",count:s.none,variant:"default",tooltipContent:"None Issues"})]});export{U as C,p as E,A as I,T as S,i as a,B as b,$ as f,K as u};
