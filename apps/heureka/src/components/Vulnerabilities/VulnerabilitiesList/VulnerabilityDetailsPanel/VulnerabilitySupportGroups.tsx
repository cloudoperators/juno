/*
 * SPDX-FileCopyrightText: 2024 SAP SE or an SAP affiliate company and Juno contributors
 * SPDX-License-Identifier: Apache-2.0
 */

import React, { Suspense, use } from "react"
import { Stack, Pill, Spinner } from "@cloudoperators/juno-ui-components"
import { Vulnerability } from "../../utils"
import { ApolloQueryResult } from "@apollo/client"
import { GetVulnerabilitiesQuery } from "../../../../generated/graphql"
import { getNormalizedVulnerabilitiesResponse } from "../../utils"

type VulnerabilitySupportGroupsProps = {
  vulnerabilitiesPromise: Promise<ApolloQueryResult<GetVulnerabilitiesQuery>>
  vulnerabilityName: string
}

export const VulnerabilitySupportGroups = ({
  vulnerabilitiesPromise,
  vulnerabilityName,
}: VulnerabilitySupportGroupsProps) => {
  const { data } = use(vulnerabilitiesPromise)
  const { vulnerabilities } = getNormalizedVulnerabilitiesResponse(data)
  const vulnerabilityData = vulnerabilities.find((vuln: Vulnerability) => vuln.name === vulnerabilityName)

  if (!vulnerabilityData) {
    return null
  }

  return (
    <Stack gap="1" direction="horizontal" wrap>
      <Suspense
        fallback={
          <Stack gap="2" alignment="center">
            <div>Loading</div>
            <Spinner variant="primary"></Spinner>
          </Stack>
        }
      >
        {vulnerabilityData.supportGroups?.map((group: string) => (
          <Pill key={group} pillValue={group} pillValueLabel={group} />
        ))}
      </Suspense>
    </Stack>
  )
}
